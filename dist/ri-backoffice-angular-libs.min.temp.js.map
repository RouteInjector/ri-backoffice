{"version":3,"sources":["ri-backoffice-angular-libs.js"],"names":["root","factory","define","amd","module","exports","safeAccess","this","helper","obj","tokens","ctx","fnArgs","length","currentToken","isUndefined","isNull","isTokenFunctionCall","isFunction","isArray","slice","isTokenArrayAccess","parseInt","substr","a","Array","token","test","tokenize","str","split","filter","t","access","accessStr","bind","funcArgs","prototype","call","arguments","mod","CodeMirror","place","options","copyObj","defaults","setGuttersForLineNumbers","doc","value","Doc","mode","display","Display","wrapper","updateGutters","themeChanged","lineWrapping","className","autofocus","mobile","focusInput","state","keyMaps","overlays","modeGen","overwrite","focused","suppressEdits","pasteIncoming","cutIncoming","draggingText","highlight","Delayed","keySeq","ie","ie_version","setTimeout","resetInput","registerEventHandlers","ensureGlobalHandlers","startOperation","curOp","forceUpdate","attachDoc","activeElt","input","onFocus","onBlur","opt","optionHandlers","hasOwnProperty","Init","maybeUpdateLineNumberWidth","i","initHooks","endOperation","d","elt","webkit","style","width","setAttribute","ios","border","inputDiv","scrollbarH","scrollbarV","scrollbarFiller","gutterFiller","lineDiv","selectionDiv","cursorDiv","measure","lineMeasure","lineSpace","mover","sizer","heightForcer","scrollerCutOff","gutters","lineGutter","scroller","zIndex","paddingRight","draggable","khtml","height","position","minHeight","minWidth","appendChild","viewFrom","viewTo","first","view","externalMeasured","viewOffset","lastWrapHeight","lastWrapWidth","updateLineNumbers","lineNumWidth","lineNumInnerWidth","lineNumChars","prevInput","alignWidgets","pollingFast","poll","cachedCharWidth","cachedTextHeight","cachedPaddingH","inaccurateSelection","maxLine","maxLineLength","maxLineChanged","wheelDX","wheelDY","wheelStartX","wheelStartY","shift","selForContextMenu","loadMode","cm","getMode","modeOption","resetModeState","iter","line","stateAfter","styles","frontier","startWorker","regChange","wrappingChanged","addClass","rmClass","findMaxLine","estimateLineHeights","clearCaches","updateScrollbars","estimateHeight","th","textHeight","wrapping","perLine","Math","max","clientWidth","charWidth","lineIsHidden","widgetsHeight","widgets","ceil","text","est","estHeight","updateLineHeight","replace","theme","guttersChanged","alignHorizontally","specs","removeChildren","gutterClass","gElt","updateGutterSpace","offsetWidth","marginLeft","left","fixedGutter","lineLength","merged","len","cur","collapsedSpanAtStart","found","find","from","ch","to","collapsedSpanAtEnd","getLine","indexOf","lineNumbers","concat","splice","hScrollbarTakesSpace","clientHeight","measureForScrollbars","scroll","barHeight","scrollWidth","barWidth","docHeight","round","paddingVert","sWidth","scrollbarWidth","scrollHeight","needsH","needsV","bottom","firstChild","right","coverGutterNextToScrollbar","checkedOverlayScrollbar","w","mac","mac_geMountainLion","barMouseDown","e","e_target","operation","onMouseDown","on","visibleLines","viewport","top","scrollTop","floor","paddingTop","lineAtHeight","ensure","ensureFrom","ensureTo","heightAtLine","min","lastLine","comp","compensateForHScroll","scrollLeft","gutterW","hidden","gutter","align","alignable","j","last","lineNumberFor","size","innerW","padding","String","lineNumberFormatter","firstLineNumber","getBoundingClientRect","DisplayUpdate","force","visible","editorIsHidden","wrapperHeight","wrapperWidth","oldViewFrom","oldViewTo","oldScrollerWidth","dims","getDimensions","updateDisplayIfNeeded","update","resetView","countDirtyView","end","viewportMargin","sawCollapsedSpans","visualLineNo","visualLineEndNo","different","adjustView","toUpdate","patchDisplay","offsetHeight","focus","postUpdateDisplay","updateHeightsInViewport","barMeasure","updateSelection","setDocumentHeight","signalLater","updateDisplaySimple","checkForWebkitWidthBug","prevBottom","offsetTop","bot","node","box","diff","updateWidgetHeight","rest","gutterLeft","clientLeft","n","nextSibling","offsetLeft","fixedPos","gutterTotalWidth","gutterWidth","updateNumbersFrom","rm","next","currentWheelTarget","parentNode","removeChild","container","lineN","lineView","updateNumber","lineNumber","changes","updateLineForChanges","document","createTextNode","buildLineElement","insertBefore","type","updateLineText","updateLineGutter","updateLineClasses","updateLineWidgets","ensureLineWrapped","replaceChild","updateLineBackground","cls","bgClass","background","wrap","getLineContent","ext","built","buildLineContent","pre","textClass","wrapClass","markers","gutterMarkers","gutterWrap","k","id","insertLineWidgets","insertLineWidgetsFor","allowAbove","ws","widget","handleMouseEvents","ignoreEvents","positionLineWidget","above","noHScroll","push","coverGutter","paddingLeft","copyPos","x","Pos","maxPos","b","cmp","minPos","Selection","ranges","primIndex","Range","anchor","head","normalizeSelection","prim","sort","prev","inv","empty","simpleSelection","clipLine","clipPos","pos","clipToLen","linelen","isLine","l","clipPosArray","array","out","extendRange","range","other","extend","posBefore","extendSelection","setSelection","sel","primary","extendSelections","heads","newSel","replaceOneSelection","setSimpleSelection","filterSelectionChange","signal","setSelectionReplaceHistory","done","history","lst","setSelectionNoUndo","addSelectionToHistory","NaN","hasHandler","bias","setSelectionInner","skipAtomicInSelection","ensureCursorVisible","equals","updateInput","selectionChanged","signalCursorActivity","reCheckSelection","sel_dontScroll","mayClear","newAnchor","skipAtomic","newHead","flipped","curPos","dir","cantEdit","search","markedSpans","sp","m","marker","inclusiveLeft","inclusiveRight","explicitlyCleared","atomic","newPos","drawSelection","result","curFragment","cursors","createDocumentFragment","selFragment","selection","collapsed","showCursorWhenSelecting","drawSelectionCursor","drawSelectionRange","moveInputWithCursor","headPos","cursorCoords","wrapOff","lineOff","teTop","teLeft","showSelection","drawn","removeChildrenAndAdd","output","singleCursorHeightPerLine","cursor","cursorHeight","otherCursor","add","fragment","rightSide","drawForLine","fromArg","toArg","coords","charCoords","lineObj","start","lineLen","iterateBidiSections","getOrder","rightPos","leftPos","tmp","leftSide","paddingH","sFrom","sTo","fromLine","toLine","singleVLine","visualLine","leftEnd","rightStart","restartBlink","clearInterval","blinker","visibility","cursorBlinkRate","setInterval","time","startState","set","highlightWorker","Date","workTime","copyState","getStateBefore","changedLines","oldStyles","highlighted","highlightLine","oldCls","styleClasses","newCls","classes","ischange","processLine","workDelay","runInOp","regLineChange","findStartLine","precise","minindent","minline","lim","innerMode","indented","countColumn","tabSize","save","window","getComputedStyle","currentStyle","data","isNaN","ensureLineHeights","rect","curWidth","heights","rects","getClientRects","abs","mapFromLineView","map","cache","maps","caches","lineNo","before","updateExternalMeasurement","LineView","measureChar","measureCharPrepared","prepareMeasureForLine","findViewForLine","findViewIndex","info","hasHeights","prepared","varHeight","key","measureCharInner","bogus","rtop","rbottom","collapse","mStart","mEnd","insertLeft","nodeType","isExtendingChar","charAt","nullRect","maybeUpdateRectForZooming","rSpan","rbot","mid","screen","logicalXDPI","deviceXDPI","hasBadZoomedRects","scaleX","scaleY","logicalYDPI","deviceYDPI","clearLineMeasurementCacheFor","clearLineMeasurementCache","externalMeasure","pageScrollX","pageXOffset","documentElement","body","pageScrollY","pageYOffset","intoCoordSystem","context","widgetHeight","yOff","lOff","xOff","fromCoordSystem","localBox","lineSpaceBox","preparedMeasure","get","getBidi","partPos","part","order","level","bidiLeft","bidiRight","getBidiPartAt","val","bidiOther","estimateCoords","PosWithInfo","outside","xRel","coordsChar","y","coordsCharInner","mergedPos","getX","wrongLine","innerOff","adjust","bidi","dist","lineLeft","lineRight","fromX","fromOutside","toX","toOutside","moveVisually","xDiff","step","middle","middleX","measureText","viewChanged","startHeight","typing","changeObjs","cursorActivityHandlers","cursorActivityCalled","updateMaxLine","scrollToPos","nextOpId","operationGroup","ops","ownsGroup","delayedCallbacks","fireCallbacksForOps","group","callbacks","op","endOperations","endOperation_R1","endOperation_W1","endOperation_R2","endOperation_W2","endOperation_finish","mustUpdate","updatedDisplay","adjustWidthTo","maxScrollLeft","newSelectionNodes","setScrollLeft","forceScroll","scrollPosIntoView","margin","isCursor","maybeScrollWindow","maybeHiddenMarkers","unhidden","maybeUnhiddenMarkers","lines","f","apply","methodOp","docMethodOp","visualLineContinued","buildViewArray","nextPos","lendiff","cut","viewCuttingPoint","index","cutTop","cutBot","arr","oldN","newN","dirty","slowPoll","pollInterval","readInput","fastPoll","p","changed","missed","hasSelection","isReadOnly","disableInput","fakedLastChar","substring","somethingSelected","inputHasSelection","withOp","charCodeAt","same","inserted","textLines","splitLines","multiPaste","lastCopied","join","changeEvent","origin","makeChange","electricChars","smartIndent","getModeAt","changeEnd","indentLine","electricInput","minimal","selected","hasCopyEvent","getSelection","content","selectInput","readOnly","ensureFocus","reFocus","drag_","signalDOMEvent","e_stop","prepareCopyCut","getSelections","lineRange","getRange","setSelections","posFromMouse","clickInGutter","eventInWidget","e_preventDefault","word","findWordAt","captureRightClick","onContextMenu","setScrollTop","onScrollWheel","onKeyUp","onKeyDown","onKeyPress","dragDrop","onDragStart","onDrop","lastMiddleDown","selectionStart","selectionEnd","blur","onResize","setSize","liberal","forRect","target","space","clientX","clientY","colDiff","shiftKey","e_button","leftButtonDown","now","lastDoubleClick","lastClick","modifier","metaKey","ctrlKey","dragAndDrop","contains","leftButtonStartDrag","leftButtonSelect","dragEnd","e2","off","addNew","extendTo","lastPos","startCol","posCol","findColumn","startSel","ourIndex","scrollIntoView","oldRange","ourRange","sel_mouse","curCount","counter","editorSize","Infinity","move","up","lastSelOrigin","altKey","gutterEvent","prevent","signalfn","mX","mY","lineBox","e_defaultPrevented","g","childNodes","lastDrop","files","dataTransfer","FileReader","File","read","loadFile","file","reader","onload","change","readAsText","getData","listSelections","replaceRange","replaceSelection","setData","setDragImage","safari","img","src","presto","_top","gecko","isScroller","dx","wheelDeltaX","dy","wheelDeltaY","detail","axis","HORIZONTAL_AXIS","VERTICAL_AXIS","wheelDelta","outer","wheelPixelsPerUnit","pixels","wheelSamples","movedX","movedY","sample","doHandleBinding","bound","dropShift","commands","prevShift","Pass","lookupKeyForEditor","name","handle","lookupKey","extraKeys","keyMap","dispatchKey","seq","isModifierKey","stopSeq","handleKeyBinding","keyName","motion","handleCharBinding","keyCode","returnValue","code","handled","lastStoppedKey","showCrossHair","charCode","which","fromCharCode","prepareSelectAllHack","extval","rehide","cssText","oldCSS","scrollPos","selectAll","detectingSelectAll","contextMenuInGutter","reset","resetSelectionOnContextMenu","oldScrollY","scrollY","scrollTo","clearTimeout","mouseup","adjustForChange","computeSelAfterChange","offsetPos","old","nw","computeReplacedSel","hint","oldPrev","newPrev","filterChange","canceled","cancel","undefined","ignoreReadOnly","sawReadOnlySpans","removeReadOnlyRanges","makeChangeInner","selAfter","addChangeToHistory","makeChangeSingleDoc","stretchSpansOverChange","rebased","linkedDocs","sharedHist","rebaseHist","makeChangeFromHistory","allowSelectionOnly","event","hist","source","undone","dest","lastOrigin","pop","pushSelectionToHistory","clearRedo","antiChanges","generation","maxGeneration","historyChangeFromChange","after","mergeOldSpans","shiftDoc","distance","spans","removed","getBetween","makeChangeSingleDocInEditor","updateDoc","recomputeMaxLength","checkWidthStart","isWholeLineUpdate","changesHandler","changeHandler","doScroll","innerHeight","phantom","scrollNode","limit","endCoords","calculateScrollPos","startTop","startLeft","x1","y1","x2","y2","snapMargin","screentop","docBottom","atTop","atBottom","newTop","screenleft","screenw","tooWide","addToScrollPos","resolveScrollToPos","getCursor","cursorScrollMargin","sPos","how","aggressive","indent","curSpace","indentation","curSpaceString","match","indentUnit","indentString","indentWithTabs","spaceStr","changeLine","changeType","no","deleteNearSelection","compute","kill","toKill","replaced","findPosH","unit","visually","findNextLine","possible","moveOnce","boundToLine","moveLogically","origDir","sawType","getHelper","isWordChar","hitSide","findPosV","pageSize","option","deflt","notOnInit","normalizeKeyName","alt","ctrl","cmd","parts","Error","getKeyMap","markText","shared","markTextShared","TextMarker","clearWhenEmpty","replacedWith","widgetNode","conflictingCollapsedRange","addToHistory","curLine","addMarkedSpan","MarkedSpan","clearOnEnter","clear","clearHistory","nextMarkerId","title","startStyle","endStyle","cloneNode","linked","isParent","SharedTextMarker","findSharedMarkers","findMarks","parent","copySharedMarkers","mFrom","mTo","subMark","detachSharedMarkers","subMarker","getMarkedSpanFor","span","removeMarkedSpan","r","attachLine","markedSpansBefore","startCh","isInsert","startsBefore","endsAfter","markedSpansAfter","endCh","oldFirst","oldLast","sameLine","offset","clearEmptySpans","newMarkers","gapMarkers","gap","getOldSpans","stretched","oldCur","stretchCur","mark","mk","newParts","dfrom","dto","detachMarkedSpans","detachLine","attachMarkedSpans","extraLeft","extraRight","compareCollapsedMarkers","lenDiff","aPos","bPos","fromCmp","toCmp","collapsedSpanAtSide","sps","vis","lineIsHiddenInner","adjustScrollWhenAboveVisible","parentStyle","getGutterElement","addLineWidget","LineWidget","insertAt","aboveVisible","updateLine","cleanUpLine","extractLineClasses","lineClass","prop","RegExp","callBlankLine","blankLine","inner","readToken","stream","takeToken","asArray","getObj","copy","string","current","StringStream","eol","runMode","lineClasses","forceToEnd","flattenSpans","curStart","curStyle","addModeClass","maxHighlightLength","mName","st","o","overlay","at","i_end","opaque","getLineStyles","updateFrontier","startAt","interpretTokenStyle","styleToClassCacheWithMode","styleToClassCache","builder","col","addToken","buildToken","getOption","buildTokenSplitSpaces","hasBadBidiRects","buildTokenBadBidi","allowFrontierUpdate","insertLineContent","joinClasses","zeroWidthElement","lastChild","defaultSpecialCharPlaceholder","toString","special","specialChars","mustWrap","lastIndex","exec","skipped","txt","tabWidth","specialCharPlaceholder","fullStyle","buildCollapsedSpan","ignoreWidget","allText","spanStyle","spanEndStyle","spanStartStyle","nextChange","foundBookmarks","upto","tokenText","wholeLineUpdateBefore","spansFor","firstLine","lastText","lastSpans","nlines","added","Line","remove","insert","LeafChunk","BranchChunk","children","chunkSize","sharedHistOnly","propagate","skip","rel","chunk","child","sz","getLines","h","lh","bidiOrdering","History","startGen","undoDepth","lastModTime","lastSelTime","lastOp","lastSelOp","histChange","attachLocalSpans","clearSelectionEvents","lastChangeEvent","opId","historyEventDelay","selectionEventCanBeMerged","existing","removeClearedSpans","copyHistoryArray","events","newGroup","instantiateSel","deepCopy","newChanges","Number","rebaseHistSelSingle","rebaseHistArray","sub","ok","copied","defaultPrevented","srcElement","button","emitter","bnd","args","_handlers","list","orphanDelayedCallbacks","fireOrphanDelayed","delayed","override","preventDefault","codemirrorIgnore","cursorActivity","eventMixin","ctor","goal","nextTab","spaceStrs","createObj","base","props","inst","Object","create","isWordCharBasic","isEmpty","extendingChars","tag","createElement","count","activeElement","classTest","as","forEachCodeMirror","getElementsByClassName","byClass","globalsRegistered","registerGlobalHandlers","resizeTimer","knownScrollbarWidth","zwspSupported","badBidiRects","r0","r1","badZoomedRects","normal","fromRange","lineStart","visual","lineEnd","lineStartSmart","firstNonWS","inWS","compareBidiLevel","linedir","moveInLine","byUnit","navigator","userAgent","ie_upto10","ie_11up","documentMode","qtwebkit","chrome","vendor","platform","windows","presto_version","flipCtrlCmd","cmpPos","here","there","constructor","setOption","getDoc","addKeyMap","removeKeyMap","addOverlay","spec","modeSpec","removeOverlay","indentSelection","newRanges","getTokenAt","getLineTokens","getTokenTypeAt","getHelpers","helpers","help","helperType","_global","pred","getStateAfter","defaultTextHeight","defaultCharWidth","setGutterMarker","gutterID","clearGutter","removeLineWidget","lineInfo","getViewport","addWidget","vert","horiz","vspace","hspace","triggerOnKeyDown","triggerOnKeyPress","triggerOnKeyUp","execCommand","amount","moveH","extendSelectionsBy","rtlMoveVisually","sel_move","deleteH","goalColumn","moveV","goals","startChar","check","toggleOverwrite","hasFocus","getScrollInfo","co","interpret","refresh","oldHeight","swapDoc","getInputField","getWrapperElement","getScrollerElement","setValue","detach","attach","integer","disabled","tabIndex","modes","mimeModes","defineMode","dependencies","defineMIME","mime","resolveMode","mfactory","modeObj","modeExtensions","exts","modeProps","skipToEnd","extendMode","properties","defineExtension","func","defineDocExtension","defineOption","defineInitHook","registerHelper","registerGlobalHelper","predicate","nstate","a1","a2","singleSelection","killLine","deleteLine","delLineLeft","delWrappedLineLeft","delWrappedLineRight","undo","redo","undoSelection","redoSelection","goDocStart","goDocEnd","goLineStart","goLineStartSmart","goLineEnd","goLineRight","goLineLeft","goLineLeftSmart","goLineUp","goLineDown","goPageUp","goPageDown","goCharLeft","goCharRight","goColumnLeft","goColumnRight","goWordLeft","goGroupRight","goGroupLeft","goWordRight","delCharBefore","delCharAfter","delWordBefore","delWordAfter","delGroupBefore","delGroupAfter","indentAuto","indentMore","indentLess","insertTab","insertSoftTab","spaces","replaceSelections","defaultTab","transposeChars","newlineAndIndent","basic","Left","Right","Up","Down","End","Home","PageUp","PageDown","Delete","Backspace","Shift-Backspace","Tab","Shift-Tab","Enter","Insert","Esc","pcDefault","Ctrl-A","Ctrl-D","Ctrl-Z","Shift-Ctrl-Z","Ctrl-Y","Ctrl-Home","Ctrl-End","Ctrl-Up","Ctrl-Down","Ctrl-Left","Ctrl-Right","Alt-Left","Alt-Right","Ctrl-Backspace","Ctrl-Delete","Ctrl-S","Ctrl-F","Ctrl-G","Shift-Ctrl-G","Shift-Ctrl-F","Shift-Ctrl-R","Ctrl-[","Ctrl-]","Ctrl-U","Shift-Ctrl-U","Alt-U","fallthrough","emacsy","Ctrl-B","Ctrl-P","Ctrl-N","Alt-F","Alt-B","Ctrl-E","Ctrl-V","Shift-Ctrl-V","Ctrl-H","Alt-D","Alt-Backspace","Ctrl-K","Ctrl-T","macDefault","Cmd-A","Cmd-D","Cmd-Z","Shift-Cmd-Z","Cmd-Y","Cmd-Home","Cmd-Up","Cmd-End","Cmd-Down","Cmd-Left","Cmd-Right","Ctrl-Alt-Backspace","Alt-Delete","Cmd-S","Cmd-F","Cmd-G","Shift-Cmd-G","Cmd-Alt-F","Shift-Cmd-Alt-F","Cmd-[","Cmd-]","Cmd-Backspace","Cmd-Delete","Cmd-U","Shift-Cmd-U","normalizeKeyMap","keymap","keyname","keys","keyNames","noShift","altGraphKey","fromTextArea","textarea","getValue","tabindex","placeholder","getAttribute","form","leaveSubmitMethodAlone","realSubmit","submit","wrappedSubmit","getTextArea","toTextArea","lastColumnPos","lastColumnValue","sol","peek","eat","eatWhile","eatSpace","skipTo","backUp","column","pattern","consume","caseInsensitive","cased","toLowerCase","hideFirstChars","side","dHeight","oldH","removeInner","insertInner","iterN","spilled","newleaf","maybeSpill","me","sibling","myIndex","used","nextDocId","cleanGeneration","lineSep","getLineHandle","getLineNumber","getLineHandleVisualStart","lineCount","setCursor","addSelection","dup","setExtending","getExtending","historySize","markClean","changeGeneration","forceSplit","isClean","gen","getHistory","setHistory","histData","addLineClass","where","removeLineClass","setBookmark","realOpts","findMarksAt","getAllMarks","posFromIndex","indexFromPos","copyHistory","linkedDoc","unlinkDoc","link","splitIds","iterLinkedDocs","getEditor","eachLine","dontDelegate","method","e_stopPropagation","stopPropagation","cancelBubble","addEventListener","attachEvent","removeEventListener","detachEvent","ms","startIndex","startValue","select","_e","nonASCIISingleCaseWordChar","toUpperCase","createRange","setEnd","setStart","createTextRange","moveToElementText","moveEnd","moveStart","div","nl","rt","te","ownerDocument","parentElement","compareEndPoints","oncopy","3","8","9","13","16","17","18","19","20","27","32","33","34","35","36","37","38","39","40","44","45","46","59","61","91","92","93","107","109","127","173","186","187","188","189","190","191","192","219","220","221","222","63232","63233","63234","63235","63272","63273","63275","63276","63277","63302","charType","lowTypes","arabicTypes","BidiSpan","bidiRE","isNeutral","isStrong","countsAsLeft","countsAsNum","outerType","types","nstart","unshift","version","require","findMatchingBracket","strict","config","matching","scanForBracket","forward","maxScanLen","maxScanLineLength","maxScanLines","stack","re","bracketRegex","matchBrackets","autoclear","maxHighlightLen","maxHighlightLineLength","marks","ie_lt8","doMatchBrackets","currentlyHighlighted","(",")","[","]","{","}","doFold","allowFolded","finder","minSize","__isFold","cleared","myWidget","makeWidget","myRange","editorOptions","foldOptions","defaultOptions","newFoldFunction","rangeFinder","toggleFold","foldCode","fold","unfold","foldAll","unfoldAll","funcs","auto","minFoldSize","scanUp","State","parseOptions","opts","indicatorOpen","indicatorFolded","isFolded","updateFoldInfo","foldGutter","updateInViewport","vp","onGutterClick","onChange","changeUpdate","foldOnChangeTimeSpan","onViewportChange","updateViewportTimeSpan","onFold","findOpening","openCh","pass","lineText","lastIndexOf","tokenType","startToken","endToken","nextOpen","nextClose","hasImport","semi","has","hasInclude","jQuery","$","paletteTemplate","color","html","tiny","tinycolor","c","toHsl","formattedString","preferredFormat","swatchStyle","rgbaSupport","toRgbString","toFilter","append","attr","noColorSelectedText","hideAll","spectrums","hide","instanceOptions","callbackContext","defaultOpts","show","beforeShow","spectrum","element","applyOptions","showPaletteOnly","showPalette","toggleButton","togglePaletteMoreText","togglePaletteLessText","palette","paletteArray","paletteLookup","rgb","toggleClass","flat","showInput","showAlpha","allowEmpty","showButtons","togglePaletteOnly","showInitial","containerClassName","reflow","initialize","paletteElementClick","ignore","closest","updateOriginalInput","hideAfterPaletteSelect","IE","shouldReplace","boundElement","replacer","clearButton","appendTo","updateSelectionPaletteFromStorage","offsetElement","toggle","is","disable","click","textInput","setFromTextInput","keydown","cancelButton","cancelText","revert","clearText","chooseButton","chooseText","trigger","isValid","css","pickerContainer","outerWidth","alphaSlider","dragX","dragY","currentAlpha","alphaWidth","dragStart","dragStop","slider","currentHue","parseFloat","slideHeight","dragger","shiftMovementDirection","oldDragX","currentSaturation","dragWidth","oldDragY","dragHeight","currentValue","furtherFromX","setSaturation","initialColor","updateUI","currentPreferredFormat","format","addColorToSelectionPalette","paletteEvent","paletteContainer","delegate","initialColorContainer","localStorageKey","localStorage","oldPalette","each","selectionPalette","showSelectionPalette","inArray","maxSelectionSize","getUniqueSelectionPalette","unique","reverse","drawPalette","currentColor","drawInitial","initial","colorOnShow","isDragging","draggingClass","removeClass","Event","isDefaultPrevented","onkeydown","clickout","resize","clickoutFiresChange","unbind","ignoreFormatChange","newColor","newHsv","toHsv","s","v","getFormat","fromRatio","hasClass","updateHelperLocations","flatColor","toHexString","realColor","displayColor","previewElement","realHex","realRgb","alpha","toRgb","realAlpha","gradient","alphaSliderInner","gradientType","alphaSlideHelper","slideHelper","dragHelper","dragHelperHeight","alphaX","alphaSlideHelperWidth","slideY","slideHelperHeight","fireCallback","hasChanged","isInput","slideWidth","getOffset","destroy","spect","optionName","optionValue","enable","setOffset","coord","throttle","markup","isInputTypeColor","inputTypeColorSupport","replaceInput","replacerClassName","picker","extraY","dpWidth","dpHeight","outerHeight","inputHeight","docElem","viewWidth","viewHeight","noop","onmove","onstart","onstop","dragging","stop","t0","originalEvent","touches","pageX","pageY","maxWidth","maxHeight","hasTouch","rightclick","duringDragEvents","wait","debounce","timeout","throttler","fn","elem","backgroundColor","gradientFix","dataID","extra","removeData","load","loadOpts","_cachedResult","colorInput","localization","palettes","processNativeColorInputs","colorInputs","inputToRGB","stringInputToObject","rgbToRgb","convertToPercentage","hsvToRgb","hslToRgb","boundAlpha","mathMin","mathMax","bound01","rgbToHsl","hue2rgb","q","rgbToHsv","math","rgbToHex","allow3Char","hex","pad2","mathRound","rgbaToHex","convertDecimalToHex","desaturate","hsl","clamp01","saturate","greyscale","lighten","brighten","darken","spin","hue","complement","triad","tetrad","splitcomplement","analogous","results","slices","ret","monochromatic","hsv","modification","flip","isOnePointZero","processPercent","isPercentage","parseIntFromHex","convertHexToDecimal","trimLeft","trimRight","named","names","matchers","rgba","hsla","hsva","hex8","hex6","hex3","tinyCounter","mathRandom","random","_originalInput","_r","_g","_b","_a","_roundA","_format","_gradientType","_ok","_tc_id","isDark","getBrightness","isLight","getOriginalInput","getAlpha","setAlpha","toHsvString","toHslString","toHex","toHex8","toHex8String","toPercentageRgb","toPercentageRgbString","toName","hexNames","secondColor","hex8String","secondHex8String","formatSet","hasAlpha","needsAlphaFormat","_applyModification","_applyCombination","color1","color2","mix","w1","rgb1","rgb2","w2","readability","c1","c2","brightnessA","brightnessB","colorDiff","brightness","isReadable","mostReadable","baseColor","colorList","bestColor","bestScore","bestIsReadable","readable","score","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","burntsienna","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","CSS_INTEGER","CSS_NUMBER","CSS_UNIT","PERMISSIVE_MATCH3","PERMISSIVE_MATCH4","angular","run","$templateCache","put","directive","$http","$routeParams","models","common","selectCache","restrict","scope","attrs","ngModel","getDocumentById","modelId","query","getModel","$eval","ref","getDocument","shard","isValidObjectID","displayField","idSelect","regex","$or","forDisplay","$regex","$options","schema","forID","dependsOn","model","userq","response","searchRes","present","some","userShard","actualShard","getField","elements","$watch","newValue","searchEnabled","printSelectedElement","selectDisplayField","selectIdField","$on","console","log","raw","$select","modalController","$scope","$modalInstance","configs","modelName","fromSchema","action","innerForm","processForm","getShard","submitForm","$broadcast","$valid","postDocument","status","close","putDocument","alert","dismiss","$inject","$rootScope","$modal","open","modalInstance","templateUrl","controller","resolve","then","schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider","select2","stdFormObj","path","lookup","stringify","object","addMapping","createDirective","setMap","forEach","titleMap","dynMap","dynmap","dynEnum","dynenum","res","resultMap","number","modelDate","$render","$viewValue","updateDate","$setViewValue","mixed","dateFormat","$timeout","onFileSelect","$files","myFiles","getModelConfig","fieldName","uploadImage","arrayIndex","defaultImage","filename","getImageUrl","url","image","imageExists","downloadImage","deleteImage","newImageInjector","pathArray","imageinjector","uploadFile","defaultImageForFile","getFileUrl","fileExists","deleteFile","fileinjector","combine","brace","constant","uiCodemirrorConfig","priority","compile","iElement","iAttrs","codeMirror","initialTextValue","codemirror","uiCodemirror","uiCodemirrorOpts","tagName","cm_el","codemirrorDefaultsKeys","newValues","oldValue","isObject","$formatters","JSON","safeViewValue","instance","$apply","parsed","parse","uiRefresh","newVal","oldVal","callback","onLoad","$emit","params","function","onClick","rows","timeMinutes","timeSeconds","newval","seconds","convertToMap","error","addStringToMap","exists","grouping","separator","lock","availableElems","enum","item","getTitle","splitted","prettifyTitle","refreshData","hasAngularVariable","deAngularizeUrl","elems","getAngularVariables","choices","multiselect","items","enumUrl","locked","limitToOptions","minValue","maxValue","iconOn","iconOff","$window","defaultConf","plugins","toolbar1","image_advtab","forced_root_block","autoresize_min_height","autoresize_max_height","fullscreen_new_window","skin_url","fullscreen_settings","theme_advanced_path_location","paste_preprocess","pl","tinyvision","ensureInstance","tinyInstance","tinymce","init","selector","setup","editor","getContent","$root","$$phase","contentAreaContainer","riTinymce","PluginManager","pluginUrl","self","win","WINDOW_HEIGHT","WINDOW_BODY","WINDOW_WIDTH","skinUrl","styleSheetHref","styleSheets","styleSheetsLength","href","getEl","$$childTail","getCompleteSelected","populateField","field","openWindow","fieldId","fieldValue","parentWin","windowManager","buttons","subtype","onclick","getElementById","settings","taka","injector","invoke","$compile","$targetDom","_id","$digest","addCommand","file_browser_callback","pathStack","findByPath","galleryGetByPath","setSelected","openUploadModal","pathstack","galleryDeleteByPath","loginProvider","success","getUser","user","dropletint","allowedExtensions","setRequestHeaders","Authorization","defineHTTPSuccess","setRequestUrl","finally","wysiwyg","tinymceOptions","punchCardTemplate","plural","singular","template","days","hours","description","flatten","JsonHuman","makePrefixer","prefix","sn","scn","linkNode","HYPERLINK_CLASS_NAME","getType","BOOL","STRING","INT","FLOAT","FUNCTION","ARRAY","OBJECT","SPECIAL_OBJECT","UNK","parentKey","keyNode","valNode","childs","tr","hyperlinksEnabled","aTarget","hyperlinkKeys","isSpecial","boolOpt","bool","showImage","BOOL_IMAGE","true","false","showText","BOOL_TRUE_CLASS_NAME","BOOL_FALSE_CLASS_NAME","STRING_EMPTY_CLASS_NAME","STRING_CLASS_NAME","INT_CLASS_NAME","FLOAT_CLASS_NAME","hyperlinks","OBJ_KEY_CLASS_NAME","OBJ_VAL_CLASS_NAME","OBJ_EMPTY_CLASS_NAME","OBJECT_CLASS_NAME","FUNCTION_CLASS_NAME","showArrayIndices","showArrayIndex","ARRAY_KEY_CLASS_NAME","ARRAY_VAL_CLASS_NAME","ARRAY_CLASS_NAME","ARRAY_EMPTY_CLASS_NAME","UNKNOWN_CLASS_NAME","validateOptions","prefixer","validateArrayIndexOption","validateHyperlinkOptions","validateBoolOptions","boolOptions","process","message","messages","emit","cleanup","warning","getMessage","flash","processData","patchXHR","fnName","newFn","XMLHttpRequest","redefineProp","xhr","defineProperty","FileAPI","shouldLoad","FormData","forceLoad","initializeUploadListener","__listeners","upload","origAddEventListener","orig","__url","__origError","__fileApiXHR","getResponseHeader","getAllResponseHeaders","abort","header","Function","__requestHeaders","__isFileAPIShim","formData","jsonp","complete","err","fileApiXHR","__completed","loaded","__loaded","total","__total","lengthComputable","loadend","statusText","resp","responseText","onreadystatechange","progress","_this","noContentTimeout","headers","hasFlash","__isFileAPIBlobShim","Blob","isInputTypeFile","fo","ActiveXObject","mimeTypes","offsetParent","html5","jsUrl","basePath","script","allScripts","getElementsByTagName","jsPath","staticPath","ngfFixIE","createFileElemFn","bindAttr","changeFn","makeFlashInput","$$ngfRefElem","fileElem","evt","fileApiChangeFn","getFiles","__files_","disableFileInput","loadStarted","listeners","dispatchEvent","onabort","onerror","onloadstart","onloadend","onprogress","constructEvent","listener","readAsArrayBuffer","readAsBinaryString","readAsDataURL","setRequestHeader","ngFileUpload","service","$q","sendHttp","deferred","defer","promise","__setXHR_","__XHR","xhrFn","notify","progressFunc","reject","origXhrFn","addFieldToFormData","isDate","toISOString","isString","sendFieldsAs","transformRequest","allFields","fields","formDataAppender","fileFormName","fileFormDataName","isFileFormNameString","fileName","http","ArrayBuffer","linkFileSelect","$parse","isUpdating","fileList","rejFiles","validate","updateModel","ngfChange","ngfSelect","bindAttrToFileInput","ngfMultiple","ngfCapture","accept","attributes","attribute","createFileInput","resetOnClick","replaceWith","resetModel","clickHandler","clickAndAssign","ngfResetOnClick","ngfResetModelOnClick","shouldClickLater","ua","globStringToRegex","ngfAccept","$file","$event","fileSizeMax","ngfMaxSize","fileSizeMin","ngfMinSize","regexp","fileChange","noDelay","ngfKeep","prevFiles","$modelValue","ngfKeepDistinct","assign","ngModelRejected","$rejectedFiles","linkDrop","$location","calculateDragOverClass","accepted","kind","clazz","ngfDragOverClass","delay","dragOverDelay","extractFiles","allowDir","multiple","addFile","traverseFileTree","entry","isDirectory","filePath","dirReader","createReader","entries","processing","readEntries","protocol","webkitGetAsEntry","getAsFile","delays","waitForProcess","available","dropAvailable","ngfHideOnDropNotAvailable","ngfDrop","actualDragOverClass","leaveTimeout","ngfStopPropagation","effectAllowed","dropEffect","ngfAllowDir","ngfDropAvailable","ngfSrc","URL","webkitURL","createObjectURL","fileReader","ngfDefaultSrc"],"mappings":"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","file":"ri-backoffice-angular-libs.min.temp.js","sourcesContent":["(function (root, factory) {\n  if(typeof define === \"function\" && define.amd) {\n    define(factory);\n  } else if(typeof module === \"object\" && module.exports) {\n    module.exports = factory();\n  } else {\n    root.safeAccess = factory();\n  }\n}(this, function() {\n\n  return function access(obj, accessStr) {\n    // auto-curry here\n    if (isUndefined(accessStr)) {\n      return access.bind(null, obj);\n    }\n\n    var funcArgs = Array.prototype.slice.call(arguments, 2);\n    return helper(obj, tokenize(accessStr), null, funcArgs);\n  };\n\n  function helper(obj, tokens, ctx, fnArgs) {\n    if (tokens.length === 0) {\n      return obj;\n    }\n\n    var currentToken = tokens[0];\n\n    if (isUndefined(obj) || isNull(obj) ||\n        (isTokenFunctionCall(currentToken) && !isFunction(obj))) {\n      return undefined;\n    }\n\n    if (isTokenFunctionCall(currentToken)) {\n\n      return helper(obj[isArray(fnArgs[0]) ? 'apply' : 'call'](ctx, fnArgs[0]),\n          tokens.slice(1),\n          // clear context because consecutive fn calls execute in global context\n          // e.g. `a.b()()`\n          null,\n          fnArgs.slice(1));\n\n    } else if (isTokenArrayAccess(currentToken)) {\n\n      return helper(obj[parseInt(currentToken.substr(1), 10)],\n          tokens.slice(1),\n          // lookahead two tokens for function calls\n          isTokenFunctionCall(tokens[1]) ? obj : ctx,\n          fnArgs);\n\n    } else {\n\n      return helper(obj[currentToken],\n          tokens.slice(1),\n          // lookahead two tokens for function calls\n          isTokenFunctionCall(tokens[1]) ? obj : ctx,\n          fnArgs);\n\n    }\n  }\n\n  function isUndefined(a) {\n    return a === void 0;\n  }\n\n  function isNull(a) {\n    return a === null;\n  }\n\n  function isArray(a) {\n    return Array.isArray(a);\n  }\n\n  function isFunction(a) {\n    return typeof a === 'function';\n  }\n\n  function isTokenFunctionCall(token) {\n    return token === '()';\n  }\n\n  function isTokenArrayAccess(token) {\n    return /^\\[\\d+\\]$/.test(token);\n  }\n\n  function tokenize(str) {\n    return str.split(/\\.|(\\(\\))|(\\[\\d+?])/).filter(function(t) { return t; });\n  }\n\n}));\n\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: http://codemirror.net/LICENSE\n\n// This is CodeMirror (http://codemirror.net), a code editor\n// implemented in JavaScript on top of the browser's DOM.\n//\n// You can find some technical background for some of the code below\n// at http://marijnhaverbeke.nl/blog/#cm-internals .\n\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    module.exports = mod();\n  else if (typeof define == \"function\" && define.amd) // AMD\n    return define([], mod);\n  else // Plain browser env\n    this.CodeMirror = mod();\n})(function() {\n  \"use strict\";\n\n  // BROWSER SNIFFING\n\n  // Kludges for bugs and behavior differences that can't be feature\n  // detected are enabled based on userAgent etc sniffing.\n\n  var gecko = /gecko\\/\\d/i.test(navigator.userAgent);\n  // ie_uptoN means Internet Explorer version N or lower\n  var ie_upto10 = /MSIE \\d/.test(navigator.userAgent);\n  var ie_11up = /Trident\\/(?:[7-9]|\\d{2,})\\..*rv:(\\d+)/.exec(navigator.userAgent);\n  var ie = ie_upto10 || ie_11up;\n  var ie_version = ie && (ie_upto10 ? document.documentMode || 6 : ie_11up[1]);\n  var webkit = /WebKit\\//.test(navigator.userAgent);\n  var qtwebkit = webkit && /Qt\\/\\d+\\.\\d+/.test(navigator.userAgent);\n  var chrome = /Chrome\\//.test(navigator.userAgent);\n  var presto = /Opera\\//.test(navigator.userAgent);\n  var safari = /Apple Computer/.test(navigator.vendor);\n  var khtml = /KHTML\\//.test(navigator.userAgent);\n  var mac_geMountainLion = /Mac OS X 1\\d\\D([8-9]|\\d\\d)\\D/.test(navigator.userAgent);\n  var phantom = /PhantomJS/.test(navigator.userAgent);\n\n  var ios = /AppleWebKit/.test(navigator.userAgent) && /Mobile\\/\\w+/.test(navigator.userAgent);\n  // This is woefully incomplete. Suggestions for alternative methods welcome.\n  var mobile = ios || /Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent);\n  var mac = ios || /Mac/.test(navigator.platform);\n  var windows = /win/i.test(navigator.platform);\n\n  var presto_version = presto && navigator.userAgent.match(/Version\\/(\\d*\\.\\d*)/);\n  if (presto_version) presto_version = Number(presto_version[1]);\n  if (presto_version && presto_version >= 15) { presto = false; webkit = true; }\n  // Some browsers use the wrong event properties to signal cmd/ctrl on OS X\n  var flipCtrlCmd = mac && (qtwebkit || presto && (presto_version == null || presto_version < 12.11));\n  var captureRightClick = gecko || (ie && ie_version >= 9);\n\n  // Optimize some code when these features are not used.\n  var sawReadOnlySpans = false, sawCollapsedSpans = false;\n\n  // EDITOR CONSTRUCTOR\n\n  // A CodeMirror instance represents an editor. This is the object\n  // that user code is usually dealing with.\n\n  function CodeMirror(place, options) {\n    if (!(this instanceof CodeMirror)) return new CodeMirror(place, options);\n\n    this.options = options = options ? copyObj(options) : {};\n    // Determine effective options based on given values and defaults.\n    copyObj(defaults, options, false);\n    setGuttersForLineNumbers(options);\n\n    var doc = options.value;\n    if (typeof doc == \"string\") doc = new Doc(doc, options.mode);\n    this.doc = doc;\n\n    var display = this.display = new Display(place, doc);\n    display.wrapper.CodeMirror = this;\n    updateGutters(this);\n    themeChanged(this);\n    if (options.lineWrapping)\n      this.display.wrapper.className += \" CodeMirror-wrap\";\n    if (options.autofocus && !mobile) focusInput(this);\n\n    this.state = {\n      keyMaps: [],  // stores maps added by addKeyMap\n      overlays: [], // highlighting overlays, as added by addOverlay\n      modeGen: 0,   // bumped when mode/overlay changes, used to invalidate highlighting info\n      overwrite: false, focused: false,\n      suppressEdits: false, // used to disable editing during key handlers when in readOnly mode\n      pasteIncoming: false, cutIncoming: false, // help recognize paste/cut edits in readInput\n      draggingText: false,\n      highlight: new Delayed(), // stores highlight worker timeout\n      keySeq: null  // Unfinished key sequence\n    };\n\n    // Override magic textarea content restore that IE sometimes does\n    // on our hidden textarea on reload\n    if (ie && ie_version < 11) setTimeout(bind(resetInput, this, true), 20);\n\n    registerEventHandlers(this);\n    ensureGlobalHandlers();\n\n    startOperation(this);\n    this.curOp.forceUpdate = true;\n    attachDoc(this, doc);\n\n    if ((options.autofocus && !mobile) || activeElt() == display.input)\n      setTimeout(bind(onFocus, this), 20);\n    else\n      onBlur(this);\n\n    for (var opt in optionHandlers) if (optionHandlers.hasOwnProperty(opt))\n      optionHandlers[opt](this, options[opt], Init);\n    maybeUpdateLineNumberWidth(this);\n    for (var i = 0; i < initHooks.length; ++i) initHooks[i](this);\n    endOperation(this);\n  }\n\n  // DISPLAY CONSTRUCTOR\n\n  // The display handles the DOM integration, both for input reading\n  // and content drawing. It holds references to DOM nodes and\n  // display-related state.\n\n  function Display(place, doc) {\n    var d = this;\n\n    // The semihidden textarea that is focused when the editor is\n    // focused, and receives input.\n    var input = d.input = elt(\"textarea\", null, null, \"position: absolute; padding: 0; width: 1px; height: 1em; outline: none\");\n    // The textarea is kept positioned near the cursor to prevent the\n    // fact that it'll be scrolled into view on input from scrolling\n    // our fake cursor out of view. On webkit, when wrap=off, paste is\n    // very slow. So make the area wide instead.\n    if (webkit) input.style.width = \"1000px\";\n    else input.setAttribute(\"wrap\", \"off\");\n    // If border: 0; -- iOS fails to open keyboard (issue #1287)\n    if (ios) input.style.border = \"1px solid black\";\n    input.setAttribute(\"autocorrect\", \"off\"); input.setAttribute(\"autocapitalize\", \"off\"); input.setAttribute(\"spellcheck\", \"false\");\n\n    // Wraps and hides input textarea\n    d.inputDiv = elt(\"div\", [input], null, \"overflow: hidden; position: relative; width: 3px; height: 0px;\");\n    // The fake scrollbar elements.\n    d.scrollbarH = elt(\"div\", [elt(\"div\", null, null, \"height: 100%; min-height: 1px\")], \"CodeMirror-hscrollbar\");\n    d.scrollbarV = elt(\"div\", [elt(\"div\", null, null, \"min-width: 1px\")], \"CodeMirror-vscrollbar\");\n    // Covers bottom-right square when both scrollbars are present.\n    d.scrollbarFiller = elt(\"div\", null, \"CodeMirror-scrollbar-filler\");\n    // Covers bottom of gutter when coverGutterNextToScrollbar is on\n    // and h scrollbar is present.\n    d.gutterFiller = elt(\"div\", null, \"CodeMirror-gutter-filler\");\n    // Will contain the actual code, positioned to cover the viewport.\n    d.lineDiv = elt(\"div\", null, \"CodeMirror-code\");\n    // Elements are added to these to represent selection and cursors.\n    d.selectionDiv = elt(\"div\", null, null, \"position: relative; z-index: 1\");\n    d.cursorDiv = elt(\"div\", null, \"CodeMirror-cursors\");\n    // A visibility: hidden element used to find the size of things.\n    d.measure = elt(\"div\", null, \"CodeMirror-measure\");\n    // When lines outside of the viewport are measured, they are drawn in this.\n    d.lineMeasure = elt(\"div\", null, \"CodeMirror-measure\");\n    // Wraps everything that needs to exist inside the vertically-padded coordinate system\n    d.lineSpace = elt(\"div\", [d.measure, d.lineMeasure, d.selectionDiv, d.cursorDiv, d.lineDiv],\n                      null, \"position: relative; outline: none\");\n    // Moved around its parent to cover visible view.\n    d.mover = elt(\"div\", [elt(\"div\", [d.lineSpace], \"CodeMirror-lines\")], null, \"position: relative\");\n    // Set to the height of the document, allowing scrolling.\n    d.sizer = elt(\"div\", [d.mover], \"CodeMirror-sizer\");\n    // Behavior of elts with overflow: auto and padding is\n    // inconsistent across browsers. This is used to ensure the\n    // scrollable area is big enough.\n    d.heightForcer = elt(\"div\", null, null, \"position: absolute; height: \" + scrollerCutOff + \"px; width: 1px;\");\n    // Will contain the gutters, if any.\n    d.gutters = elt(\"div\", null, \"CodeMirror-gutters\");\n    d.lineGutter = null;\n    // Actual scrollable element.\n    d.scroller = elt(\"div\", [d.sizer, d.heightForcer, d.gutters], \"CodeMirror-scroll\");\n    d.scroller.setAttribute(\"tabIndex\", \"-1\");\n    // The element in which the editor lives.\n    d.wrapper = elt(\"div\", [d.inputDiv, d.scrollbarH, d.scrollbarV,\n                            d.scrollbarFiller, d.gutterFiller, d.scroller], \"CodeMirror\");\n\n    // Work around IE7 z-index bug (not perfect, hence IE7 not really being supported)\n    if (ie && ie_version < 8) { d.gutters.style.zIndex = -1; d.scroller.style.paddingRight = 0; }\n    // Needed to hide big blue blinking cursor on Mobile Safari\n    if (ios) input.style.width = \"0px\";\n    if (!webkit) d.scroller.draggable = true;\n    // Needed to handle Tab key in KHTML\n    if (khtml) { d.inputDiv.style.height = \"1px\"; d.inputDiv.style.position = \"absolute\"; }\n    // Need to set a minimum width to see the scrollbar on IE7 (but must not set it on IE8).\n    if (ie && ie_version < 8) d.scrollbarH.style.minHeight = d.scrollbarV.style.minWidth = \"18px\";\n\n    if (place) {\n      if (place.appendChild) place.appendChild(d.wrapper);\n      else place(d.wrapper);\n    }\n\n    // Current rendered range (may be bigger than the view window).\n    d.viewFrom = d.viewTo = doc.first;\n    // Information about the rendered lines.\n    d.view = [];\n    // Holds info about a single rendered line when it was rendered\n    // for measurement, while not in view.\n    d.externalMeasured = null;\n    // Empty space (in pixels) above the view\n    d.viewOffset = 0;\n    d.lastWrapHeight = d.lastWrapWidth = 0;\n    d.updateLineNumbers = null;\n\n    // Used to only resize the line number gutter when necessary (when\n    // the amount of lines crosses a boundary that makes its width change)\n    d.lineNumWidth = d.lineNumInnerWidth = d.lineNumChars = null;\n    // See readInput and resetInput\n    d.prevInput = \"\";\n    // Set to true when a non-horizontal-scrolling line widget is\n    // added. As an optimization, line widget aligning is skipped when\n    // this is false.\n    d.alignWidgets = false;\n    // Flag that indicates whether we expect input to appear real soon\n    // now (after some event like 'keypress' or 'input') and are\n    // polling intensively.\n    d.pollingFast = false;\n    // Self-resetting timeout for the poller\n    d.poll = new Delayed();\n\n    d.cachedCharWidth = d.cachedTextHeight = d.cachedPaddingH = null;\n\n    // Tracks when resetInput has punted to just putting a short\n    // string into the textarea instead of the full selection.\n    d.inaccurateSelection = false;\n\n    // Tracks the maximum line length so that the horizontal scrollbar\n    // can be kept static when scrolling.\n    d.maxLine = null;\n    d.maxLineLength = 0;\n    d.maxLineChanged = false;\n\n    // Used for measuring wheel scrolling granularity\n    d.wheelDX = d.wheelDY = d.wheelStartX = d.wheelStartY = null;\n\n    // True when shift is held down.\n    d.shift = false;\n\n    // Used to track whether anything happened since the context menu\n    // was opened.\n    d.selForContextMenu = null;\n  }\n\n  // STATE UPDATES\n\n  // Used to get the editor into a consistent state again when options change.\n\n  function loadMode(cm) {\n    cm.doc.mode = CodeMirror.getMode(cm.options, cm.doc.modeOption);\n    resetModeState(cm);\n  }\n\n  function resetModeState(cm) {\n    cm.doc.iter(function(line) {\n      if (line.stateAfter) line.stateAfter = null;\n      if (line.styles) line.styles = null;\n    });\n    cm.doc.frontier = cm.doc.first;\n    startWorker(cm, 100);\n    cm.state.modeGen++;\n    if (cm.curOp) regChange(cm);\n  }\n\n  function wrappingChanged(cm) {\n    if (cm.options.lineWrapping) {\n      addClass(cm.display.wrapper, \"CodeMirror-wrap\");\n      cm.display.sizer.style.minWidth = \"\";\n    } else {\n      rmClass(cm.display.wrapper, \"CodeMirror-wrap\");\n      findMaxLine(cm);\n    }\n    estimateLineHeights(cm);\n    regChange(cm);\n    clearCaches(cm);\n    setTimeout(function(){updateScrollbars(cm);}, 100);\n  }\n\n  // Returns a function that estimates the height of a line, to use as\n  // first approximation until the line becomes visible (and is thus\n  // properly measurable).\n  function estimateHeight(cm) {\n    var th = textHeight(cm.display), wrapping = cm.options.lineWrapping;\n    var perLine = wrapping && Math.max(5, cm.display.scroller.clientWidth / charWidth(cm.display) - 3);\n    return function(line) {\n      if (lineIsHidden(cm.doc, line)) return 0;\n\n      var widgetsHeight = 0;\n      if (line.widgets) for (var i = 0; i < line.widgets.length; i++) {\n        if (line.widgets[i].height) widgetsHeight += line.widgets[i].height;\n      }\n\n      if (wrapping)\n        return widgetsHeight + (Math.ceil(line.text.length / perLine) || 1) * th;\n      else\n        return widgetsHeight + th;\n    };\n  }\n\n  function estimateLineHeights(cm) {\n    var doc = cm.doc, est = estimateHeight(cm);\n    doc.iter(function(line) {\n      var estHeight = est(line);\n      if (estHeight != line.height) updateLineHeight(line, estHeight);\n    });\n  }\n\n  function themeChanged(cm) {\n    cm.display.wrapper.className = cm.display.wrapper.className.replace(/\\s*cm-s-\\S+/g, \"\") +\n      cm.options.theme.replace(/(^|\\s)\\s*/g, \" cm-s-\");\n    clearCaches(cm);\n  }\n\n  function guttersChanged(cm) {\n    updateGutters(cm);\n    regChange(cm);\n    setTimeout(function(){alignHorizontally(cm);}, 20);\n  }\n\n  // Rebuild the gutter elements, ensure the margin to the left of the\n  // code matches their width.\n  function updateGutters(cm) {\n    var gutters = cm.display.gutters, specs = cm.options.gutters;\n    removeChildren(gutters);\n    for (var i = 0; i < specs.length; ++i) {\n      var gutterClass = specs[i];\n      var gElt = gutters.appendChild(elt(\"div\", null, \"CodeMirror-gutter \" + gutterClass));\n      if (gutterClass == \"CodeMirror-linenumbers\") {\n        cm.display.lineGutter = gElt;\n        gElt.style.width = (cm.display.lineNumWidth || 1) + \"px\";\n      }\n    }\n    gutters.style.display = i ? \"\" : \"none\";\n    updateGutterSpace(cm);\n  }\n\n  function updateGutterSpace(cm) {\n    var width = cm.display.gutters.offsetWidth;\n    cm.display.sizer.style.marginLeft = width + \"px\";\n    cm.display.scrollbarH.style.left = cm.options.fixedGutter ? width + \"px\" : 0;\n  }\n\n  // Compute the character length of a line, taking into account\n  // collapsed ranges (see markText) that might hide parts, and join\n  // other lines onto it.\n  function lineLength(line) {\n    if (line.height == 0) return 0;\n    var len = line.text.length, merged, cur = line;\n    while (merged = collapsedSpanAtStart(cur)) {\n      var found = merged.find(0, true);\n      cur = found.from.line;\n      len += found.from.ch - found.to.ch;\n    }\n    cur = line;\n    while (merged = collapsedSpanAtEnd(cur)) {\n      var found = merged.find(0, true);\n      len -= cur.text.length - found.from.ch;\n      cur = found.to.line;\n      len += cur.text.length - found.to.ch;\n    }\n    return len;\n  }\n\n  // Find the longest line in the document.\n  function findMaxLine(cm) {\n    var d = cm.display, doc = cm.doc;\n    d.maxLine = getLine(doc, doc.first);\n    d.maxLineLength = lineLength(d.maxLine);\n    d.maxLineChanged = true;\n    doc.iter(function(line) {\n      var len = lineLength(line);\n      if (len > d.maxLineLength) {\n        d.maxLineLength = len;\n        d.maxLine = line;\n      }\n    });\n  }\n\n  // Make sure the gutters options contains the element\n  // \"CodeMirror-linenumbers\" when the lineNumbers option is true.\n  function setGuttersForLineNumbers(options) {\n    var found = indexOf(options.gutters, \"CodeMirror-linenumbers\");\n    if (found == -1 && options.lineNumbers) {\n      options.gutters = options.gutters.concat([\"CodeMirror-linenumbers\"]);\n    } else if (found > -1 && !options.lineNumbers) {\n      options.gutters = options.gutters.slice(0);\n      options.gutters.splice(found, 1);\n    }\n  }\n\n  // SCROLLBARS\n\n  function hScrollbarTakesSpace(cm) {\n    return cm.display.scroller.clientHeight - cm.display.wrapper.clientHeight < scrollerCutOff - 3;\n  }\n\n  // Prepare DOM reads needed to update the scrollbars. Done in one\n  // shot to minimize update/measure roundtrips.\n  function measureForScrollbars(cm) {\n    var scroll = cm.display.scroller;\n    return {\n      clientHeight: scroll.clientHeight,\n      barHeight: cm.display.scrollbarV.clientHeight,\n      scrollWidth: scroll.scrollWidth, clientWidth: scroll.clientWidth,\n      hScrollbarTakesSpace: hScrollbarTakesSpace(cm),\n      barWidth: cm.display.scrollbarH.clientWidth,\n      docHeight: Math.round(cm.doc.height + paddingVert(cm.display))\n    };\n  }\n\n  // Re-synchronize the fake scrollbars with the actual size of the\n  // content.\n  function updateScrollbars(cm, measure) {\n    if (!measure) measure = measureForScrollbars(cm);\n    var d = cm.display, sWidth = scrollbarWidth(d.measure);\n    var scrollHeight = measure.docHeight + scrollerCutOff;\n    var needsH = measure.scrollWidth > measure.clientWidth;\n    if (needsH && measure.scrollWidth <= measure.clientWidth + 1 &&\n        sWidth > 0 && !measure.hScrollbarTakesSpace)\n      needsH = false; // (Issue #2562)\n    var needsV = scrollHeight > measure.clientHeight;\n\n    if (needsV) {\n      d.scrollbarV.style.display = \"block\";\n      d.scrollbarV.style.bottom = needsH ? sWidth + \"px\" : \"0\";\n      // A bug in IE8 can cause this value to be negative, so guard it.\n      d.scrollbarV.firstChild.style.height =\n        Math.max(0, scrollHeight - measure.clientHeight + (measure.barHeight || d.scrollbarV.clientHeight)) + \"px\";\n    } else {\n      d.scrollbarV.style.display = \"\";\n      d.scrollbarV.firstChild.style.height = \"0\";\n    }\n    if (needsH) {\n      d.scrollbarH.style.display = \"block\";\n      d.scrollbarH.style.right = needsV ? sWidth + \"px\" : \"0\";\n      d.scrollbarH.firstChild.style.width =\n        (measure.scrollWidth - measure.clientWidth + (measure.barWidth || d.scrollbarH.clientWidth)) + \"px\";\n    } else {\n      d.scrollbarH.style.display = \"\";\n      d.scrollbarH.firstChild.style.width = \"0\";\n    }\n    if (needsH && needsV) {\n      d.scrollbarFiller.style.display = \"block\";\n      d.scrollbarFiller.style.height = d.scrollbarFiller.style.width = sWidth + \"px\";\n    } else d.scrollbarFiller.style.display = \"\";\n    if (needsH && cm.options.coverGutterNextToScrollbar && cm.options.fixedGutter) {\n      d.gutterFiller.style.display = \"block\";\n      d.gutterFiller.style.height = sWidth + \"px\";\n      d.gutterFiller.style.width = d.gutters.offsetWidth + \"px\";\n    } else d.gutterFiller.style.display = \"\";\n\n    if (!cm.state.checkedOverlayScrollbar && measure.clientHeight > 0) {\n      if (sWidth === 0) {\n        var w = mac && !mac_geMountainLion ? \"12px\" : \"18px\";\n        d.scrollbarV.style.minWidth = d.scrollbarH.style.minHeight = w;\n        var barMouseDown = function(e) {\n          if (e_target(e) != d.scrollbarV && e_target(e) != d.scrollbarH)\n            operation(cm, onMouseDown)(e);\n        };\n        on(d.scrollbarV, \"mousedown\", barMouseDown);\n        on(d.scrollbarH, \"mousedown\", barMouseDown);\n      }\n      cm.state.checkedOverlayScrollbar = true;\n    }\n  }\n\n  // Compute the lines that are visible in a given viewport (defaults\n  // the the current scroll position). viewport may contain top,\n  // height, and ensure (see op.scrollToPos) properties.\n  function visibleLines(display, doc, viewport) {\n    var top = viewport && viewport.top != null ? Math.max(0, viewport.top) : display.scroller.scrollTop;\n    top = Math.floor(top - paddingTop(display));\n    var bottom = viewport && viewport.bottom != null ? viewport.bottom : top + display.wrapper.clientHeight;\n\n    var from = lineAtHeight(doc, top), to = lineAtHeight(doc, bottom);\n    // Ensure is a {from: {line, ch}, to: {line, ch}} object, and\n    // forces those lines into the viewport (if possible).\n    if (viewport && viewport.ensure) {\n      var ensureFrom = viewport.ensure.from.line, ensureTo = viewport.ensure.to.line;\n      if (ensureFrom < from)\n        return {from: ensureFrom,\n                to: lineAtHeight(doc, heightAtLine(getLine(doc, ensureFrom)) + display.wrapper.clientHeight)};\n      if (Math.min(ensureTo, doc.lastLine()) >= to)\n        return {from: lineAtHeight(doc, heightAtLine(getLine(doc, ensureTo)) - display.wrapper.clientHeight),\n                to: ensureTo};\n    }\n    return {from: from, to: Math.max(to, from + 1)};\n  }\n\n  // LINE NUMBERS\n\n  // Re-align line numbers and gutter marks to compensate for\n  // horizontal scrolling.\n  function alignHorizontally(cm) {\n    var display = cm.display, view = display.view;\n    if (!display.alignWidgets && (!display.gutters.firstChild || !cm.options.fixedGutter)) return;\n    var comp = compensateForHScroll(display) - display.scroller.scrollLeft + cm.doc.scrollLeft;\n    var gutterW = display.gutters.offsetWidth, left = comp + \"px\";\n    for (var i = 0; i < view.length; i++) if (!view[i].hidden) {\n      if (cm.options.fixedGutter && view[i].gutter)\n        view[i].gutter.style.left = left;\n      var align = view[i].alignable;\n      if (align) for (var j = 0; j < align.length; j++)\n        align[j].style.left = left;\n    }\n    if (cm.options.fixedGutter)\n      display.gutters.style.left = (comp + gutterW) + \"px\";\n  }\n\n  // Used to ensure that the line number gutter is still the right\n  // size for the current document size. Returns true when an update\n  // is needed.\n  function maybeUpdateLineNumberWidth(cm) {\n    if (!cm.options.lineNumbers) return false;\n    var doc = cm.doc, last = lineNumberFor(cm.options, doc.first + doc.size - 1), display = cm.display;\n    if (last.length != display.lineNumChars) {\n      var test = display.measure.appendChild(elt(\"div\", [elt(\"div\", last)],\n                                                 \"CodeMirror-linenumber CodeMirror-gutter-elt\"));\n      var innerW = test.firstChild.offsetWidth, padding = test.offsetWidth - innerW;\n      display.lineGutter.style.width = \"\";\n      display.lineNumInnerWidth = Math.max(innerW, display.lineGutter.offsetWidth - padding);\n      display.lineNumWidth = display.lineNumInnerWidth + padding;\n      display.lineNumChars = display.lineNumInnerWidth ? last.length : -1;\n      display.lineGutter.style.width = display.lineNumWidth + \"px\";\n      updateGutterSpace(cm);\n      return true;\n    }\n    return false;\n  }\n\n  function lineNumberFor(options, i) {\n    return String(options.lineNumberFormatter(i + options.firstLineNumber));\n  }\n\n  // Computes display.scroller.scrollLeft + display.gutters.offsetWidth,\n  // but using getBoundingClientRect to get a sub-pixel-accurate\n  // result.\n  function compensateForHScroll(display) {\n    return display.scroller.getBoundingClientRect().left - display.sizer.getBoundingClientRect().left;\n  }\n\n  // DISPLAY DRAWING\n\n  function DisplayUpdate(cm, viewport, force) {\n    var display = cm.display;\n\n    this.viewport = viewport;\n    // Store some values that we'll need later (but don't want to force a relayout for)\n    this.visible = visibleLines(display, cm.doc, viewport);\n    this.editorIsHidden = !display.wrapper.offsetWidth;\n    this.wrapperHeight = display.wrapper.clientHeight;\n    this.wrapperWidth = display.wrapper.clientWidth;\n    this.oldViewFrom = display.viewFrom; this.oldViewTo = display.viewTo;\n    this.oldScrollerWidth = display.scroller.clientWidth;\n    this.force = force;\n    this.dims = getDimensions(cm);\n  }\n\n  // Does the actual updating of the line display. Bails out\n  // (returning false) when there is nothing to be done and forced is\n  // false.\n  function updateDisplayIfNeeded(cm, update) {\n    var display = cm.display, doc = cm.doc;\n    if (update.editorIsHidden) {\n      resetView(cm);\n      return false;\n    }\n\n    // Bail out if the visible area is already rendered and nothing changed.\n    if (!update.force &&\n        update.visible.from >= display.viewFrom && update.visible.to <= display.viewTo &&\n        (display.updateLineNumbers == null || display.updateLineNumbers >= display.viewTo) &&\n        countDirtyView(cm) == 0)\n      return false;\n\n    if (maybeUpdateLineNumberWidth(cm)) {\n      resetView(cm);\n      update.dims = getDimensions(cm);\n    }\n\n    // Compute a suitable new viewport (from & to)\n    var end = doc.first + doc.size;\n    var from = Math.max(update.visible.from - cm.options.viewportMargin, doc.first);\n    var to = Math.min(end, update.visible.to + cm.options.viewportMargin);\n    if (display.viewFrom < from && from - display.viewFrom < 20) from = Math.max(doc.first, display.viewFrom);\n    if (display.viewTo > to && display.viewTo - to < 20) to = Math.min(end, display.viewTo);\n    if (sawCollapsedSpans) {\n      from = visualLineNo(cm.doc, from);\n      to = visualLineEndNo(cm.doc, to);\n    }\n\n    var different = from != display.viewFrom || to != display.viewTo ||\n      display.lastWrapHeight != update.wrapperHeight || display.lastWrapWidth != update.wrapperWidth;\n    adjustView(cm, from, to);\n\n    display.viewOffset = heightAtLine(getLine(cm.doc, display.viewFrom));\n    // Position the mover div to align with the current scroll position\n    cm.display.mover.style.top = display.viewOffset + \"px\";\n\n    var toUpdate = countDirtyView(cm);\n    if (!different && toUpdate == 0 && !update.force &&\n        (display.updateLineNumbers == null || display.updateLineNumbers >= display.viewTo))\n      return false;\n\n    // For big changes, we hide the enclosing element during the\n    // update, since that speeds up the operations on most browsers.\n    var focused = activeElt();\n    if (toUpdate > 4) display.lineDiv.style.display = \"none\";\n    patchDisplay(cm, display.updateLineNumbers, update.dims);\n    if (toUpdate > 4) display.lineDiv.style.display = \"\";\n    // There might have been a widget with a focused element that got\n    // hidden or updated, if so re-focus it.\n    if (focused && activeElt() != focused && focused.offsetHeight) focused.focus();\n\n    // Prevent selection and cursors from interfering with the scroll\n    // width.\n    removeChildren(display.cursorDiv);\n    removeChildren(display.selectionDiv);\n\n    if (different) {\n      display.lastWrapHeight = update.wrapperHeight;\n      display.lastWrapWidth = update.wrapperWidth;\n      startWorker(cm, 400);\n    }\n\n    display.updateLineNumbers = null;\n\n    return true;\n  }\n\n  function postUpdateDisplay(cm, update) {\n    var force = update.force, viewport = update.viewport;\n    for (var first = true;; first = false) {\n      if (first && cm.options.lineWrapping && update.oldScrollerWidth != cm.display.scroller.clientWidth) {\n        force = true;\n      } else {\n        force = false;\n        // Clip forced viewport to actual scrollable area.\n        if (viewport && viewport.top != null)\n          viewport = {top: Math.min(cm.doc.height + paddingVert(cm.display) - scrollerCutOff -\n                                    cm.display.scroller.clientHeight, viewport.top)};\n        // Updated line heights might result in the drawn area not\n        // actually covering the viewport. Keep looping until it does.\n        update.visible = visibleLines(cm.display, cm.doc, viewport);\n        if (update.visible.from >= cm.display.viewFrom && update.visible.to <= cm.display.viewTo)\n          break;\n      }\n      if (!updateDisplayIfNeeded(cm, update)) break;\n      updateHeightsInViewport(cm);\n      var barMeasure = measureForScrollbars(cm);\n      updateSelection(cm);\n      setDocumentHeight(cm, barMeasure);\n      updateScrollbars(cm, barMeasure);\n    }\n\n    signalLater(cm, \"update\", cm);\n    if (cm.display.viewFrom != update.oldViewFrom || cm.display.viewTo != update.oldViewTo)\n      signalLater(cm, \"viewportChange\", cm, cm.display.viewFrom, cm.display.viewTo);\n  }\n\n  function updateDisplaySimple(cm, viewport) {\n    var update = new DisplayUpdate(cm, viewport);\n    if (updateDisplayIfNeeded(cm, update)) {\n      updateHeightsInViewport(cm);\n      postUpdateDisplay(cm, update);\n      var barMeasure = measureForScrollbars(cm);\n      updateSelection(cm);\n      setDocumentHeight(cm, barMeasure);\n      updateScrollbars(cm, barMeasure);\n    }\n  }\n\n  function setDocumentHeight(cm, measure) {\n    cm.display.sizer.style.minHeight = cm.display.heightForcer.style.top = measure.docHeight + \"px\";\n    cm.display.gutters.style.height = Math.max(measure.docHeight, measure.clientHeight - scrollerCutOff) + \"px\";\n  }\n\n  function checkForWebkitWidthBug(cm, measure) {\n    // Work around Webkit bug where it sometimes reserves space for a\n    // non-existing phantom scrollbar in the scroller (Issue #2420)\n    if (cm.display.sizer.offsetWidth + cm.display.gutters.offsetWidth < cm.display.scroller.clientWidth - 1) {\n      cm.display.sizer.style.minHeight = cm.display.heightForcer.style.top = \"0px\";\n      cm.display.gutters.style.height = measure.docHeight + \"px\";\n    }\n  }\n\n  // Read the actual heights of the rendered lines, and update their\n  // stored heights to match.\n  function updateHeightsInViewport(cm) {\n    var display = cm.display;\n    var prevBottom = display.lineDiv.offsetTop;\n    for (var i = 0; i < display.view.length; i++) {\n      var cur = display.view[i], height;\n      if (cur.hidden) continue;\n      if (ie && ie_version < 8) {\n        var bot = cur.node.offsetTop + cur.node.offsetHeight;\n        height = bot - prevBottom;\n        prevBottom = bot;\n      } else {\n        var box = cur.node.getBoundingClientRect();\n        height = box.bottom - box.top;\n      }\n      var diff = cur.line.height - height;\n      if (height < 2) height = textHeight(display);\n      if (diff > .001 || diff < -.001) {\n        updateLineHeight(cur.line, height);\n        updateWidgetHeight(cur.line);\n        if (cur.rest) for (var j = 0; j < cur.rest.length; j++)\n          updateWidgetHeight(cur.rest[j]);\n      }\n    }\n  }\n\n  // Read and store the height of line widgets associated with the\n  // given line.\n  function updateWidgetHeight(line) {\n    if (line.widgets) for (var i = 0; i < line.widgets.length; ++i)\n      line.widgets[i].height = line.widgets[i].node.offsetHeight;\n  }\n\n  // Do a bulk-read of the DOM positions and sizes needed to draw the\n  // view, so that we don't interleave reading and writing to the DOM.\n  function getDimensions(cm) {\n    var d = cm.display, left = {}, width = {};\n    var gutterLeft = d.gutters.clientLeft;\n    for (var n = d.gutters.firstChild, i = 0; n; n = n.nextSibling, ++i) {\n      left[cm.options.gutters[i]] = n.offsetLeft + n.clientLeft + gutterLeft;\n      width[cm.options.gutters[i]] = n.clientWidth;\n    }\n    return {fixedPos: compensateForHScroll(d),\n            gutterTotalWidth: d.gutters.offsetWidth,\n            gutterLeft: left,\n            gutterWidth: width,\n            wrapperWidth: d.wrapper.clientWidth};\n  }\n\n  // Sync the actual display DOM structure with display.view, removing\n  // nodes for lines that are no longer in view, and creating the ones\n  // that are not there yet, and updating the ones that are out of\n  // date.\n  function patchDisplay(cm, updateNumbersFrom, dims) {\n    var display = cm.display, lineNumbers = cm.options.lineNumbers;\n    var container = display.lineDiv, cur = container.firstChild;\n\n    function rm(node) {\n      var next = node.nextSibling;\n      // Works around a throw-scroll bug in OS X Webkit\n      if (webkit && mac && cm.display.currentWheelTarget == node)\n        node.style.display = \"none\";\n      else\n        node.parentNode.removeChild(node);\n      return next;\n    }\n\n    var view = display.view, lineN = display.viewFrom;\n    // Loop over the elements in the view, syncing cur (the DOM nodes\n    // in display.lineDiv) with the view as we go.\n    for (var i = 0; i < view.length; i++) {\n      var lineView = view[i];\n      if (lineView.hidden) {\n      } else if (!lineView.node) { // Not drawn yet\n        var node = buildLineElement(cm, lineView, lineN, dims);\n        container.insertBefore(node, cur);\n      } else { // Already drawn\n        while (cur != lineView.node) cur = rm(cur);\n        var updateNumber = lineNumbers && updateNumbersFrom != null &&\n          updateNumbersFrom <= lineN && lineView.lineNumber;\n        if (lineView.changes) {\n          if (indexOf(lineView.changes, \"gutter\") > -1) updateNumber = false;\n          updateLineForChanges(cm, lineView, lineN, dims);\n        }\n        if (updateNumber) {\n          removeChildren(lineView.lineNumber);\n          lineView.lineNumber.appendChild(document.createTextNode(lineNumberFor(cm.options, lineN)));\n        }\n        cur = lineView.node.nextSibling;\n      }\n      lineN += lineView.size;\n    }\n    while (cur) cur = rm(cur);\n  }\n\n  // When an aspect of a line changes, a string is added to\n  // lineView.changes. This updates the relevant part of the line's\n  // DOM structure.\n  function updateLineForChanges(cm, lineView, lineN, dims) {\n    for (var j = 0; j < lineView.changes.length; j++) {\n      var type = lineView.changes[j];\n      if (type == \"text\") updateLineText(cm, lineView);\n      else if (type == \"gutter\") updateLineGutter(cm, lineView, lineN, dims);\n      else if (type == \"class\") updateLineClasses(lineView);\n      else if (type == \"widget\") updateLineWidgets(lineView, dims);\n    }\n    lineView.changes = null;\n  }\n\n  // Lines with gutter elements, widgets or a background class need to\n  // be wrapped, and have the extra elements added to the wrapper div\n  function ensureLineWrapped(lineView) {\n    if (lineView.node == lineView.text) {\n      lineView.node = elt(\"div\", null, null, \"position: relative\");\n      if (lineView.text.parentNode)\n        lineView.text.parentNode.replaceChild(lineView.node, lineView.text);\n      lineView.node.appendChild(lineView.text);\n      if (ie && ie_version < 8) lineView.node.style.zIndex = 2;\n    }\n    return lineView.node;\n  }\n\n  function updateLineBackground(lineView) {\n    var cls = lineView.bgClass ? lineView.bgClass + \" \" + (lineView.line.bgClass || \"\") : lineView.line.bgClass;\n    if (cls) cls += \" CodeMirror-linebackground\";\n    if (lineView.background) {\n      if (cls) lineView.background.className = cls;\n      else { lineView.background.parentNode.removeChild(lineView.background); lineView.background = null; }\n    } else if (cls) {\n      var wrap = ensureLineWrapped(lineView);\n      lineView.background = wrap.insertBefore(elt(\"div\", null, cls), wrap.firstChild);\n    }\n  }\n\n  // Wrapper around buildLineContent which will reuse the structure\n  // in display.externalMeasured when possible.\n  function getLineContent(cm, lineView) {\n    var ext = cm.display.externalMeasured;\n    if (ext && ext.line == lineView.line) {\n      cm.display.externalMeasured = null;\n      lineView.measure = ext.measure;\n      return ext.built;\n    }\n    return buildLineContent(cm, lineView);\n  }\n\n  // Redraw the line's text. Interacts with the background and text\n  // classes because the mode may output tokens that influence these\n  // classes.\n  function updateLineText(cm, lineView) {\n    var cls = lineView.text.className;\n    var built = getLineContent(cm, lineView);\n    if (lineView.text == lineView.node) lineView.node = built.pre;\n    lineView.text.parentNode.replaceChild(built.pre, lineView.text);\n    lineView.text = built.pre;\n    if (built.bgClass != lineView.bgClass || built.textClass != lineView.textClass) {\n      lineView.bgClass = built.bgClass;\n      lineView.textClass = built.textClass;\n      updateLineClasses(lineView);\n    } else if (cls) {\n      lineView.text.className = cls;\n    }\n  }\n\n  function updateLineClasses(lineView) {\n    updateLineBackground(lineView);\n    if (lineView.line.wrapClass)\n      ensureLineWrapped(lineView).className = lineView.line.wrapClass;\n    else if (lineView.node != lineView.text)\n      lineView.node.className = \"\";\n    var textClass = lineView.textClass ? lineView.textClass + \" \" + (lineView.line.textClass || \"\") : lineView.line.textClass;\n    lineView.text.className = textClass || \"\";\n  }\n\n  function updateLineGutter(cm, lineView, lineN, dims) {\n    if (lineView.gutter) {\n      lineView.node.removeChild(lineView.gutter);\n      lineView.gutter = null;\n    }\n    var markers = lineView.line.gutterMarkers;\n    if (cm.options.lineNumbers || markers) {\n      var wrap = ensureLineWrapped(lineView);\n      var gutterWrap = lineView.gutter =\n        wrap.insertBefore(elt(\"div\", null, \"CodeMirror-gutter-wrapper\", \"left: \" +\n                              (cm.options.fixedGutter ? dims.fixedPos : -dims.gutterTotalWidth) +\n                              \"px; width: \" + dims.gutterTotalWidth + \"px\"),\n                          lineView.text);\n      if (lineView.line.gutterClass)\n        gutterWrap.className += \" \" + lineView.line.gutterClass;\n      if (cm.options.lineNumbers && (!markers || !markers[\"CodeMirror-linenumbers\"]))\n        lineView.lineNumber = gutterWrap.appendChild(\n          elt(\"div\", lineNumberFor(cm.options, lineN),\n              \"CodeMirror-linenumber CodeMirror-gutter-elt\",\n              \"left: \" + dims.gutterLeft[\"CodeMirror-linenumbers\"] + \"px; width: \"\n              + cm.display.lineNumInnerWidth + \"px\"));\n      if (markers) for (var k = 0; k < cm.options.gutters.length; ++k) {\n        var id = cm.options.gutters[k], found = markers.hasOwnProperty(id) && markers[id];\n        if (found)\n          gutterWrap.appendChild(elt(\"div\", [found], \"CodeMirror-gutter-elt\", \"left: \" +\n                                     dims.gutterLeft[id] + \"px; width: \" + dims.gutterWidth[id] + \"px\"));\n      }\n    }\n  }\n\n  function updateLineWidgets(lineView, dims) {\n    if (lineView.alignable) lineView.alignable = null;\n    for (var node = lineView.node.firstChild, next; node; node = next) {\n      var next = node.nextSibling;\n      if (node.className == \"CodeMirror-linewidget\")\n        lineView.node.removeChild(node);\n    }\n    insertLineWidgets(lineView, dims);\n  }\n\n  // Build a line's DOM representation from scratch\n  function buildLineElement(cm, lineView, lineN, dims) {\n    var built = getLineContent(cm, lineView);\n    lineView.text = lineView.node = built.pre;\n    if (built.bgClass) lineView.bgClass = built.bgClass;\n    if (built.textClass) lineView.textClass = built.textClass;\n\n    updateLineClasses(lineView);\n    updateLineGutter(cm, lineView, lineN, dims);\n    insertLineWidgets(lineView, dims);\n    return lineView.node;\n  }\n\n  // A lineView may contain multiple logical lines (when merged by\n  // collapsed spans). The widgets for all of them need to be drawn.\n  function insertLineWidgets(lineView, dims) {\n    insertLineWidgetsFor(lineView.line, lineView, dims, true);\n    if (lineView.rest) for (var i = 0; i < lineView.rest.length; i++)\n      insertLineWidgetsFor(lineView.rest[i], lineView, dims, false);\n  }\n\n  function insertLineWidgetsFor(line, lineView, dims, allowAbove) {\n    if (!line.widgets) return;\n    var wrap = ensureLineWrapped(lineView);\n    for (var i = 0, ws = line.widgets; i < ws.length; ++i) {\n      var widget = ws[i], node = elt(\"div\", [widget.node], \"CodeMirror-linewidget\");\n      if (!widget.handleMouseEvents) node.ignoreEvents = true;\n      positionLineWidget(widget, node, lineView, dims);\n      if (allowAbove && widget.above)\n        wrap.insertBefore(node, lineView.gutter || lineView.text);\n      else\n        wrap.appendChild(node);\n      signalLater(widget, \"redraw\");\n    }\n  }\n\n  function positionLineWidget(widget, node, lineView, dims) {\n    if (widget.noHScroll) {\n      (lineView.alignable || (lineView.alignable = [])).push(node);\n      var width = dims.wrapperWidth;\n      node.style.left = dims.fixedPos + \"px\";\n      if (!widget.coverGutter) {\n        width -= dims.gutterTotalWidth;\n        node.style.paddingLeft = dims.gutterTotalWidth + \"px\";\n      }\n      node.style.width = width + \"px\";\n    }\n    if (widget.coverGutter) {\n      node.style.zIndex = 5;\n      node.style.position = \"relative\";\n      if (!widget.noHScroll) node.style.marginLeft = -dims.gutterTotalWidth + \"px\";\n    }\n  }\n\n  // POSITION OBJECT\n\n  // A Pos instance represents a position within the text.\n  var Pos = CodeMirror.Pos = function(line, ch) {\n    if (!(this instanceof Pos)) return new Pos(line, ch);\n    this.line = line; this.ch = ch;\n  };\n\n  // Compare two positions, return 0 if they are the same, a negative\n  // number when a is less, and a positive number otherwise.\n  var cmp = CodeMirror.cmpPos = function(a, b) { return a.line - b.line || a.ch - b.ch; };\n\n  function copyPos(x) {return Pos(x.line, x.ch);}\n  function maxPos(a, b) { return cmp(a, b) < 0 ? b : a; }\n  function minPos(a, b) { return cmp(a, b) < 0 ? a : b; }\n\n  // SELECTION / CURSOR\n\n  // Selection objects are immutable. A new one is created every time\n  // the selection changes. A selection is one or more non-overlapping\n  // (and non-touching) ranges, sorted, and an integer that indicates\n  // which one is the primary selection (the one that's scrolled into\n  // view, that getCursor returns, etc).\n  function Selection(ranges, primIndex) {\n    this.ranges = ranges;\n    this.primIndex = primIndex;\n  }\n\n  Selection.prototype = {\n    primary: function() { return this.ranges[this.primIndex]; },\n    equals: function(other) {\n      if (other == this) return true;\n      if (other.primIndex != this.primIndex || other.ranges.length != this.ranges.length) return false;\n      for (var i = 0; i < this.ranges.length; i++) {\n        var here = this.ranges[i], there = other.ranges[i];\n        if (cmp(here.anchor, there.anchor) != 0 || cmp(here.head, there.head) != 0) return false;\n      }\n      return true;\n    },\n    deepCopy: function() {\n      for (var out = [], i = 0; i < this.ranges.length; i++)\n        out[i] = new Range(copyPos(this.ranges[i].anchor), copyPos(this.ranges[i].head));\n      return new Selection(out, this.primIndex);\n    },\n    somethingSelected: function() {\n      for (var i = 0; i < this.ranges.length; i++)\n        if (!this.ranges[i].empty()) return true;\n      return false;\n    },\n    contains: function(pos, end) {\n      if (!end) end = pos;\n      for (var i = 0; i < this.ranges.length; i++) {\n        var range = this.ranges[i];\n        if (cmp(end, range.from()) >= 0 && cmp(pos, range.to()) <= 0)\n          return i;\n      }\n      return -1;\n    }\n  };\n\n  function Range(anchor, head) {\n    this.anchor = anchor; this.head = head;\n  }\n\n  Range.prototype = {\n    from: function() { return minPos(this.anchor, this.head); },\n    to: function() { return maxPos(this.anchor, this.head); },\n    empty: function() {\n      return this.head.line == this.anchor.line && this.head.ch == this.anchor.ch;\n    }\n  };\n\n  // Take an unsorted, potentially overlapping set of ranges, and\n  // build a selection out of it. 'Consumes' ranges array (modifying\n  // it).\n  function normalizeSelection(ranges, primIndex) {\n    var prim = ranges[primIndex];\n    ranges.sort(function(a, b) { return cmp(a.from(), b.from()); });\n    primIndex = indexOf(ranges, prim);\n    for (var i = 1; i < ranges.length; i++) {\n      var cur = ranges[i], prev = ranges[i - 1];\n      if (cmp(prev.to(), cur.from()) >= 0) {\n        var from = minPos(prev.from(), cur.from()), to = maxPos(prev.to(), cur.to());\n        var inv = prev.empty() ? cur.from() == cur.head : prev.from() == prev.head;\n        if (i <= primIndex) --primIndex;\n        ranges.splice(--i, 2, new Range(inv ? to : from, inv ? from : to));\n      }\n    }\n    return new Selection(ranges, primIndex);\n  }\n\n  function simpleSelection(anchor, head) {\n    return new Selection([new Range(anchor, head || anchor)], 0);\n  }\n\n  // Most of the external API clips given positions to make sure they\n  // actually exist within the document.\n  function clipLine(doc, n) {return Math.max(doc.first, Math.min(n, doc.first + doc.size - 1));}\n  function clipPos(doc, pos) {\n    if (pos.line < doc.first) return Pos(doc.first, 0);\n    var last = doc.first + doc.size - 1;\n    if (pos.line > last) return Pos(last, getLine(doc, last).text.length);\n    return clipToLen(pos, getLine(doc, pos.line).text.length);\n  }\n  function clipToLen(pos, linelen) {\n    var ch = pos.ch;\n    if (ch == null || ch > linelen) return Pos(pos.line, linelen);\n    else if (ch < 0) return Pos(pos.line, 0);\n    else return pos;\n  }\n  function isLine(doc, l) {return l >= doc.first && l < doc.first + doc.size;}\n  function clipPosArray(doc, array) {\n    for (var out = [], i = 0; i < array.length; i++) out[i] = clipPos(doc, array[i]);\n    return out;\n  }\n\n  // SELECTION UPDATES\n\n  // The 'scroll' parameter given to many of these indicated whether\n  // the new cursor position should be scrolled into view after\n  // modifying the selection.\n\n  // If shift is held or the extend flag is set, extends a range to\n  // include a given position (and optionally a second position).\n  // Otherwise, simply returns the range between the given positions.\n  // Used for cursor motion and such.\n  function extendRange(doc, range, head, other) {\n    if (doc.cm && doc.cm.display.shift || doc.extend) {\n      var anchor = range.anchor;\n      if (other) {\n        var posBefore = cmp(head, anchor) < 0;\n        if (posBefore != (cmp(other, anchor) < 0)) {\n          anchor = head;\n          head = other;\n        } else if (posBefore != (cmp(head, other) < 0)) {\n          head = other;\n        }\n      }\n      return new Range(anchor, head);\n    } else {\n      return new Range(other || head, head);\n    }\n  }\n\n  // Extend the primary selection range, discard the rest.\n  function extendSelection(doc, head, other, options) {\n    setSelection(doc, new Selection([extendRange(doc, doc.sel.primary(), head, other)], 0), options);\n  }\n\n  // Extend all selections (pos is an array of selections with length\n  // equal the number of selections)\n  function extendSelections(doc, heads, options) {\n    for (var out = [], i = 0; i < doc.sel.ranges.length; i++)\n      out[i] = extendRange(doc, doc.sel.ranges[i], heads[i], null);\n    var newSel = normalizeSelection(out, doc.sel.primIndex);\n    setSelection(doc, newSel, options);\n  }\n\n  // Updates a single range in the selection.\n  function replaceOneSelection(doc, i, range, options) {\n    var ranges = doc.sel.ranges.slice(0);\n    ranges[i] = range;\n    setSelection(doc, normalizeSelection(ranges, doc.sel.primIndex), options);\n  }\n\n  // Reset the selection to a single range.\n  function setSimpleSelection(doc, anchor, head, options) {\n    setSelection(doc, simpleSelection(anchor, head), options);\n  }\n\n  // Give beforeSelectionChange handlers a change to influence a\n  // selection update.\n  function filterSelectionChange(doc, sel) {\n    var obj = {\n      ranges: sel.ranges,\n      update: function(ranges) {\n        this.ranges = [];\n        for (var i = 0; i < ranges.length; i++)\n          this.ranges[i] = new Range(clipPos(doc, ranges[i].anchor),\n                                     clipPos(doc, ranges[i].head));\n      }\n    };\n    signal(doc, \"beforeSelectionChange\", doc, obj);\n    if (doc.cm) signal(doc.cm, \"beforeSelectionChange\", doc.cm, obj);\n    if (obj.ranges != sel.ranges) return normalizeSelection(obj.ranges, obj.ranges.length - 1);\n    else return sel;\n  }\n\n  function setSelectionReplaceHistory(doc, sel, options) {\n    var done = doc.history.done, last = lst(done);\n    if (last && last.ranges) {\n      done[done.length - 1] = sel;\n      setSelectionNoUndo(doc, sel, options);\n    } else {\n      setSelection(doc, sel, options);\n    }\n  }\n\n  // Set a new selection.\n  function setSelection(doc, sel, options) {\n    setSelectionNoUndo(doc, sel, options);\n    addSelectionToHistory(doc, doc.sel, doc.cm ? doc.cm.curOp.id : NaN, options);\n  }\n\n  function setSelectionNoUndo(doc, sel, options) {\n    if (hasHandler(doc, \"beforeSelectionChange\") || doc.cm && hasHandler(doc.cm, \"beforeSelectionChange\"))\n      sel = filterSelectionChange(doc, sel);\n\n    var bias = options && options.bias ||\n      (cmp(sel.primary().head, doc.sel.primary().head) < 0 ? -1 : 1);\n    setSelectionInner(doc, skipAtomicInSelection(doc, sel, bias, true));\n\n    if (!(options && options.scroll === false) && doc.cm)\n      ensureCursorVisible(doc.cm);\n  }\n\n  function setSelectionInner(doc, sel) {\n    if (sel.equals(doc.sel)) return;\n\n    doc.sel = sel;\n\n    if (doc.cm) {\n      doc.cm.curOp.updateInput = doc.cm.curOp.selectionChanged = true;\n      signalCursorActivity(doc.cm);\n    }\n    signalLater(doc, \"cursorActivity\", doc);\n  }\n\n  // Verify that the selection does not partially select any atomic\n  // marked ranges.\n  function reCheckSelection(doc) {\n    setSelectionInner(doc, skipAtomicInSelection(doc, doc.sel, null, false), sel_dontScroll);\n  }\n\n  // Return a selection that does not partially select any atomic\n  // ranges.\n  function skipAtomicInSelection(doc, sel, bias, mayClear) {\n    var out;\n    for (var i = 0; i < sel.ranges.length; i++) {\n      var range = sel.ranges[i];\n      var newAnchor = skipAtomic(doc, range.anchor, bias, mayClear);\n      var newHead = skipAtomic(doc, range.head, bias, mayClear);\n      if (out || newAnchor != range.anchor || newHead != range.head) {\n        if (!out) out = sel.ranges.slice(0, i);\n        out[i] = new Range(newAnchor, newHead);\n      }\n    }\n    return out ? normalizeSelection(out, sel.primIndex) : sel;\n  }\n\n  // Ensure a given position is not inside an atomic range.\n  function skipAtomic(doc, pos, bias, mayClear) {\n    var flipped = false, curPos = pos;\n    var dir = bias || 1;\n    doc.cantEdit = false;\n    search: for (;;) {\n      var line = getLine(doc, curPos.line);\n      if (line.markedSpans) {\n        for (var i = 0; i < line.markedSpans.length; ++i) {\n          var sp = line.markedSpans[i], m = sp.marker;\n          if ((sp.from == null || (m.inclusiveLeft ? sp.from <= curPos.ch : sp.from < curPos.ch)) &&\n              (sp.to == null || (m.inclusiveRight ? sp.to >= curPos.ch : sp.to > curPos.ch))) {\n            if (mayClear) {\n              signal(m, \"beforeCursorEnter\");\n              if (m.explicitlyCleared) {\n                if (!line.markedSpans) break;\n                else {--i; continue;}\n              }\n            }\n            if (!m.atomic) continue;\n            var newPos = m.find(dir < 0 ? -1 : 1);\n            if (cmp(newPos, curPos) == 0) {\n              newPos.ch += dir;\n              if (newPos.ch < 0) {\n                if (newPos.line > doc.first) newPos = clipPos(doc, Pos(newPos.line - 1));\n                else newPos = null;\n              } else if (newPos.ch > line.text.length) {\n                if (newPos.line < doc.first + doc.size - 1) newPos = Pos(newPos.line + 1, 0);\n                else newPos = null;\n              }\n              if (!newPos) {\n                if (flipped) {\n                  // Driven in a corner -- no valid cursor position found at all\n                  // -- try again *with* clearing, if we didn't already\n                  if (!mayClear) return skipAtomic(doc, pos, bias, true);\n                  // Otherwise, turn off editing until further notice, and return the start of the doc\n                  doc.cantEdit = true;\n                  return Pos(doc.first, 0);\n                }\n                flipped = true; newPos = pos; dir = -dir;\n              }\n            }\n            curPos = newPos;\n            continue search;\n          }\n        }\n      }\n      return curPos;\n    }\n  }\n\n  // SELECTION DRAWING\n\n  // Redraw the selection and/or cursor\n  function drawSelection(cm) {\n    var display = cm.display, doc = cm.doc, result = {};\n    var curFragment = result.cursors = document.createDocumentFragment();\n    var selFragment = result.selection = document.createDocumentFragment();\n\n    for (var i = 0; i < doc.sel.ranges.length; i++) {\n      var range = doc.sel.ranges[i];\n      var collapsed = range.empty();\n      if (collapsed || cm.options.showCursorWhenSelecting)\n        drawSelectionCursor(cm, range, curFragment);\n      if (!collapsed)\n        drawSelectionRange(cm, range, selFragment);\n    }\n\n    // Move the hidden textarea near the cursor to prevent scrolling artifacts\n    if (cm.options.moveInputWithCursor) {\n      var headPos = cursorCoords(cm, doc.sel.primary().head, \"div\");\n      var wrapOff = display.wrapper.getBoundingClientRect(), lineOff = display.lineDiv.getBoundingClientRect();\n      result.teTop = Math.max(0, Math.min(display.wrapper.clientHeight - 10,\n                                          headPos.top + lineOff.top - wrapOff.top));\n      result.teLeft = Math.max(0, Math.min(display.wrapper.clientWidth - 10,\n                                           headPos.left + lineOff.left - wrapOff.left));\n    }\n\n    return result;\n  }\n\n  function showSelection(cm, drawn) {\n    removeChildrenAndAdd(cm.display.cursorDiv, drawn.cursors);\n    removeChildrenAndAdd(cm.display.selectionDiv, drawn.selection);\n    if (drawn.teTop != null) {\n      cm.display.inputDiv.style.top = drawn.teTop + \"px\";\n      cm.display.inputDiv.style.left = drawn.teLeft + \"px\";\n    }\n  }\n\n  function updateSelection(cm) {\n    showSelection(cm, drawSelection(cm));\n  }\n\n  // Draws a cursor for the given range\n  function drawSelectionCursor(cm, range, output) {\n    var pos = cursorCoords(cm, range.head, \"div\", null, null, !cm.options.singleCursorHeightPerLine);\n\n    var cursor = output.appendChild(elt(\"div\", \"\\u00a0\", \"CodeMirror-cursor\"));\n    cursor.style.left = pos.left + \"px\";\n    cursor.style.top = pos.top + \"px\";\n    cursor.style.height = Math.max(0, pos.bottom - pos.top) * cm.options.cursorHeight + \"px\";\n\n    if (pos.other) {\n      // Secondary cursor, shown when on a 'jump' in bi-directional text\n      var otherCursor = output.appendChild(elt(\"div\", \"\\u00a0\", \"CodeMirror-cursor CodeMirror-secondarycursor\"));\n      otherCursor.style.display = \"\";\n      otherCursor.style.left = pos.other.left + \"px\";\n      otherCursor.style.top = pos.other.top + \"px\";\n      otherCursor.style.height = (pos.other.bottom - pos.other.top) * .85 + \"px\";\n    }\n  }\n\n  // Draws the given range as a highlighted selection\n  function drawSelectionRange(cm, range, output) {\n    var display = cm.display, doc = cm.doc;\n    var fragment = document.createDocumentFragment();\n    var padding = paddingH(cm.display), leftSide = padding.left, rightSide = display.lineSpace.offsetWidth - padding.right;\n\n    function add(left, top, width, bottom) {\n      if (top < 0) top = 0;\n      top = Math.round(top);\n      bottom = Math.round(bottom);\n      fragment.appendChild(elt(\"div\", null, \"CodeMirror-selected\", \"position: absolute; left: \" + left +\n                               \"px; top: \" + top + \"px; width: \" + (width == null ? rightSide - left : width) +\n                               \"px; height: \" + (bottom - top) + \"px\"));\n    }\n\n    function drawForLine(line, fromArg, toArg) {\n      var lineObj = getLine(doc, line);\n      var lineLen = lineObj.text.length;\n      var start, end;\n      function coords(ch, bias) {\n        return charCoords(cm, Pos(line, ch), \"div\", lineObj, bias);\n      }\n\n      iterateBidiSections(getOrder(lineObj), fromArg || 0, toArg == null ? lineLen : toArg, function(from, to, dir) {\n        var leftPos = coords(from, \"left\"), rightPos, left, right;\n        if (from == to) {\n          rightPos = leftPos;\n          left = right = leftPos.left;\n        } else {\n          rightPos = coords(to - 1, \"right\");\n          if (dir == \"rtl\") { var tmp = leftPos; leftPos = rightPos; rightPos = tmp; }\n          left = leftPos.left;\n          right = rightPos.right;\n        }\n        if (fromArg == null && from == 0) left = leftSide;\n        if (rightPos.top - leftPos.top > 3) { // Different lines, draw top part\n          add(left, leftPos.top, null, leftPos.bottom);\n          left = leftSide;\n          if (leftPos.bottom < rightPos.top) add(left, leftPos.bottom, null, rightPos.top);\n        }\n        if (toArg == null && to == lineLen) right = rightSide;\n        if (!start || leftPos.top < start.top || leftPos.top == start.top && leftPos.left < start.left)\n          start = leftPos;\n        if (!end || rightPos.bottom > end.bottom || rightPos.bottom == end.bottom && rightPos.right > end.right)\n          end = rightPos;\n        if (left < leftSide + 1) left = leftSide;\n        add(left, rightPos.top, right - left, rightPos.bottom);\n      });\n      return {start: start, end: end};\n    }\n\n    var sFrom = range.from(), sTo = range.to();\n    if (sFrom.line == sTo.line) {\n      drawForLine(sFrom.line, sFrom.ch, sTo.ch);\n    } else {\n      var fromLine = getLine(doc, sFrom.line), toLine = getLine(doc, sTo.line);\n      var singleVLine = visualLine(fromLine) == visualLine(toLine);\n      var leftEnd = drawForLine(sFrom.line, sFrom.ch, singleVLine ? fromLine.text.length + 1 : null).end;\n      var rightStart = drawForLine(sTo.line, singleVLine ? 0 : null, sTo.ch).start;\n      if (singleVLine) {\n        if (leftEnd.top < rightStart.top - 2) {\n          add(leftEnd.right, leftEnd.top, null, leftEnd.bottom);\n          add(leftSide, rightStart.top, rightStart.left, rightStart.bottom);\n        } else {\n          add(leftEnd.right, leftEnd.top, rightStart.left - leftEnd.right, leftEnd.bottom);\n        }\n      }\n      if (leftEnd.bottom < rightStart.top)\n        add(leftSide, leftEnd.bottom, null, rightStart.top);\n    }\n\n    output.appendChild(fragment);\n  }\n\n  // Cursor-blinking\n  function restartBlink(cm) {\n    if (!cm.state.focused) return;\n    var display = cm.display;\n    clearInterval(display.blinker);\n    var on = true;\n    display.cursorDiv.style.visibility = \"\";\n    if (cm.options.cursorBlinkRate > 0)\n      display.blinker = setInterval(function() {\n        display.cursorDiv.style.visibility = (on = !on) ? \"\" : \"hidden\";\n      }, cm.options.cursorBlinkRate);\n    else if (cm.options.cursorBlinkRate < 0)\n      display.cursorDiv.style.visibility = \"hidden\";\n  }\n\n  // HIGHLIGHT WORKER\n\n  function startWorker(cm, time) {\n    if (cm.doc.mode.startState && cm.doc.frontier < cm.display.viewTo)\n      cm.state.highlight.set(time, bind(highlightWorker, cm));\n  }\n\n  function highlightWorker(cm) {\n    var doc = cm.doc;\n    if (doc.frontier < doc.first) doc.frontier = doc.first;\n    if (doc.frontier >= cm.display.viewTo) return;\n    var end = +new Date + cm.options.workTime;\n    var state = copyState(doc.mode, getStateBefore(cm, doc.frontier));\n    var changedLines = [];\n\n    doc.iter(doc.frontier, Math.min(doc.first + doc.size, cm.display.viewTo + 500), function(line) {\n      if (doc.frontier >= cm.display.viewFrom) { // Visible\n        var oldStyles = line.styles;\n        var highlighted = highlightLine(cm, line, state, true);\n        line.styles = highlighted.styles;\n        var oldCls = line.styleClasses, newCls = highlighted.classes;\n        if (newCls) line.styleClasses = newCls;\n        else if (oldCls) line.styleClasses = null;\n        var ischange = !oldStyles || oldStyles.length != line.styles.length ||\n          oldCls != newCls && (!oldCls || !newCls || oldCls.bgClass != newCls.bgClass || oldCls.textClass != newCls.textClass);\n        for (var i = 0; !ischange && i < oldStyles.length; ++i) ischange = oldStyles[i] != line.styles[i];\n        if (ischange) changedLines.push(doc.frontier);\n        line.stateAfter = copyState(doc.mode, state);\n      } else {\n        processLine(cm, line.text, state);\n        line.stateAfter = doc.frontier % 5 == 0 ? copyState(doc.mode, state) : null;\n      }\n      ++doc.frontier;\n      if (+new Date > end) {\n        startWorker(cm, cm.options.workDelay);\n        return true;\n      }\n    });\n    if (changedLines.length) runInOp(cm, function() {\n      for (var i = 0; i < changedLines.length; i++)\n        regLineChange(cm, changedLines[i], \"text\");\n    });\n  }\n\n  // Finds the line to start with when starting a parse. Tries to\n  // find a line with a stateAfter, so that it can start with a\n  // valid state. If that fails, it returns the line with the\n  // smallest indentation, which tends to need the least context to\n  // parse correctly.\n  function findStartLine(cm, n, precise) {\n    var minindent, minline, doc = cm.doc;\n    var lim = precise ? -1 : n - (cm.doc.mode.innerMode ? 1000 : 100);\n    for (var search = n; search > lim; --search) {\n      if (search <= doc.first) return doc.first;\n      var line = getLine(doc, search - 1);\n      if (line.stateAfter && (!precise || search <= doc.frontier)) return search;\n      var indented = countColumn(line.text, null, cm.options.tabSize);\n      if (minline == null || minindent > indented) {\n        minline = search - 1;\n        minindent = indented;\n      }\n    }\n    return minline;\n  }\n\n  function getStateBefore(cm, n, precise) {\n    var doc = cm.doc, display = cm.display;\n    if (!doc.mode.startState) return true;\n    var pos = findStartLine(cm, n, precise), state = pos > doc.first && getLine(doc, pos-1).stateAfter;\n    if (!state) state = startState(doc.mode);\n    else state = copyState(doc.mode, state);\n    doc.iter(pos, n, function(line) {\n      processLine(cm, line.text, state);\n      var save = pos == n - 1 || pos % 5 == 0 || pos >= display.viewFrom && pos < display.viewTo;\n      line.stateAfter = save ? copyState(doc.mode, state) : null;\n      ++pos;\n    });\n    if (precise) doc.frontier = pos;\n    return state;\n  }\n\n  // POSITION MEASUREMENT\n\n  function paddingTop(display) {return display.lineSpace.offsetTop;}\n  function paddingVert(display) {return display.mover.offsetHeight - display.lineSpace.offsetHeight;}\n  function paddingH(display) {\n    if (display.cachedPaddingH) return display.cachedPaddingH;\n    var e = removeChildrenAndAdd(display.measure, elt(\"pre\", \"x\"));\n    var style = window.getComputedStyle ? window.getComputedStyle(e) : e.currentStyle;\n    var data = {left: parseInt(style.paddingLeft), right: parseInt(style.paddingRight)};\n    if (!isNaN(data.left) && !isNaN(data.right)) display.cachedPaddingH = data;\n    return data;\n  }\n\n  // Ensure the lineView.wrapping.heights array is populated. This is\n  // an array of bottom offsets for the lines that make up a drawn\n  // line. When lineWrapping is on, there might be more than one\n  // height.\n  function ensureLineHeights(cm, lineView, rect) {\n    var wrapping = cm.options.lineWrapping;\n    var curWidth = wrapping && cm.display.scroller.clientWidth;\n    if (!lineView.measure.heights || wrapping && lineView.measure.width != curWidth) {\n      var heights = lineView.measure.heights = [];\n      if (wrapping) {\n        lineView.measure.width = curWidth;\n        var rects = lineView.text.firstChild.getClientRects();\n        for (var i = 0; i < rects.length - 1; i++) {\n          var cur = rects[i], next = rects[i + 1];\n          if (Math.abs(cur.bottom - next.bottom) > 2)\n            heights.push((cur.bottom + next.top) / 2 - rect.top);\n        }\n      }\n      heights.push(rect.bottom - rect.top);\n    }\n  }\n\n  // Find a line map (mapping character offsets to text nodes) and a\n  // measurement cache for the given line number. (A line view might\n  // contain multiple lines when collapsed ranges are present.)\n  function mapFromLineView(lineView, line, lineN) {\n    if (lineView.line == line)\n      return {map: lineView.measure.map, cache: lineView.measure.cache};\n    for (var i = 0; i < lineView.rest.length; i++)\n      if (lineView.rest[i] == line)\n        return {map: lineView.measure.maps[i], cache: lineView.measure.caches[i]};\n    for (var i = 0; i < lineView.rest.length; i++)\n      if (lineNo(lineView.rest[i]) > lineN)\n        return {map: lineView.measure.maps[i], cache: lineView.measure.caches[i], before: true};\n  }\n\n  // Render a line into the hidden node display.externalMeasured. Used\n  // when measurement is needed for a line that's not in the viewport.\n  function updateExternalMeasurement(cm, line) {\n    line = visualLine(line);\n    var lineN = lineNo(line);\n    var view = cm.display.externalMeasured = new LineView(cm.doc, line, lineN);\n    view.lineN = lineN;\n    var built = view.built = buildLineContent(cm, view);\n    view.text = built.pre;\n    removeChildrenAndAdd(cm.display.lineMeasure, built.pre);\n    return view;\n  }\n\n  // Get a {top, bottom, left, right} box (in line-local coordinates)\n  // for a given character.\n  function measureChar(cm, line, ch, bias) {\n    return measureCharPrepared(cm, prepareMeasureForLine(cm, line), ch, bias);\n  }\n\n  // Find a line view that corresponds to the given line number.\n  function findViewForLine(cm, lineN) {\n    if (lineN >= cm.display.viewFrom && lineN < cm.display.viewTo)\n      return cm.display.view[findViewIndex(cm, lineN)];\n    var ext = cm.display.externalMeasured;\n    if (ext && lineN >= ext.lineN && lineN < ext.lineN + ext.size)\n      return ext;\n  }\n\n  // Measurement can be split in two steps, the set-up work that\n  // applies to the whole line, and the measurement of the actual\n  // character. Functions like coordsChar, that need to do a lot of\n  // measurements in a row, can thus ensure that the set-up work is\n  // only done once.\n  function prepareMeasureForLine(cm, line) {\n    var lineN = lineNo(line);\n    var view = findViewForLine(cm, lineN);\n    if (view && !view.text)\n      view = null;\n    else if (view && view.changes)\n      updateLineForChanges(cm, view, lineN, getDimensions(cm));\n    if (!view)\n      view = updateExternalMeasurement(cm, line);\n\n    var info = mapFromLineView(view, line, lineN);\n    return {\n      line: line, view: view, rect: null,\n      map: info.map, cache: info.cache, before: info.before,\n      hasHeights: false\n    };\n  }\n\n  // Given a prepared measurement object, measures the position of an\n  // actual character (or fetches it from the cache).\n  function measureCharPrepared(cm, prepared, ch, bias, varHeight) {\n    if (prepared.before) ch = -1;\n    var key = ch + (bias || \"\"), found;\n    if (prepared.cache.hasOwnProperty(key)) {\n      found = prepared.cache[key];\n    } else {\n      if (!prepared.rect)\n        prepared.rect = prepared.view.text.getBoundingClientRect();\n      if (!prepared.hasHeights) {\n        ensureLineHeights(cm, prepared.view, prepared.rect);\n        prepared.hasHeights = true;\n      }\n      found = measureCharInner(cm, prepared, ch, bias);\n      if (!found.bogus) prepared.cache[key] = found;\n    }\n    return {left: found.left, right: found.right,\n            top: varHeight ? found.rtop : found.top,\n            bottom: varHeight ? found.rbottom : found.bottom};\n  }\n\n  var nullRect = {left: 0, right: 0, top: 0, bottom: 0};\n\n  function measureCharInner(cm, prepared, ch, bias) {\n    var map = prepared.map;\n\n    var node, start, end, collapse;\n    // First, search the line map for the text node corresponding to,\n    // or closest to, the target character.\n    for (var i = 0; i < map.length; i += 3) {\n      var mStart = map[i], mEnd = map[i + 1];\n      if (ch < mStart) {\n        start = 0; end = 1;\n        collapse = \"left\";\n      } else if (ch < mEnd) {\n        start = ch - mStart;\n        end = start + 1;\n      } else if (i == map.length - 3 || ch == mEnd && map[i + 3] > ch) {\n        end = mEnd - mStart;\n        start = end - 1;\n        if (ch >= mEnd) collapse = \"right\";\n      }\n      if (start != null) {\n        node = map[i + 2];\n        if (mStart == mEnd && bias == (node.insertLeft ? \"left\" : \"right\"))\n          collapse = bias;\n        if (bias == \"left\" && start == 0)\n          while (i && map[i - 2] == map[i - 3] && map[i - 1].insertLeft) {\n            node = map[(i -= 3) + 2];\n            collapse = \"left\";\n          }\n        if (bias == \"right\" && start == mEnd - mStart)\n          while (i < map.length - 3 && map[i + 3] == map[i + 4] && !map[i + 5].insertLeft) {\n            node = map[(i += 3) + 2];\n            collapse = \"right\";\n          }\n        break;\n      }\n    }\n\n    var rect;\n    if (node.nodeType == 3) { // If it is a text node, use a range to retrieve the coordinates.\n      for (var i = 0; i < 4; i++) { // Retry a maximum of 4 times when nonsense rectangles are returned\n        while (start && isExtendingChar(prepared.line.text.charAt(mStart + start))) --start;\n        while (mStart + end < mEnd && isExtendingChar(prepared.line.text.charAt(mStart + end))) ++end;\n        if (ie && ie_version < 9 && start == 0 && end == mEnd - mStart) {\n          rect = node.parentNode.getBoundingClientRect();\n        } else if (ie && cm.options.lineWrapping) {\n          var rects = range(node, start, end).getClientRects();\n          if (rects.length)\n            rect = rects[bias == \"right\" ? rects.length - 1 : 0];\n          else\n            rect = nullRect;\n        } else {\n          rect = range(node, start, end).getBoundingClientRect() || nullRect;\n        }\n        if (rect.left || rect.right || start == 0) break;\n        end = start;\n        start = start - 1;\n        collapse = \"right\";\n      }\n      if (ie && ie_version < 11) rect = maybeUpdateRectForZooming(cm.display.measure, rect);\n    } else { // If it is a widget, simply get the box for the whole widget.\n      if (start > 0) collapse = bias = \"right\";\n      var rects;\n      if (cm.options.lineWrapping && (rects = node.getClientRects()).length > 1)\n        rect = rects[bias == \"right\" ? rects.length - 1 : 0];\n      else\n        rect = node.getBoundingClientRect();\n    }\n    if (ie && ie_version < 9 && !start && (!rect || !rect.left && !rect.right)) {\n      var rSpan = node.parentNode.getClientRects()[0];\n      if (rSpan)\n        rect = {left: rSpan.left, right: rSpan.left + charWidth(cm.display), top: rSpan.top, bottom: rSpan.bottom};\n      else\n        rect = nullRect;\n    }\n\n    var rtop = rect.top - prepared.rect.top, rbot = rect.bottom - prepared.rect.top;\n    var mid = (rtop + rbot) / 2;\n    var heights = prepared.view.measure.heights;\n    for (var i = 0; i < heights.length - 1; i++)\n      if (mid < heights[i]) break;\n    var top = i ? heights[i - 1] : 0, bot = heights[i];\n    var result = {left: (collapse == \"right\" ? rect.right : rect.left) - prepared.rect.left,\n                  right: (collapse == \"left\" ? rect.left : rect.right) - prepared.rect.left,\n                  top: top, bottom: bot};\n    if (!rect.left && !rect.right) result.bogus = true;\n    if (!cm.options.singleCursorHeightPerLine) { result.rtop = rtop; result.rbottom = rbot; }\n\n    return result;\n  }\n\n  // Work around problem with bounding client rects on ranges being\n  // returned incorrectly when zoomed on IE10 and below.\n  function maybeUpdateRectForZooming(measure, rect) {\n    if (!window.screen || screen.logicalXDPI == null ||\n        screen.logicalXDPI == screen.deviceXDPI || !hasBadZoomedRects(measure))\n      return rect;\n    var scaleX = screen.logicalXDPI / screen.deviceXDPI;\n    var scaleY = screen.logicalYDPI / screen.deviceYDPI;\n    return {left: rect.left * scaleX, right: rect.right * scaleX,\n            top: rect.top * scaleY, bottom: rect.bottom * scaleY};\n  }\n\n  function clearLineMeasurementCacheFor(lineView) {\n    if (lineView.measure) {\n      lineView.measure.cache = {};\n      lineView.measure.heights = null;\n      if (lineView.rest) for (var i = 0; i < lineView.rest.length; i++)\n        lineView.measure.caches[i] = {};\n    }\n  }\n\n  function clearLineMeasurementCache(cm) {\n    cm.display.externalMeasure = null;\n    removeChildren(cm.display.lineMeasure);\n    for (var i = 0; i < cm.display.view.length; i++)\n      clearLineMeasurementCacheFor(cm.display.view[i]);\n  }\n\n  function clearCaches(cm) {\n    clearLineMeasurementCache(cm);\n    cm.display.cachedCharWidth = cm.display.cachedTextHeight = cm.display.cachedPaddingH = null;\n    if (!cm.options.lineWrapping) cm.display.maxLineChanged = true;\n    cm.display.lineNumChars = null;\n  }\n\n  function pageScrollX() { return window.pageXOffset || (document.documentElement || document.body).scrollLeft; }\n  function pageScrollY() { return window.pageYOffset || (document.documentElement || document.body).scrollTop; }\n\n  // Converts a {top, bottom, left, right} box from line-local\n  // coordinates into another coordinate system. Context may be one of\n  // \"line\", \"div\" (display.lineDiv), \"local\"/null (editor), or \"page\".\n  function intoCoordSystem(cm, lineObj, rect, context) {\n    if (lineObj.widgets) for (var i = 0; i < lineObj.widgets.length; ++i) if (lineObj.widgets[i].above) {\n      var size = widgetHeight(lineObj.widgets[i]);\n      rect.top += size; rect.bottom += size;\n    }\n    if (context == \"line\") return rect;\n    if (!context) context = \"local\";\n    var yOff = heightAtLine(lineObj);\n    if (context == \"local\") yOff += paddingTop(cm.display);\n    else yOff -= cm.display.viewOffset;\n    if (context == \"page\" || context == \"window\") {\n      var lOff = cm.display.lineSpace.getBoundingClientRect();\n      yOff += lOff.top + (context == \"window\" ? 0 : pageScrollY());\n      var xOff = lOff.left + (context == \"window\" ? 0 : pageScrollX());\n      rect.left += xOff; rect.right += xOff;\n    }\n    rect.top += yOff; rect.bottom += yOff;\n    return rect;\n  }\n\n  // Coverts a box from \"div\" coords to another coordinate system.\n  // Context may be \"window\", \"page\", \"div\", or \"local\"/null.\n  function fromCoordSystem(cm, coords, context) {\n    if (context == \"div\") return coords;\n    var left = coords.left, top = coords.top;\n    // First move into \"page\" coordinate system\n    if (context == \"page\") {\n      left -= pageScrollX();\n      top -= pageScrollY();\n    } else if (context == \"local\" || !context) {\n      var localBox = cm.display.sizer.getBoundingClientRect();\n      left += localBox.left;\n      top += localBox.top;\n    }\n\n    var lineSpaceBox = cm.display.lineSpace.getBoundingClientRect();\n    return {left: left - lineSpaceBox.left, top: top - lineSpaceBox.top};\n  }\n\n  function charCoords(cm, pos, context, lineObj, bias) {\n    if (!lineObj) lineObj = getLine(cm.doc, pos.line);\n    return intoCoordSystem(cm, lineObj, measureChar(cm, lineObj, pos.ch, bias), context);\n  }\n\n  // Returns a box for a given cursor position, which may have an\n  // 'other' property containing the position of the secondary cursor\n  // on a bidi boundary.\n  function cursorCoords(cm, pos, context, lineObj, preparedMeasure, varHeight) {\n    lineObj = lineObj || getLine(cm.doc, pos.line);\n    if (!preparedMeasure) preparedMeasure = prepareMeasureForLine(cm, lineObj);\n    function get(ch, right) {\n      var m = measureCharPrepared(cm, preparedMeasure, ch, right ? \"right\" : \"left\", varHeight);\n      if (right) m.left = m.right; else m.right = m.left;\n      return intoCoordSystem(cm, lineObj, m, context);\n    }\n    function getBidi(ch, partPos) {\n      var part = order[partPos], right = part.level % 2;\n      if (ch == bidiLeft(part) && partPos && part.level < order[partPos - 1].level) {\n        part = order[--partPos];\n        ch = bidiRight(part) - (part.level % 2 ? 0 : 1);\n        right = true;\n      } else if (ch == bidiRight(part) && partPos < order.length - 1 && part.level < order[partPos + 1].level) {\n        part = order[++partPos];\n        ch = bidiLeft(part) - part.level % 2;\n        right = false;\n      }\n      if (right && ch == part.to && ch > part.from) return get(ch - 1);\n      return get(ch, right);\n    }\n    var order = getOrder(lineObj), ch = pos.ch;\n    if (!order) return get(ch);\n    var partPos = getBidiPartAt(order, ch);\n    var val = getBidi(ch, partPos);\n    if (bidiOther != null) val.other = getBidi(ch, bidiOther);\n    return val;\n  }\n\n  // Used to cheaply estimate the coordinates for a position. Used for\n  // intermediate scroll updates.\n  function estimateCoords(cm, pos) {\n    var left = 0, pos = clipPos(cm.doc, pos);\n    if (!cm.options.lineWrapping) left = charWidth(cm.display) * pos.ch;\n    var lineObj = getLine(cm.doc, pos.line);\n    var top = heightAtLine(lineObj) + paddingTop(cm.display);\n    return {left: left, right: left, top: top, bottom: top + lineObj.height};\n  }\n\n  // Positions returned by coordsChar contain some extra information.\n  // xRel is the relative x position of the input coordinates compared\n  // to the found position (so xRel > 0 means the coordinates are to\n  // the right of the character position, for example). When outside\n  // is true, that means the coordinates lie outside the line's\n  // vertical range.\n  function PosWithInfo(line, ch, outside, xRel) {\n    var pos = Pos(line, ch);\n    pos.xRel = xRel;\n    if (outside) pos.outside = true;\n    return pos;\n  }\n\n  // Compute the character position closest to the given coordinates.\n  // Input must be lineSpace-local (\"div\" coordinate system).\n  function coordsChar(cm, x, y) {\n    var doc = cm.doc;\n    y += cm.display.viewOffset;\n    if (y < 0) return PosWithInfo(doc.first, 0, true, -1);\n    var lineN = lineAtHeight(doc, y), last = doc.first + doc.size - 1;\n    if (lineN > last)\n      return PosWithInfo(doc.first + doc.size - 1, getLine(doc, last).text.length, true, 1);\n    if (x < 0) x = 0;\n\n    var lineObj = getLine(doc, lineN);\n    for (;;) {\n      var found = coordsCharInner(cm, lineObj, lineN, x, y);\n      var merged = collapsedSpanAtEnd(lineObj);\n      var mergedPos = merged && merged.find(0, true);\n      if (merged && (found.ch > mergedPos.from.ch || found.ch == mergedPos.from.ch && found.xRel > 0))\n        lineN = lineNo(lineObj = mergedPos.to.line);\n      else\n        return found;\n    }\n  }\n\n  function coordsCharInner(cm, lineObj, lineNo, x, y) {\n    var innerOff = y - heightAtLine(lineObj);\n    var wrongLine = false, adjust = 2 * cm.display.wrapper.clientWidth;\n    var preparedMeasure = prepareMeasureForLine(cm, lineObj);\n\n    function getX(ch) {\n      var sp = cursorCoords(cm, Pos(lineNo, ch), \"line\", lineObj, preparedMeasure);\n      wrongLine = true;\n      if (innerOff > sp.bottom) return sp.left - adjust;\n      else if (innerOff < sp.top) return sp.left + adjust;\n      else wrongLine = false;\n      return sp.left;\n    }\n\n    var bidi = getOrder(lineObj), dist = lineObj.text.length;\n    var from = lineLeft(lineObj), to = lineRight(lineObj);\n    var fromX = getX(from), fromOutside = wrongLine, toX = getX(to), toOutside = wrongLine;\n\n    if (x > toX) return PosWithInfo(lineNo, to, toOutside, 1);\n    // Do a binary search between these bounds.\n    for (;;) {\n      if (bidi ? to == from || to == moveVisually(lineObj, from, 1) : to - from <= 1) {\n        var ch = x < fromX || x - fromX <= toX - x ? from : to;\n        var xDiff = x - (ch == from ? fromX : toX);\n        while (isExtendingChar(lineObj.text.charAt(ch))) ++ch;\n        var pos = PosWithInfo(lineNo, ch, ch == from ? fromOutside : toOutside,\n                              xDiff < -1 ? -1 : xDiff > 1 ? 1 : 0);\n        return pos;\n      }\n      var step = Math.ceil(dist / 2), middle = from + step;\n      if (bidi) {\n        middle = from;\n        for (var i = 0; i < step; ++i) middle = moveVisually(lineObj, middle, 1);\n      }\n      var middleX = getX(middle);\n      if (middleX > x) {to = middle; toX = middleX; if (toOutside = wrongLine) toX += 1000; dist = step;}\n      else {from = middle; fromX = middleX; fromOutside = wrongLine; dist -= step;}\n    }\n  }\n\n  var measureText;\n  // Compute the default text height.\n  function textHeight(display) {\n    if (display.cachedTextHeight != null) return display.cachedTextHeight;\n    if (measureText == null) {\n      measureText = elt(\"pre\");\n      // Measure a bunch of lines, for browsers that compute\n      // fractional heights.\n      for (var i = 0; i < 49; ++i) {\n        measureText.appendChild(document.createTextNode(\"x\"));\n        measureText.appendChild(elt(\"br\"));\n      }\n      measureText.appendChild(document.createTextNode(\"x\"));\n    }\n    removeChildrenAndAdd(display.measure, measureText);\n    var height = measureText.offsetHeight / 50;\n    if (height > 3) display.cachedTextHeight = height;\n    removeChildren(display.measure);\n    return height || 1;\n  }\n\n  // Compute the default character width.\n  function charWidth(display) {\n    if (display.cachedCharWidth != null) return display.cachedCharWidth;\n    var anchor = elt(\"span\", \"xxxxxxxxxx\");\n    var pre = elt(\"pre\", [anchor]);\n    removeChildrenAndAdd(display.measure, pre);\n    var rect = anchor.getBoundingClientRect(), width = (rect.right - rect.left) / 10;\n    if (width > 2) display.cachedCharWidth = width;\n    return width || 10;\n  }\n\n  // OPERATIONS\n\n  // Operations are used to wrap a series of changes to the editor\n  // state in such a way that each change won't have to update the\n  // cursor and display (which would be awkward, slow, and\n  // error-prone). Instead, display updates are batched and then all\n  // combined and executed at once.\n\n  var operationGroup = null;\n\n  var nextOpId = 0;\n  // Start a new operation.\n  function startOperation(cm) {\n    cm.curOp = {\n      cm: cm,\n      viewChanged: false,      // Flag that indicates that lines might need to be redrawn\n      startHeight: cm.doc.height, // Used to detect need to update scrollbar\n      forceUpdate: false,      // Used to force a redraw\n      updateInput: null,       // Whether to reset the input textarea\n      typing: false,           // Whether this reset should be careful to leave existing text (for compositing)\n      changeObjs: null,        // Accumulated changes, for firing change events\n      cursorActivityHandlers: null, // Set of handlers to fire cursorActivity on\n      cursorActivityCalled: 0, // Tracks which cursorActivity handlers have been called already\n      selectionChanged: false, // Whether the selection needs to be redrawn\n      updateMaxLine: false,    // Set when the widest line needs to be determined anew\n      scrollLeft: null, scrollTop: null, // Intermediate scroll position, not pushed to DOM yet\n      scrollToPos: null,       // Used to scroll to a specific position\n      id: ++nextOpId           // Unique ID\n    };\n    if (operationGroup) {\n      operationGroup.ops.push(cm.curOp);\n    } else {\n      cm.curOp.ownsGroup = operationGroup = {\n        ops: [cm.curOp],\n        delayedCallbacks: []\n      };\n    }\n  }\n\n  function fireCallbacksForOps(group) {\n    // Calls delayed callbacks and cursorActivity handlers until no\n    // new ones appear\n    var callbacks = group.delayedCallbacks, i = 0;\n    do {\n      for (; i < callbacks.length; i++)\n        callbacks[i]();\n      for (var j = 0; j < group.ops.length; j++) {\n        var op = group.ops[j];\n        if (op.cursorActivityHandlers)\n          while (op.cursorActivityCalled < op.cursorActivityHandlers.length)\n            op.cursorActivityHandlers[op.cursorActivityCalled++](op.cm);\n      }\n    } while (i < callbacks.length);\n  }\n\n  // Finish an operation, updating the display and signalling delayed events\n  function endOperation(cm) {\n    var op = cm.curOp, group = op.ownsGroup;\n    if (!group) return;\n\n    try { fireCallbacksForOps(group); }\n    finally {\n      operationGroup = null;\n      for (var i = 0; i < group.ops.length; i++)\n        group.ops[i].cm.curOp = null;\n      endOperations(group);\n    }\n  }\n\n  // The DOM updates done when an operation finishes are batched so\n  // that the minimum number of relayouts are required.\n  function endOperations(group) {\n    var ops = group.ops;\n    for (var i = 0; i < ops.length; i++) // Read DOM\n      endOperation_R1(ops[i]);\n    for (var i = 0; i < ops.length; i++) // Write DOM (maybe)\n      endOperation_W1(ops[i]);\n    for (var i = 0; i < ops.length; i++) // Read DOM\n      endOperation_R2(ops[i]);\n    for (var i = 0; i < ops.length; i++) // Write DOM (maybe)\n      endOperation_W2(ops[i]);\n    for (var i = 0; i < ops.length; i++) // Read DOM\n      endOperation_finish(ops[i]);\n  }\n\n  function endOperation_R1(op) {\n    var cm = op.cm, display = cm.display;\n    if (op.updateMaxLine) findMaxLine(cm);\n\n    op.mustUpdate = op.viewChanged || op.forceUpdate || op.scrollTop != null ||\n      op.scrollToPos && (op.scrollToPos.from.line < display.viewFrom ||\n                         op.scrollToPos.to.line >= display.viewTo) ||\n      display.maxLineChanged && cm.options.lineWrapping;\n    op.update = op.mustUpdate &&\n      new DisplayUpdate(cm, op.mustUpdate && {top: op.scrollTop, ensure: op.scrollToPos}, op.forceUpdate);\n  }\n\n  function endOperation_W1(op) {\n    op.updatedDisplay = op.mustUpdate && updateDisplayIfNeeded(op.cm, op.update);\n  }\n\n  function endOperation_R2(op) {\n    var cm = op.cm, display = cm.display;\n    if (op.updatedDisplay) updateHeightsInViewport(cm);\n\n    op.barMeasure = measureForScrollbars(cm);\n\n    // If the max line changed since it was last measured, measure it,\n    // and ensure the document's width matches it.\n    // updateDisplay_W2 will use these properties to do the actual resizing\n    if (display.maxLineChanged && !cm.options.lineWrapping) {\n      op.adjustWidthTo = measureChar(cm, display.maxLine, display.maxLine.text.length).left + 3;\n      op.maxScrollLeft = Math.max(0, display.sizer.offsetLeft + op.adjustWidthTo +\n                                  scrollerCutOff - display.scroller.clientWidth);\n    }\n\n    if (op.updatedDisplay || op.selectionChanged)\n      op.newSelectionNodes = drawSelection(cm);\n  }\n\n  function endOperation_W2(op) {\n    var cm = op.cm;\n\n    if (op.adjustWidthTo != null) {\n      cm.display.sizer.style.minWidth = op.adjustWidthTo + \"px\";\n      if (op.maxScrollLeft < cm.doc.scrollLeft)\n        setScrollLeft(cm, Math.min(cm.display.scroller.scrollLeft, op.maxScrollLeft), true);\n      cm.display.maxLineChanged = false;\n    }\n\n    if (op.newSelectionNodes)\n      showSelection(cm, op.newSelectionNodes);\n    if (op.updatedDisplay)\n      setDocumentHeight(cm, op.barMeasure);\n    if (op.updatedDisplay || op.startHeight != cm.doc.height)\n      updateScrollbars(cm, op.barMeasure);\n\n    if (op.selectionChanged) restartBlink(cm);\n\n    if (cm.state.focused && op.updateInput)\n      resetInput(cm, op.typing);\n  }\n\n  function endOperation_finish(op) {\n    var cm = op.cm, display = cm.display, doc = cm.doc;\n\n    if (op.adjustWidthTo != null && Math.abs(op.barMeasure.scrollWidth - cm.display.scroller.scrollWidth) > 1)\n      updateScrollbars(cm);\n\n    if (op.updatedDisplay) postUpdateDisplay(cm, op.update);\n\n    // Abort mouse wheel delta measurement, when scrolling explicitly\n    if (display.wheelStartX != null && (op.scrollTop != null || op.scrollLeft != null || op.scrollToPos))\n      display.wheelStartX = display.wheelStartY = null;\n\n    // Propagate the scroll position to the actual DOM scroller\n    if (op.scrollTop != null && (display.scroller.scrollTop != op.scrollTop || op.forceScroll)) {\n      var top = Math.max(0, Math.min(display.scroller.scrollHeight - display.scroller.clientHeight, op.scrollTop));\n      display.scroller.scrollTop = display.scrollbarV.scrollTop = doc.scrollTop = top;\n    }\n    if (op.scrollLeft != null && (display.scroller.scrollLeft != op.scrollLeft || op.forceScroll)) {\n      var left = Math.max(0, Math.min(display.scroller.scrollWidth - display.scroller.clientWidth, op.scrollLeft));\n      display.scroller.scrollLeft = display.scrollbarH.scrollLeft = doc.scrollLeft = left;\n      alignHorizontally(cm);\n    }\n    // If we need to scroll a specific position into view, do so.\n    if (op.scrollToPos) {\n      var coords = scrollPosIntoView(cm, clipPos(doc, op.scrollToPos.from),\n                                     clipPos(doc, op.scrollToPos.to), op.scrollToPos.margin);\n      if (op.scrollToPos.isCursor && cm.state.focused) maybeScrollWindow(cm, coords);\n    }\n\n    // Fire events for markers that are hidden/unidden by editing or\n    // undoing\n    var hidden = op.maybeHiddenMarkers, unhidden = op.maybeUnhiddenMarkers;\n    if (hidden) for (var i = 0; i < hidden.length; ++i)\n      if (!hidden[i].lines.length) signal(hidden[i], \"hide\");\n    if (unhidden) for (var i = 0; i < unhidden.length; ++i)\n      if (unhidden[i].lines.length) signal(unhidden[i], \"unhide\");\n\n    if (display.wrapper.offsetHeight)\n      doc.scrollTop = cm.display.scroller.scrollTop;\n\n    // Apply workaround for two webkit bugs\n    if (op.updatedDisplay && webkit) {\n      if (cm.options.lineWrapping)\n        checkForWebkitWidthBug(cm, op.barMeasure); // (Issue #2420)\n      if (op.barMeasure.scrollWidth > op.barMeasure.clientWidth &&\n          op.barMeasure.scrollWidth < op.barMeasure.clientWidth + 1 &&\n          !hScrollbarTakesSpace(cm))\n        updateScrollbars(cm); // (Issue #2562)\n    }\n\n    // Fire change events, and delayed event handlers\n    if (op.changeObjs)\n      signal(cm, \"changes\", cm, op.changeObjs);\n  }\n\n  // Run the given function in an operation\n  function runInOp(cm, f) {\n    if (cm.curOp) return f();\n    startOperation(cm);\n    try { return f(); }\n    finally { endOperation(cm); }\n  }\n  // Wraps a function in an operation. Returns the wrapped function.\n  function operation(cm, f) {\n    return function() {\n      if (cm.curOp) return f.apply(cm, arguments);\n      startOperation(cm);\n      try { return f.apply(cm, arguments); }\n      finally { endOperation(cm); }\n    };\n  }\n  // Used to add methods to editor and doc instances, wrapping them in\n  // operations.\n  function methodOp(f) {\n    return function() {\n      if (this.curOp) return f.apply(this, arguments);\n      startOperation(this);\n      try { return f.apply(this, arguments); }\n      finally { endOperation(this); }\n    };\n  }\n  function docMethodOp(f) {\n    return function() {\n      var cm = this.cm;\n      if (!cm || cm.curOp) return f.apply(this, arguments);\n      startOperation(cm);\n      try { return f.apply(this, arguments); }\n      finally { endOperation(cm); }\n    };\n  }\n\n  // VIEW TRACKING\n\n  // These objects are used to represent the visible (currently drawn)\n  // part of the document. A LineView may correspond to multiple\n  // logical lines, if those are connected by collapsed ranges.\n  function LineView(doc, line, lineN) {\n    // The starting line\n    this.line = line;\n    // Continuing lines, if any\n    this.rest = visualLineContinued(line);\n    // Number of logical lines in this visual line\n    this.size = this.rest ? lineNo(lst(this.rest)) - lineN + 1 : 1;\n    this.node = this.text = null;\n    this.hidden = lineIsHidden(doc, line);\n  }\n\n  // Create a range of LineView objects for the given lines.\n  function buildViewArray(cm, from, to) {\n    var array = [], nextPos;\n    for (var pos = from; pos < to; pos = nextPos) {\n      var view = new LineView(cm.doc, getLine(cm.doc, pos), pos);\n      nextPos = pos + view.size;\n      array.push(view);\n    }\n    return array;\n  }\n\n  // Updates the display.view data structure for a given change to the\n  // document. From and to are in pre-change coordinates. Lendiff is\n  // the amount of lines added or subtracted by the change. This is\n  // used for changes that span multiple lines, or change the way\n  // lines are divided into visual lines. regLineChange (below)\n  // registers single-line changes.\n  function regChange(cm, from, to, lendiff) {\n    if (from == null) from = cm.doc.first;\n    if (to == null) to = cm.doc.first + cm.doc.size;\n    if (!lendiff) lendiff = 0;\n\n    var display = cm.display;\n    if (lendiff && to < display.viewTo &&\n        (display.updateLineNumbers == null || display.updateLineNumbers > from))\n      display.updateLineNumbers = from;\n\n    cm.curOp.viewChanged = true;\n\n    if (from >= display.viewTo) { // Change after\n      if (sawCollapsedSpans && visualLineNo(cm.doc, from) < display.viewTo)\n        resetView(cm);\n    } else if (to <= display.viewFrom) { // Change before\n      if (sawCollapsedSpans && visualLineEndNo(cm.doc, to + lendiff) > display.viewFrom) {\n        resetView(cm);\n      } else {\n        display.viewFrom += lendiff;\n        display.viewTo += lendiff;\n      }\n    } else if (from <= display.viewFrom && to >= display.viewTo) { // Full overlap\n      resetView(cm);\n    } else if (from <= display.viewFrom) { // Top overlap\n      var cut = viewCuttingPoint(cm, to, to + lendiff, 1);\n      if (cut) {\n        display.view = display.view.slice(cut.index);\n        display.viewFrom = cut.lineN;\n        display.viewTo += lendiff;\n      } else {\n        resetView(cm);\n      }\n    } else if (to >= display.viewTo) { // Bottom overlap\n      var cut = viewCuttingPoint(cm, from, from, -1);\n      if (cut) {\n        display.view = display.view.slice(0, cut.index);\n        display.viewTo = cut.lineN;\n      } else {\n        resetView(cm);\n      }\n    } else { // Gap in the middle\n      var cutTop = viewCuttingPoint(cm, from, from, -1);\n      var cutBot = viewCuttingPoint(cm, to, to + lendiff, 1);\n      if (cutTop && cutBot) {\n        display.view = display.view.slice(0, cutTop.index)\n          .concat(buildViewArray(cm, cutTop.lineN, cutBot.lineN))\n          .concat(display.view.slice(cutBot.index));\n        display.viewTo += lendiff;\n      } else {\n        resetView(cm);\n      }\n    }\n\n    var ext = display.externalMeasured;\n    if (ext) {\n      if (to < ext.lineN)\n        ext.lineN += lendiff;\n      else if (from < ext.lineN + ext.size)\n        display.externalMeasured = null;\n    }\n  }\n\n  // Register a change to a single line. Type must be one of \"text\",\n  // \"gutter\", \"class\", \"widget\"\n  function regLineChange(cm, line, type) {\n    cm.curOp.viewChanged = true;\n    var display = cm.display, ext = cm.display.externalMeasured;\n    if (ext && line >= ext.lineN && line < ext.lineN + ext.size)\n      display.externalMeasured = null;\n\n    if (line < display.viewFrom || line >= display.viewTo) return;\n    var lineView = display.view[findViewIndex(cm, line)];\n    if (lineView.node == null) return;\n    var arr = lineView.changes || (lineView.changes = []);\n    if (indexOf(arr, type) == -1) arr.push(type);\n  }\n\n  // Clear the view.\n  function resetView(cm) {\n    cm.display.viewFrom = cm.display.viewTo = cm.doc.first;\n    cm.display.view = [];\n    cm.display.viewOffset = 0;\n  }\n\n  // Find the view element corresponding to a given line. Return null\n  // when the line isn't visible.\n  function findViewIndex(cm, n) {\n    if (n >= cm.display.viewTo) return null;\n    n -= cm.display.viewFrom;\n    if (n < 0) return null;\n    var view = cm.display.view;\n    for (var i = 0; i < view.length; i++) {\n      n -= view[i].size;\n      if (n < 0) return i;\n    }\n  }\n\n  function viewCuttingPoint(cm, oldN, newN, dir) {\n    var index = findViewIndex(cm, oldN), diff, view = cm.display.view;\n    if (!sawCollapsedSpans || newN == cm.doc.first + cm.doc.size)\n      return {index: index, lineN: newN};\n    for (var i = 0, n = cm.display.viewFrom; i < index; i++)\n      n += view[i].size;\n    if (n != oldN) {\n      if (dir > 0) {\n        if (index == view.length - 1) return null;\n        diff = (n + view[index].size) - oldN;\n        index++;\n      } else {\n        diff = n - oldN;\n      }\n      oldN += diff; newN += diff;\n    }\n    while (visualLineNo(cm.doc, newN) != newN) {\n      if (index == (dir < 0 ? 0 : view.length - 1)) return null;\n      newN += dir * view[index - (dir < 0 ? 1 : 0)].size;\n      index += dir;\n    }\n    return {index: index, lineN: newN};\n  }\n\n  // Force the view to cover a given range, adding empty view element\n  // or clipping off existing ones as needed.\n  function adjustView(cm, from, to) {\n    var display = cm.display, view = display.view;\n    if (view.length == 0 || from >= display.viewTo || to <= display.viewFrom) {\n      display.view = buildViewArray(cm, from, to);\n      display.viewFrom = from;\n    } else {\n      if (display.viewFrom > from)\n        display.view = buildViewArray(cm, from, display.viewFrom).concat(display.view);\n      else if (display.viewFrom < from)\n        display.view = display.view.slice(findViewIndex(cm, from));\n      display.viewFrom = from;\n      if (display.viewTo < to)\n        display.view = display.view.concat(buildViewArray(cm, display.viewTo, to));\n      else if (display.viewTo > to)\n        display.view = display.view.slice(0, findViewIndex(cm, to));\n    }\n    display.viewTo = to;\n  }\n\n  // Count the number of lines in the view whose DOM representation is\n  // out of date (or nonexistent).\n  function countDirtyView(cm) {\n    var view = cm.display.view, dirty = 0;\n    for (var i = 0; i < view.length; i++) {\n      var lineView = view[i];\n      if (!lineView.hidden && (!lineView.node || lineView.changes)) ++dirty;\n    }\n    return dirty;\n  }\n\n  // INPUT HANDLING\n\n  // Poll for input changes, using the normal rate of polling. This\n  // runs as long as the editor is focused.\n  function slowPoll(cm) {\n    if (cm.display.pollingFast) return;\n    cm.display.poll.set(cm.options.pollInterval, function() {\n      readInput(cm);\n      if (cm.state.focused) slowPoll(cm);\n    });\n  }\n\n  // When an event has just come in that is likely to add or change\n  // something in the input textarea, we poll faster, to ensure that\n  // the change appears on the screen quickly.\n  function fastPoll(cm) {\n    var missed = false;\n    cm.display.pollingFast = true;\n    function p() {\n      var changed = readInput(cm);\n      if (!changed && !missed) {missed = true; cm.display.poll.set(60, p);}\n      else {cm.display.pollingFast = false; slowPoll(cm);}\n    }\n    cm.display.poll.set(20, p);\n  }\n\n  // This will be set to an array of strings when copying, so that,\n  // when pasting, we know what kind of selections the copied text\n  // was made out of.\n  var lastCopied = null;\n\n  // Read input from the textarea, and update the document to match.\n  // When something is selected, it is present in the textarea, and\n  // selected (unless it is huge, in which case a placeholder is\n  // used). When nothing is selected, the cursor sits after previously\n  // seen text (can be empty), which is stored in prevInput (we must\n  // not reset the textarea when typing, because that breaks IME).\n  function readInput(cm) {\n    var input = cm.display.input, prevInput = cm.display.prevInput, doc = cm.doc;\n    // Since this is called a *lot*, try to bail out as cheaply as\n    // possible when it is clear that nothing happened. hasSelection\n    // will be the case when there is a lot of text in the textarea,\n    // in which case reading its value would be expensive.\n    if (!cm.state.focused || (hasSelection(input) && !prevInput) || isReadOnly(cm) || cm.options.disableInput || cm.state.keySeq)\n      return false;\n    // See paste handler for more on the fakedLastChar kludge\n    if (cm.state.pasteIncoming && cm.state.fakedLastChar) {\n      input.value = input.value.substring(0, input.value.length - 1);\n      cm.state.fakedLastChar = false;\n    }\n    var text = input.value;\n    // If nothing changed, bail.\n    if (text == prevInput && !cm.somethingSelected()) return false;\n    // Work around nonsensical selection resetting in IE9/10, and\n    // inexplicable appearance of private area unicode characters on\n    // some key combos in Mac (#2689).\n    if (ie && ie_version >= 9 && cm.display.inputHasSelection === text ||\n        mac && /[\\uf700-\\uf7ff]/.test(text)) {\n      resetInput(cm);\n      return false;\n    }\n\n    var withOp = !cm.curOp;\n    if (withOp) startOperation(cm);\n    cm.display.shift = false;\n\n    if (text.charCodeAt(0) == 0x200b && doc.sel == cm.display.selForContextMenu && !prevInput)\n      prevInput = \"\\u200b\";\n    // Find the part of the input that is actually new\n    var same = 0, l = Math.min(prevInput.length, text.length);\n    while (same < l && prevInput.charCodeAt(same) == text.charCodeAt(same)) ++same;\n    var inserted = text.slice(same), textLines = splitLines(inserted);\n\n    // When pasing N lines into N selections, insert one line per selection\n    var multiPaste = null;\n    if (cm.state.pasteIncoming && doc.sel.ranges.length > 1) {\n      if (lastCopied && lastCopied.join(\"\\n\") == inserted)\n        multiPaste = doc.sel.ranges.length % lastCopied.length == 0 && map(lastCopied, splitLines);\n      else if (textLines.length == doc.sel.ranges.length)\n        multiPaste = map(textLines, function(l) { return [l]; });\n    }\n\n    // Normal behavior is to insert the new text into every selection\n    for (var i = doc.sel.ranges.length - 1; i >= 0; i--) {\n      var range = doc.sel.ranges[i];\n      var from = range.from(), to = range.to();\n      // Handle deletion\n      if (same < prevInput.length)\n        from = Pos(from.line, from.ch - (prevInput.length - same));\n      // Handle overwrite\n      else if (cm.state.overwrite && range.empty() && !cm.state.pasteIncoming)\n        to = Pos(to.line, Math.min(getLine(doc, to.line).text.length, to.ch + lst(textLines).length));\n      var updateInput = cm.curOp.updateInput;\n      var changeEvent = {from: from, to: to, text: multiPaste ? multiPaste[i % multiPaste.length] : textLines,\n                         origin: cm.state.pasteIncoming ? \"paste\" : cm.state.cutIncoming ? \"cut\" : \"+input\"};\n      makeChange(cm.doc, changeEvent);\n      signalLater(cm, \"inputRead\", cm, changeEvent);\n      // When an 'electric' character is inserted, immediately trigger a reindent\n      if (inserted && !cm.state.pasteIncoming && cm.options.electricChars &&\n          cm.options.smartIndent && range.head.ch < 100 &&\n          (!i || doc.sel.ranges[i - 1].head.line != range.head.line)) {\n        var mode = cm.getModeAt(range.head);\n        var end = changeEnd(changeEvent);\n        if (mode.electricChars) {\n          for (var j = 0; j < mode.electricChars.length; j++)\n            if (inserted.indexOf(mode.electricChars.charAt(j)) > -1) {\n              indentLine(cm, end.line, \"smart\");\n              break;\n            }\n        } else if (mode.electricInput) {\n          if (mode.electricInput.test(getLine(doc, end.line).text.slice(0, end.ch)))\n            indentLine(cm, end.line, \"smart\");\n        }\n      }\n    }\n    ensureCursorVisible(cm);\n    cm.curOp.updateInput = updateInput;\n    cm.curOp.typing = true;\n\n    // Don't leave long text in the textarea, since it makes further polling slow\n    if (text.length > 1000 || text.indexOf(\"\\n\") > -1) input.value = cm.display.prevInput = \"\";\n    else cm.display.prevInput = text;\n    if (withOp) endOperation(cm);\n    cm.state.pasteIncoming = cm.state.cutIncoming = false;\n    return true;\n  }\n\n  // Reset the input to correspond to the selection (or to be empty,\n  // when not typing and nothing is selected)\n  function resetInput(cm, typing) {\n    var minimal, selected, doc = cm.doc;\n    if (cm.somethingSelected()) {\n      cm.display.prevInput = \"\";\n      var range = doc.sel.primary();\n      minimal = hasCopyEvent &&\n        (range.to().line - range.from().line > 100 || (selected = cm.getSelection()).length > 1000);\n      var content = minimal ? \"-\" : selected || cm.getSelection();\n      cm.display.input.value = content;\n      if (cm.state.focused) selectInput(cm.display.input);\n      if (ie && ie_version >= 9) cm.display.inputHasSelection = content;\n    } else if (!typing) {\n      cm.display.prevInput = cm.display.input.value = \"\";\n      if (ie && ie_version >= 9) cm.display.inputHasSelection = null;\n    }\n    cm.display.inaccurateSelection = minimal;\n  }\n\n  function focusInput(cm) {\n    if (cm.options.readOnly != \"nocursor\" && (!mobile || activeElt() != cm.display.input))\n      cm.display.input.focus();\n  }\n\n  function ensureFocus(cm) {\n    if (!cm.state.focused) { focusInput(cm); onFocus(cm); }\n  }\n\n  function isReadOnly(cm) {\n    return cm.options.readOnly || cm.doc.cantEdit;\n  }\n\n  // EVENT HANDLERS\n\n  // Attach the necessary event handlers when initializing the editor\n  function registerEventHandlers(cm) {\n    var d = cm.display;\n    on(d.scroller, \"mousedown\", operation(cm, onMouseDown));\n    // Older IE's will not fire a second mousedown for a double click\n    if (ie && ie_version < 11)\n      on(d.scroller, \"dblclick\", operation(cm, function(e) {\n        if (signalDOMEvent(cm, e)) return;\n        var pos = posFromMouse(cm, e);\n        if (!pos || clickInGutter(cm, e) || eventInWidget(cm.display, e)) return;\n        e_preventDefault(e);\n        var word = cm.findWordAt(pos);\n        extendSelection(cm.doc, word.anchor, word.head);\n      }));\n    else\n      on(d.scroller, \"dblclick\", function(e) { signalDOMEvent(cm, e) || e_preventDefault(e); });\n    // Prevent normal selection in the editor (we handle our own)\n    on(d.lineSpace, \"selectstart\", function(e) {\n      if (!eventInWidget(d, e)) e_preventDefault(e);\n    });\n    // Some browsers fire contextmenu *after* opening the menu, at\n    // which point we can't mess with it anymore. Context menu is\n    // handled in onMouseDown for these browsers.\n    if (!captureRightClick) on(d.scroller, \"contextmenu\", function(e) {onContextMenu(cm, e);});\n\n    // Sync scrolling between fake scrollbars and real scrollable\n    // area, ensure viewport is updated when scrolling.\n    on(d.scroller, \"scroll\", function() {\n      if (d.scroller.clientHeight) {\n        setScrollTop(cm, d.scroller.scrollTop);\n        setScrollLeft(cm, d.scroller.scrollLeft, true);\n        signal(cm, \"scroll\", cm);\n      }\n    });\n    on(d.scrollbarV, \"scroll\", function() {\n      if (d.scroller.clientHeight) setScrollTop(cm, d.scrollbarV.scrollTop);\n    });\n    on(d.scrollbarH, \"scroll\", function() {\n      if (d.scroller.clientHeight) setScrollLeft(cm, d.scrollbarH.scrollLeft);\n    });\n\n    // Listen to wheel events in order to try and update the viewport on time.\n    on(d.scroller, \"mousewheel\", function(e){onScrollWheel(cm, e);});\n    on(d.scroller, \"DOMMouseScroll\", function(e){onScrollWheel(cm, e);});\n\n    // Prevent clicks in the scrollbars from killing focus\n    function reFocus() { if (cm.state.focused) setTimeout(bind(focusInput, cm), 0); }\n    on(d.scrollbarH, \"mousedown\", reFocus);\n    on(d.scrollbarV, \"mousedown\", reFocus);\n    // Prevent wrapper from ever scrolling\n    on(d.wrapper, \"scroll\", function() { d.wrapper.scrollTop = d.wrapper.scrollLeft = 0; });\n\n    on(d.input, \"keyup\", function(e) { onKeyUp.call(cm, e); });\n    on(d.input, \"input\", function() {\n      if (ie && ie_version >= 9 && cm.display.inputHasSelection) cm.display.inputHasSelection = null;\n      fastPoll(cm);\n    });\n    on(d.input, \"keydown\", operation(cm, onKeyDown));\n    on(d.input, \"keypress\", operation(cm, onKeyPress));\n    on(d.input, \"focus\", bind(onFocus, cm));\n    on(d.input, \"blur\", bind(onBlur, cm));\n\n    function drag_(e) {\n      if (!signalDOMEvent(cm, e)) e_stop(e);\n    }\n    if (cm.options.dragDrop) {\n      on(d.scroller, \"dragstart\", function(e){onDragStart(cm, e);});\n      on(d.scroller, \"dragenter\", drag_);\n      on(d.scroller, \"dragover\", drag_);\n      on(d.scroller, \"drop\", operation(cm, onDrop));\n    }\n    on(d.scroller, \"paste\", function(e) {\n      if (eventInWidget(d, e)) return;\n      cm.state.pasteIncoming = true;\n      focusInput(cm);\n      fastPoll(cm);\n    });\n    on(d.input, \"paste\", function() {\n      // Workaround for webkit bug https://bugs.webkit.org/show_bug.cgi?id=90206\n      // Add a char to the end of textarea before paste occur so that\n      // selection doesn't span to the end of textarea.\n      if (webkit && !cm.state.fakedLastChar && !(new Date - cm.state.lastMiddleDown < 200)) {\n        var start = d.input.selectionStart, end = d.input.selectionEnd;\n        d.input.value += \"$\";\n        // The selection end needs to be set before the start, otherwise there\n        // can be an intermediate non-empty selection between the two, which\n        // can override the middle-click paste buffer on linux and cause the\n        // wrong thing to get pasted.\n        d.input.selectionEnd = end;\n        d.input.selectionStart = start;\n        cm.state.fakedLastChar = true;\n      }\n      cm.state.pasteIncoming = true;\n      fastPoll(cm);\n    });\n\n    function prepareCopyCut(e) {\n      if (cm.somethingSelected()) {\n        lastCopied = cm.getSelections();\n        if (d.inaccurateSelection) {\n          d.prevInput = \"\";\n          d.inaccurateSelection = false;\n          d.input.value = lastCopied.join(\"\\n\");\n          selectInput(d.input);\n        }\n      } else {\n        var text = [], ranges = [];\n        for (var i = 0; i < cm.doc.sel.ranges.length; i++) {\n          var line = cm.doc.sel.ranges[i].head.line;\n          var lineRange = {anchor: Pos(line, 0), head: Pos(line + 1, 0)};\n          ranges.push(lineRange);\n          text.push(cm.getRange(lineRange.anchor, lineRange.head));\n        }\n        if (e.type == \"cut\") {\n          cm.setSelections(ranges, null, sel_dontScroll);\n        } else {\n          d.prevInput = \"\";\n          d.input.value = text.join(\"\\n\");\n          selectInput(d.input);\n        }\n        lastCopied = text;\n      }\n      if (e.type == \"cut\") cm.state.cutIncoming = true;\n    }\n    on(d.input, \"cut\", prepareCopyCut);\n    on(d.input, \"copy\", prepareCopyCut);\n\n    // Needed to handle Tab key in KHTML\n    if (khtml) on(d.sizer, \"mouseup\", function() {\n      if (activeElt() == d.input) d.input.blur();\n      focusInput(cm);\n    });\n  }\n\n  // Called when the window resizes\n  function onResize(cm) {\n    var d = cm.display;\n    if (d.lastWrapHeight == d.wrapper.clientHeight && d.lastWrapWidth == d.wrapper.clientWidth)\n      return;\n    // Might be a text scaling operation, clear size caches.\n    d.cachedCharWidth = d.cachedTextHeight = d.cachedPaddingH = null;\n    cm.setSize();\n  }\n\n  // MOUSE EVENTS\n\n  // Return true when the given mouse event happened in a widget\n  function eventInWidget(display, e) {\n    for (var n = e_target(e); n != display.wrapper; n = n.parentNode) {\n      if (!n || n.ignoreEvents || n.parentNode == display.sizer && n != display.mover) return true;\n    }\n  }\n\n  // Given a mouse event, find the corresponding position. If liberal\n  // is false, it checks whether a gutter or scrollbar was clicked,\n  // and returns null if it was. forRect is used by rectangular\n  // selections, and tries to estimate a character position even for\n  // coordinates beyond the right of the text.\n  function posFromMouse(cm, e, liberal, forRect) {\n    var display = cm.display;\n    if (!liberal) {\n      var target = e_target(e);\n      if (target == display.scrollbarH || target == display.scrollbarV ||\n          target == display.scrollbarFiller || target == display.gutterFiller) return null;\n    }\n    var x, y, space = display.lineSpace.getBoundingClientRect();\n    // Fails unpredictably on IE[67] when mouse is dragged around quickly.\n    try { x = e.clientX - space.left; y = e.clientY - space.top; }\n    catch (e) { return null; }\n    var coords = coordsChar(cm, x, y), line;\n    if (forRect && coords.xRel == 1 && (line = getLine(cm.doc, coords.line).text).length == coords.ch) {\n      var colDiff = countColumn(line, line.length, cm.options.tabSize) - line.length;\n      coords = Pos(coords.line, Math.max(0, Math.round((x - paddingH(cm.display).left) / charWidth(cm.display)) - colDiff));\n    }\n    return coords;\n  }\n\n  // A mouse down can be a single click, double click, triple click,\n  // start of selection drag, start of text drag, new cursor\n  // (ctrl-click), rectangle drag (alt-drag), or xwin\n  // middle-click-paste. Or it might be a click on something we should\n  // not interfere with, such as a scrollbar or widget.\n  function onMouseDown(e) {\n    if (signalDOMEvent(this, e)) return;\n    var cm = this, display = cm.display;\n    display.shift = e.shiftKey;\n\n    if (eventInWidget(display, e)) {\n      if (!webkit) {\n        // Briefly turn off draggability, to allow widgets to do\n        // normal dragging things.\n        display.scroller.draggable = false;\n        setTimeout(function(){display.scroller.draggable = true;}, 100);\n      }\n      return;\n    }\n    if (clickInGutter(cm, e)) return;\n    var start = posFromMouse(cm, e);\n    window.focus();\n\n    switch (e_button(e)) {\n    case 1:\n      if (start)\n        leftButtonDown(cm, e, start);\n      else if (e_target(e) == display.scroller)\n        e_preventDefault(e);\n      break;\n    case 2:\n      if (webkit) cm.state.lastMiddleDown = +new Date;\n      if (start) extendSelection(cm.doc, start);\n      setTimeout(bind(focusInput, cm), 20);\n      e_preventDefault(e);\n      break;\n    case 3:\n      if (captureRightClick) onContextMenu(cm, e);\n      break;\n    }\n  }\n\n  var lastClick, lastDoubleClick;\n  function leftButtonDown(cm, e, start) {\n    setTimeout(bind(ensureFocus, cm), 0);\n\n    var now = +new Date, type;\n    if (lastDoubleClick && lastDoubleClick.time > now - 400 && cmp(lastDoubleClick.pos, start) == 0) {\n      type = \"triple\";\n    } else if (lastClick && lastClick.time > now - 400 && cmp(lastClick.pos, start) == 0) {\n      type = \"double\";\n      lastDoubleClick = {time: now, pos: start};\n    } else {\n      type = \"single\";\n      lastClick = {time: now, pos: start};\n    }\n\n    var sel = cm.doc.sel, modifier = mac ? e.metaKey : e.ctrlKey;\n    if (cm.options.dragDrop && dragAndDrop && !isReadOnly(cm) &&\n        type == \"single\" && sel.contains(start) > -1 && sel.somethingSelected())\n      leftButtonStartDrag(cm, e, start, modifier);\n    else\n      leftButtonSelect(cm, e, start, type, modifier);\n  }\n\n  // Start a text drag. When it ends, see if any dragging actually\n  // happen, and treat as a click if it didn't.\n  function leftButtonStartDrag(cm, e, start, modifier) {\n    var display = cm.display;\n    var dragEnd = operation(cm, function(e2) {\n      if (webkit) display.scroller.draggable = false;\n      cm.state.draggingText = false;\n      off(document, \"mouseup\", dragEnd);\n      off(display.scroller, \"drop\", dragEnd);\n      if (Math.abs(e.clientX - e2.clientX) + Math.abs(e.clientY - e2.clientY) < 10) {\n        e_preventDefault(e2);\n        if (!modifier)\n          extendSelection(cm.doc, start);\n        focusInput(cm);\n        // Work around unexplainable focus problem in IE9 (#2127)\n        if (ie && ie_version == 9)\n          setTimeout(function() {document.body.focus(); focusInput(cm);}, 20);\n      }\n    });\n    // Let the drag handler handle this.\n    if (webkit) display.scroller.draggable = true;\n    cm.state.draggingText = dragEnd;\n    // IE's approach to draggable\n    if (display.scroller.dragDrop) display.scroller.dragDrop();\n    on(document, \"mouseup\", dragEnd);\n    on(display.scroller, \"drop\", dragEnd);\n  }\n\n  // Normal selection, as opposed to text dragging.\n  function leftButtonSelect(cm, e, start, type, addNew) {\n    var display = cm.display, doc = cm.doc;\n    e_preventDefault(e);\n\n    var ourRange, ourIndex, startSel = doc.sel;\n    if (addNew && !e.shiftKey) {\n      ourIndex = doc.sel.contains(start);\n      if (ourIndex > -1)\n        ourRange = doc.sel.ranges[ourIndex];\n      else\n        ourRange = new Range(start, start);\n    } else {\n      ourRange = doc.sel.primary();\n    }\n\n    if (e.altKey) {\n      type = \"rect\";\n      if (!addNew) ourRange = new Range(start, start);\n      start = posFromMouse(cm, e, true, true);\n      ourIndex = -1;\n    } else if (type == \"double\") {\n      var word = cm.findWordAt(start);\n      if (cm.display.shift || doc.extend)\n        ourRange = extendRange(doc, ourRange, word.anchor, word.head);\n      else\n        ourRange = word;\n    } else if (type == \"triple\") {\n      var line = new Range(Pos(start.line, 0), clipPos(doc, Pos(start.line + 1, 0)));\n      if (cm.display.shift || doc.extend)\n        ourRange = extendRange(doc, ourRange, line.anchor, line.head);\n      else\n        ourRange = line;\n    } else {\n      ourRange = extendRange(doc, ourRange, start);\n    }\n\n    if (!addNew) {\n      ourIndex = 0;\n      setSelection(doc, new Selection([ourRange], 0), sel_mouse);\n      startSel = doc.sel;\n    } else if (ourIndex > -1) {\n      replaceOneSelection(doc, ourIndex, ourRange, sel_mouse);\n    } else {\n      ourIndex = doc.sel.ranges.length;\n      setSelection(doc, normalizeSelection(doc.sel.ranges.concat([ourRange]), ourIndex),\n                   {scroll: false, origin: \"*mouse\"});\n    }\n\n    var lastPos = start;\n    function extendTo(pos) {\n      if (cmp(lastPos, pos) == 0) return;\n      lastPos = pos;\n\n      if (type == \"rect\") {\n        var ranges = [], tabSize = cm.options.tabSize;\n        var startCol = countColumn(getLine(doc, start.line).text, start.ch, tabSize);\n        var posCol = countColumn(getLine(doc, pos.line).text, pos.ch, tabSize);\n        var left = Math.min(startCol, posCol), right = Math.max(startCol, posCol);\n        for (var line = Math.min(start.line, pos.line), end = Math.min(cm.lastLine(), Math.max(start.line, pos.line));\n             line <= end; line++) {\n          var text = getLine(doc, line).text, leftPos = findColumn(text, left, tabSize);\n          if (left == right)\n            ranges.push(new Range(Pos(line, leftPos), Pos(line, leftPos)));\n          else if (text.length > leftPos)\n            ranges.push(new Range(Pos(line, leftPos), Pos(line, findColumn(text, right, tabSize))));\n        }\n        if (!ranges.length) ranges.push(new Range(start, start));\n        setSelection(doc, normalizeSelection(startSel.ranges.slice(0, ourIndex).concat(ranges), ourIndex),\n                     {origin: \"*mouse\", scroll: false});\n        cm.scrollIntoView(pos);\n      } else {\n        var oldRange = ourRange;\n        var anchor = oldRange.anchor, head = pos;\n        if (type != \"single\") {\n          if (type == \"double\")\n            var range = cm.findWordAt(pos);\n          else\n            var range = new Range(Pos(pos.line, 0), clipPos(doc, Pos(pos.line + 1, 0)));\n          if (cmp(range.anchor, anchor) > 0) {\n            head = range.head;\n            anchor = minPos(oldRange.from(), range.anchor);\n          } else {\n            head = range.anchor;\n            anchor = maxPos(oldRange.to(), range.head);\n          }\n        }\n        var ranges = startSel.ranges.slice(0);\n        ranges[ourIndex] = new Range(clipPos(doc, anchor), head);\n        setSelection(doc, normalizeSelection(ranges, ourIndex), sel_mouse);\n      }\n    }\n\n    var editorSize = display.wrapper.getBoundingClientRect();\n    // Used to ensure timeout re-tries don't fire when another extend\n    // happened in the meantime (clearTimeout isn't reliable -- at\n    // least on Chrome, the timeouts still happen even when cleared,\n    // if the clear happens after their scheduled firing time).\n    var counter = 0;\n\n    function extend(e) {\n      var curCount = ++counter;\n      var cur = posFromMouse(cm, e, true, type == \"rect\");\n      if (!cur) return;\n      if (cmp(cur, lastPos) != 0) {\n        ensureFocus(cm);\n        extendTo(cur);\n        var visible = visibleLines(display, doc);\n        if (cur.line >= visible.to || cur.line < visible.from)\n          setTimeout(operation(cm, function(){if (counter == curCount) extend(e);}), 150);\n      } else {\n        var outside = e.clientY < editorSize.top ? -20 : e.clientY > editorSize.bottom ? 20 : 0;\n        if (outside) setTimeout(operation(cm, function() {\n          if (counter != curCount) return;\n          display.scroller.scrollTop += outside;\n          extend(e);\n        }), 50);\n      }\n    }\n\n    function done(e) {\n      counter = Infinity;\n      e_preventDefault(e);\n      focusInput(cm);\n      off(document, \"mousemove\", move);\n      off(document, \"mouseup\", up);\n      doc.history.lastSelOrigin = null;\n    }\n\n    var move = operation(cm, function(e) {\n      if (!e_button(e)) done(e);\n      else extend(e);\n    });\n    var up = operation(cm, done);\n    on(document, \"mousemove\", move);\n    on(document, \"mouseup\", up);\n  }\n\n  // Determines whether an event happened in the gutter, and fires the\n  // handlers for the corresponding event.\n  function gutterEvent(cm, e, type, prevent, signalfn) {\n    try { var mX = e.clientX, mY = e.clientY; }\n    catch(e) { return false; }\n    if (mX >= Math.floor(cm.display.gutters.getBoundingClientRect().right)) return false;\n    if (prevent) e_preventDefault(e);\n\n    var display = cm.display;\n    var lineBox = display.lineDiv.getBoundingClientRect();\n\n    if (mY > lineBox.bottom || !hasHandler(cm, type)) return e_defaultPrevented(e);\n    mY -= lineBox.top - display.viewOffset;\n\n    for (var i = 0; i < cm.options.gutters.length; ++i) {\n      var g = display.gutters.childNodes[i];\n      if (g && g.getBoundingClientRect().right >= mX) {\n        var line = lineAtHeight(cm.doc, mY);\n        var gutter = cm.options.gutters[i];\n        signalfn(cm, type, cm, line, gutter, e);\n        return e_defaultPrevented(e);\n      }\n    }\n  }\n\n  function clickInGutter(cm, e) {\n    return gutterEvent(cm, e, \"gutterClick\", true, signalLater);\n  }\n\n  // Kludge to work around strange IE behavior where it'll sometimes\n  // re-fire a series of drag-related events right after the drop (#1551)\n  var lastDrop = 0;\n\n  function onDrop(e) {\n    var cm = this;\n    if (signalDOMEvent(cm, e) || eventInWidget(cm.display, e))\n      return;\n    e_preventDefault(e);\n    if (ie) lastDrop = +new Date;\n    var pos = posFromMouse(cm, e, true), files = e.dataTransfer.files;\n    if (!pos || isReadOnly(cm)) return;\n    // Might be a file drop, in which case we simply extract the text\n    // and insert it.\n    if (files && files.length && window.FileReader && window.File) {\n      var n = files.length, text = Array(n), read = 0;\n      var loadFile = function(file, i) {\n        var reader = new FileReader;\n        reader.onload = operation(cm, function() {\n          text[i] = reader.result;\n          if (++read == n) {\n            pos = clipPos(cm.doc, pos);\n            var change = {from: pos, to: pos, text: splitLines(text.join(\"\\n\")), origin: \"paste\"};\n            makeChange(cm.doc, change);\n            setSelectionReplaceHistory(cm.doc, simpleSelection(pos, changeEnd(change)));\n          }\n        });\n        reader.readAsText(file);\n      };\n      for (var i = 0; i < n; ++i) loadFile(files[i], i);\n    } else { // Normal drop\n      // Don't do a replace if the drop happened inside of the selected text.\n      if (cm.state.draggingText && cm.doc.sel.contains(pos) > -1) {\n        cm.state.draggingText(e);\n        // Ensure the editor is re-focused\n        setTimeout(bind(focusInput, cm), 20);\n        return;\n      }\n      try {\n        var text = e.dataTransfer.getData(\"Text\");\n        if (text) {\n          if (cm.state.draggingText && !(mac ? e.metaKey : e.ctrlKey))\n            var selected = cm.listSelections();\n          setSelectionNoUndo(cm.doc, simpleSelection(pos, pos));\n          if (selected) for (var i = 0; i < selected.length; ++i)\n            replaceRange(cm.doc, \"\", selected[i].anchor, selected[i].head, \"drag\");\n          cm.replaceSelection(text, \"around\", \"paste\");\n          focusInput(cm);\n        }\n      }\n      catch(e){}\n    }\n  }\n\n  function onDragStart(cm, e) {\n    if (ie && (!cm.state.draggingText || +new Date - lastDrop < 100)) { e_stop(e); return; }\n    if (signalDOMEvent(cm, e) || eventInWidget(cm.display, e)) return;\n\n    e.dataTransfer.setData(\"Text\", cm.getSelection());\n\n    // Use dummy image instead of default browsers image.\n    // Recent Safari (~6.0.2) have a tendency to segfault when this happens, so we don't do it there.\n    if (e.dataTransfer.setDragImage && !safari) {\n      var img = elt(\"img\", null, null, \"position: fixed; left: 0; top: 0;\");\n      img.src = \"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\";\n      if (presto) {\n        img.width = img.height = 1;\n        cm.display.wrapper.appendChild(img);\n        // Force a relayout, or Opera won't use our image for some obscure reason\n        img._top = img.offsetTop;\n      }\n      e.dataTransfer.setDragImage(img, 0, 0);\n      if (presto) img.parentNode.removeChild(img);\n    }\n  }\n\n  // SCROLL EVENTS\n\n  // Sync the scrollable area and scrollbars, ensure the viewport\n  // covers the visible area.\n  function setScrollTop(cm, val) {\n    if (Math.abs(cm.doc.scrollTop - val) < 2) return;\n    cm.doc.scrollTop = val;\n    if (!gecko) updateDisplaySimple(cm, {top: val});\n    if (cm.display.scroller.scrollTop != val) cm.display.scroller.scrollTop = val;\n    if (cm.display.scrollbarV.scrollTop != val) cm.display.scrollbarV.scrollTop = val;\n    if (gecko) updateDisplaySimple(cm);\n    startWorker(cm, 100);\n  }\n  // Sync scroller and scrollbar, ensure the gutter elements are\n  // aligned.\n  function setScrollLeft(cm, val, isScroller) {\n    if (isScroller ? val == cm.doc.scrollLeft : Math.abs(cm.doc.scrollLeft - val) < 2) return;\n    val = Math.min(val, cm.display.scroller.scrollWidth - cm.display.scroller.clientWidth);\n    cm.doc.scrollLeft = val;\n    alignHorizontally(cm);\n    if (cm.display.scroller.scrollLeft != val) cm.display.scroller.scrollLeft = val;\n    if (cm.display.scrollbarH.scrollLeft != val) cm.display.scrollbarH.scrollLeft = val;\n  }\n\n  // Since the delta values reported on mouse wheel events are\n  // unstandardized between browsers and even browser versions, and\n  // generally horribly unpredictable, this code starts by measuring\n  // the scroll effect that the first few mouse wheel events have,\n  // and, from that, detects the way it can convert deltas to pixel\n  // offsets afterwards.\n  //\n  // The reason we want to know the amount a wheel event will scroll\n  // is that it gives us a chance to update the display before the\n  // actual scrolling happens, reducing flickering.\n\n  var wheelSamples = 0, wheelPixelsPerUnit = null;\n  // Fill in a browser-detected starting value on browsers where we\n  // know one. These don't have to be accurate -- the result of them\n  // being wrong would just be a slight flicker on the first wheel\n  // scroll (if it is large enough).\n  if (ie) wheelPixelsPerUnit = -.53;\n  else if (gecko) wheelPixelsPerUnit = 15;\n  else if (chrome) wheelPixelsPerUnit = -.7;\n  else if (safari) wheelPixelsPerUnit = -1/3;\n\n  function onScrollWheel(cm, e) {\n    var dx = e.wheelDeltaX, dy = e.wheelDeltaY;\n    if (dx == null && e.detail && e.axis == e.HORIZONTAL_AXIS) dx = e.detail;\n    if (dy == null && e.detail && e.axis == e.VERTICAL_AXIS) dy = e.detail;\n    else if (dy == null) dy = e.wheelDelta;\n\n    var display = cm.display, scroll = display.scroller;\n    // Quit if there's nothing to scroll here\n    if (!(dx && scroll.scrollWidth > scroll.clientWidth ||\n          dy && scroll.scrollHeight > scroll.clientHeight)) return;\n\n    // Webkit browsers on OS X abort momentum scrolls when the target\n    // of the scroll event is removed from the scrollable element.\n    // This hack (see related code in patchDisplay) makes sure the\n    // element is kept around.\n    if (dy && mac && webkit) {\n      outer: for (var cur = e.target, view = display.view; cur != scroll; cur = cur.parentNode) {\n        for (var i = 0; i < view.length; i++) {\n          if (view[i].node == cur) {\n            cm.display.currentWheelTarget = cur;\n            break outer;\n          }\n        }\n      }\n    }\n\n    // On some browsers, horizontal scrolling will cause redraws to\n    // happen before the gutter has been realigned, causing it to\n    // wriggle around in a most unseemly way. When we have an\n    // estimated pixels/delta value, we just handle horizontal\n    // scrolling entirely here. It'll be slightly off from native, but\n    // better than glitching out.\n    if (dx && !gecko && !presto && wheelPixelsPerUnit != null) {\n      if (dy)\n        setScrollTop(cm, Math.max(0, Math.min(scroll.scrollTop + dy * wheelPixelsPerUnit, scroll.scrollHeight - scroll.clientHeight)));\n      setScrollLeft(cm, Math.max(0, Math.min(scroll.scrollLeft + dx * wheelPixelsPerUnit, scroll.scrollWidth - scroll.clientWidth)));\n      e_preventDefault(e);\n      display.wheelStartX = null; // Abort measurement, if in progress\n      return;\n    }\n\n    // 'Project' the visible viewport to cover the area that is being\n    // scrolled into view (if we know enough to estimate it).\n    if (dy && wheelPixelsPerUnit != null) {\n      var pixels = dy * wheelPixelsPerUnit;\n      var top = cm.doc.scrollTop, bot = top + display.wrapper.clientHeight;\n      if (pixels < 0) top = Math.max(0, top + pixels - 50);\n      else bot = Math.min(cm.doc.height, bot + pixels + 50);\n      updateDisplaySimple(cm, {top: top, bottom: bot});\n    }\n\n    if (wheelSamples < 20) {\n      if (display.wheelStartX == null) {\n        display.wheelStartX = scroll.scrollLeft; display.wheelStartY = scroll.scrollTop;\n        display.wheelDX = dx; display.wheelDY = dy;\n        setTimeout(function() {\n          if (display.wheelStartX == null) return;\n          var movedX = scroll.scrollLeft - display.wheelStartX;\n          var movedY = scroll.scrollTop - display.wheelStartY;\n          var sample = (movedY && display.wheelDY && movedY / display.wheelDY) ||\n            (movedX && display.wheelDX && movedX / display.wheelDX);\n          display.wheelStartX = display.wheelStartY = null;\n          if (!sample) return;\n          wheelPixelsPerUnit = (wheelPixelsPerUnit * wheelSamples + sample) / (wheelSamples + 1);\n          ++wheelSamples;\n        }, 200);\n      } else {\n        display.wheelDX += dx; display.wheelDY += dy;\n      }\n    }\n  }\n\n  // KEY EVENTS\n\n  // Run a handler that was bound to a key.\n  function doHandleBinding(cm, bound, dropShift) {\n    if (typeof bound == \"string\") {\n      bound = commands[bound];\n      if (!bound) return false;\n    }\n    // Ensure previous input has been read, so that the handler sees a\n    // consistent view of the document\n    if (cm.display.pollingFast && readInput(cm)) cm.display.pollingFast = false;\n    var prevShift = cm.display.shift, done = false;\n    try {\n      if (isReadOnly(cm)) cm.state.suppressEdits = true;\n      if (dropShift) cm.display.shift = false;\n      done = bound(cm) != Pass;\n    } finally {\n      cm.display.shift = prevShift;\n      cm.state.suppressEdits = false;\n    }\n    return done;\n  }\n\n  function lookupKeyForEditor(cm, name, handle) {\n    for (var i = 0; i < cm.state.keyMaps.length; i++) {\n      var result = lookupKey(name, cm.state.keyMaps[i], handle);\n      if (result) return result;\n    }\n    return (cm.options.extraKeys && lookupKey(name, cm.options.extraKeys, handle))\n      || lookupKey(name, cm.options.keyMap, handle);\n  }\n\n  var stopSeq = new Delayed;\n  function dispatchKey(cm, name, e, handle) {\n    var seq = cm.state.keySeq;\n    if (seq) {\n      if (isModifierKey(name)) return \"handled\";\n      stopSeq.set(50, function() {\n        if (cm.state.keySeq == seq) {\n          cm.state.keySeq = null;\n          resetInput(cm);\n        }\n      });\n      name = seq + \" \" + name;\n    }\n    var result = lookupKeyForEditor(cm, name, handle);\n\n    if (result == \"multi\")\n      cm.state.keySeq = name;\n    if (result == \"handled\")\n      signalLater(cm, \"keyHandled\", cm, name, e);\n\n    if (result == \"handled\" || result == \"multi\") {\n      e_preventDefault(e);\n      restartBlink(cm);\n    }\n\n    if (seq && !result && /\\'$/.test(name)) {\n      e_preventDefault(e);\n      return true;\n    }\n    return !!result;\n  }\n\n  // Handle a key from the keydown event.\n  function handleKeyBinding(cm, e) {\n    var name = keyName(e, true);\n    if (!name) return false;\n\n    if (e.shiftKey && !cm.state.keySeq) {\n      // First try to resolve full name (including 'Shift-'). Failing\n      // that, see if there is a cursor-motion command (starting with\n      // 'go') bound to the keyname without 'Shift-'.\n      return dispatchKey(cm, \"Shift-\" + name, e, function(b) {return doHandleBinding(cm, b, true);})\n          || dispatchKey(cm, name, e, function(b) {\n               if (typeof b == \"string\" ? /^go[A-Z]/.test(b) : b.motion)\n                 return doHandleBinding(cm, b);\n             });\n    } else {\n      return dispatchKey(cm, name, e, function(b) { return doHandleBinding(cm, b); });\n    }\n  }\n\n  // Handle a key from the keypress event\n  function handleCharBinding(cm, e, ch) {\n    return dispatchKey(cm, \"'\" + ch + \"'\", e,\n                       function(b) { return doHandleBinding(cm, b, true); });\n  }\n\n  var lastStoppedKey = null;\n  function onKeyDown(e) {\n    var cm = this;\n    ensureFocus(cm);\n    if (signalDOMEvent(cm, e)) return;\n    // IE does strange things with escape.\n    if (ie && ie_version < 11 && e.keyCode == 27) e.returnValue = false;\n    var code = e.keyCode;\n    cm.display.shift = code == 16 || e.shiftKey;\n    var handled = handleKeyBinding(cm, e);\n    if (presto) {\n      lastStoppedKey = handled ? code : null;\n      // Opera has no cut event... we try to at least catch the key combo\n      if (!handled && code == 88 && !hasCopyEvent && (mac ? e.metaKey : e.ctrlKey))\n        cm.replaceSelection(\"\", null, \"cut\");\n    }\n\n    // Turn mouse into crosshair when Alt is held on Mac.\n    if (code == 18 && !/\\bCodeMirror-crosshair\\b/.test(cm.display.lineDiv.className))\n      showCrossHair(cm);\n  }\n\n  function showCrossHair(cm) {\n    var lineDiv = cm.display.lineDiv;\n    addClass(lineDiv, \"CodeMirror-crosshair\");\n\n    function up(e) {\n      if (e.keyCode == 18 || !e.altKey) {\n        rmClass(lineDiv, \"CodeMirror-crosshair\");\n        off(document, \"keyup\", up);\n        off(document, \"mouseover\", up);\n      }\n    }\n    on(document, \"keyup\", up);\n    on(document, \"mouseover\", up);\n  }\n\n  function onKeyUp(e) {\n    if (e.keyCode == 16) this.doc.sel.shift = false;\n    signalDOMEvent(this, e);\n  }\n\n  function onKeyPress(e) {\n    var cm = this;\n    if (signalDOMEvent(cm, e) || e.ctrlKey && !e.altKey || mac && e.metaKey) return;\n    var keyCode = e.keyCode, charCode = e.charCode;\n    if (presto && keyCode == lastStoppedKey) {lastStoppedKey = null; e_preventDefault(e); return;}\n    if (((presto && (!e.which || e.which < 10)) || khtml) && handleKeyBinding(cm, e)) return;\n    var ch = String.fromCharCode(charCode == null ? keyCode : charCode);\n    if (handleCharBinding(cm, e, ch)) return;\n    if (ie && ie_version >= 9) cm.display.inputHasSelection = null;\n    fastPoll(cm);\n  }\n\n  // FOCUS/BLUR EVENTS\n\n  function onFocus(cm) {\n    if (cm.options.readOnly == \"nocursor\") return;\n    if (!cm.state.focused) {\n      signal(cm, \"focus\", cm);\n      cm.state.focused = true;\n      addClass(cm.display.wrapper, \"CodeMirror-focused\");\n      // The prevInput test prevents this from firing when a context\n      // menu is closed (since the resetInput would kill the\n      // select-all detection hack)\n      if (!cm.curOp && cm.display.selForContextMenu != cm.doc.sel) {\n        resetInput(cm);\n        if (webkit) setTimeout(bind(resetInput, cm, true), 0); // Issue #1730\n      }\n    }\n    slowPoll(cm);\n    restartBlink(cm);\n  }\n  function onBlur(cm) {\n    if (cm.state.focused) {\n      signal(cm, \"blur\", cm);\n      cm.state.focused = false;\n      rmClass(cm.display.wrapper, \"CodeMirror-focused\");\n    }\n    clearInterval(cm.display.blinker);\n    setTimeout(function() {if (!cm.state.focused) cm.display.shift = false;}, 150);\n  }\n\n  // CONTEXT MENU HANDLING\n\n  // To make the context menu work, we need to briefly unhide the\n  // textarea (making it as unobtrusive as possible) to let the\n  // right-click take effect on it.\n  function onContextMenu(cm, e) {\n    if (signalDOMEvent(cm, e, \"contextmenu\")) return;\n    var display = cm.display;\n    if (eventInWidget(display, e) || contextMenuInGutter(cm, e)) return;\n\n    var pos = posFromMouse(cm, e), scrollPos = display.scroller.scrollTop;\n    if (!pos || presto) return; // Opera is difficult.\n\n    // Reset the current text selection only if the click is done outside of the selection\n    // and 'resetSelectionOnContextMenu' option is true.\n    var reset = cm.options.resetSelectionOnContextMenu;\n    if (reset && cm.doc.sel.contains(pos) == -1)\n      operation(cm, setSelection)(cm.doc, simpleSelection(pos), sel_dontScroll);\n\n    var oldCSS = display.input.style.cssText;\n    display.inputDiv.style.position = \"absolute\";\n    display.input.style.cssText = \"position: fixed; width: 30px; height: 30px; top: \" + (e.clientY - 5) +\n      \"px; left: \" + (e.clientX - 5) + \"px; z-index: 1000; background: \" +\n      (ie ? \"rgba(255, 255, 255, .05)\" : \"transparent\") +\n      \"; outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);\";\n    if (webkit) var oldScrollY = window.scrollY; // Work around Chrome issue (#2712)\n    focusInput(cm);\n    if (webkit) window.scrollTo(null, oldScrollY);\n    resetInput(cm);\n    // Adds \"Select all\" to context menu in FF\n    if (!cm.somethingSelected()) display.input.value = display.prevInput = \" \";\n    display.selForContextMenu = cm.doc.sel;\n    clearTimeout(display.detectingSelectAll);\n\n    // Select-all will be greyed out if there's nothing to select, so\n    // this adds a zero-width space so that we can later check whether\n    // it got selected.\n    function prepareSelectAllHack() {\n      if (display.input.selectionStart != null) {\n        var selected = cm.somethingSelected();\n        var extval = display.input.value = \"\\u200b\" + (selected ? display.input.value : \"\");\n        display.prevInput = selected ? \"\" : \"\\u200b\";\n        display.input.selectionStart = 1; display.input.selectionEnd = extval.length;\n        // Re-set this, in case some other handler touched the\n        // selection in the meantime.\n        display.selForContextMenu = cm.doc.sel;\n      }\n    }\n    function rehide() {\n      display.inputDiv.style.position = \"relative\";\n      display.input.style.cssText = oldCSS;\n      if (ie && ie_version < 9) display.scrollbarV.scrollTop = display.scroller.scrollTop = scrollPos;\n      slowPoll(cm);\n\n      // Try to detect the user choosing select-all\n      if (display.input.selectionStart != null) {\n        if (!ie || (ie && ie_version < 9)) prepareSelectAllHack();\n        var i = 0, poll = function() {\n          if (display.selForContextMenu == cm.doc.sel && display.input.selectionStart == 0)\n            operation(cm, commands.selectAll)(cm);\n          else if (i++ < 10) display.detectingSelectAll = setTimeout(poll, 500);\n          else resetInput(cm);\n        };\n        display.detectingSelectAll = setTimeout(poll, 200);\n      }\n    }\n\n    if (ie && ie_version >= 9) prepareSelectAllHack();\n    if (captureRightClick) {\n      e_stop(e);\n      var mouseup = function() {\n        off(window, \"mouseup\", mouseup);\n        setTimeout(rehide, 20);\n      };\n      on(window, \"mouseup\", mouseup);\n    } else {\n      setTimeout(rehide, 50);\n    }\n  }\n\n  function contextMenuInGutter(cm, e) {\n    if (!hasHandler(cm, \"gutterContextMenu\")) return false;\n    return gutterEvent(cm, e, \"gutterContextMenu\", false, signal);\n  }\n\n  // UPDATING\n\n  // Compute the position of the end of a change (its 'to' property\n  // refers to the pre-change end).\n  var changeEnd = CodeMirror.changeEnd = function(change) {\n    if (!change.text) return change.to;\n    return Pos(change.from.line + change.text.length - 1,\n               lst(change.text).length + (change.text.length == 1 ? change.from.ch : 0));\n  };\n\n  // Adjust a position to refer to the post-change position of the\n  // same text, or the end of the change if the change covers it.\n  function adjustForChange(pos, change) {\n    if (cmp(pos, change.from) < 0) return pos;\n    if (cmp(pos, change.to) <= 0) return changeEnd(change);\n\n    var line = pos.line + change.text.length - (change.to.line - change.from.line) - 1, ch = pos.ch;\n    if (pos.line == change.to.line) ch += changeEnd(change).ch - change.to.ch;\n    return Pos(line, ch);\n  }\n\n  function computeSelAfterChange(doc, change) {\n    var out = [];\n    for (var i = 0; i < doc.sel.ranges.length; i++) {\n      var range = doc.sel.ranges[i];\n      out.push(new Range(adjustForChange(range.anchor, change),\n                         adjustForChange(range.head, change)));\n    }\n    return normalizeSelection(out, doc.sel.primIndex);\n  }\n\n  function offsetPos(pos, old, nw) {\n    if (pos.line == old.line)\n      return Pos(nw.line, pos.ch - old.ch + nw.ch);\n    else\n      return Pos(nw.line + (pos.line - old.line), pos.ch);\n  }\n\n  // Used by replaceSelections to allow moving the selection to the\n  // start or around the replaced test. Hint may be \"start\" or \"around\".\n  function computeReplacedSel(doc, changes, hint) {\n    var out = [];\n    var oldPrev = Pos(doc.first, 0), newPrev = oldPrev;\n    for (var i = 0; i < changes.length; i++) {\n      var change = changes[i];\n      var from = offsetPos(change.from, oldPrev, newPrev);\n      var to = offsetPos(changeEnd(change), oldPrev, newPrev);\n      oldPrev = change.to;\n      newPrev = to;\n      if (hint == \"around\") {\n        var range = doc.sel.ranges[i], inv = cmp(range.head, range.anchor) < 0;\n        out[i] = new Range(inv ? to : from, inv ? from : to);\n      } else {\n        out[i] = new Range(from, from);\n      }\n    }\n    return new Selection(out, doc.sel.primIndex);\n  }\n\n  // Allow \"beforeChange\" event handlers to influence a change\n  function filterChange(doc, change, update) {\n    var obj = {\n      canceled: false,\n      from: change.from,\n      to: change.to,\n      text: change.text,\n      origin: change.origin,\n      cancel: function() { this.canceled = true; }\n    };\n    if (update) obj.update = function(from, to, text, origin) {\n      if (from) this.from = clipPos(doc, from);\n      if (to) this.to = clipPos(doc, to);\n      if (text) this.text = text;\n      if (origin !== undefined) this.origin = origin;\n    };\n    signal(doc, \"beforeChange\", doc, obj);\n    if (doc.cm) signal(doc.cm, \"beforeChange\", doc.cm, obj);\n\n    if (obj.canceled) return null;\n    return {from: obj.from, to: obj.to, text: obj.text, origin: obj.origin};\n  }\n\n  // Apply a change to a document, and add it to the document's\n  // history, and propagating it to all linked documents.\n  function makeChange(doc, change, ignoreReadOnly) {\n    if (doc.cm) {\n      if (!doc.cm.curOp) return operation(doc.cm, makeChange)(doc, change, ignoreReadOnly);\n      if (doc.cm.state.suppressEdits) return;\n    }\n\n    if (hasHandler(doc, \"beforeChange\") || doc.cm && hasHandler(doc.cm, \"beforeChange\")) {\n      change = filterChange(doc, change, true);\n      if (!change) return;\n    }\n\n    // Possibly split or suppress the update based on the presence\n    // of read-only spans in its range.\n    var split = sawReadOnlySpans && !ignoreReadOnly && removeReadOnlyRanges(doc, change.from, change.to);\n    if (split) {\n      for (var i = split.length - 1; i >= 0; --i)\n        makeChangeInner(doc, {from: split[i].from, to: split[i].to, text: i ? [\"\"] : change.text});\n    } else {\n      makeChangeInner(doc, change);\n    }\n  }\n\n  function makeChangeInner(doc, change) {\n    if (change.text.length == 1 && change.text[0] == \"\" && cmp(change.from, change.to) == 0) return;\n    var selAfter = computeSelAfterChange(doc, change);\n    addChangeToHistory(doc, change, selAfter, doc.cm ? doc.cm.curOp.id : NaN);\n\n    makeChangeSingleDoc(doc, change, selAfter, stretchSpansOverChange(doc, change));\n    var rebased = [];\n\n    linkedDocs(doc, function(doc, sharedHist) {\n      if (!sharedHist && indexOf(rebased, doc.history) == -1) {\n        rebaseHist(doc.history, change);\n        rebased.push(doc.history);\n      }\n      makeChangeSingleDoc(doc, change, null, stretchSpansOverChange(doc, change));\n    });\n  }\n\n  // Revert a change stored in a document's history.\n  function makeChangeFromHistory(doc, type, allowSelectionOnly) {\n    if (doc.cm && doc.cm.state.suppressEdits) return;\n\n    var hist = doc.history, event, selAfter = doc.sel;\n    var source = type == \"undo\" ? hist.done : hist.undone, dest = type == \"undo\" ? hist.undone : hist.done;\n\n    // Verify that there is a useable event (so that ctrl-z won't\n    // needlessly clear selection events)\n    for (var i = 0; i < source.length; i++) {\n      event = source[i];\n      if (allowSelectionOnly ? event.ranges && !event.equals(doc.sel) : !event.ranges)\n        break;\n    }\n    if (i == source.length) return;\n    hist.lastOrigin = hist.lastSelOrigin = null;\n\n    for (;;) {\n      event = source.pop();\n      if (event.ranges) {\n        pushSelectionToHistory(event, dest);\n        if (allowSelectionOnly && !event.equals(doc.sel)) {\n          setSelection(doc, event, {clearRedo: false});\n          return;\n        }\n        selAfter = event;\n      }\n      else break;\n    }\n\n    // Build up a reverse change object to add to the opposite history\n    // stack (redo when undoing, and vice versa).\n    var antiChanges = [];\n    pushSelectionToHistory(selAfter, dest);\n    dest.push({changes: antiChanges, generation: hist.generation});\n    hist.generation = event.generation || ++hist.maxGeneration;\n\n    var filter = hasHandler(doc, \"beforeChange\") || doc.cm && hasHandler(doc.cm, \"beforeChange\");\n\n    for (var i = event.changes.length - 1; i >= 0; --i) {\n      var change = event.changes[i];\n      change.origin = type;\n      if (filter && !filterChange(doc, change, false)) {\n        source.length = 0;\n        return;\n      }\n\n      antiChanges.push(historyChangeFromChange(doc, change));\n\n      var after = i ? computeSelAfterChange(doc, change) : lst(source);\n      makeChangeSingleDoc(doc, change, after, mergeOldSpans(doc, change));\n      if (!i && doc.cm) doc.cm.scrollIntoView({from: change.from, to: changeEnd(change)});\n      var rebased = [];\n\n      // Propagate to the linked documents\n      linkedDocs(doc, function(doc, sharedHist) {\n        if (!sharedHist && indexOf(rebased, doc.history) == -1) {\n          rebaseHist(doc.history, change);\n          rebased.push(doc.history);\n        }\n        makeChangeSingleDoc(doc, change, null, mergeOldSpans(doc, change));\n      });\n    }\n  }\n\n  // Sub-views need their line numbers shifted when text is added\n  // above or below them in the parent document.\n  function shiftDoc(doc, distance) {\n    if (distance == 0) return;\n    doc.first += distance;\n    doc.sel = new Selection(map(doc.sel.ranges, function(range) {\n      return new Range(Pos(range.anchor.line + distance, range.anchor.ch),\n                       Pos(range.head.line + distance, range.head.ch));\n    }), doc.sel.primIndex);\n    if (doc.cm) {\n      regChange(doc.cm, doc.first, doc.first - distance, distance);\n      for (var d = doc.cm.display, l = d.viewFrom; l < d.viewTo; l++)\n        regLineChange(doc.cm, l, \"gutter\");\n    }\n  }\n\n  // More lower-level change function, handling only a single document\n  // (not linked ones).\n  function makeChangeSingleDoc(doc, change, selAfter, spans) {\n    if (doc.cm && !doc.cm.curOp)\n      return operation(doc.cm, makeChangeSingleDoc)(doc, change, selAfter, spans);\n\n    if (change.to.line < doc.first) {\n      shiftDoc(doc, change.text.length - 1 - (change.to.line - change.from.line));\n      return;\n    }\n    if (change.from.line > doc.lastLine()) return;\n\n    // Clip the change to the size of this doc\n    if (change.from.line < doc.first) {\n      var shift = change.text.length - 1 - (doc.first - change.from.line);\n      shiftDoc(doc, shift);\n      change = {from: Pos(doc.first, 0), to: Pos(change.to.line + shift, change.to.ch),\n                text: [lst(change.text)], origin: change.origin};\n    }\n    var last = doc.lastLine();\n    if (change.to.line > last) {\n      change = {from: change.from, to: Pos(last, getLine(doc, last).text.length),\n                text: [change.text[0]], origin: change.origin};\n    }\n\n    change.removed = getBetween(doc, change.from, change.to);\n\n    if (!selAfter) selAfter = computeSelAfterChange(doc, change);\n    if (doc.cm) makeChangeSingleDocInEditor(doc.cm, change, spans);\n    else updateDoc(doc, change, spans);\n    setSelectionNoUndo(doc, selAfter, sel_dontScroll);\n  }\n\n  // Handle the interaction of a change to a document with the editor\n  // that this document is part of.\n  function makeChangeSingleDocInEditor(cm, change, spans) {\n    var doc = cm.doc, display = cm.display, from = change.from, to = change.to;\n\n    var recomputeMaxLength = false, checkWidthStart = from.line;\n    if (!cm.options.lineWrapping) {\n      checkWidthStart = lineNo(visualLine(getLine(doc, from.line)));\n      doc.iter(checkWidthStart, to.line + 1, function(line) {\n        if (line == display.maxLine) {\n          recomputeMaxLength = true;\n          return true;\n        }\n      });\n    }\n\n    if (doc.sel.contains(change.from, change.to) > -1)\n      signalCursorActivity(cm);\n\n    updateDoc(doc, change, spans, estimateHeight(cm));\n\n    if (!cm.options.lineWrapping) {\n      doc.iter(checkWidthStart, from.line + change.text.length, function(line) {\n        var len = lineLength(line);\n        if (len > display.maxLineLength) {\n          display.maxLine = line;\n          display.maxLineLength = len;\n          display.maxLineChanged = true;\n          recomputeMaxLength = false;\n        }\n      });\n      if (recomputeMaxLength) cm.curOp.updateMaxLine = true;\n    }\n\n    // Adjust frontier, schedule worker\n    doc.frontier = Math.min(doc.frontier, from.line);\n    startWorker(cm, 400);\n\n    var lendiff = change.text.length - (to.line - from.line) - 1;\n    // Remember that these lines changed, for updating the display\n    if (from.line == to.line && change.text.length == 1 && !isWholeLineUpdate(cm.doc, change))\n      regLineChange(cm, from.line, \"text\");\n    else\n      regChange(cm, from.line, to.line + 1, lendiff);\n\n    var changesHandler = hasHandler(cm, \"changes\"), changeHandler = hasHandler(cm, \"change\");\n    if (changeHandler || changesHandler) {\n      var obj = {\n        from: from, to: to,\n        text: change.text,\n        removed: change.removed,\n        origin: change.origin\n      };\n      if (changeHandler) signalLater(cm, \"change\", cm, obj);\n      if (changesHandler) (cm.curOp.changeObjs || (cm.curOp.changeObjs = [])).push(obj);\n    }\n    cm.display.selForContextMenu = null;\n  }\n\n  function replaceRange(doc, code, from, to, origin) {\n    if (!to) to = from;\n    if (cmp(to, from) < 0) { var tmp = to; to = from; from = tmp; }\n    if (typeof code == \"string\") code = splitLines(code);\n    makeChange(doc, {from: from, to: to, text: code, origin: origin});\n  }\n\n  // SCROLLING THINGS INTO VIEW\n\n  // If an editor sits on the top or bottom of the window, partially\n  // scrolled out of view, this ensures that the cursor is visible.\n  function maybeScrollWindow(cm, coords) {\n    if (signalDOMEvent(cm, \"scrollCursorIntoView\")) return;\n\n    var display = cm.display, box = display.sizer.getBoundingClientRect(), doScroll = null;\n    if (coords.top + box.top < 0) doScroll = true;\n    else if (coords.bottom + box.top > (window.innerHeight || document.documentElement.clientHeight)) doScroll = false;\n    if (doScroll != null && !phantom) {\n      var scrollNode = elt(\"div\", \"\\u200b\", null, \"position: absolute; top: \" +\n                           (coords.top - display.viewOffset - paddingTop(cm.display)) + \"px; height: \" +\n                           (coords.bottom - coords.top + scrollerCutOff) + \"px; left: \" +\n                           coords.left + \"px; width: 2px;\");\n      cm.display.lineSpace.appendChild(scrollNode);\n      scrollNode.scrollIntoView(doScroll);\n      cm.display.lineSpace.removeChild(scrollNode);\n    }\n  }\n\n  // Scroll a given position into view (immediately), verifying that\n  // it actually became visible (as line heights are accurately\n  // measured, the position of something may 'drift' during drawing).\n  function scrollPosIntoView(cm, pos, end, margin) {\n    if (margin == null) margin = 0;\n    for (var limit = 0; limit < 5; limit++) {\n      var changed = false, coords = cursorCoords(cm, pos);\n      var endCoords = !end || end == pos ? coords : cursorCoords(cm, end);\n      var scrollPos = calculateScrollPos(cm, Math.min(coords.left, endCoords.left),\n                                         Math.min(coords.top, endCoords.top) - margin,\n                                         Math.max(coords.left, endCoords.left),\n                                         Math.max(coords.bottom, endCoords.bottom) + margin);\n      var startTop = cm.doc.scrollTop, startLeft = cm.doc.scrollLeft;\n      if (scrollPos.scrollTop != null) {\n        setScrollTop(cm, scrollPos.scrollTop);\n        if (Math.abs(cm.doc.scrollTop - startTop) > 1) changed = true;\n      }\n      if (scrollPos.scrollLeft != null) {\n        setScrollLeft(cm, scrollPos.scrollLeft);\n        if (Math.abs(cm.doc.scrollLeft - startLeft) > 1) changed = true;\n      }\n      if (!changed) return coords;\n    }\n  }\n\n  // Scroll a given set of coordinates into view (immediately).\n  function scrollIntoView(cm, x1, y1, x2, y2) {\n    var scrollPos = calculateScrollPos(cm, x1, y1, x2, y2);\n    if (scrollPos.scrollTop != null) setScrollTop(cm, scrollPos.scrollTop);\n    if (scrollPos.scrollLeft != null) setScrollLeft(cm, scrollPos.scrollLeft);\n  }\n\n  // Calculate a new scroll position needed to scroll the given\n  // rectangle into view. Returns an object with scrollTop and\n  // scrollLeft properties. When these are undefined, the\n  // vertical/horizontal position does not need to be adjusted.\n  function calculateScrollPos(cm, x1, y1, x2, y2) {\n    var display = cm.display, snapMargin = textHeight(cm.display);\n    if (y1 < 0) y1 = 0;\n    var screentop = cm.curOp && cm.curOp.scrollTop != null ? cm.curOp.scrollTop : display.scroller.scrollTop;\n    var screen = display.scroller.clientHeight - scrollerCutOff, result = {};\n    if (y2 - y1 > screen) y2 = y1 + screen;\n    var docBottom = cm.doc.height + paddingVert(display);\n    var atTop = y1 < snapMargin, atBottom = y2 > docBottom - snapMargin;\n    if (y1 < screentop) {\n      result.scrollTop = atTop ? 0 : y1;\n    } else if (y2 > screentop + screen) {\n      var newTop = Math.min(y1, (atBottom ? docBottom : y2) - screen);\n      if (newTop != screentop) result.scrollTop = newTop;\n    }\n\n    var screenleft = cm.curOp && cm.curOp.scrollLeft != null ? cm.curOp.scrollLeft : display.scroller.scrollLeft;\n    var screenw = display.scroller.clientWidth - scrollerCutOff - display.gutters.offsetWidth;\n    var tooWide = x2 - x1 > screenw;\n    if (tooWide) x2 = x1 + screenw;\n    if (x1 < 10)\n      result.scrollLeft = 0;\n    else if (x1 < screenleft)\n      result.scrollLeft = Math.max(0, x1 - (tooWide ? 0 : 10));\n    else if (x2 > screenw + screenleft - 3)\n      result.scrollLeft = x2 + (tooWide ? 0 : 10) - screenw;\n\n    return result;\n  }\n\n  // Store a relative adjustment to the scroll position in the current\n  // operation (to be applied when the operation finishes).\n  function addToScrollPos(cm, left, top) {\n    if (left != null || top != null) resolveScrollToPos(cm);\n    if (left != null)\n      cm.curOp.scrollLeft = (cm.curOp.scrollLeft == null ? cm.doc.scrollLeft : cm.curOp.scrollLeft) + left;\n    if (top != null)\n      cm.curOp.scrollTop = (cm.curOp.scrollTop == null ? cm.doc.scrollTop : cm.curOp.scrollTop) + top;\n  }\n\n  // Make sure that at the end of the operation the current cursor is\n  // shown.\n  function ensureCursorVisible(cm) {\n    resolveScrollToPos(cm);\n    var cur = cm.getCursor(), from = cur, to = cur;\n    if (!cm.options.lineWrapping) {\n      from = cur.ch ? Pos(cur.line, cur.ch - 1) : cur;\n      to = Pos(cur.line, cur.ch + 1);\n    }\n    cm.curOp.scrollToPos = {from: from, to: to, margin: cm.options.cursorScrollMargin, isCursor: true};\n  }\n\n  // When an operation has its scrollToPos property set, and another\n  // scroll action is applied before the end of the operation, this\n  // 'simulates' scrolling that position into view in a cheap way, so\n  // that the effect of intermediate scroll commands is not ignored.\n  function resolveScrollToPos(cm) {\n    var range = cm.curOp.scrollToPos;\n    if (range) {\n      cm.curOp.scrollToPos = null;\n      var from = estimateCoords(cm, range.from), to = estimateCoords(cm, range.to);\n      var sPos = calculateScrollPos(cm, Math.min(from.left, to.left),\n                                    Math.min(from.top, to.top) - range.margin,\n                                    Math.max(from.right, to.right),\n                                    Math.max(from.bottom, to.bottom) + range.margin);\n      cm.scrollTo(sPos.scrollLeft, sPos.scrollTop);\n    }\n  }\n\n  // API UTILITIES\n\n  // Indent the given line. The how parameter can be \"smart\",\n  // \"add\"/null, \"subtract\", or \"prev\". When aggressive is false\n  // (typically set to true for forced single-line indents), empty\n  // lines are not indented, and places where the mode returns Pass\n  // are left alone.\n  function indentLine(cm, n, how, aggressive) {\n    var doc = cm.doc, state;\n    if (how == null) how = \"add\";\n    if (how == \"smart\") {\n      // Fall back to \"prev\" when the mode doesn't have an indentation\n      // method.\n      if (!doc.mode.indent) how = \"prev\";\n      else state = getStateBefore(cm, n);\n    }\n\n    var tabSize = cm.options.tabSize;\n    var line = getLine(doc, n), curSpace = countColumn(line.text, null, tabSize);\n    if (line.stateAfter) line.stateAfter = null;\n    var curSpaceString = line.text.match(/^\\s*/)[0], indentation;\n    if (!aggressive && !/\\S/.test(line.text)) {\n      indentation = 0;\n      how = \"not\";\n    } else if (how == \"smart\") {\n      indentation = doc.mode.indent(state, line.text.slice(curSpaceString.length), line.text);\n      if (indentation == Pass || indentation > 150) {\n        if (!aggressive) return;\n        how = \"prev\";\n      }\n    }\n    if (how == \"prev\") {\n      if (n > doc.first) indentation = countColumn(getLine(doc, n-1).text, null, tabSize);\n      else indentation = 0;\n    } else if (how == \"add\") {\n      indentation = curSpace + cm.options.indentUnit;\n    } else if (how == \"subtract\") {\n      indentation = curSpace - cm.options.indentUnit;\n    } else if (typeof how == \"number\") {\n      indentation = curSpace + how;\n    }\n    indentation = Math.max(0, indentation);\n\n    var indentString = \"\", pos = 0;\n    if (cm.options.indentWithTabs)\n      for (var i = Math.floor(indentation / tabSize); i; --i) {pos += tabSize; indentString += \"\\t\";}\n    if (pos < indentation) indentString += spaceStr(indentation - pos);\n\n    if (indentString != curSpaceString) {\n      replaceRange(doc, indentString, Pos(n, 0), Pos(n, curSpaceString.length), \"+input\");\n    } else {\n      // Ensure that, if the cursor was in the whitespace at the start\n      // of the line, it is moved to the end of that space.\n      for (var i = 0; i < doc.sel.ranges.length; i++) {\n        var range = doc.sel.ranges[i];\n        if (range.head.line == n && range.head.ch < curSpaceString.length) {\n          var pos = Pos(n, curSpaceString.length);\n          replaceOneSelection(doc, i, new Range(pos, pos));\n          break;\n        }\n      }\n    }\n    line.stateAfter = null;\n  }\n\n  // Utility for applying a change to a line by handle or number,\n  // returning the number and optionally registering the line as\n  // changed.\n  function changeLine(doc, handle, changeType, op) {\n    var no = handle, line = handle;\n    if (typeof handle == \"number\") line = getLine(doc, clipLine(doc, handle));\n    else no = lineNo(handle);\n    if (no == null) return null;\n    if (op(line, no) && doc.cm) regLineChange(doc.cm, no, changeType);\n    return line;\n  }\n\n  // Helper for deleting text near the selection(s), used to implement\n  // backspace, delete, and similar functionality.\n  function deleteNearSelection(cm, compute) {\n    var ranges = cm.doc.sel.ranges, kill = [];\n    // Build up a set of ranges to kill first, merging overlapping\n    // ranges.\n    for (var i = 0; i < ranges.length; i++) {\n      var toKill = compute(ranges[i]);\n      while (kill.length && cmp(toKill.from, lst(kill).to) <= 0) {\n        var replaced = kill.pop();\n        if (cmp(replaced.from, toKill.from) < 0) {\n          toKill.from = replaced.from;\n          break;\n        }\n      }\n      kill.push(toKill);\n    }\n    // Next, remove those actual ranges.\n    runInOp(cm, function() {\n      for (var i = kill.length - 1; i >= 0; i--)\n        replaceRange(cm.doc, \"\", kill[i].from, kill[i].to, \"+delete\");\n      ensureCursorVisible(cm);\n    });\n  }\n\n  // Used for horizontal relative motion. Dir is -1 or 1 (left or\n  // right), unit can be \"char\", \"column\" (like char, but doesn't\n  // cross line boundaries), \"word\" (across next word), or \"group\" (to\n  // the start of next group of word or non-word-non-whitespace\n  // chars). The visually param controls whether, in right-to-left\n  // text, direction 1 means to move towards the next index in the\n  // string, or towards the character to the right of the current\n  // position. The resulting position will have a hitSide=true\n  // property if it reached the end of the document.\n  function findPosH(doc, pos, dir, unit, visually) {\n    var line = pos.line, ch = pos.ch, origDir = dir;\n    var lineObj = getLine(doc, line);\n    var possible = true;\n    function findNextLine() {\n      var l = line + dir;\n      if (l < doc.first || l >= doc.first + doc.size) return (possible = false);\n      line = l;\n      return lineObj = getLine(doc, l);\n    }\n    function moveOnce(boundToLine) {\n      var next = (visually ? moveVisually : moveLogically)(lineObj, ch, dir, true);\n      if (next == null) {\n        if (!boundToLine && findNextLine()) {\n          if (visually) ch = (dir < 0 ? lineRight : lineLeft)(lineObj);\n          else ch = dir < 0 ? lineObj.text.length : 0;\n        } else return (possible = false);\n      } else ch = next;\n      return true;\n    }\n\n    if (unit == \"char\") moveOnce();\n    else if (unit == \"column\") moveOnce(true);\n    else if (unit == \"word\" || unit == \"group\") {\n      var sawType = null, group = unit == \"group\";\n      var helper = doc.cm && doc.cm.getHelper(pos, \"wordChars\");\n      for (var first = true;; first = false) {\n        if (dir < 0 && !moveOnce(!first)) break;\n        var cur = lineObj.text.charAt(ch) || \"\\n\";\n        var type = isWordChar(cur, helper) ? \"w\"\n          : group && cur == \"\\n\" ? \"n\"\n          : !group || /\\s/.test(cur) ? null\n          : \"p\";\n        if (group && !first && !type) type = \"s\";\n        if (sawType && sawType != type) {\n          if (dir < 0) {dir = 1; moveOnce();}\n          break;\n        }\n\n        if (type) sawType = type;\n        if (dir > 0 && !moveOnce(!first)) break;\n      }\n    }\n    var result = skipAtomic(doc, Pos(line, ch), origDir, true);\n    if (!possible) result.hitSide = true;\n    return result;\n  }\n\n  // For relative vertical movement. Dir may be -1 or 1. Unit can be\n  // \"page\" or \"line\". The resulting position will have a hitSide=true\n  // property if it reached the end of the document.\n  function findPosV(cm, pos, dir, unit) {\n    var doc = cm.doc, x = pos.left, y;\n    if (unit == \"page\") {\n      var pageSize = Math.min(cm.display.wrapper.clientHeight, window.innerHeight || document.documentElement.clientHeight);\n      y = pos.top + dir * (pageSize - (dir < 0 ? 1.5 : .5) * textHeight(cm.display));\n    } else if (unit == \"line\") {\n      y = dir > 0 ? pos.bottom + 3 : pos.top - 3;\n    }\n    for (;;) {\n      var target = coordsChar(cm, x, y);\n      if (!target.outside) break;\n      if (dir < 0 ? y <= 0 : y >= doc.height) { target.hitSide = true; break; }\n      y += dir * 5;\n    }\n    return target;\n  }\n\n  // EDITOR METHODS\n\n  // The publicly visible API. Note that methodOp(f) means\n  // 'wrap f in an operation, performed on its `this` parameter'.\n\n  // This is not the complete set of editor methods. Most of the\n  // methods defined on the Doc type are also injected into\n  // CodeMirror.prototype, for backwards compatibility and\n  // convenience.\n\n  CodeMirror.prototype = {\n    constructor: CodeMirror,\n    focus: function(){window.focus(); focusInput(this); fastPoll(this);},\n\n    setOption: function(option, value) {\n      var options = this.options, old = options[option];\n      if (options[option] == value && option != \"mode\") return;\n      options[option] = value;\n      if (optionHandlers.hasOwnProperty(option))\n        operation(this, optionHandlers[option])(this, value, old);\n    },\n\n    getOption: function(option) {return this.options[option];},\n    getDoc: function() {return this.doc;},\n\n    addKeyMap: function(map, bottom) {\n      this.state.keyMaps[bottom ? \"push\" : \"unshift\"](getKeyMap(map));\n    },\n    removeKeyMap: function(map) {\n      var maps = this.state.keyMaps;\n      for (var i = 0; i < maps.length; ++i)\n        if (maps[i] == map || maps[i].name == map) {\n          maps.splice(i, 1);\n          return true;\n        }\n    },\n\n    addOverlay: methodOp(function(spec, options) {\n      var mode = spec.token ? spec : CodeMirror.getMode(this.options, spec);\n      if (mode.startState) throw new Error(\"Overlays may not be stateful.\");\n      this.state.overlays.push({mode: mode, modeSpec: spec, opaque: options && options.opaque});\n      this.state.modeGen++;\n      regChange(this);\n    }),\n    removeOverlay: methodOp(function(spec) {\n      var overlays = this.state.overlays;\n      for (var i = 0; i < overlays.length; ++i) {\n        var cur = overlays[i].modeSpec;\n        if (cur == spec || typeof spec == \"string\" && cur.name == spec) {\n          overlays.splice(i, 1);\n          this.state.modeGen++;\n          regChange(this);\n          return;\n        }\n      }\n    }),\n\n    indentLine: methodOp(function(n, dir, aggressive) {\n      if (typeof dir != \"string\" && typeof dir != \"number\") {\n        if (dir == null) dir = this.options.smartIndent ? \"smart\" : \"prev\";\n        else dir = dir ? \"add\" : \"subtract\";\n      }\n      if (isLine(this.doc, n)) indentLine(this, n, dir, aggressive);\n    }),\n    indentSelection: methodOp(function(how) {\n      var ranges = this.doc.sel.ranges, end = -1;\n      for (var i = 0; i < ranges.length; i++) {\n        var range = ranges[i];\n        if (!range.empty()) {\n          var from = range.from(), to = range.to();\n          var start = Math.max(end, from.line);\n          end = Math.min(this.lastLine(), to.line - (to.ch ? 0 : 1)) + 1;\n          for (var j = start; j < end; ++j)\n            indentLine(this, j, how);\n          var newRanges = this.doc.sel.ranges;\n          if (from.ch == 0 && ranges.length == newRanges.length && newRanges[i].from().ch > 0)\n            replaceOneSelection(this.doc, i, new Range(from, newRanges[i].to()), sel_dontScroll);\n        } else if (range.head.line > end) {\n          indentLine(this, range.head.line, how, true);\n          end = range.head.line;\n          if (i == this.doc.sel.primIndex) ensureCursorVisible(this);\n        }\n      }\n    }),\n\n    // Fetch the parser token for a given character. Useful for hacks\n    // that want to inspect the mode state (say, for completion).\n    getTokenAt: function(pos, precise) {\n      return takeToken(this, pos, precise);\n    },\n\n    getLineTokens: function(line, precise) {\n      return takeToken(this, Pos(line), precise, true);\n    },\n\n    getTokenTypeAt: function(pos) {\n      pos = clipPos(this.doc, pos);\n      var styles = getLineStyles(this, getLine(this.doc, pos.line));\n      var before = 0, after = (styles.length - 1) / 2, ch = pos.ch;\n      var type;\n      if (ch == 0) type = styles[2];\n      else for (;;) {\n        var mid = (before + after) >> 1;\n        if ((mid ? styles[mid * 2 - 1] : 0) >= ch) after = mid;\n        else if (styles[mid * 2 + 1] < ch) before = mid + 1;\n        else { type = styles[mid * 2 + 2]; break; }\n      }\n      var cut = type ? type.indexOf(\"cm-overlay \") : -1;\n      return cut < 0 ? type : cut == 0 ? null : type.slice(0, cut - 1);\n    },\n\n    getModeAt: function(pos) {\n      var mode = this.doc.mode;\n      if (!mode.innerMode) return mode;\n      return CodeMirror.innerMode(mode, this.getTokenAt(pos).state).mode;\n    },\n\n    getHelper: function(pos, type) {\n      return this.getHelpers(pos, type)[0];\n    },\n\n    getHelpers: function(pos, type) {\n      var found = [];\n      if (!helpers.hasOwnProperty(type)) return helpers;\n      var help = helpers[type], mode = this.getModeAt(pos);\n      if (typeof mode[type] == \"string\") {\n        if (help[mode[type]]) found.push(help[mode[type]]);\n      } else if (mode[type]) {\n        for (var i = 0; i < mode[type].length; i++) {\n          var val = help[mode[type][i]];\n          if (val) found.push(val);\n        }\n      } else if (mode.helperType && help[mode.helperType]) {\n        found.push(help[mode.helperType]);\n      } else if (help[mode.name]) {\n        found.push(help[mode.name]);\n      }\n      for (var i = 0; i < help._global.length; i++) {\n        var cur = help._global[i];\n        if (cur.pred(mode, this) && indexOf(found, cur.val) == -1)\n          found.push(cur.val);\n      }\n      return found;\n    },\n\n    getStateAfter: function(line, precise) {\n      var doc = this.doc;\n      line = clipLine(doc, line == null ? doc.first + doc.size - 1: line);\n      return getStateBefore(this, line + 1, precise);\n    },\n\n    cursorCoords: function(start, mode) {\n      var pos, range = this.doc.sel.primary();\n      if (start == null) pos = range.head;\n      else if (typeof start == \"object\") pos = clipPos(this.doc, start);\n      else pos = start ? range.from() : range.to();\n      return cursorCoords(this, pos, mode || \"page\");\n    },\n\n    charCoords: function(pos, mode) {\n      return charCoords(this, clipPos(this.doc, pos), mode || \"page\");\n    },\n\n    coordsChar: function(coords, mode) {\n      coords = fromCoordSystem(this, coords, mode || \"page\");\n      return coordsChar(this, coords.left, coords.top);\n    },\n\n    lineAtHeight: function(height, mode) {\n      height = fromCoordSystem(this, {top: height, left: 0}, mode || \"page\").top;\n      return lineAtHeight(this.doc, height + this.display.viewOffset);\n    },\n    heightAtLine: function(line, mode) {\n      var end = false, last = this.doc.first + this.doc.size - 1;\n      if (line < this.doc.first) line = this.doc.first;\n      else if (line > last) { line = last; end = true; }\n      var lineObj = getLine(this.doc, line);\n      return intoCoordSystem(this, lineObj, {top: 0, left: 0}, mode || \"page\").top +\n        (end ? this.doc.height - heightAtLine(lineObj) : 0);\n    },\n\n    defaultTextHeight: function() { return textHeight(this.display); },\n    defaultCharWidth: function() { return charWidth(this.display); },\n\n    setGutterMarker: methodOp(function(line, gutterID, value) {\n      return changeLine(this.doc, line, \"gutter\", function(line) {\n        var markers = line.gutterMarkers || (line.gutterMarkers = {});\n        markers[gutterID] = value;\n        if (!value && isEmpty(markers)) line.gutterMarkers = null;\n        return true;\n      });\n    }),\n\n    clearGutter: methodOp(function(gutterID) {\n      var cm = this, doc = cm.doc, i = doc.first;\n      doc.iter(function(line) {\n        if (line.gutterMarkers && line.gutterMarkers[gutterID]) {\n          line.gutterMarkers[gutterID] = null;\n          regLineChange(cm, i, \"gutter\");\n          if (isEmpty(line.gutterMarkers)) line.gutterMarkers = null;\n        }\n        ++i;\n      });\n    }),\n\n    addLineWidget: methodOp(function(handle, node, options) {\n      return addLineWidget(this, handle, node, options);\n    }),\n\n    removeLineWidget: function(widget) { widget.clear(); },\n\n    lineInfo: function(line) {\n      if (typeof line == \"number\") {\n        if (!isLine(this.doc, line)) return null;\n        var n = line;\n        line = getLine(this.doc, line);\n        if (!line) return null;\n      } else {\n        var n = lineNo(line);\n        if (n == null) return null;\n      }\n      return {line: n, handle: line, text: line.text, gutterMarkers: line.gutterMarkers,\n              textClass: line.textClass, bgClass: line.bgClass, wrapClass: line.wrapClass,\n              widgets: line.widgets};\n    },\n\n    getViewport: function() { return {from: this.display.viewFrom, to: this.display.viewTo};},\n\n    addWidget: function(pos, node, scroll, vert, horiz) {\n      var display = this.display;\n      pos = cursorCoords(this, clipPos(this.doc, pos));\n      var top = pos.bottom, left = pos.left;\n      node.style.position = \"absolute\";\n      display.sizer.appendChild(node);\n      if (vert == \"over\") {\n        top = pos.top;\n      } else if (vert == \"above\" || vert == \"near\") {\n        var vspace = Math.max(display.wrapper.clientHeight, this.doc.height),\n        hspace = Math.max(display.sizer.clientWidth, display.lineSpace.clientWidth);\n        // Default to positioning above (if specified and possible); otherwise default to positioning below\n        if ((vert == 'above' || pos.bottom + node.offsetHeight > vspace) && pos.top > node.offsetHeight)\n          top = pos.top - node.offsetHeight;\n        else if (pos.bottom + node.offsetHeight <= vspace)\n          top = pos.bottom;\n        if (left + node.offsetWidth > hspace)\n          left = hspace - node.offsetWidth;\n      }\n      node.style.top = top + \"px\";\n      node.style.left = node.style.right = \"\";\n      if (horiz == \"right\") {\n        left = display.sizer.clientWidth - node.offsetWidth;\n        node.style.right = \"0px\";\n      } else {\n        if (horiz == \"left\") left = 0;\n        else if (horiz == \"middle\") left = (display.sizer.clientWidth - node.offsetWidth) / 2;\n        node.style.left = left + \"px\";\n      }\n      if (scroll)\n        scrollIntoView(this, left, top, left + node.offsetWidth, top + node.offsetHeight);\n    },\n\n    triggerOnKeyDown: methodOp(onKeyDown),\n    triggerOnKeyPress: methodOp(onKeyPress),\n    triggerOnKeyUp: onKeyUp,\n\n    execCommand: function(cmd) {\n      if (commands.hasOwnProperty(cmd))\n        return commands[cmd](this);\n    },\n\n    findPosH: function(from, amount, unit, visually) {\n      var dir = 1;\n      if (amount < 0) { dir = -1; amount = -amount; }\n      for (var i = 0, cur = clipPos(this.doc, from); i < amount; ++i) {\n        cur = findPosH(this.doc, cur, dir, unit, visually);\n        if (cur.hitSide) break;\n      }\n      return cur;\n    },\n\n    moveH: methodOp(function(dir, unit) {\n      var cm = this;\n      cm.extendSelectionsBy(function(range) {\n        if (cm.display.shift || cm.doc.extend || range.empty())\n          return findPosH(cm.doc, range.head, dir, unit, cm.options.rtlMoveVisually);\n        else\n          return dir < 0 ? range.from() : range.to();\n      }, sel_move);\n    }),\n\n    deleteH: methodOp(function(dir, unit) {\n      var sel = this.doc.sel, doc = this.doc;\n      if (sel.somethingSelected())\n        doc.replaceSelection(\"\", null, \"+delete\");\n      else\n        deleteNearSelection(this, function(range) {\n          var other = findPosH(doc, range.head, dir, unit, false);\n          return dir < 0 ? {from: other, to: range.head} : {from: range.head, to: other};\n        });\n    }),\n\n    findPosV: function(from, amount, unit, goalColumn) {\n      var dir = 1, x = goalColumn;\n      if (amount < 0) { dir = -1; amount = -amount; }\n      for (var i = 0, cur = clipPos(this.doc, from); i < amount; ++i) {\n        var coords = cursorCoords(this, cur, \"div\");\n        if (x == null) x = coords.left;\n        else coords.left = x;\n        cur = findPosV(this, coords, dir, unit);\n        if (cur.hitSide) break;\n      }\n      return cur;\n    },\n\n    moveV: methodOp(function(dir, unit) {\n      var cm = this, doc = this.doc, goals = [];\n      var collapse = !cm.display.shift && !doc.extend && doc.sel.somethingSelected();\n      doc.extendSelectionsBy(function(range) {\n        if (collapse)\n          return dir < 0 ? range.from() : range.to();\n        var headPos = cursorCoords(cm, range.head, \"div\");\n        if (range.goalColumn != null) headPos.left = range.goalColumn;\n        goals.push(headPos.left);\n        var pos = findPosV(cm, headPos, dir, unit);\n        if (unit == \"page\" && range == doc.sel.primary())\n          addToScrollPos(cm, null, charCoords(cm, pos, \"div\").top - headPos.top);\n        return pos;\n      }, sel_move);\n      if (goals.length) for (var i = 0; i < doc.sel.ranges.length; i++)\n        doc.sel.ranges[i].goalColumn = goals[i];\n    }),\n\n    // Find the word at the given position (as returned by coordsChar).\n    findWordAt: function(pos) {\n      var doc = this.doc, line = getLine(doc, pos.line).text;\n      var start = pos.ch, end = pos.ch;\n      if (line) {\n        var helper = this.getHelper(pos, \"wordChars\");\n        if ((pos.xRel < 0 || end == line.length) && start) --start; else ++end;\n        var startChar = line.charAt(start);\n        var check = isWordChar(startChar, helper)\n          ? function(ch) { return isWordChar(ch, helper); }\n          : /\\s/.test(startChar) ? function(ch) {return /\\s/.test(ch);}\n          : function(ch) {return !/\\s/.test(ch) && !isWordChar(ch);};\n        while (start > 0 && check(line.charAt(start - 1))) --start;\n        while (end < line.length && check(line.charAt(end))) ++end;\n      }\n      return new Range(Pos(pos.line, start), Pos(pos.line, end));\n    },\n\n    toggleOverwrite: function(value) {\n      if (value != null && value == this.state.overwrite) return;\n      if (this.state.overwrite = !this.state.overwrite)\n        addClass(this.display.cursorDiv, \"CodeMirror-overwrite\");\n      else\n        rmClass(this.display.cursorDiv, \"CodeMirror-overwrite\");\n\n      signal(this, \"overwriteToggle\", this, this.state.overwrite);\n    },\n    hasFocus: function() { return activeElt() == this.display.input; },\n\n    scrollTo: methodOp(function(x, y) {\n      if (x != null || y != null) resolveScrollToPos(this);\n      if (x != null) this.curOp.scrollLeft = x;\n      if (y != null) this.curOp.scrollTop = y;\n    }),\n    getScrollInfo: function() {\n      var scroller = this.display.scroller, co = scrollerCutOff;\n      return {left: scroller.scrollLeft, top: scroller.scrollTop,\n              height: scroller.scrollHeight - co, width: scroller.scrollWidth - co,\n              clientHeight: scroller.clientHeight - co, clientWidth: scroller.clientWidth - co};\n    },\n\n    scrollIntoView: methodOp(function(range, margin) {\n      if (range == null) {\n        range = {from: this.doc.sel.primary().head, to: null};\n        if (margin == null) margin = this.options.cursorScrollMargin;\n      } else if (typeof range == \"number\") {\n        range = {from: Pos(range, 0), to: null};\n      } else if (range.from == null) {\n        range = {from: range, to: null};\n      }\n      if (!range.to) range.to = range.from;\n      range.margin = margin || 0;\n\n      if (range.from.line != null) {\n        resolveScrollToPos(this);\n        this.curOp.scrollToPos = range;\n      } else {\n        var sPos = calculateScrollPos(this, Math.min(range.from.left, range.to.left),\n                                      Math.min(range.from.top, range.to.top) - range.margin,\n                                      Math.max(range.from.right, range.to.right),\n                                      Math.max(range.from.bottom, range.to.bottom) + range.margin);\n        this.scrollTo(sPos.scrollLeft, sPos.scrollTop);\n      }\n    }),\n\n    setSize: methodOp(function(width, height) {\n      var cm = this;\n      function interpret(val) {\n        return typeof val == \"number\" || /^\\d+$/.test(String(val)) ? val + \"px\" : val;\n      }\n      if (width != null) cm.display.wrapper.style.width = interpret(width);\n      if (height != null) cm.display.wrapper.style.height = interpret(height);\n      if (cm.options.lineWrapping) clearLineMeasurementCache(this);\n      var lineNo = cm.display.viewFrom;\n      cm.doc.iter(lineNo, cm.display.viewTo, function(line) {\n        if (line.widgets) for (var i = 0; i < line.widgets.length; i++)\n          if (line.widgets[i].noHScroll) { regLineChange(cm, lineNo, \"widget\"); break; }\n        ++lineNo;\n      });\n      cm.curOp.forceUpdate = true;\n      signal(cm, \"refresh\", this);\n    }),\n\n    operation: function(f){return runInOp(this, f);},\n\n    refresh: methodOp(function() {\n      var oldHeight = this.display.cachedTextHeight;\n      regChange(this);\n      this.curOp.forceUpdate = true;\n      clearCaches(this);\n      this.scrollTo(this.doc.scrollLeft, this.doc.scrollTop);\n      updateGutterSpace(this);\n      if (oldHeight == null || Math.abs(oldHeight - textHeight(this.display)) > .5)\n        estimateLineHeights(this);\n      signal(this, \"refresh\", this);\n    }),\n\n    swapDoc: methodOp(function(doc) {\n      var old = this.doc;\n      old.cm = null;\n      attachDoc(this, doc);\n      clearCaches(this);\n      resetInput(this);\n      this.scrollTo(doc.scrollLeft, doc.scrollTop);\n      this.curOp.forceScroll = true;\n      signalLater(this, \"swapDoc\", this, old);\n      return old;\n    }),\n\n    getInputField: function(){return this.display.input;},\n    getWrapperElement: function(){return this.display.wrapper;},\n    getScrollerElement: function(){return this.display.scroller;},\n    getGutterElement: function(){return this.display.gutters;}\n  };\n  eventMixin(CodeMirror);\n\n  // OPTION DEFAULTS\n\n  // The default configuration options.\n  var defaults = CodeMirror.defaults = {};\n  // Functions to run when options are changed.\n  var optionHandlers = CodeMirror.optionHandlers = {};\n\n  function option(name, deflt, handle, notOnInit) {\n    CodeMirror.defaults[name] = deflt;\n    if (handle) optionHandlers[name] =\n      notOnInit ? function(cm, val, old) {if (old != Init) handle(cm, val, old);} : handle;\n  }\n\n  // Passed to option handlers when there is no old value.\n  var Init = CodeMirror.Init = {toString: function(){return \"CodeMirror.Init\";}};\n\n  // These two are, on init, called from the constructor because they\n  // have to be initialized before the editor can start at all.\n  option(\"value\", \"\", function(cm, val) {\n    cm.setValue(val);\n  }, true);\n  option(\"mode\", null, function(cm, val) {\n    cm.doc.modeOption = val;\n    loadMode(cm);\n  }, true);\n\n  option(\"indentUnit\", 2, loadMode, true);\n  option(\"indentWithTabs\", false);\n  option(\"smartIndent\", true);\n  option(\"tabSize\", 4, function(cm) {\n    resetModeState(cm);\n    clearCaches(cm);\n    regChange(cm);\n  }, true);\n  option(\"specialChars\", /[\\t\\u0000-\\u0019\\u00ad\\u200b-\\u200f\\u2028\\u2029\\ufeff]/g, function(cm, val) {\n    cm.options.specialChars = new RegExp(val.source + (val.test(\"\\t\") ? \"\" : \"|\\t\"), \"g\");\n    cm.refresh();\n  }, true);\n  option(\"specialCharPlaceholder\", defaultSpecialCharPlaceholder, function(cm) {cm.refresh();}, true);\n  option(\"electricChars\", true);\n  option(\"rtlMoveVisually\", !windows);\n  option(\"wholeLineUpdateBefore\", true);\n\n  option(\"theme\", \"default\", function(cm) {\n    themeChanged(cm);\n    guttersChanged(cm);\n  }, true);\n  option(\"keyMap\", \"default\", function(cm, val, old) {\n    var next = getKeyMap(val);\n    var prev = old != CodeMirror.Init && getKeyMap(old);\n    if (prev && prev.detach) prev.detach(cm, next);\n    if (next.attach) next.attach(cm, prev || null);\n  });\n  option(\"extraKeys\", null);\n\n  option(\"lineWrapping\", false, wrappingChanged, true);\n  option(\"gutters\", [], function(cm) {\n    setGuttersForLineNumbers(cm.options);\n    guttersChanged(cm);\n  }, true);\n  option(\"fixedGutter\", true, function(cm, val) {\n    cm.display.gutters.style.left = val ? compensateForHScroll(cm.display) + \"px\" : \"0\";\n    cm.refresh();\n  }, true);\n  option(\"coverGutterNextToScrollbar\", false, updateScrollbars, true);\n  option(\"lineNumbers\", false, function(cm) {\n    setGuttersForLineNumbers(cm.options);\n    guttersChanged(cm);\n  }, true);\n  option(\"firstLineNumber\", 1, guttersChanged, true);\n  option(\"lineNumberFormatter\", function(integer) {return integer;}, guttersChanged, true);\n  option(\"showCursorWhenSelecting\", false, updateSelection, true);\n\n  option(\"resetSelectionOnContextMenu\", true);\n\n  option(\"readOnly\", false, function(cm, val) {\n    if (val == \"nocursor\") {\n      onBlur(cm);\n      cm.display.input.blur();\n      cm.display.disabled = true;\n    } else {\n      cm.display.disabled = false;\n      if (!val) resetInput(cm);\n    }\n  });\n  option(\"disableInput\", false, function(cm, val) {if (!val) resetInput(cm);}, true);\n  option(\"dragDrop\", true);\n\n  option(\"cursorBlinkRate\", 530);\n  option(\"cursorScrollMargin\", 0);\n  option(\"cursorHeight\", 1, updateSelection, true);\n  option(\"singleCursorHeightPerLine\", true, updateSelection, true);\n  option(\"workTime\", 100);\n  option(\"workDelay\", 100);\n  option(\"flattenSpans\", true, resetModeState, true);\n  option(\"addModeClass\", false, resetModeState, true);\n  option(\"pollInterval\", 100);\n  option(\"undoDepth\", 200, function(cm, val){cm.doc.history.undoDepth = val;});\n  option(\"historyEventDelay\", 1250);\n  option(\"viewportMargin\", 10, function(cm){cm.refresh();}, true);\n  option(\"maxHighlightLength\", 10000, resetModeState, true);\n  option(\"moveInputWithCursor\", true, function(cm, val) {\n    if (!val) cm.display.inputDiv.style.top = cm.display.inputDiv.style.left = 0;\n  });\n\n  option(\"tabindex\", null, function(cm, val) {\n    cm.display.input.tabIndex = val || \"\";\n  });\n  option(\"autofocus\", null);\n\n  // MODE DEFINITION AND QUERYING\n\n  // Known modes, by name and by MIME\n  var modes = CodeMirror.modes = {}, mimeModes = CodeMirror.mimeModes = {};\n\n  // Extra arguments are stored as the mode's dependencies, which is\n  // used by (legacy) mechanisms like loadmode.js to automatically\n  // load a mode. (Preferred mechanism is the require/define calls.)\n  CodeMirror.defineMode = function(name, mode) {\n    if (!CodeMirror.defaults.mode && name != \"null\") CodeMirror.defaults.mode = name;\n    if (arguments.length > 2)\n      mode.dependencies = Array.prototype.slice.call(arguments, 2);\n    modes[name] = mode;\n  };\n\n  CodeMirror.defineMIME = function(mime, spec) {\n    mimeModes[mime] = spec;\n  };\n\n  // Given a MIME type, a {name, ...options} config object, or a name\n  // string, return a mode config object.\n  CodeMirror.resolveMode = function(spec) {\n    if (typeof spec == \"string\" && mimeModes.hasOwnProperty(spec)) {\n      spec = mimeModes[spec];\n    } else if (spec && typeof spec.name == \"string\" && mimeModes.hasOwnProperty(spec.name)) {\n      var found = mimeModes[spec.name];\n      if (typeof found == \"string\") found = {name: found};\n      spec = createObj(found, spec);\n      spec.name = found.name;\n    } else if (typeof spec == \"string\" && /^[\\w\\-]+\\/[\\w\\-]+\\+xml$/.test(spec)) {\n      return CodeMirror.resolveMode(\"application/xml\");\n    }\n    if (typeof spec == \"string\") return {name: spec};\n    else return spec || {name: \"null\"};\n  };\n\n  // Given a mode spec (anything that resolveMode accepts), find and\n  // initialize an actual mode object.\n  CodeMirror.getMode = function(options, spec) {\n    var spec = CodeMirror.resolveMode(spec);\n    var mfactory = modes[spec.name];\n    if (!mfactory) return CodeMirror.getMode(options, \"text/plain\");\n    var modeObj = mfactory(options, spec);\n    if (modeExtensions.hasOwnProperty(spec.name)) {\n      var exts = modeExtensions[spec.name];\n      for (var prop in exts) {\n        if (!exts.hasOwnProperty(prop)) continue;\n        if (modeObj.hasOwnProperty(prop)) modeObj[\"_\" + prop] = modeObj[prop];\n        modeObj[prop] = exts[prop];\n      }\n    }\n    modeObj.name = spec.name;\n    if (spec.helperType) modeObj.helperType = spec.helperType;\n    if (spec.modeProps) for (var prop in spec.modeProps)\n      modeObj[prop] = spec.modeProps[prop];\n\n    return modeObj;\n  };\n\n  // Minimal default mode.\n  CodeMirror.defineMode(\"null\", function() {\n    return {token: function(stream) {stream.skipToEnd();}};\n  });\n  CodeMirror.defineMIME(\"text/plain\", \"null\");\n\n  // This can be used to attach properties to mode objects from\n  // outside the actual mode definition.\n  var modeExtensions = CodeMirror.modeExtensions = {};\n  CodeMirror.extendMode = function(mode, properties) {\n    var exts = modeExtensions.hasOwnProperty(mode) ? modeExtensions[mode] : (modeExtensions[mode] = {});\n    copyObj(properties, exts);\n  };\n\n  // EXTENSIONS\n\n  CodeMirror.defineExtension = function(name, func) {\n    CodeMirror.prototype[name] = func;\n  };\n  CodeMirror.defineDocExtension = function(name, func) {\n    Doc.prototype[name] = func;\n  };\n  CodeMirror.defineOption = option;\n\n  var initHooks = [];\n  CodeMirror.defineInitHook = function(f) {initHooks.push(f);};\n\n  var helpers = CodeMirror.helpers = {};\n  CodeMirror.registerHelper = function(type, name, value) {\n    if (!helpers.hasOwnProperty(type)) helpers[type] = CodeMirror[type] = {_global: []};\n    helpers[type][name] = value;\n  };\n  CodeMirror.registerGlobalHelper = function(type, name, predicate, value) {\n    CodeMirror.registerHelper(type, name, value);\n    helpers[type]._global.push({pred: predicate, val: value});\n  };\n\n  // MODE STATE HANDLING\n\n  // Utility functions for working with state. Exported because nested\n  // modes need to do this for their inner modes.\n\n  var copyState = CodeMirror.copyState = function(mode, state) {\n    if (state === true) return state;\n    if (mode.copyState) return mode.copyState(state);\n    var nstate = {};\n    for (var n in state) {\n      var val = state[n];\n      if (val instanceof Array) val = val.concat([]);\n      nstate[n] = val;\n    }\n    return nstate;\n  };\n\n  var startState = CodeMirror.startState = function(mode, a1, a2) {\n    return mode.startState ? mode.startState(a1, a2) : true;\n  };\n\n  // Given a mode and a state (for that mode), find the inner mode and\n  // state at the position that the state refers to.\n  CodeMirror.innerMode = function(mode, state) {\n    while (mode.innerMode) {\n      var info = mode.innerMode(state);\n      if (!info || info.mode == mode) break;\n      state = info.state;\n      mode = info.mode;\n    }\n    return info || {mode: mode, state: state};\n  };\n\n  // STANDARD COMMANDS\n\n  // Commands are parameter-less actions that can be performed on an\n  // editor, mostly used for keybindings.\n  var commands = CodeMirror.commands = {\n    selectAll: function(cm) {cm.setSelection(Pos(cm.firstLine(), 0), Pos(cm.lastLine()), sel_dontScroll);},\n    singleSelection: function(cm) {\n      cm.setSelection(cm.getCursor(\"anchor\"), cm.getCursor(\"head\"), sel_dontScroll);\n    },\n    killLine: function(cm) {\n      deleteNearSelection(cm, function(range) {\n        if (range.empty()) {\n          var len = getLine(cm.doc, range.head.line).text.length;\n          if (range.head.ch == len && range.head.line < cm.lastLine())\n            return {from: range.head, to: Pos(range.head.line + 1, 0)};\n          else\n            return {from: range.head, to: Pos(range.head.line, len)};\n        } else {\n          return {from: range.from(), to: range.to()};\n        }\n      });\n    },\n    deleteLine: function(cm) {\n      deleteNearSelection(cm, function(range) {\n        return {from: Pos(range.from().line, 0),\n                to: clipPos(cm.doc, Pos(range.to().line + 1, 0))};\n      });\n    },\n    delLineLeft: function(cm) {\n      deleteNearSelection(cm, function(range) {\n        return {from: Pos(range.from().line, 0), to: range.from()};\n      });\n    },\n    delWrappedLineLeft: function(cm) {\n      deleteNearSelection(cm, function(range) {\n        var top = cm.charCoords(range.head, \"div\").top + 5;\n        var leftPos = cm.coordsChar({left: 0, top: top}, \"div\");\n        return {from: leftPos, to: range.from()};\n      });\n    },\n    delWrappedLineRight: function(cm) {\n      deleteNearSelection(cm, function(range) {\n        var top = cm.charCoords(range.head, \"div\").top + 5;\n        var rightPos = cm.coordsChar({left: cm.display.lineDiv.offsetWidth + 100, top: top}, \"div\");\n        return {from: range.from(), to: rightPos };\n      });\n    },\n    undo: function(cm) {cm.undo();},\n    redo: function(cm) {cm.redo();},\n    undoSelection: function(cm) {cm.undoSelection();},\n    redoSelection: function(cm) {cm.redoSelection();},\n    goDocStart: function(cm) {cm.extendSelection(Pos(cm.firstLine(), 0));},\n    goDocEnd: function(cm) {cm.extendSelection(Pos(cm.lastLine()));},\n    goLineStart: function(cm) {\n      cm.extendSelectionsBy(function(range) { return lineStart(cm, range.head.line); },\n                            {origin: \"+move\", bias: 1});\n    },\n    goLineStartSmart: function(cm) {\n      cm.extendSelectionsBy(function(range) {\n        return lineStartSmart(cm, range.head);\n      }, {origin: \"+move\", bias: 1});\n    },\n    goLineEnd: function(cm) {\n      cm.extendSelectionsBy(function(range) { return lineEnd(cm, range.head.line); },\n                            {origin: \"+move\", bias: -1});\n    },\n    goLineRight: function(cm) {\n      cm.extendSelectionsBy(function(range) {\n        var top = cm.charCoords(range.head, \"div\").top + 5;\n        return cm.coordsChar({left: cm.display.lineDiv.offsetWidth + 100, top: top}, \"div\");\n      }, sel_move);\n    },\n    goLineLeft: function(cm) {\n      cm.extendSelectionsBy(function(range) {\n        var top = cm.charCoords(range.head, \"div\").top + 5;\n        return cm.coordsChar({left: 0, top: top}, \"div\");\n      }, sel_move);\n    },\n    goLineLeftSmart: function(cm) {\n      cm.extendSelectionsBy(function(range) {\n        var top = cm.charCoords(range.head, \"div\").top + 5;\n        var pos = cm.coordsChar({left: 0, top: top}, \"div\");\n        if (pos.ch < cm.getLine(pos.line).search(/\\S/)) return lineStartSmart(cm, range.head);\n        return pos;\n      }, sel_move);\n    },\n    goLineUp: function(cm) {cm.moveV(-1, \"line\");},\n    goLineDown: function(cm) {cm.moveV(1, \"line\");},\n    goPageUp: function(cm) {cm.moveV(-1, \"page\");},\n    goPageDown: function(cm) {cm.moveV(1, \"page\");},\n    goCharLeft: function(cm) {cm.moveH(-1, \"char\");},\n    goCharRight: function(cm) {cm.moveH(1, \"char\");},\n    goColumnLeft: function(cm) {cm.moveH(-1, \"column\");},\n    goColumnRight: function(cm) {cm.moveH(1, \"column\");},\n    goWordLeft: function(cm) {cm.moveH(-1, \"word\");},\n    goGroupRight: function(cm) {cm.moveH(1, \"group\");},\n    goGroupLeft: function(cm) {cm.moveH(-1, \"group\");},\n    goWordRight: function(cm) {cm.moveH(1, \"word\");},\n    delCharBefore: function(cm) {cm.deleteH(-1, \"char\");},\n    delCharAfter: function(cm) {cm.deleteH(1, \"char\");},\n    delWordBefore: function(cm) {cm.deleteH(-1, \"word\");},\n    delWordAfter: function(cm) {cm.deleteH(1, \"word\");},\n    delGroupBefore: function(cm) {cm.deleteH(-1, \"group\");},\n    delGroupAfter: function(cm) {cm.deleteH(1, \"group\");},\n    indentAuto: function(cm) {cm.indentSelection(\"smart\");},\n    indentMore: function(cm) {cm.indentSelection(\"add\");},\n    indentLess: function(cm) {cm.indentSelection(\"subtract\");},\n    insertTab: function(cm) {cm.replaceSelection(\"\\t\");},\n    insertSoftTab: function(cm) {\n      var spaces = [], ranges = cm.listSelections(), tabSize = cm.options.tabSize;\n      for (var i = 0; i < ranges.length; i++) {\n        var pos = ranges[i].from();\n        var col = countColumn(cm.getLine(pos.line), pos.ch, tabSize);\n        spaces.push(new Array(tabSize - col % tabSize + 1).join(\" \"));\n      }\n      cm.replaceSelections(spaces);\n    },\n    defaultTab: function(cm) {\n      if (cm.somethingSelected()) cm.indentSelection(\"add\");\n      else cm.execCommand(\"insertTab\");\n    },\n    transposeChars: function(cm) {\n      runInOp(cm, function() {\n        var ranges = cm.listSelections(), newSel = [];\n        for (var i = 0; i < ranges.length; i++) {\n          var cur = ranges[i].head, line = getLine(cm.doc, cur.line).text;\n          if (line) {\n            if (cur.ch == line.length) cur = new Pos(cur.line, cur.ch - 1);\n            if (cur.ch > 0) {\n              cur = new Pos(cur.line, cur.ch + 1);\n              cm.replaceRange(line.charAt(cur.ch - 1) + line.charAt(cur.ch - 2),\n                              Pos(cur.line, cur.ch - 2), cur, \"+transpose\");\n            } else if (cur.line > cm.doc.first) {\n              var prev = getLine(cm.doc, cur.line - 1).text;\n              if (prev)\n                cm.replaceRange(line.charAt(0) + \"\\n\" + prev.charAt(prev.length - 1),\n                                Pos(cur.line - 1, prev.length - 1), Pos(cur.line, 1), \"+transpose\");\n            }\n          }\n          newSel.push(new Range(cur, cur));\n        }\n        cm.setSelections(newSel);\n      });\n    },\n    newlineAndIndent: function(cm) {\n      runInOp(cm, function() {\n        var len = cm.listSelections().length;\n        for (var i = 0; i < len; i++) {\n          var range = cm.listSelections()[i];\n          cm.replaceRange(\"\\n\", range.anchor, range.head, \"+input\");\n          cm.indentLine(range.from().line + 1, null, true);\n          ensureCursorVisible(cm);\n        }\n      });\n    },\n    toggleOverwrite: function(cm) {cm.toggleOverwrite();}\n  };\n\n\n  // STANDARD KEYMAPS\n\n  var keyMap = CodeMirror.keyMap = {};\n\n  keyMap.basic = {\n    \"Left\": \"goCharLeft\", \"Right\": \"goCharRight\", \"Up\": \"goLineUp\", \"Down\": \"goLineDown\",\n    \"End\": \"goLineEnd\", \"Home\": \"goLineStartSmart\", \"PageUp\": \"goPageUp\", \"PageDown\": \"goPageDown\",\n    \"Delete\": \"delCharAfter\", \"Backspace\": \"delCharBefore\", \"Shift-Backspace\": \"delCharBefore\",\n    \"Tab\": \"defaultTab\", \"Shift-Tab\": \"indentAuto\",\n    \"Enter\": \"newlineAndIndent\", \"Insert\": \"toggleOverwrite\",\n    \"Esc\": \"singleSelection\"\n  };\n  // Note that the save and find-related commands aren't defined by\n  // default. User code or addons can define them. Unknown commands\n  // are simply ignored.\n  keyMap.pcDefault = {\n    \"Ctrl-A\": \"selectAll\", \"Ctrl-D\": \"deleteLine\", \"Ctrl-Z\": \"undo\", \"Shift-Ctrl-Z\": \"redo\", \"Ctrl-Y\": \"redo\",\n    \"Ctrl-Home\": \"goDocStart\", \"Ctrl-End\": \"goDocEnd\", \"Ctrl-Up\": \"goLineUp\", \"Ctrl-Down\": \"goLineDown\",\n    \"Ctrl-Left\": \"goGroupLeft\", \"Ctrl-Right\": \"goGroupRight\", \"Alt-Left\": \"goLineStart\", \"Alt-Right\": \"goLineEnd\",\n    \"Ctrl-Backspace\": \"delGroupBefore\", \"Ctrl-Delete\": \"delGroupAfter\", \"Ctrl-S\": \"save\", \"Ctrl-F\": \"find\",\n    \"Ctrl-G\": \"findNext\", \"Shift-Ctrl-G\": \"findPrev\", \"Shift-Ctrl-F\": \"replace\", \"Shift-Ctrl-R\": \"replaceAll\",\n    \"Ctrl-[\": \"indentLess\", \"Ctrl-]\": \"indentMore\",\n    \"Ctrl-U\": \"undoSelection\", \"Shift-Ctrl-U\": \"redoSelection\", \"Alt-U\": \"redoSelection\",\n    fallthrough: \"basic\"\n  };\n  // Very basic readline/emacs-style bindings, which are standard on Mac.\n  keyMap.emacsy = {\n    \"Ctrl-F\": \"goCharRight\", \"Ctrl-B\": \"goCharLeft\", \"Ctrl-P\": \"goLineUp\", \"Ctrl-N\": \"goLineDown\",\n    \"Alt-F\": \"goWordRight\", \"Alt-B\": \"goWordLeft\", \"Ctrl-A\": \"goLineStart\", \"Ctrl-E\": \"goLineEnd\",\n    \"Ctrl-V\": \"goPageDown\", \"Shift-Ctrl-V\": \"goPageUp\", \"Ctrl-D\": \"delCharAfter\", \"Ctrl-H\": \"delCharBefore\",\n    \"Alt-D\": \"delWordAfter\", \"Alt-Backspace\": \"delWordBefore\", \"Ctrl-K\": \"killLine\", \"Ctrl-T\": \"transposeChars\"\n  };\n  keyMap.macDefault = {\n    \"Cmd-A\": \"selectAll\", \"Cmd-D\": \"deleteLine\", \"Cmd-Z\": \"undo\", \"Shift-Cmd-Z\": \"redo\", \"Cmd-Y\": \"redo\",\n    \"Cmd-Home\": \"goDocStart\", \"Cmd-Up\": \"goDocStart\", \"Cmd-End\": \"goDocEnd\", \"Cmd-Down\": \"goDocEnd\", \"Alt-Left\": \"goGroupLeft\",\n    \"Alt-Right\": \"goGroupRight\", \"Cmd-Left\": \"goLineLeft\", \"Cmd-Right\": \"goLineRight\", \"Alt-Backspace\": \"delGroupBefore\",\n    \"Ctrl-Alt-Backspace\": \"delGroupAfter\", \"Alt-Delete\": \"delGroupAfter\", \"Cmd-S\": \"save\", \"Cmd-F\": \"find\",\n    \"Cmd-G\": \"findNext\", \"Shift-Cmd-G\": \"findPrev\", \"Cmd-Alt-F\": \"replace\", \"Shift-Cmd-Alt-F\": \"replaceAll\",\n    \"Cmd-[\": \"indentLess\", \"Cmd-]\": \"indentMore\", \"Cmd-Backspace\": \"delWrappedLineLeft\", \"Cmd-Delete\": \"delWrappedLineRight\",\n    \"Cmd-U\": \"undoSelection\", \"Shift-Cmd-U\": \"redoSelection\", \"Ctrl-Up\": \"goDocStart\", \"Ctrl-Down\": \"goDocEnd\",\n    fallthrough: [\"basic\", \"emacsy\"]\n  };\n  keyMap[\"default\"] = mac ? keyMap.macDefault : keyMap.pcDefault;\n\n  // KEYMAP DISPATCH\n\n  function normalizeKeyName(name) {\n    var parts = name.split(/-(?!$)/), name = parts[parts.length - 1];\n    var alt, ctrl, shift, cmd;\n    for (var i = 0; i < parts.length - 1; i++) {\n      var mod = parts[i];\n      if (/^(cmd|meta|m)$/i.test(mod)) cmd = true;\n      else if (/^a(lt)?$/i.test(mod)) alt = true;\n      else if (/^(c|ctrl|control)$/i.test(mod)) ctrl = true;\n      else if (/^s(hift)$/i.test(mod)) shift = true;\n      else throw new Error(\"Unrecognized modifier name: \" + mod);\n    }\n    if (alt) name = \"Alt-\" + name;\n    if (ctrl) name = \"Ctrl-\" + name;\n    if (cmd) name = \"Cmd-\" + name;\n    if (shift) name = \"Shift-\" + name;\n    return name;\n  }\n\n  // This is a kludge to keep keymaps mostly working as raw objects\n  // (backwards compatibility) while at the same time support features\n  // like normalization and multi-stroke key bindings. It compiles a\n  // new normalized keymap, and then updates the old object to reflect\n  // this.\n  CodeMirror.normalizeKeyMap = function(keymap) {\n    var copy = {};\n    for (var keyname in keymap) if (keymap.hasOwnProperty(keyname)) {\n      var value = keymap[keyname];\n      if (/^(name|fallthrough|(de|at)tach)$/.test(keyname)) continue;\n      if (value == \"...\") { delete keymap[keyname]; continue; }\n\n      var keys = map(keyname.split(\" \"), normalizeKeyName);\n      for (var i = 0; i < keys.length; i++) {\n        var val, name;\n        if (i == keys.length - 1) {\n          name = keyname;\n          val = value;\n        } else {\n          name = keys.slice(0, i + 1).join(\" \");\n          val = \"...\";\n        }\n        var prev = copy[name];\n        if (!prev) copy[name] = val;\n        else if (prev != val) throw new Error(\"Inconsistent bindings for \" + name);\n      }\n      delete keymap[keyname];\n    }\n    for (var prop in copy) keymap[prop] = copy[prop];\n    return keymap;\n  };\n\n  var lookupKey = CodeMirror.lookupKey = function(key, map, handle) {\n    map = getKeyMap(map);\n    var found = map.call ? map.call(key) : map[key];\n    if (found === false) return \"nothing\";\n    if (found === \"...\") return \"multi\";\n    if (found != null && handle(found)) return \"handled\";\n\n    if (map.fallthrough) {\n      if (Object.prototype.toString.call(map.fallthrough) != \"[object Array]\")\n        return lookupKey(key, map.fallthrough, handle);\n      for (var i = 0; i < map.fallthrough.length; i++) {\n        var result = lookupKey(key, map.fallthrough[i], handle);\n        if (result) return result;\n      }\n    }\n  };\n\n  // Modifier key presses don't count as 'real' key presses for the\n  // purpose of keymap fallthrough.\n  var isModifierKey = CodeMirror.isModifierKey = function(value) {\n    var name = typeof value == \"string\" ? value : keyNames[value.keyCode];\n    return name == \"Ctrl\" || name == \"Alt\" || name == \"Shift\" || name == \"Mod\";\n  };\n\n  // Look up the name of a key as indicated by an event object.\n  var keyName = CodeMirror.keyName = function(event, noShift) {\n    if (presto && event.keyCode == 34 && event[\"char\"]) return false;\n    var base = keyNames[event.keyCode], name = base;\n    if (name == null || event.altGraphKey) return false;\n    if (event.altKey && base != \"Alt\") name = \"Alt-\" + name;\n    if ((flipCtrlCmd ? event.metaKey : event.ctrlKey) && base != \"Ctrl\") name = \"Ctrl-\" + name;\n    if ((flipCtrlCmd ? event.ctrlKey : event.metaKey) && base != \"Cmd\") name = \"Cmd-\" + name;\n    if (!noShift && event.shiftKey && base != \"Shift\") name = \"Shift-\" + name;\n    return name;\n  };\n\n  function getKeyMap(val) {\n    return typeof val == \"string\" ? keyMap[val] : val;\n  }\n\n  // FROMTEXTAREA\n\n  CodeMirror.fromTextArea = function(textarea, options) {\n    if (!options) options = {};\n    options.value = textarea.value;\n    if (!options.tabindex && textarea.tabindex)\n      options.tabindex = textarea.tabindex;\n    if (!options.placeholder && textarea.placeholder)\n      options.placeholder = textarea.placeholder;\n    // Set autofocus to true if this textarea is focused, or if it has\n    // autofocus and no other element is focused.\n    if (options.autofocus == null) {\n      var hasFocus = activeElt();\n      options.autofocus = hasFocus == textarea ||\n        textarea.getAttribute(\"autofocus\") != null && hasFocus == document.body;\n    }\n\n    function save() {textarea.value = cm.getValue();}\n    if (textarea.form) {\n      on(textarea.form, \"submit\", save);\n      // Deplorable hack to make the submit method do the right thing.\n      if (!options.leaveSubmitMethodAlone) {\n        var form = textarea.form, realSubmit = form.submit;\n        try {\n          var wrappedSubmit = form.submit = function() {\n            save();\n            form.submit = realSubmit;\n            form.submit();\n            form.submit = wrappedSubmit;\n          };\n        } catch(e) {}\n      }\n    }\n\n    textarea.style.display = \"none\";\n    var cm = CodeMirror(function(node) {\n      textarea.parentNode.insertBefore(node, textarea.nextSibling);\n    }, options);\n    cm.save = save;\n    cm.getTextArea = function() { return textarea; };\n    cm.toTextArea = function() {\n      cm.toTextArea = isNaN; // Prevent this from being ran twice\n      save();\n      textarea.parentNode.removeChild(cm.getWrapperElement());\n      textarea.style.display = \"\";\n      if (textarea.form) {\n        off(textarea.form, \"submit\", save);\n        if (typeof textarea.form.submit == \"function\")\n          textarea.form.submit = realSubmit;\n      }\n    };\n    return cm;\n  };\n\n  // STRING STREAM\n\n  // Fed to the mode parsers, provides helper functions to make\n  // parsers more succinct.\n\n  var StringStream = CodeMirror.StringStream = function(string, tabSize) {\n    this.pos = this.start = 0;\n    this.string = string;\n    this.tabSize = tabSize || 8;\n    this.lastColumnPos = this.lastColumnValue = 0;\n    this.lineStart = 0;\n  };\n\n  StringStream.prototype = {\n    eol: function() {return this.pos >= this.string.length;},\n    sol: function() {return this.pos == this.lineStart;},\n    peek: function() {return this.string.charAt(this.pos) || undefined;},\n    next: function() {\n      if (this.pos < this.string.length)\n        return this.string.charAt(this.pos++);\n    },\n    eat: function(match) {\n      var ch = this.string.charAt(this.pos);\n      if (typeof match == \"string\") var ok = ch == match;\n      else var ok = ch && (match.test ? match.test(ch) : match(ch));\n      if (ok) {++this.pos; return ch;}\n    },\n    eatWhile: function(match) {\n      var start = this.pos;\n      while (this.eat(match)){}\n      return this.pos > start;\n    },\n    eatSpace: function() {\n      var start = this.pos;\n      while (/[\\s\\u00a0]/.test(this.string.charAt(this.pos))) ++this.pos;\n      return this.pos > start;\n    },\n    skipToEnd: function() {this.pos = this.string.length;},\n    skipTo: function(ch) {\n      var found = this.string.indexOf(ch, this.pos);\n      if (found > -1) {this.pos = found; return true;}\n    },\n    backUp: function(n) {this.pos -= n;},\n    column: function() {\n      if (this.lastColumnPos < this.start) {\n        this.lastColumnValue = countColumn(this.string, this.start, this.tabSize, this.lastColumnPos, this.lastColumnValue);\n        this.lastColumnPos = this.start;\n      }\n      return this.lastColumnValue - (this.lineStart ? countColumn(this.string, this.lineStart, this.tabSize) : 0);\n    },\n    indentation: function() {\n      return countColumn(this.string, null, this.tabSize) -\n        (this.lineStart ? countColumn(this.string, this.lineStart, this.tabSize) : 0);\n    },\n    match: function(pattern, consume, caseInsensitive) {\n      if (typeof pattern == \"string\") {\n        var cased = function(str) {return caseInsensitive ? str.toLowerCase() : str;};\n        var substr = this.string.substr(this.pos, pattern.length);\n        if (cased(substr) == cased(pattern)) {\n          if (consume !== false) this.pos += pattern.length;\n          return true;\n        }\n      } else {\n        var match = this.string.slice(this.pos).match(pattern);\n        if (match && match.index > 0) return null;\n        if (match && consume !== false) this.pos += match[0].length;\n        return match;\n      }\n    },\n    current: function(){return this.string.slice(this.start, this.pos);},\n    hideFirstChars: function(n, inner) {\n      this.lineStart += n;\n      try { return inner(); }\n      finally { this.lineStart -= n; }\n    }\n  };\n\n  // TEXTMARKERS\n\n  // Created with markText and setBookmark methods. A TextMarker is a\n  // handle that can be used to clear or find a marked position in the\n  // document. Line objects hold arrays (markedSpans) containing\n  // {from, to, marker} object pointing to such marker objects, and\n  // indicating that such a marker is present on that line. Multiple\n  // lines may point to the same marker when it spans across lines.\n  // The spans will have null for their from/to properties when the\n  // marker continues beyond the start/end of the line. Markers have\n  // links back to the lines they currently touch.\n\n  var TextMarker = CodeMirror.TextMarker = function(doc, type) {\n    this.lines = [];\n    this.type = type;\n    this.doc = doc;\n  };\n  eventMixin(TextMarker);\n\n  // Clear the marker.\n  TextMarker.prototype.clear = function() {\n    if (this.explicitlyCleared) return;\n    var cm = this.doc.cm, withOp = cm && !cm.curOp;\n    if (withOp) startOperation(cm);\n    if (hasHandler(this, \"clear\")) {\n      var found = this.find();\n      if (found) signalLater(this, \"clear\", found.from, found.to);\n    }\n    var min = null, max = null;\n    for (var i = 0; i < this.lines.length; ++i) {\n      var line = this.lines[i];\n      var span = getMarkedSpanFor(line.markedSpans, this);\n      if (cm && !this.collapsed) regLineChange(cm, lineNo(line), \"text\");\n      else if (cm) {\n        if (span.to != null) max = lineNo(line);\n        if (span.from != null) min = lineNo(line);\n      }\n      line.markedSpans = removeMarkedSpan(line.markedSpans, span);\n      if (span.from == null && this.collapsed && !lineIsHidden(this.doc, line) && cm)\n        updateLineHeight(line, textHeight(cm.display));\n    }\n    if (cm && this.collapsed && !cm.options.lineWrapping) for (var i = 0; i < this.lines.length; ++i) {\n      var visual = visualLine(this.lines[i]), len = lineLength(visual);\n      if (len > cm.display.maxLineLength) {\n        cm.display.maxLine = visual;\n        cm.display.maxLineLength = len;\n        cm.display.maxLineChanged = true;\n      }\n    }\n\n    if (min != null && cm && this.collapsed) regChange(cm, min, max + 1);\n    this.lines.length = 0;\n    this.explicitlyCleared = true;\n    if (this.atomic && this.doc.cantEdit) {\n      this.doc.cantEdit = false;\n      if (cm) reCheckSelection(cm.doc);\n    }\n    if (cm) signalLater(cm, \"markerCleared\", cm, this);\n    if (withOp) endOperation(cm);\n    if (this.parent) this.parent.clear();\n  };\n\n  // Find the position of the marker in the document. Returns a {from,\n  // to} object by default. Side can be passed to get a specific side\n  // -- 0 (both), -1 (left), or 1 (right). When lineObj is true, the\n  // Pos objects returned contain a line object, rather than a line\n  // number (used to prevent looking up the same line twice).\n  TextMarker.prototype.find = function(side, lineObj) {\n    if (side == null && this.type == \"bookmark\") side = 1;\n    var from, to;\n    for (var i = 0; i < this.lines.length; ++i) {\n      var line = this.lines[i];\n      var span = getMarkedSpanFor(line.markedSpans, this);\n      if (span.from != null) {\n        from = Pos(lineObj ? line : lineNo(line), span.from);\n        if (side == -1) return from;\n      }\n      if (span.to != null) {\n        to = Pos(lineObj ? line : lineNo(line), span.to);\n        if (side == 1) return to;\n      }\n    }\n    return from && {from: from, to: to};\n  };\n\n  // Signals that the marker's widget changed, and surrounding layout\n  // should be recomputed.\n  TextMarker.prototype.changed = function() {\n    var pos = this.find(-1, true), widget = this, cm = this.doc.cm;\n    if (!pos || !cm) return;\n    runInOp(cm, function() {\n      var line = pos.line, lineN = lineNo(pos.line);\n      var view = findViewForLine(cm, lineN);\n      if (view) {\n        clearLineMeasurementCacheFor(view);\n        cm.curOp.selectionChanged = cm.curOp.forceUpdate = true;\n      }\n      cm.curOp.updateMaxLine = true;\n      if (!lineIsHidden(widget.doc, line) && widget.height != null) {\n        var oldHeight = widget.height;\n        widget.height = null;\n        var dHeight = widgetHeight(widget) - oldHeight;\n        if (dHeight)\n          updateLineHeight(line, line.height + dHeight);\n      }\n    });\n  };\n\n  TextMarker.prototype.attachLine = function(line) {\n    if (!this.lines.length && this.doc.cm) {\n      var op = this.doc.cm.curOp;\n      if (!op.maybeHiddenMarkers || indexOf(op.maybeHiddenMarkers, this) == -1)\n        (op.maybeUnhiddenMarkers || (op.maybeUnhiddenMarkers = [])).push(this);\n    }\n    this.lines.push(line);\n  };\n  TextMarker.prototype.detachLine = function(line) {\n    this.lines.splice(indexOf(this.lines, line), 1);\n    if (!this.lines.length && this.doc.cm) {\n      var op = this.doc.cm.curOp;\n      (op.maybeHiddenMarkers || (op.maybeHiddenMarkers = [])).push(this);\n    }\n  };\n\n  // Collapsed markers have unique ids, in order to be able to order\n  // them, which is needed for uniquely determining an outer marker\n  // when they overlap (they may nest, but not partially overlap).\n  var nextMarkerId = 0;\n\n  // Create a marker, wire it up to the right lines, and\n  function markText(doc, from, to, options, type) {\n    // Shared markers (across linked documents) are handled separately\n    // (markTextShared will call out to this again, once per\n    // document).\n    if (options && options.shared) return markTextShared(doc, from, to, options, type);\n    // Ensure we are in an operation.\n    if (doc.cm && !doc.cm.curOp) return operation(doc.cm, markText)(doc, from, to, options, type);\n\n    var marker = new TextMarker(doc, type), diff = cmp(from, to);\n    if (options) copyObj(options, marker, false);\n    // Don't connect empty markers unless clearWhenEmpty is false\n    if (diff > 0 || diff == 0 && marker.clearWhenEmpty !== false)\n      return marker;\n    if (marker.replacedWith) {\n      // Showing up as a widget implies collapsed (widget replaces text)\n      marker.collapsed = true;\n      marker.widgetNode = elt(\"span\", [marker.replacedWith], \"CodeMirror-widget\");\n      if (!options.handleMouseEvents) marker.widgetNode.ignoreEvents = true;\n      if (options.insertLeft) marker.widgetNode.insertLeft = true;\n    }\n    if (marker.collapsed) {\n      if (conflictingCollapsedRange(doc, from.line, from, to, marker) ||\n          from.line != to.line && conflictingCollapsedRange(doc, to.line, from, to, marker))\n        throw new Error(\"Inserting collapsed marker partially overlapping an existing one\");\n      sawCollapsedSpans = true;\n    }\n\n    if (marker.addToHistory)\n      addChangeToHistory(doc, {from: from, to: to, origin: \"markText\"}, doc.sel, NaN);\n\n    var curLine = from.line, cm = doc.cm, updateMaxLine;\n    doc.iter(curLine, to.line + 1, function(line) {\n      if (cm && marker.collapsed && !cm.options.lineWrapping && visualLine(line) == cm.display.maxLine)\n        updateMaxLine = true;\n      if (marker.collapsed && curLine != from.line) updateLineHeight(line, 0);\n      addMarkedSpan(line, new MarkedSpan(marker,\n                                         curLine == from.line ? from.ch : null,\n                                         curLine == to.line ? to.ch : null));\n      ++curLine;\n    });\n    // lineIsHidden depends on the presence of the spans, so needs a second pass\n    if (marker.collapsed) doc.iter(from.line, to.line + 1, function(line) {\n      if (lineIsHidden(doc, line)) updateLineHeight(line, 0);\n    });\n\n    if (marker.clearOnEnter) on(marker, \"beforeCursorEnter\", function() { marker.clear(); });\n\n    if (marker.readOnly) {\n      sawReadOnlySpans = true;\n      if (doc.history.done.length || doc.history.undone.length)\n        doc.clearHistory();\n    }\n    if (marker.collapsed) {\n      marker.id = ++nextMarkerId;\n      marker.atomic = true;\n    }\n    if (cm) {\n      // Sync editor state\n      if (updateMaxLine) cm.curOp.updateMaxLine = true;\n      if (marker.collapsed)\n        regChange(cm, from.line, to.line + 1);\n      else if (marker.className || marker.title || marker.startStyle || marker.endStyle)\n        for (var i = from.line; i <= to.line; i++) regLineChange(cm, i, \"text\");\n      if (marker.atomic) reCheckSelection(cm.doc);\n      signalLater(cm, \"markerAdded\", cm, marker);\n    }\n    return marker;\n  }\n\n  // SHARED TEXTMARKERS\n\n  // A shared marker spans multiple linked documents. It is\n  // implemented as a meta-marker-object controlling multiple normal\n  // markers.\n  var SharedTextMarker = CodeMirror.SharedTextMarker = function(markers, primary) {\n    this.markers = markers;\n    this.primary = primary;\n    for (var i = 0; i < markers.length; ++i)\n      markers[i].parent = this;\n  };\n  eventMixin(SharedTextMarker);\n\n  SharedTextMarker.prototype.clear = function() {\n    if (this.explicitlyCleared) return;\n    this.explicitlyCleared = true;\n    for (var i = 0; i < this.markers.length; ++i)\n      this.markers[i].clear();\n    signalLater(this, \"clear\");\n  };\n  SharedTextMarker.prototype.find = function(side, lineObj) {\n    return this.primary.find(side, lineObj);\n  };\n\n  function markTextShared(doc, from, to, options, type) {\n    options = copyObj(options);\n    options.shared = false;\n    var markers = [markText(doc, from, to, options, type)], primary = markers[0];\n    var widget = options.widgetNode;\n    linkedDocs(doc, function(doc) {\n      if (widget) options.widgetNode = widget.cloneNode(true);\n      markers.push(markText(doc, clipPos(doc, from), clipPos(doc, to), options, type));\n      for (var i = 0; i < doc.linked.length; ++i)\n        if (doc.linked[i].isParent) return;\n      primary = lst(markers);\n    });\n    return new SharedTextMarker(markers, primary);\n  }\n\n  function findSharedMarkers(doc) {\n    return doc.findMarks(Pos(doc.first, 0), doc.clipPos(Pos(doc.lastLine())),\n                         function(m) { return m.parent; });\n  }\n\n  function copySharedMarkers(doc, markers) {\n    for (var i = 0; i < markers.length; i++) {\n      var marker = markers[i], pos = marker.find();\n      var mFrom = doc.clipPos(pos.from), mTo = doc.clipPos(pos.to);\n      if (cmp(mFrom, mTo)) {\n        var subMark = markText(doc, mFrom, mTo, marker.primary, marker.primary.type);\n        marker.markers.push(subMark);\n        subMark.parent = marker;\n      }\n    }\n  }\n\n  function detachSharedMarkers(markers) {\n    for (var i = 0; i < markers.length; i++) {\n      var marker = markers[i], linked = [marker.primary.doc];;\n      linkedDocs(marker.primary.doc, function(d) { linked.push(d); });\n      for (var j = 0; j < marker.markers.length; j++) {\n        var subMarker = marker.markers[j];\n        if (indexOf(linked, subMarker.doc) == -1) {\n          subMarker.parent = null;\n          marker.markers.splice(j--, 1);\n        }\n      }\n    }\n  }\n\n  // TEXTMARKER SPANS\n\n  function MarkedSpan(marker, from, to) {\n    this.marker = marker;\n    this.from = from; this.to = to;\n  }\n\n  // Search an array of spans for a span matching the given marker.\n  function getMarkedSpanFor(spans, marker) {\n    if (spans) for (var i = 0; i < spans.length; ++i) {\n      var span = spans[i];\n      if (span.marker == marker) return span;\n    }\n  }\n  // Remove a span from an array, returning undefined if no spans are\n  // left (we don't store arrays for lines without spans).\n  function removeMarkedSpan(spans, span) {\n    for (var r, i = 0; i < spans.length; ++i)\n      if (spans[i] != span) (r || (r = [])).push(spans[i]);\n    return r;\n  }\n  // Add a span to a line.\n  function addMarkedSpan(line, span) {\n    line.markedSpans = line.markedSpans ? line.markedSpans.concat([span]) : [span];\n    span.marker.attachLine(line);\n  }\n\n  // Used for the algorithm that adjusts markers for a change in the\n  // document. These functions cut an array of spans at a given\n  // character position, returning an array of remaining chunks (or\n  // undefined if nothing remains).\n  function markedSpansBefore(old, startCh, isInsert) {\n    if (old) for (var i = 0, nw; i < old.length; ++i) {\n      var span = old[i], marker = span.marker;\n      var startsBefore = span.from == null || (marker.inclusiveLeft ? span.from <= startCh : span.from < startCh);\n      if (startsBefore || span.from == startCh && marker.type == \"bookmark\" && (!isInsert || !span.marker.insertLeft)) {\n        var endsAfter = span.to == null || (marker.inclusiveRight ? span.to >= startCh : span.to > startCh);\n        (nw || (nw = [])).push(new MarkedSpan(marker, span.from, endsAfter ? null : span.to));\n      }\n    }\n    return nw;\n  }\n  function markedSpansAfter(old, endCh, isInsert) {\n    if (old) for (var i = 0, nw; i < old.length; ++i) {\n      var span = old[i], marker = span.marker;\n      var endsAfter = span.to == null || (marker.inclusiveRight ? span.to >= endCh : span.to > endCh);\n      if (endsAfter || span.from == endCh && marker.type == \"bookmark\" && (!isInsert || span.marker.insertLeft)) {\n        var startsBefore = span.from == null || (marker.inclusiveLeft ? span.from <= endCh : span.from < endCh);\n        (nw || (nw = [])).push(new MarkedSpan(marker, startsBefore ? null : span.from - endCh,\n                                              span.to == null ? null : span.to - endCh));\n      }\n    }\n    return nw;\n  }\n\n  // Given a change object, compute the new set of marker spans that\n  // cover the line in which the change took place. Removes spans\n  // entirely within the change, reconnects spans belonging to the\n  // same marker that appear on both sides of the change, and cuts off\n  // spans partially within the change. Returns an array of span\n  // arrays with one element for each line in (after) the change.\n  function stretchSpansOverChange(doc, change) {\n    var oldFirst = isLine(doc, change.from.line) && getLine(doc, change.from.line).markedSpans;\n    var oldLast = isLine(doc, change.to.line) && getLine(doc, change.to.line).markedSpans;\n    if (!oldFirst && !oldLast) return null;\n\n    var startCh = change.from.ch, endCh = change.to.ch, isInsert = cmp(change.from, change.to) == 0;\n    // Get the spans that 'stick out' on both sides\n    var first = markedSpansBefore(oldFirst, startCh, isInsert);\n    var last = markedSpansAfter(oldLast, endCh, isInsert);\n\n    // Next, merge those two ends\n    var sameLine = change.text.length == 1, offset = lst(change.text).length + (sameLine ? startCh : 0);\n    if (first) {\n      // Fix up .to properties of first\n      for (var i = 0; i < first.length; ++i) {\n        var span = first[i];\n        if (span.to == null) {\n          var found = getMarkedSpanFor(last, span.marker);\n          if (!found) span.to = startCh;\n          else if (sameLine) span.to = found.to == null ? null : found.to + offset;\n        }\n      }\n    }\n    if (last) {\n      // Fix up .from in last (or move them into first in case of sameLine)\n      for (var i = 0; i < last.length; ++i) {\n        var span = last[i];\n        if (span.to != null) span.to += offset;\n        if (span.from == null) {\n          var found = getMarkedSpanFor(first, span.marker);\n          if (!found) {\n            span.from = offset;\n            if (sameLine) (first || (first = [])).push(span);\n          }\n        } else {\n          span.from += offset;\n          if (sameLine) (first || (first = [])).push(span);\n        }\n      }\n    }\n    // Make sure we didn't create any zero-length spans\n    if (first) first = clearEmptySpans(first);\n    if (last && last != first) last = clearEmptySpans(last);\n\n    var newMarkers = [first];\n    if (!sameLine) {\n      // Fill gap with whole-line-spans\n      var gap = change.text.length - 2, gapMarkers;\n      if (gap > 0 && first)\n        for (var i = 0; i < first.length; ++i)\n          if (first[i].to == null)\n            (gapMarkers || (gapMarkers = [])).push(new MarkedSpan(first[i].marker, null, null));\n      for (var i = 0; i < gap; ++i)\n        newMarkers.push(gapMarkers);\n      newMarkers.push(last);\n    }\n    return newMarkers;\n  }\n\n  // Remove spans that are empty and don't have a clearWhenEmpty\n  // option of false.\n  function clearEmptySpans(spans) {\n    for (var i = 0; i < spans.length; ++i) {\n      var span = spans[i];\n      if (span.from != null && span.from == span.to && span.marker.clearWhenEmpty !== false)\n        spans.splice(i--, 1);\n    }\n    if (!spans.length) return null;\n    return spans;\n  }\n\n  // Used for un/re-doing changes from the history. Combines the\n  // result of computing the existing spans with the set of spans that\n  // existed in the history (so that deleting around a span and then\n  // undoing brings back the span).\n  function mergeOldSpans(doc, change) {\n    var old = getOldSpans(doc, change);\n    var stretched = stretchSpansOverChange(doc, change);\n    if (!old) return stretched;\n    if (!stretched) return old;\n\n    for (var i = 0; i < old.length; ++i) {\n      var oldCur = old[i], stretchCur = stretched[i];\n      if (oldCur && stretchCur) {\n        spans: for (var j = 0; j < stretchCur.length; ++j) {\n          var span = stretchCur[j];\n          for (var k = 0; k < oldCur.length; ++k)\n            if (oldCur[k].marker == span.marker) continue spans;\n          oldCur.push(span);\n        }\n      } else if (stretchCur) {\n        old[i] = stretchCur;\n      }\n    }\n    return old;\n  }\n\n  // Used to 'clip' out readOnly ranges when making a change.\n  function removeReadOnlyRanges(doc, from, to) {\n    var markers = null;\n    doc.iter(from.line, to.line + 1, function(line) {\n      if (line.markedSpans) for (var i = 0; i < line.markedSpans.length; ++i) {\n        var mark = line.markedSpans[i].marker;\n        if (mark.readOnly && (!markers || indexOf(markers, mark) == -1))\n          (markers || (markers = [])).push(mark);\n      }\n    });\n    if (!markers) return null;\n    var parts = [{from: from, to: to}];\n    for (var i = 0; i < markers.length; ++i) {\n      var mk = markers[i], m = mk.find(0);\n      for (var j = 0; j < parts.length; ++j) {\n        var p = parts[j];\n        if (cmp(p.to, m.from) < 0 || cmp(p.from, m.to) > 0) continue;\n        var newParts = [j, 1], dfrom = cmp(p.from, m.from), dto = cmp(p.to, m.to);\n        if (dfrom < 0 || !mk.inclusiveLeft && !dfrom)\n          newParts.push({from: p.from, to: m.from});\n        if (dto > 0 || !mk.inclusiveRight && !dto)\n          newParts.push({from: m.to, to: p.to});\n        parts.splice.apply(parts, newParts);\n        j += newParts.length - 1;\n      }\n    }\n    return parts;\n  }\n\n  // Connect or disconnect spans from a line.\n  function detachMarkedSpans(line) {\n    var spans = line.markedSpans;\n    if (!spans) return;\n    for (var i = 0; i < spans.length; ++i)\n      spans[i].marker.detachLine(line);\n    line.markedSpans = null;\n  }\n  function attachMarkedSpans(line, spans) {\n    if (!spans) return;\n    for (var i = 0; i < spans.length; ++i)\n      spans[i].marker.attachLine(line);\n    line.markedSpans = spans;\n  }\n\n  // Helpers used when computing which overlapping collapsed span\n  // counts as the larger one.\n  function extraLeft(marker) { return marker.inclusiveLeft ? -1 : 0; }\n  function extraRight(marker) { return marker.inclusiveRight ? 1 : 0; }\n\n  // Returns a number indicating which of two overlapping collapsed\n  // spans is larger (and thus includes the other). Falls back to\n  // comparing ids when the spans cover exactly the same range.\n  function compareCollapsedMarkers(a, b) {\n    var lenDiff = a.lines.length - b.lines.length;\n    if (lenDiff != 0) return lenDiff;\n    var aPos = a.find(), bPos = b.find();\n    var fromCmp = cmp(aPos.from, bPos.from) || extraLeft(a) - extraLeft(b);\n    if (fromCmp) return -fromCmp;\n    var toCmp = cmp(aPos.to, bPos.to) || extraRight(a) - extraRight(b);\n    if (toCmp) return toCmp;\n    return b.id - a.id;\n  }\n\n  // Find out whether a line ends or starts in a collapsed span. If\n  // so, return the marker for that span.\n  function collapsedSpanAtSide(line, start) {\n    var sps = sawCollapsedSpans && line.markedSpans, found;\n    if (sps) for (var sp, i = 0; i < sps.length; ++i) {\n      sp = sps[i];\n      if (sp.marker.collapsed && (start ? sp.from : sp.to) == null &&\n          (!found || compareCollapsedMarkers(found, sp.marker) < 0))\n        found = sp.marker;\n    }\n    return found;\n  }\n  function collapsedSpanAtStart(line) { return collapsedSpanAtSide(line, true); }\n  function collapsedSpanAtEnd(line) { return collapsedSpanAtSide(line, false); }\n\n  // Test whether there exists a collapsed span that partially\n  // overlaps (covers the start or end, but not both) of a new span.\n  // Such overlap is not allowed.\n  function conflictingCollapsedRange(doc, lineNo, from, to, marker) {\n    var line = getLine(doc, lineNo);\n    var sps = sawCollapsedSpans && line.markedSpans;\n    if (sps) for (var i = 0; i < sps.length; ++i) {\n      var sp = sps[i];\n      if (!sp.marker.collapsed) continue;\n      var found = sp.marker.find(0);\n      var fromCmp = cmp(found.from, from) || extraLeft(sp.marker) - extraLeft(marker);\n      var toCmp = cmp(found.to, to) || extraRight(sp.marker) - extraRight(marker);\n      if (fromCmp >= 0 && toCmp <= 0 || fromCmp <= 0 && toCmp >= 0) continue;\n      if (fromCmp <= 0 && (cmp(found.to, from) > 0 || (sp.marker.inclusiveRight && marker.inclusiveLeft)) ||\n          fromCmp >= 0 && (cmp(found.from, to) < 0 || (sp.marker.inclusiveLeft && marker.inclusiveRight)))\n        return true;\n    }\n  }\n\n  // A visual line is a line as drawn on the screen. Folding, for\n  // example, can cause multiple logical lines to appear on the same\n  // visual line. This finds the start of the visual line that the\n  // given line is part of (usually that is the line itself).\n  function visualLine(line) {\n    var merged;\n    while (merged = collapsedSpanAtStart(line))\n      line = merged.find(-1, true).line;\n    return line;\n  }\n\n  // Returns an array of logical lines that continue the visual line\n  // started by the argument, or undefined if there are no such lines.\n  function visualLineContinued(line) {\n    var merged, lines;\n    while (merged = collapsedSpanAtEnd(line)) {\n      line = merged.find(1, true).line;\n      (lines || (lines = [])).push(line);\n    }\n    return lines;\n  }\n\n  // Get the line number of the start of the visual line that the\n  // given line number is part of.\n  function visualLineNo(doc, lineN) {\n    var line = getLine(doc, lineN), vis = visualLine(line);\n    if (line == vis) return lineN;\n    return lineNo(vis);\n  }\n  // Get the line number of the start of the next visual line after\n  // the given line.\n  function visualLineEndNo(doc, lineN) {\n    if (lineN > doc.lastLine()) return lineN;\n    var line = getLine(doc, lineN), merged;\n    if (!lineIsHidden(doc, line)) return lineN;\n    while (merged = collapsedSpanAtEnd(line))\n      line = merged.find(1, true).line;\n    return lineNo(line) + 1;\n  }\n\n  // Compute whether a line is hidden. Lines count as hidden when they\n  // are part of a visual line that starts with another line, or when\n  // they are entirely covered by collapsed, non-widget span.\n  function lineIsHidden(doc, line) {\n    var sps = sawCollapsedSpans && line.markedSpans;\n    if (sps) for (var sp, i = 0; i < sps.length; ++i) {\n      sp = sps[i];\n      if (!sp.marker.collapsed) continue;\n      if (sp.from == null) return true;\n      if (sp.marker.widgetNode) continue;\n      if (sp.from == 0 && sp.marker.inclusiveLeft && lineIsHiddenInner(doc, line, sp))\n        return true;\n    }\n  }\n  function lineIsHiddenInner(doc, line, span) {\n    if (span.to == null) {\n      var end = span.marker.find(1, true);\n      return lineIsHiddenInner(doc, end.line, getMarkedSpanFor(end.line.markedSpans, span.marker));\n    }\n    if (span.marker.inclusiveRight && span.to == line.text.length)\n      return true;\n    for (var sp, i = 0; i < line.markedSpans.length; ++i) {\n      sp = line.markedSpans[i];\n      if (sp.marker.collapsed && !sp.marker.widgetNode && sp.from == span.to &&\n          (sp.to == null || sp.to != span.from) &&\n          (sp.marker.inclusiveLeft || span.marker.inclusiveRight) &&\n          lineIsHiddenInner(doc, line, sp)) return true;\n    }\n  }\n\n  // LINE WIDGETS\n\n  // Line widgets are block elements displayed above or below a line.\n\n  var LineWidget = CodeMirror.LineWidget = function(cm, node, options) {\n    if (options) for (var opt in options) if (options.hasOwnProperty(opt))\n      this[opt] = options[opt];\n    this.cm = cm;\n    this.node = node;\n  };\n  eventMixin(LineWidget);\n\n  function adjustScrollWhenAboveVisible(cm, line, diff) {\n    if (heightAtLine(line) < ((cm.curOp && cm.curOp.scrollTop) || cm.doc.scrollTop))\n      addToScrollPos(cm, null, diff);\n  }\n\n  LineWidget.prototype.clear = function() {\n    var cm = this.cm, ws = this.line.widgets, line = this.line, no = lineNo(line);\n    if (no == null || !ws) return;\n    for (var i = 0; i < ws.length; ++i) if (ws[i] == this) ws.splice(i--, 1);\n    if (!ws.length) line.widgets = null;\n    var height = widgetHeight(this);\n    runInOp(cm, function() {\n      adjustScrollWhenAboveVisible(cm, line, -height);\n      regLineChange(cm, no, \"widget\");\n      updateLineHeight(line, Math.max(0, line.height - height));\n    });\n  };\n  LineWidget.prototype.changed = function() {\n    var oldH = this.height, cm = this.cm, line = this.line;\n    this.height = null;\n    var diff = widgetHeight(this) - oldH;\n    if (!diff) return;\n    runInOp(cm, function() {\n      cm.curOp.forceUpdate = true;\n      adjustScrollWhenAboveVisible(cm, line, diff);\n      updateLineHeight(line, line.height + diff);\n    });\n  };\n\n  function widgetHeight(widget) {\n    if (widget.height != null) return widget.height;\n    if (!contains(document.body, widget.node)) {\n      var parentStyle = \"position: relative;\";\n      if (widget.coverGutter)\n        parentStyle += \"margin-left: -\" + widget.cm.getGutterElement().offsetWidth + \"px;\";\n      removeChildrenAndAdd(widget.cm.display.measure, elt(\"div\", [widget.node], null, parentStyle));\n    }\n    return widget.height = widget.node.offsetHeight;\n  }\n\n  function addLineWidget(cm, handle, node, options) {\n    var widget = new LineWidget(cm, node, options);\n    if (widget.noHScroll) cm.display.alignWidgets = true;\n    changeLine(cm.doc, handle, \"widget\", function(line) {\n      var widgets = line.widgets || (line.widgets = []);\n      if (widget.insertAt == null) widgets.push(widget);\n      else widgets.splice(Math.min(widgets.length - 1, Math.max(0, widget.insertAt)), 0, widget);\n      widget.line = line;\n      if (!lineIsHidden(cm.doc, line)) {\n        var aboveVisible = heightAtLine(line) < cm.doc.scrollTop;\n        updateLineHeight(line, line.height + widgetHeight(widget));\n        if (aboveVisible) addToScrollPos(cm, null, widget.height);\n        cm.curOp.forceUpdate = true;\n      }\n      return true;\n    });\n    return widget;\n  }\n\n  // LINE DATA STRUCTURE\n\n  // Line objects. These hold state related to a line, including\n  // highlighting info (the styles array).\n  var Line = CodeMirror.Line = function(text, markedSpans, estimateHeight) {\n    this.text = text;\n    attachMarkedSpans(this, markedSpans);\n    this.height = estimateHeight ? estimateHeight(this) : 1;\n  };\n  eventMixin(Line);\n  Line.prototype.lineNo = function() { return lineNo(this); };\n\n  // Change the content (text, markers) of a line. Automatically\n  // invalidates cached information and tries to re-estimate the\n  // line's height.\n  function updateLine(line, text, markedSpans, estimateHeight) {\n    line.text = text;\n    if (line.stateAfter) line.stateAfter = null;\n    if (line.styles) line.styles = null;\n    if (line.order != null) line.order = null;\n    detachMarkedSpans(line);\n    attachMarkedSpans(line, markedSpans);\n    var estHeight = estimateHeight ? estimateHeight(line) : 1;\n    if (estHeight != line.height) updateLineHeight(line, estHeight);\n  }\n\n  // Detach a line from the document tree and its markers.\n  function cleanUpLine(line) {\n    line.parent = null;\n    detachMarkedSpans(line);\n  }\n\n  function extractLineClasses(type, output) {\n    if (type) for (;;) {\n      var lineClass = type.match(/(?:^|\\s+)line-(background-)?(\\S+)/);\n      if (!lineClass) break;\n      type = type.slice(0, lineClass.index) + type.slice(lineClass.index + lineClass[0].length);\n      var prop = lineClass[1] ? \"bgClass\" : \"textClass\";\n      if (output[prop] == null)\n        output[prop] = lineClass[2];\n      else if (!(new RegExp(\"(?:^|\\s)\" + lineClass[2] + \"(?:$|\\s)\")).test(output[prop]))\n        output[prop] += \" \" + lineClass[2];\n    }\n    return type;\n  }\n\n  function callBlankLine(mode, state) {\n    if (mode.blankLine) return mode.blankLine(state);\n    if (!mode.innerMode) return;\n    var inner = CodeMirror.innerMode(mode, state);\n    if (inner.mode.blankLine) return inner.mode.blankLine(inner.state);\n  }\n\n  function readToken(mode, stream, state, inner) {\n    for (var i = 0; i < 10; i++) {\n      if (inner) inner[0] = CodeMirror.innerMode(mode, state).mode;\n      var style = mode.token(stream, state);\n      if (stream.pos > stream.start) return style;\n    }\n    throw new Error(\"Mode \" + mode.name + \" failed to advance stream.\");\n  }\n\n  // Utility for getTokenAt and getLineTokens\n  function takeToken(cm, pos, precise, asArray) {\n    function getObj(copy) {\n      return {start: stream.start, end: stream.pos,\n              string: stream.current(),\n              type: style || null,\n              state: copy ? copyState(doc.mode, state) : state};\n    }\n\n    var doc = cm.doc, mode = doc.mode, style;\n    pos = clipPos(doc, pos);\n    var line = getLine(doc, pos.line), state = getStateBefore(cm, pos.line, precise);\n    var stream = new StringStream(line.text, cm.options.tabSize), tokens;\n    if (asArray) tokens = [];\n    while ((asArray || stream.pos < pos.ch) && !stream.eol()) {\n      stream.start = stream.pos;\n      style = readToken(mode, stream, state);\n      if (asArray) tokens.push(getObj(true));\n    }\n    return asArray ? tokens : getObj();\n  }\n\n  // Run the given mode's parser over a line, calling f for each token.\n  function runMode(cm, text, mode, state, f, lineClasses, forceToEnd) {\n    var flattenSpans = mode.flattenSpans;\n    if (flattenSpans == null) flattenSpans = cm.options.flattenSpans;\n    var curStart = 0, curStyle = null;\n    var stream = new StringStream(text, cm.options.tabSize), style;\n    var inner = cm.options.addModeClass && [null];\n    if (text == \"\") extractLineClasses(callBlankLine(mode, state), lineClasses);\n    while (!stream.eol()) {\n      if (stream.pos > cm.options.maxHighlightLength) {\n        flattenSpans = false;\n        if (forceToEnd) processLine(cm, text, state, stream.pos);\n        stream.pos = text.length;\n        style = null;\n      } else {\n        style = extractLineClasses(readToken(mode, stream, state, inner), lineClasses);\n      }\n      if (inner) {\n        var mName = inner[0].name;\n        if (mName) style = \"m-\" + (style ? mName + \" \" + style : mName);\n      }\n      if (!flattenSpans || curStyle != style) {\n        if (curStart < stream.start) f(stream.start, curStyle);\n        curStart = stream.start; curStyle = style;\n      }\n      stream.start = stream.pos;\n    }\n    while (curStart < stream.pos) {\n      // Webkit seems to refuse to render text nodes longer than 57444 characters\n      var pos = Math.min(stream.pos, curStart + 50000);\n      f(pos, curStyle);\n      curStart = pos;\n    }\n  }\n\n  // Compute a style array (an array starting with a mode generation\n  // -- for invalidation -- followed by pairs of end positions and\n  // style strings), which is used to highlight the tokens on the\n  // line.\n  function highlightLine(cm, line, state, forceToEnd) {\n    // A styles array always starts with a number identifying the\n    // mode/overlays that it is based on (for easy invalidation).\n    var st = [cm.state.modeGen], lineClasses = {};\n    // Compute the base array of styles\n    runMode(cm, line.text, cm.doc.mode, state, function(end, style) {\n      st.push(end, style);\n    }, lineClasses, forceToEnd);\n\n    // Run overlays, adjust style array.\n    for (var o = 0; o < cm.state.overlays.length; ++o) {\n      var overlay = cm.state.overlays[o], i = 1, at = 0;\n      runMode(cm, line.text, overlay.mode, true, function(end, style) {\n        var start = i;\n        // Ensure there's a token end at the current position, and that i points at it\n        while (at < end) {\n          var i_end = st[i];\n          if (i_end > end)\n            st.splice(i, 1, end, st[i+1], i_end);\n          i += 2;\n          at = Math.min(end, i_end);\n        }\n        if (!style) return;\n        if (overlay.opaque) {\n          st.splice(start, i - start, end, \"cm-overlay \" + style);\n          i = start + 2;\n        } else {\n          for (; start < i; start += 2) {\n            var cur = st[start+1];\n            st[start+1] = (cur ? cur + \" \" : \"\") + \"cm-overlay \" + style;\n          }\n        }\n      }, lineClasses);\n    }\n\n    return {styles: st, classes: lineClasses.bgClass || lineClasses.textClass ? lineClasses : null};\n  }\n\n  function getLineStyles(cm, line, updateFrontier) {\n    if (!line.styles || line.styles[0] != cm.state.modeGen) {\n      var result = highlightLine(cm, line, line.stateAfter = getStateBefore(cm, lineNo(line)));\n      line.styles = result.styles;\n      if (result.classes) line.styleClasses = result.classes;\n      else if (line.styleClasses) line.styleClasses = null;\n      if (updateFrontier === cm.doc.frontier) cm.doc.frontier++;\n    }\n    return line.styles;\n  }\n\n  // Lightweight form of highlight -- proceed over this line and\n  // update state, but don't save a style array. Used for lines that\n  // aren't currently visible.\n  function processLine(cm, text, state, startAt) {\n    var mode = cm.doc.mode;\n    var stream = new StringStream(text, cm.options.tabSize);\n    stream.start = stream.pos = startAt || 0;\n    if (text == \"\") callBlankLine(mode, state);\n    while (!stream.eol() && stream.pos <= cm.options.maxHighlightLength) {\n      readToken(mode, stream, state);\n      stream.start = stream.pos;\n    }\n  }\n\n  // Convert a style as returned by a mode (either null, or a string\n  // containing one or more styles) to a CSS style. This is cached,\n  // and also looks for line-wide styles.\n  var styleToClassCache = {}, styleToClassCacheWithMode = {};\n  function interpretTokenStyle(style, options) {\n    if (!style || /^\\s*$/.test(style)) return null;\n    var cache = options.addModeClass ? styleToClassCacheWithMode : styleToClassCache;\n    return cache[style] ||\n      (cache[style] = style.replace(/\\S+/g, \"cm-$&\"));\n  }\n\n  // Render the DOM representation of the text of a line. Also builds\n  // up a 'line map', which points at the DOM nodes that represent\n  // specific stretches of text, and is used by the measuring code.\n  // The returned object contains the DOM node, this map, and\n  // information about line-wide styles that were set by the mode.\n  function buildLineContent(cm, lineView) {\n    // The padding-right forces the element to have a 'border', which\n    // is needed on Webkit to be able to get line-level bounding\n    // rectangles for it (in measureChar).\n    var content = elt(\"span\", null, null, webkit ? \"padding-right: .1px\" : null);\n    var builder = {pre: elt(\"pre\", [content]), content: content, col: 0, pos: 0, cm: cm};\n    lineView.measure = {};\n\n    // Iterate over the logical lines that make up this visual line.\n    for (var i = 0; i <= (lineView.rest ? lineView.rest.length : 0); i++) {\n      var line = i ? lineView.rest[i - 1] : lineView.line, order;\n      builder.pos = 0;\n      builder.addToken = buildToken;\n      // Optionally wire in some hacks into the token-rendering\n      // algorithm, to deal with browser quirks.\n      if ((ie || webkit) && cm.getOption(\"lineWrapping\"))\n        builder.addToken = buildTokenSplitSpaces(builder.addToken);\n      if (hasBadBidiRects(cm.display.measure) && (order = getOrder(line)))\n        builder.addToken = buildTokenBadBidi(builder.addToken, order);\n      builder.map = [];\n      var allowFrontierUpdate = lineView != cm.display.externalMeasured && lineNo(line);\n      insertLineContent(line, builder, getLineStyles(cm, line, allowFrontierUpdate));\n      if (line.styleClasses) {\n        if (line.styleClasses.bgClass)\n          builder.bgClass = joinClasses(line.styleClasses.bgClass, builder.bgClass || \"\");\n        if (line.styleClasses.textClass)\n          builder.textClass = joinClasses(line.styleClasses.textClass, builder.textClass || \"\");\n      }\n\n      // Ensure at least a single node is present, for measuring.\n      if (builder.map.length == 0)\n        builder.map.push(0, 0, builder.content.appendChild(zeroWidthElement(cm.display.measure)));\n\n      // Store the map and a cache object for the current logical line\n      if (i == 0) {\n        lineView.measure.map = builder.map;\n        lineView.measure.cache = {};\n      } else {\n        (lineView.measure.maps || (lineView.measure.maps = [])).push(builder.map);\n        (lineView.measure.caches || (lineView.measure.caches = [])).push({});\n      }\n    }\n\n    // See issue #2901\n    if (webkit && /\\bcm-tab\\b/.test(builder.content.lastChild.className))\n      builder.content.className = \"cm-tab-wrap-hack\";\n\n    signal(cm, \"renderLine\", cm, lineView.line, builder.pre);\n    if (builder.pre.className)\n      builder.textClass = joinClasses(builder.pre.className, builder.textClass || \"\");\n\n    return builder;\n  }\n\n  function defaultSpecialCharPlaceholder(ch) {\n    var token = elt(\"span\", \"\\u2022\", \"cm-invalidchar\");\n    token.title = \"\\\\u\" + ch.charCodeAt(0).toString(16);\n    return token;\n  }\n\n  // Build up the DOM representation for a single token, and add it to\n  // the line map. Takes care to render special characters separately.\n  function buildToken(builder, text, style, startStyle, endStyle, title) {\n    if (!text) return;\n    var special = builder.cm.options.specialChars, mustWrap = false;\n    if (!special.test(text)) {\n      builder.col += text.length;\n      var content = document.createTextNode(text);\n      builder.map.push(builder.pos, builder.pos + text.length, content);\n      if (ie && ie_version < 9) mustWrap = true;\n      builder.pos += text.length;\n    } else {\n      var content = document.createDocumentFragment(), pos = 0;\n      while (true) {\n        special.lastIndex = pos;\n        var m = special.exec(text);\n        var skipped = m ? m.index - pos : text.length - pos;\n        if (skipped) {\n          var txt = document.createTextNode(text.slice(pos, pos + skipped));\n          if (ie && ie_version < 9) content.appendChild(elt(\"span\", [txt]));\n          else content.appendChild(txt);\n          builder.map.push(builder.pos, builder.pos + skipped, txt);\n          builder.col += skipped;\n          builder.pos += skipped;\n        }\n        if (!m) break;\n        pos += skipped + 1;\n        if (m[0] == \"\\t\") {\n          var tabSize = builder.cm.options.tabSize, tabWidth = tabSize - builder.col % tabSize;\n          var txt = content.appendChild(elt(\"span\", spaceStr(tabWidth), \"cm-tab\"));\n          builder.col += tabWidth;\n        } else {\n          var txt = builder.cm.options.specialCharPlaceholder(m[0]);\n          if (ie && ie_version < 9) content.appendChild(elt(\"span\", [txt]));\n          else content.appendChild(txt);\n          builder.col += 1;\n        }\n        builder.map.push(builder.pos, builder.pos + 1, txt);\n        builder.pos++;\n      }\n    }\n    if (style || startStyle || endStyle || mustWrap) {\n      var fullStyle = style || \"\";\n      if (startStyle) fullStyle += startStyle;\n      if (endStyle) fullStyle += endStyle;\n      var token = elt(\"span\", [content], fullStyle);\n      if (title) token.title = title;\n      return builder.content.appendChild(token);\n    }\n    builder.content.appendChild(content);\n  }\n\n  function buildTokenSplitSpaces(inner) {\n    function split(old) {\n      var out = \" \";\n      for (var i = 0; i < old.length - 2; ++i) out += i % 2 ? \" \" : \"\\u00a0\";\n      out += \" \";\n      return out;\n    }\n    return function(builder, text, style, startStyle, endStyle, title) {\n      inner(builder, text.replace(/ {3,}/g, split), style, startStyle, endStyle, title);\n    };\n  }\n\n  // Work around nonsense dimensions being reported for stretches of\n  // right-to-left text.\n  function buildTokenBadBidi(inner, order) {\n    return function(builder, text, style, startStyle, endStyle, title) {\n      style = style ? style + \" cm-force-border\" : \"cm-force-border\";\n      var start = builder.pos, end = start + text.length;\n      for (;;) {\n        // Find the part that overlaps with the start of this text\n        for (var i = 0; i < order.length; i++) {\n          var part = order[i];\n          if (part.to > start && part.from <= start) break;\n        }\n        if (part.to >= end) return inner(builder, text, style, startStyle, endStyle, title);\n        inner(builder, text.slice(0, part.to - start), style, startStyle, null, title);\n        startStyle = null;\n        text = text.slice(part.to - start);\n        start = part.to;\n      }\n    };\n  }\n\n  function buildCollapsedSpan(builder, size, marker, ignoreWidget) {\n    var widget = !ignoreWidget && marker.widgetNode;\n    if (widget) {\n      builder.map.push(builder.pos, builder.pos + size, widget);\n      builder.content.appendChild(widget);\n    }\n    builder.pos += size;\n  }\n\n  // Outputs a number of spans to make up a line, taking highlighting\n  // and marked text into account.\n  function insertLineContent(line, builder, styles) {\n    var spans = line.markedSpans, allText = line.text, at = 0;\n    if (!spans) {\n      for (var i = 1; i < styles.length; i+=2)\n        builder.addToken(builder, allText.slice(at, at = styles[i]), interpretTokenStyle(styles[i+1], builder.cm.options));\n      return;\n    }\n\n    var len = allText.length, pos = 0, i = 1, text = \"\", style;\n    var nextChange = 0, spanStyle, spanEndStyle, spanStartStyle, title, collapsed;\n    for (;;) {\n      if (nextChange == pos) { // Update current marker set\n        spanStyle = spanEndStyle = spanStartStyle = title = \"\";\n        collapsed = null; nextChange = Infinity;\n        var foundBookmarks = [];\n        for (var j = 0; j < spans.length; ++j) {\n          var sp = spans[j], m = sp.marker;\n          if (sp.from <= pos && (sp.to == null || sp.to > pos)) {\n            if (sp.to != null && nextChange > sp.to) { nextChange = sp.to; spanEndStyle = \"\"; }\n            if (m.className) spanStyle += \" \" + m.className;\n            if (m.startStyle && sp.from == pos) spanStartStyle += \" \" + m.startStyle;\n            if (m.endStyle && sp.to == nextChange) spanEndStyle += \" \" + m.endStyle;\n            if (m.title && !title) title = m.title;\n            if (m.collapsed && (!collapsed || compareCollapsedMarkers(collapsed.marker, m) < 0))\n              collapsed = sp;\n          } else if (sp.from > pos && nextChange > sp.from) {\n            nextChange = sp.from;\n          }\n          if (m.type == \"bookmark\" && sp.from == pos && m.widgetNode) foundBookmarks.push(m);\n        }\n        if (collapsed && (collapsed.from || 0) == pos) {\n          buildCollapsedSpan(builder, (collapsed.to == null ? len + 1 : collapsed.to) - pos,\n                             collapsed.marker, collapsed.from == null);\n          if (collapsed.to == null) return;\n        }\n        if (!collapsed && foundBookmarks.length) for (var j = 0; j < foundBookmarks.length; ++j)\n          buildCollapsedSpan(builder, 0, foundBookmarks[j]);\n      }\n      if (pos >= len) break;\n\n      var upto = Math.min(len, nextChange);\n      while (true) {\n        if (text) {\n          var end = pos + text.length;\n          if (!collapsed) {\n            var tokenText = end > upto ? text.slice(0, upto - pos) : text;\n            builder.addToken(builder, tokenText, style ? style + spanStyle : spanStyle,\n                             spanStartStyle, pos + tokenText.length == nextChange ? spanEndStyle : \"\", title);\n          }\n          if (end >= upto) {text = text.slice(upto - pos); pos = upto; break;}\n          pos = end;\n          spanStartStyle = \"\";\n        }\n        text = allText.slice(at, at = styles[i++]);\n        style = interpretTokenStyle(styles[i++], builder.cm.options);\n      }\n    }\n  }\n\n  // DOCUMENT DATA STRUCTURE\n\n  // By default, updates that start and end at the beginning of a line\n  // are treated specially, in order to make the association of line\n  // widgets and marker elements with the text behave more intuitive.\n  function isWholeLineUpdate(doc, change) {\n    return change.from.ch == 0 && change.to.ch == 0 && lst(change.text) == \"\" &&\n      (!doc.cm || doc.cm.options.wholeLineUpdateBefore);\n  }\n\n  // Perform a change on the document data structure.\n  function updateDoc(doc, change, markedSpans, estimateHeight) {\n    function spansFor(n) {return markedSpans ? markedSpans[n] : null;}\n    function update(line, text, spans) {\n      updateLine(line, text, spans, estimateHeight);\n      signalLater(line, \"change\", line, change);\n    }\n\n    var from = change.from, to = change.to, text = change.text;\n    var firstLine = getLine(doc, from.line), lastLine = getLine(doc, to.line);\n    var lastText = lst(text), lastSpans = spansFor(text.length - 1), nlines = to.line - from.line;\n\n    // Adjust the line structure\n    if (isWholeLineUpdate(doc, change)) {\n      // This is a whole-line replace. Treated specially to make\n      // sure line objects move the way they are supposed to.\n      for (var i = 0, added = []; i < text.length - 1; ++i)\n        added.push(new Line(text[i], spansFor(i), estimateHeight));\n      update(lastLine, lastLine.text, lastSpans);\n      if (nlines) doc.remove(from.line, nlines);\n      if (added.length) doc.insert(from.line, added);\n    } else if (firstLine == lastLine) {\n      if (text.length == 1) {\n        update(firstLine, firstLine.text.slice(0, from.ch) + lastText + firstLine.text.slice(to.ch), lastSpans);\n      } else {\n        for (var added = [], i = 1; i < text.length - 1; ++i)\n          added.push(new Line(text[i], spansFor(i), estimateHeight));\n        added.push(new Line(lastText + firstLine.text.slice(to.ch), lastSpans, estimateHeight));\n        update(firstLine, firstLine.text.slice(0, from.ch) + text[0], spansFor(0));\n        doc.insert(from.line + 1, added);\n      }\n    } else if (text.length == 1) {\n      update(firstLine, firstLine.text.slice(0, from.ch) + text[0] + lastLine.text.slice(to.ch), spansFor(0));\n      doc.remove(from.line + 1, nlines);\n    } else {\n      update(firstLine, firstLine.text.slice(0, from.ch) + text[0], spansFor(0));\n      update(lastLine, lastText + lastLine.text.slice(to.ch), lastSpans);\n      for (var i = 1, added = []; i < text.length - 1; ++i)\n        added.push(new Line(text[i], spansFor(i), estimateHeight));\n      if (nlines > 1) doc.remove(from.line + 1, nlines - 1);\n      doc.insert(from.line + 1, added);\n    }\n\n    signalLater(doc, \"change\", doc, change);\n  }\n\n  // The document is represented as a BTree consisting of leaves, with\n  // chunk of lines in them, and branches, with up to ten leaves or\n  // other branch nodes below them. The top node is always a branch\n  // node, and is the document object itself (meaning it has\n  // additional methods and properties).\n  //\n  // All nodes have parent links. The tree is used both to go from\n  // line numbers to line objects, and to go from objects to numbers.\n  // It also indexes by height, and is used to convert between height\n  // and line object, and to find the total height of the document.\n  //\n  // See also http://marijnhaverbeke.nl/blog/codemirror-line-tree.html\n\n  function LeafChunk(lines) {\n    this.lines = lines;\n    this.parent = null;\n    for (var i = 0, height = 0; i < lines.length; ++i) {\n      lines[i].parent = this;\n      height += lines[i].height;\n    }\n    this.height = height;\n  }\n\n  LeafChunk.prototype = {\n    chunkSize: function() { return this.lines.length; },\n    // Remove the n lines at offset 'at'.\n    removeInner: function(at, n) {\n      for (var i = at, e = at + n; i < e; ++i) {\n        var line = this.lines[i];\n        this.height -= line.height;\n        cleanUpLine(line);\n        signalLater(line, \"delete\");\n      }\n      this.lines.splice(at, n);\n    },\n    // Helper used to collapse a small branch into a single leaf.\n    collapse: function(lines) {\n      lines.push.apply(lines, this.lines);\n    },\n    // Insert the given array of lines at offset 'at', count them as\n    // having the given height.\n    insertInner: function(at, lines, height) {\n      this.height += height;\n      this.lines = this.lines.slice(0, at).concat(lines).concat(this.lines.slice(at));\n      for (var i = 0; i < lines.length; ++i) lines[i].parent = this;\n    },\n    // Used to iterate over a part of the tree.\n    iterN: function(at, n, op) {\n      for (var e = at + n; at < e; ++at)\n        if (op(this.lines[at])) return true;\n    }\n  };\n\n  function BranchChunk(children) {\n    this.children = children;\n    var size = 0, height = 0;\n    for (var i = 0; i < children.length; ++i) {\n      var ch = children[i];\n      size += ch.chunkSize(); height += ch.height;\n      ch.parent = this;\n    }\n    this.size = size;\n    this.height = height;\n    this.parent = null;\n  }\n\n  BranchChunk.prototype = {\n    chunkSize: function() { return this.size; },\n    removeInner: function(at, n) {\n      this.size -= n;\n      for (var i = 0; i < this.children.length; ++i) {\n        var child = this.children[i], sz = child.chunkSize();\n        if (at < sz) {\n          var rm = Math.min(n, sz - at), oldHeight = child.height;\n          child.removeInner(at, rm);\n          this.height -= oldHeight - child.height;\n          if (sz == rm) { this.children.splice(i--, 1); child.parent = null; }\n          if ((n -= rm) == 0) break;\n          at = 0;\n        } else at -= sz;\n      }\n      // If the result is smaller than 25 lines, ensure that it is a\n      // single leaf node.\n      if (this.size - n < 25 &&\n          (this.children.length > 1 || !(this.children[0] instanceof LeafChunk))) {\n        var lines = [];\n        this.collapse(lines);\n        this.children = [new LeafChunk(lines)];\n        this.children[0].parent = this;\n      }\n    },\n    collapse: function(lines) {\n      for (var i = 0; i < this.children.length; ++i) this.children[i].collapse(lines);\n    },\n    insertInner: function(at, lines, height) {\n      this.size += lines.length;\n      this.height += height;\n      for (var i = 0; i < this.children.length; ++i) {\n        var child = this.children[i], sz = child.chunkSize();\n        if (at <= sz) {\n          child.insertInner(at, lines, height);\n          if (child.lines && child.lines.length > 50) {\n            while (child.lines.length > 50) {\n              var spilled = child.lines.splice(child.lines.length - 25, 25);\n              var newleaf = new LeafChunk(spilled);\n              child.height -= newleaf.height;\n              this.children.splice(i + 1, 0, newleaf);\n              newleaf.parent = this;\n            }\n            this.maybeSpill();\n          }\n          break;\n        }\n        at -= sz;\n      }\n    },\n    // When a node has grown, check whether it should be split.\n    maybeSpill: function() {\n      if (this.children.length <= 10) return;\n      var me = this;\n      do {\n        var spilled = me.children.splice(me.children.length - 5, 5);\n        var sibling = new BranchChunk(spilled);\n        if (!me.parent) { // Become the parent node\n          var copy = new BranchChunk(me.children);\n          copy.parent = me;\n          me.children = [copy, sibling];\n          me = copy;\n        } else {\n          me.size -= sibling.size;\n          me.height -= sibling.height;\n          var myIndex = indexOf(me.parent.children, me);\n          me.parent.children.splice(myIndex + 1, 0, sibling);\n        }\n        sibling.parent = me.parent;\n      } while (me.children.length > 10);\n      me.parent.maybeSpill();\n    },\n    iterN: function(at, n, op) {\n      for (var i = 0; i < this.children.length; ++i) {\n        var child = this.children[i], sz = child.chunkSize();\n        if (at < sz) {\n          var used = Math.min(n, sz - at);\n          if (child.iterN(at, used, op)) return true;\n          if ((n -= used) == 0) break;\n          at = 0;\n        } else at -= sz;\n      }\n    }\n  };\n\n  var nextDocId = 0;\n  var Doc = CodeMirror.Doc = function(text, mode, firstLine) {\n    if (!(this instanceof Doc)) return new Doc(text, mode, firstLine);\n    if (firstLine == null) firstLine = 0;\n\n    BranchChunk.call(this, [new LeafChunk([new Line(\"\", null)])]);\n    this.first = firstLine;\n    this.scrollTop = this.scrollLeft = 0;\n    this.cantEdit = false;\n    this.cleanGeneration = 1;\n    this.frontier = firstLine;\n    var start = Pos(firstLine, 0);\n    this.sel = simpleSelection(start);\n    this.history = new History(null);\n    this.id = ++nextDocId;\n    this.modeOption = mode;\n\n    if (typeof text == \"string\") text = splitLines(text);\n    updateDoc(this, {from: start, to: start, text: text});\n    setSelection(this, simpleSelection(start), sel_dontScroll);\n  };\n\n  Doc.prototype = createObj(BranchChunk.prototype, {\n    constructor: Doc,\n    // Iterate over the document. Supports two forms -- with only one\n    // argument, it calls that for each line in the document. With\n    // three, it iterates over the range given by the first two (with\n    // the second being non-inclusive).\n    iter: function(from, to, op) {\n      if (op) this.iterN(from - this.first, to - from, op);\n      else this.iterN(this.first, this.first + this.size, from);\n    },\n\n    // Non-public interface for adding and removing lines.\n    insert: function(at, lines) {\n      var height = 0;\n      for (var i = 0; i < lines.length; ++i) height += lines[i].height;\n      this.insertInner(at - this.first, lines, height);\n    },\n    remove: function(at, n) { this.removeInner(at - this.first, n); },\n\n    // From here, the methods are part of the public interface. Most\n    // are also available from CodeMirror (editor) instances.\n\n    getValue: function(lineSep) {\n      var lines = getLines(this, this.first, this.first + this.size);\n      if (lineSep === false) return lines;\n      return lines.join(lineSep || \"\\n\");\n    },\n    setValue: docMethodOp(function(code) {\n      var top = Pos(this.first, 0), last = this.first + this.size - 1;\n      makeChange(this, {from: top, to: Pos(last, getLine(this, last).text.length),\n                        text: splitLines(code), origin: \"setValue\"}, true);\n      setSelection(this, simpleSelection(top));\n    }),\n    replaceRange: function(code, from, to, origin) {\n      from = clipPos(this, from);\n      to = to ? clipPos(this, to) : from;\n      replaceRange(this, code, from, to, origin);\n    },\n    getRange: function(from, to, lineSep) {\n      var lines = getBetween(this, clipPos(this, from), clipPos(this, to));\n      if (lineSep === false) return lines;\n      return lines.join(lineSep || \"\\n\");\n    },\n\n    getLine: function(line) {var l = this.getLineHandle(line); return l && l.text;},\n\n    getLineHandle: function(line) {if (isLine(this, line)) return getLine(this, line);},\n    getLineNumber: function(line) {return lineNo(line);},\n\n    getLineHandleVisualStart: function(line) {\n      if (typeof line == \"number\") line = getLine(this, line);\n      return visualLine(line);\n    },\n\n    lineCount: function() {return this.size;},\n    firstLine: function() {return this.first;},\n    lastLine: function() {return this.first + this.size - 1;},\n\n    clipPos: function(pos) {return clipPos(this, pos);},\n\n    getCursor: function(start) {\n      var range = this.sel.primary(), pos;\n      if (start == null || start == \"head\") pos = range.head;\n      else if (start == \"anchor\") pos = range.anchor;\n      else if (start == \"end\" || start == \"to\" || start === false) pos = range.to();\n      else pos = range.from();\n      return pos;\n    },\n    listSelections: function() { return this.sel.ranges; },\n    somethingSelected: function() {return this.sel.somethingSelected();},\n\n    setCursor: docMethodOp(function(line, ch, options) {\n      setSimpleSelection(this, clipPos(this, typeof line == \"number\" ? Pos(line, ch || 0) : line), null, options);\n    }),\n    setSelection: docMethodOp(function(anchor, head, options) {\n      setSimpleSelection(this, clipPos(this, anchor), clipPos(this, head || anchor), options);\n    }),\n    extendSelection: docMethodOp(function(head, other, options) {\n      extendSelection(this, clipPos(this, head), other && clipPos(this, other), options);\n    }),\n    extendSelections: docMethodOp(function(heads, options) {\n      extendSelections(this, clipPosArray(this, heads, options));\n    }),\n    extendSelectionsBy: docMethodOp(function(f, options) {\n      extendSelections(this, map(this.sel.ranges, f), options);\n    }),\n    setSelections: docMethodOp(function(ranges, primary, options) {\n      if (!ranges.length) return;\n      for (var i = 0, out = []; i < ranges.length; i++)\n        out[i] = new Range(clipPos(this, ranges[i].anchor),\n                           clipPos(this, ranges[i].head));\n      if (primary == null) primary = Math.min(ranges.length - 1, this.sel.primIndex);\n      setSelection(this, normalizeSelection(out, primary), options);\n    }),\n    addSelection: docMethodOp(function(anchor, head, options) {\n      var ranges = this.sel.ranges.slice(0);\n      ranges.push(new Range(clipPos(this, anchor), clipPos(this, head || anchor)));\n      setSelection(this, normalizeSelection(ranges, ranges.length - 1), options);\n    }),\n\n    getSelection: function(lineSep) {\n      var ranges = this.sel.ranges, lines;\n      for (var i = 0; i < ranges.length; i++) {\n        var sel = getBetween(this, ranges[i].from(), ranges[i].to());\n        lines = lines ? lines.concat(sel) : sel;\n      }\n      if (lineSep === false) return lines;\n      else return lines.join(lineSep || \"\\n\");\n    },\n    getSelections: function(lineSep) {\n      var parts = [], ranges = this.sel.ranges;\n      for (var i = 0; i < ranges.length; i++) {\n        var sel = getBetween(this, ranges[i].from(), ranges[i].to());\n        if (lineSep !== false) sel = sel.join(lineSep || \"\\n\");\n        parts[i] = sel;\n      }\n      return parts;\n    },\n    replaceSelection: function(code, collapse, origin) {\n      var dup = [];\n      for (var i = 0; i < this.sel.ranges.length; i++)\n        dup[i] = code;\n      this.replaceSelections(dup, collapse, origin || \"+input\");\n    },\n    replaceSelections: docMethodOp(function(code, collapse, origin) {\n      var changes = [], sel = this.sel;\n      for (var i = 0; i < sel.ranges.length; i++) {\n        var range = sel.ranges[i];\n        changes[i] = {from: range.from(), to: range.to(), text: splitLines(code[i]), origin: origin};\n      }\n      var newSel = collapse && collapse != \"end\" && computeReplacedSel(this, changes, collapse);\n      for (var i = changes.length - 1; i >= 0; i--)\n        makeChange(this, changes[i]);\n      if (newSel) setSelectionReplaceHistory(this, newSel);\n      else if (this.cm) ensureCursorVisible(this.cm);\n    }),\n    undo: docMethodOp(function() {makeChangeFromHistory(this, \"undo\");}),\n    redo: docMethodOp(function() {makeChangeFromHistory(this, \"redo\");}),\n    undoSelection: docMethodOp(function() {makeChangeFromHistory(this, \"undo\", true);}),\n    redoSelection: docMethodOp(function() {makeChangeFromHistory(this, \"redo\", true);}),\n\n    setExtending: function(val) {this.extend = val;},\n    getExtending: function() {return this.extend;},\n\n    historySize: function() {\n      var hist = this.history, done = 0, undone = 0;\n      for (var i = 0; i < hist.done.length; i++) if (!hist.done[i].ranges) ++done;\n      for (var i = 0; i < hist.undone.length; i++) if (!hist.undone[i].ranges) ++undone;\n      return {undo: done, redo: undone};\n    },\n    clearHistory: function() {this.history = new History(this.history.maxGeneration);},\n\n    markClean: function() {\n      this.cleanGeneration = this.changeGeneration(true);\n    },\n    changeGeneration: function(forceSplit) {\n      if (forceSplit)\n        this.history.lastOp = this.history.lastSelOp = this.history.lastOrigin = null;\n      return this.history.generation;\n    },\n    isClean: function (gen) {\n      return this.history.generation == (gen || this.cleanGeneration);\n    },\n\n    getHistory: function() {\n      return {done: copyHistoryArray(this.history.done),\n              undone: copyHistoryArray(this.history.undone)};\n    },\n    setHistory: function(histData) {\n      var hist = this.history = new History(this.history.maxGeneration);\n      hist.done = copyHistoryArray(histData.done.slice(0), null, true);\n      hist.undone = copyHistoryArray(histData.undone.slice(0), null, true);\n    },\n\n    addLineClass: docMethodOp(function(handle, where, cls) {\n      return changeLine(this, handle, where == \"gutter\" ? \"gutter\" : \"class\", function(line) {\n        var prop = where == \"text\" ? \"textClass\"\n                 : where == \"background\" ? \"bgClass\"\n                 : where == \"gutter\" ? \"gutterClass\" : \"wrapClass\";\n        if (!line[prop]) line[prop] = cls;\n        else if (classTest(cls).test(line[prop])) return false;\n        else line[prop] += \" \" + cls;\n        return true;\n      });\n    }),\n    removeLineClass: docMethodOp(function(handle, where, cls) {\n      return changeLine(this, handle, \"class\", function(line) {\n        var prop = where == \"text\" ? \"textClass\"\n                 : where == \"background\" ? \"bgClass\"\n                 : where == \"gutter\" ? \"gutterClass\" : \"wrapClass\";\n        var cur = line[prop];\n        if (!cur) return false;\n        else if (cls == null) line[prop] = null;\n        else {\n          var found = cur.match(classTest(cls));\n          if (!found) return false;\n          var end = found.index + found[0].length;\n          line[prop] = cur.slice(0, found.index) + (!found.index || end == cur.length ? \"\" : \" \") + cur.slice(end) || null;\n        }\n        return true;\n      });\n    }),\n\n    markText: function(from, to, options) {\n      return markText(this, clipPos(this, from), clipPos(this, to), options, \"range\");\n    },\n    setBookmark: function(pos, options) {\n      var realOpts = {replacedWith: options && (options.nodeType == null ? options.widget : options),\n                      insertLeft: options && options.insertLeft,\n                      clearWhenEmpty: false, shared: options && options.shared};\n      pos = clipPos(this, pos);\n      return markText(this, pos, pos, realOpts, \"bookmark\");\n    },\n    findMarksAt: function(pos) {\n      pos = clipPos(this, pos);\n      var markers = [], spans = getLine(this, pos.line).markedSpans;\n      if (spans) for (var i = 0; i < spans.length; ++i) {\n        var span = spans[i];\n        if ((span.from == null || span.from <= pos.ch) &&\n            (span.to == null || span.to >= pos.ch))\n          markers.push(span.marker.parent || span.marker);\n      }\n      return markers;\n    },\n    findMarks: function(from, to, filter) {\n      from = clipPos(this, from); to = clipPos(this, to);\n      var found = [], lineNo = from.line;\n      this.iter(from.line, to.line + 1, function(line) {\n        var spans = line.markedSpans;\n        if (spans) for (var i = 0; i < spans.length; i++) {\n          var span = spans[i];\n          if (!(lineNo == from.line && from.ch > span.to ||\n                span.from == null && lineNo != from.line||\n                lineNo == to.line && span.from > to.ch) &&\n              (!filter || filter(span.marker)))\n            found.push(span.marker.parent || span.marker);\n        }\n        ++lineNo;\n      });\n      return found;\n    },\n    getAllMarks: function() {\n      var markers = [];\n      this.iter(function(line) {\n        var sps = line.markedSpans;\n        if (sps) for (var i = 0; i < sps.length; ++i)\n          if (sps[i].from != null) markers.push(sps[i].marker);\n      });\n      return markers;\n    },\n\n    posFromIndex: function(off) {\n      var ch, lineNo = this.first;\n      this.iter(function(line) {\n        var sz = line.text.length + 1;\n        if (sz > off) { ch = off; return true; }\n        off -= sz;\n        ++lineNo;\n      });\n      return clipPos(this, Pos(lineNo, ch));\n    },\n    indexFromPos: function (coords) {\n      coords = clipPos(this, coords);\n      var index = coords.ch;\n      if (coords.line < this.first || coords.ch < 0) return 0;\n      this.iter(this.first, coords.line, function (line) {\n        index += line.text.length + 1;\n      });\n      return index;\n    },\n\n    copy: function(copyHistory) {\n      var doc = new Doc(getLines(this, this.first, this.first + this.size), this.modeOption, this.first);\n      doc.scrollTop = this.scrollTop; doc.scrollLeft = this.scrollLeft;\n      doc.sel = this.sel;\n      doc.extend = false;\n      if (copyHistory) {\n        doc.history.undoDepth = this.history.undoDepth;\n        doc.setHistory(this.getHistory());\n      }\n      return doc;\n    },\n\n    linkedDoc: function(options) {\n      if (!options) options = {};\n      var from = this.first, to = this.first + this.size;\n      if (options.from != null && options.from > from) from = options.from;\n      if (options.to != null && options.to < to) to = options.to;\n      var copy = new Doc(getLines(this, from, to), options.mode || this.modeOption, from);\n      if (options.sharedHist) copy.history = this.history;\n      (this.linked || (this.linked = [])).push({doc: copy, sharedHist: options.sharedHist});\n      copy.linked = [{doc: this, isParent: true, sharedHist: options.sharedHist}];\n      copySharedMarkers(copy, findSharedMarkers(this));\n      return copy;\n    },\n    unlinkDoc: function(other) {\n      if (other instanceof CodeMirror) other = other.doc;\n      if (this.linked) for (var i = 0; i < this.linked.length; ++i) {\n        var link = this.linked[i];\n        if (link.doc != other) continue;\n        this.linked.splice(i, 1);\n        other.unlinkDoc(this);\n        detachSharedMarkers(findSharedMarkers(this));\n        break;\n      }\n      // If the histories were shared, split them again\n      if (other.history == this.history) {\n        var splitIds = [other.id];\n        linkedDocs(other, function(doc) {splitIds.push(doc.id);}, true);\n        other.history = new History(null);\n        other.history.done = copyHistoryArray(this.history.done, splitIds);\n        other.history.undone = copyHistoryArray(this.history.undone, splitIds);\n      }\n    },\n    iterLinkedDocs: function(f) {linkedDocs(this, f);},\n\n    getMode: function() {return this.mode;},\n    getEditor: function() {return this.cm;}\n  });\n\n  // Public alias.\n  Doc.prototype.eachLine = Doc.prototype.iter;\n\n  // Set up methods on CodeMirror's prototype to redirect to the editor's document.\n  var dontDelegate = \"iter insert remove copy getEditor\".split(\" \");\n  for (var prop in Doc.prototype) if (Doc.prototype.hasOwnProperty(prop) && indexOf(dontDelegate, prop) < 0)\n    CodeMirror.prototype[prop] = (function(method) {\n      return function() {return method.apply(this.doc, arguments);};\n    })(Doc.prototype[prop]);\n\n  eventMixin(Doc);\n\n  // Call f for all linked documents.\n  function linkedDocs(doc, f, sharedHistOnly) {\n    function propagate(doc, skip, sharedHist) {\n      if (doc.linked) for (var i = 0; i < doc.linked.length; ++i) {\n        var rel = doc.linked[i];\n        if (rel.doc == skip) continue;\n        var shared = sharedHist && rel.sharedHist;\n        if (sharedHistOnly && !shared) continue;\n        f(rel.doc, shared);\n        propagate(rel.doc, doc, shared);\n      }\n    }\n    propagate(doc, null, true);\n  }\n\n  // Attach a document to an editor.\n  function attachDoc(cm, doc) {\n    if (doc.cm) throw new Error(\"This document is already in use.\");\n    cm.doc = doc;\n    doc.cm = cm;\n    estimateLineHeights(cm);\n    loadMode(cm);\n    if (!cm.options.lineWrapping) findMaxLine(cm);\n    cm.options.mode = doc.modeOption;\n    regChange(cm);\n  }\n\n  // LINE UTILITIES\n\n  // Find the line object corresponding to the given line number.\n  function getLine(doc, n) {\n    n -= doc.first;\n    if (n < 0 || n >= doc.size) throw new Error(\"There is no line \" + (n + doc.first) + \" in the document.\");\n    for (var chunk = doc; !chunk.lines;) {\n      for (var i = 0;; ++i) {\n        var child = chunk.children[i], sz = child.chunkSize();\n        if (n < sz) { chunk = child; break; }\n        n -= sz;\n      }\n    }\n    return chunk.lines[n];\n  }\n\n  // Get the part of a document between two positions, as an array of\n  // strings.\n  function getBetween(doc, start, end) {\n    var out = [], n = start.line;\n    doc.iter(start.line, end.line + 1, function(line) {\n      var text = line.text;\n      if (n == end.line) text = text.slice(0, end.ch);\n      if (n == start.line) text = text.slice(start.ch);\n      out.push(text);\n      ++n;\n    });\n    return out;\n  }\n  // Get the lines between from and to, as array of strings.\n  function getLines(doc, from, to) {\n    var out = [];\n    doc.iter(from, to, function(line) { out.push(line.text); });\n    return out;\n  }\n\n  // Update the height of a line, propagating the height change\n  // upwards to parent nodes.\n  function updateLineHeight(line, height) {\n    var diff = height - line.height;\n    if (diff) for (var n = line; n; n = n.parent) n.height += diff;\n  }\n\n  // Given a line object, find its line number by walking up through\n  // its parent links.\n  function lineNo(line) {\n    if (line.parent == null) return null;\n    var cur = line.parent, no = indexOf(cur.lines, line);\n    for (var chunk = cur.parent; chunk; cur = chunk, chunk = chunk.parent) {\n      for (var i = 0;; ++i) {\n        if (chunk.children[i] == cur) break;\n        no += chunk.children[i].chunkSize();\n      }\n    }\n    return no + cur.first;\n  }\n\n  // Find the line at the given vertical position, using the height\n  // information in the document tree.\n  function lineAtHeight(chunk, h) {\n    var n = chunk.first;\n    outer: do {\n      for (var i = 0; i < chunk.children.length; ++i) {\n        var child = chunk.children[i], ch = child.height;\n        if (h < ch) { chunk = child; continue outer; }\n        h -= ch;\n        n += child.chunkSize();\n      }\n      return n;\n    } while (!chunk.lines);\n    for (var i = 0; i < chunk.lines.length; ++i) {\n      var line = chunk.lines[i], lh = line.height;\n      if (h < lh) break;\n      h -= lh;\n    }\n    return n + i;\n  }\n\n\n  // Find the height above the given line.\n  function heightAtLine(lineObj) {\n    lineObj = visualLine(lineObj);\n\n    var h = 0, chunk = lineObj.parent;\n    for (var i = 0; i < chunk.lines.length; ++i) {\n      var line = chunk.lines[i];\n      if (line == lineObj) break;\n      else h += line.height;\n    }\n    for (var p = chunk.parent; p; chunk = p, p = chunk.parent) {\n      for (var i = 0; i < p.children.length; ++i) {\n        var cur = p.children[i];\n        if (cur == chunk) break;\n        else h += cur.height;\n      }\n    }\n    return h;\n  }\n\n  // Get the bidi ordering for the given line (and cache it). Returns\n  // false for lines that are fully left-to-right, and an array of\n  // BidiSpan objects otherwise.\n  function getOrder(line) {\n    var order = line.order;\n    if (order == null) order = line.order = bidiOrdering(line.text);\n    return order;\n  }\n\n  // HISTORY\n\n  function History(startGen) {\n    // Arrays of change events and selections. Doing something adds an\n    // event to done and clears undo. Undoing moves events from done\n    // to undone, redoing moves them in the other direction.\n    this.done = []; this.undone = [];\n    this.undoDepth = Infinity;\n    // Used to track when changes can be merged into a single undo\n    // event\n    this.lastModTime = this.lastSelTime = 0;\n    this.lastOp = this.lastSelOp = null;\n    this.lastOrigin = this.lastSelOrigin = null;\n    // Used by the isClean() method\n    this.generation = this.maxGeneration = startGen || 1;\n  }\n\n  // Create a history change event from an updateDoc-style change\n  // object.\n  function historyChangeFromChange(doc, change) {\n    var histChange = {from: copyPos(change.from), to: changeEnd(change), text: getBetween(doc, change.from, change.to)};\n    attachLocalSpans(doc, histChange, change.from.line, change.to.line + 1);\n    linkedDocs(doc, function(doc) {attachLocalSpans(doc, histChange, change.from.line, change.to.line + 1);}, true);\n    return histChange;\n  }\n\n  // Pop all selection events off the end of a history array. Stop at\n  // a change event.\n  function clearSelectionEvents(array) {\n    while (array.length) {\n      var last = lst(array);\n      if (last.ranges) array.pop();\n      else break;\n    }\n  }\n\n  // Find the top change event in the history. Pop off selection\n  // events that are in the way.\n  function lastChangeEvent(hist, force) {\n    if (force) {\n      clearSelectionEvents(hist.done);\n      return lst(hist.done);\n    } else if (hist.done.length && !lst(hist.done).ranges) {\n      return lst(hist.done);\n    } else if (hist.done.length > 1 && !hist.done[hist.done.length - 2].ranges) {\n      hist.done.pop();\n      return lst(hist.done);\n    }\n  }\n\n  // Register a change in the history. Merges changes that are within\n  // a single operation, ore are close together with an origin that\n  // allows merging (starting with \"+\") into a single event.\n  function addChangeToHistory(doc, change, selAfter, opId) {\n    var hist = doc.history;\n    hist.undone.length = 0;\n    var time = +new Date, cur;\n\n    if ((hist.lastOp == opId ||\n         hist.lastOrigin == change.origin && change.origin &&\n         ((change.origin.charAt(0) == \"+\" && doc.cm && hist.lastModTime > time - doc.cm.options.historyEventDelay) ||\n          change.origin.charAt(0) == \"*\")) &&\n        (cur = lastChangeEvent(hist, hist.lastOp == opId))) {\n      // Merge this change into the last event\n      var last = lst(cur.changes);\n      if (cmp(change.from, change.to) == 0 && cmp(change.from, last.to) == 0) {\n        // Optimized case for simple insertion -- don't want to add\n        // new changesets for every character typed\n        last.to = changeEnd(change);\n      } else {\n        // Add new sub-event\n        cur.changes.push(historyChangeFromChange(doc, change));\n      }\n    } else {\n      // Can not be merged, start a new event.\n      var before = lst(hist.done);\n      if (!before || !before.ranges)\n        pushSelectionToHistory(doc.sel, hist.done);\n      cur = {changes: [historyChangeFromChange(doc, change)],\n             generation: hist.generation};\n      hist.done.push(cur);\n      while (hist.done.length > hist.undoDepth) {\n        hist.done.shift();\n        if (!hist.done[0].ranges) hist.done.shift();\n      }\n    }\n    hist.done.push(selAfter);\n    hist.generation = ++hist.maxGeneration;\n    hist.lastModTime = hist.lastSelTime = time;\n    hist.lastOp = hist.lastSelOp = opId;\n    hist.lastOrigin = hist.lastSelOrigin = change.origin;\n\n    if (!last) signal(doc, \"historyAdded\");\n  }\n\n  function selectionEventCanBeMerged(doc, origin, prev, sel) {\n    var ch = origin.charAt(0);\n    return ch == \"*\" ||\n      ch == \"+\" &&\n      prev.ranges.length == sel.ranges.length &&\n      prev.somethingSelected() == sel.somethingSelected() &&\n      new Date - doc.history.lastSelTime <= (doc.cm ? doc.cm.options.historyEventDelay : 500);\n  }\n\n  // Called whenever the selection changes, sets the new selection as\n  // the pending selection in the history, and pushes the old pending\n  // selection into the 'done' array when it was significantly\n  // different (in number of selected ranges, emptiness, or time).\n  function addSelectionToHistory(doc, sel, opId, options) {\n    var hist = doc.history, origin = options && options.origin;\n\n    // A new event is started when the previous origin does not match\n    // the current, or the origins don't allow matching. Origins\n    // starting with * are always merged, those starting with + are\n    // merged when similar and close together in time.\n    if (opId == hist.lastSelOp ||\n        (origin && hist.lastSelOrigin == origin &&\n         (hist.lastModTime == hist.lastSelTime && hist.lastOrigin == origin ||\n          selectionEventCanBeMerged(doc, origin, lst(hist.done), sel))))\n      hist.done[hist.done.length - 1] = sel;\n    else\n      pushSelectionToHistory(sel, hist.done);\n\n    hist.lastSelTime = +new Date;\n    hist.lastSelOrigin = origin;\n    hist.lastSelOp = opId;\n    if (options && options.clearRedo !== false)\n      clearSelectionEvents(hist.undone);\n  }\n\n  function pushSelectionToHistory(sel, dest) {\n    var top = lst(dest);\n    if (!(top && top.ranges && top.equals(sel)))\n      dest.push(sel);\n  }\n\n  // Used to store marked span information in the history.\n  function attachLocalSpans(doc, change, from, to) {\n    var existing = change[\"spans_\" + doc.id], n = 0;\n    doc.iter(Math.max(doc.first, from), Math.min(doc.first + doc.size, to), function(line) {\n      if (line.markedSpans)\n        (existing || (existing = change[\"spans_\" + doc.id] = {}))[n] = line.markedSpans;\n      ++n;\n    });\n  }\n\n  // When un/re-doing restores text containing marked spans, those\n  // that have been explicitly cleared should not be restored.\n  function removeClearedSpans(spans) {\n    if (!spans) return null;\n    for (var i = 0, out; i < spans.length; ++i) {\n      if (spans[i].marker.explicitlyCleared) { if (!out) out = spans.slice(0, i); }\n      else if (out) out.push(spans[i]);\n    }\n    return !out ? spans : out.length ? out : null;\n  }\n\n  // Retrieve and filter the old marked spans stored in a change event.\n  function getOldSpans(doc, change) {\n    var found = change[\"spans_\" + doc.id];\n    if (!found) return null;\n    for (var i = 0, nw = []; i < change.text.length; ++i)\n      nw.push(removeClearedSpans(found[i]));\n    return nw;\n  }\n\n  // Used both to provide a JSON-safe object in .getHistory, and, when\n  // detaching a document, to split the history in two\n  function copyHistoryArray(events, newGroup, instantiateSel) {\n    for (var i = 0, copy = []; i < events.length; ++i) {\n      var event = events[i];\n      if (event.ranges) {\n        copy.push(instantiateSel ? Selection.prototype.deepCopy.call(event) : event);\n        continue;\n      }\n      var changes = event.changes, newChanges = [];\n      copy.push({changes: newChanges});\n      for (var j = 0; j < changes.length; ++j) {\n        var change = changes[j], m;\n        newChanges.push({from: change.from, to: change.to, text: change.text});\n        if (newGroup) for (var prop in change) if (m = prop.match(/^spans_(\\d+)$/)) {\n          if (indexOf(newGroup, Number(m[1])) > -1) {\n            lst(newChanges)[prop] = change[prop];\n            delete change[prop];\n          }\n        }\n      }\n    }\n    return copy;\n  }\n\n  // Rebasing/resetting history to deal with externally-sourced changes\n\n  function rebaseHistSelSingle(pos, from, to, diff) {\n    if (to < pos.line) {\n      pos.line += diff;\n    } else if (from < pos.line) {\n      pos.line = from;\n      pos.ch = 0;\n    }\n  }\n\n  // Tries to rebase an array of history events given a change in the\n  // document. If the change touches the same lines as the event, the\n  // event, and everything 'behind' it, is discarded. If the change is\n  // before the event, the event's positions are updated. Uses a\n  // copy-on-write scheme for the positions, to avoid having to\n  // reallocate them all on every rebase, but also avoid problems with\n  // shared position objects being unsafely updated.\n  function rebaseHistArray(array, from, to, diff) {\n    for (var i = 0; i < array.length; ++i) {\n      var sub = array[i], ok = true;\n      if (sub.ranges) {\n        if (!sub.copied) { sub = array[i] = sub.deepCopy(); sub.copied = true; }\n        for (var j = 0; j < sub.ranges.length; j++) {\n          rebaseHistSelSingle(sub.ranges[j].anchor, from, to, diff);\n          rebaseHistSelSingle(sub.ranges[j].head, from, to, diff);\n        }\n        continue;\n      }\n      for (var j = 0; j < sub.changes.length; ++j) {\n        var cur = sub.changes[j];\n        if (to < cur.from.line) {\n          cur.from = Pos(cur.from.line + diff, cur.from.ch);\n          cur.to = Pos(cur.to.line + diff, cur.to.ch);\n        } else if (from <= cur.to.line) {\n          ok = false;\n          break;\n        }\n      }\n      if (!ok) {\n        array.splice(0, i + 1);\n        i = 0;\n      }\n    }\n  }\n\n  function rebaseHist(hist, change) {\n    var from = change.from.line, to = change.to.line, diff = change.text.length - (to - from) - 1;\n    rebaseHistArray(hist.done, from, to, diff);\n    rebaseHistArray(hist.undone, from, to, diff);\n  }\n\n  // EVENT UTILITIES\n\n  // Due to the fact that we still support jurassic IE versions, some\n  // compatibility wrappers are needed.\n\n  var e_preventDefault = CodeMirror.e_preventDefault = function(e) {\n    if (e.preventDefault) e.preventDefault();\n    else e.returnValue = false;\n  };\n  var e_stopPropagation = CodeMirror.e_stopPropagation = function(e) {\n    if (e.stopPropagation) e.stopPropagation();\n    else e.cancelBubble = true;\n  };\n  function e_defaultPrevented(e) {\n    return e.defaultPrevented != null ? e.defaultPrevented : e.returnValue == false;\n  }\n  var e_stop = CodeMirror.e_stop = function(e) {e_preventDefault(e); e_stopPropagation(e);};\n\n  function e_target(e) {return e.target || e.srcElement;}\n  function e_button(e) {\n    var b = e.which;\n    if (b == null) {\n      if (e.button & 1) b = 1;\n      else if (e.button & 2) b = 3;\n      else if (e.button & 4) b = 2;\n    }\n    if (mac && e.ctrlKey && b == 1) b = 3;\n    return b;\n  }\n\n  // EVENT HANDLING\n\n  // Lightweight event framework. on/off also work on DOM nodes,\n  // registering native DOM handlers.\n\n  var on = CodeMirror.on = function(emitter, type, f) {\n    if (emitter.addEventListener)\n      emitter.addEventListener(type, f, false);\n    else if (emitter.attachEvent)\n      emitter.attachEvent(\"on\" + type, f);\n    else {\n      var map = emitter._handlers || (emitter._handlers = {});\n      var arr = map[type] || (map[type] = []);\n      arr.push(f);\n    }\n  };\n\n  var off = CodeMirror.off = function(emitter, type, f) {\n    if (emitter.removeEventListener)\n      emitter.removeEventListener(type, f, false);\n    else if (emitter.detachEvent)\n      emitter.detachEvent(\"on\" + type, f);\n    else {\n      var arr = emitter._handlers && emitter._handlers[type];\n      if (!arr) return;\n      for (var i = 0; i < arr.length; ++i)\n        if (arr[i] == f) { arr.splice(i, 1); break; }\n    }\n  };\n\n  var signal = CodeMirror.signal = function(emitter, type /*, values...*/) {\n    var arr = emitter._handlers && emitter._handlers[type];\n    if (!arr) return;\n    var args = Array.prototype.slice.call(arguments, 2);\n    for (var i = 0; i < arr.length; ++i) arr[i].apply(null, args);\n  };\n\n  var orphanDelayedCallbacks = null;\n\n  // Often, we want to signal events at a point where we are in the\n  // middle of some work, but don't want the handler to start calling\n  // other methods on the editor, which might be in an inconsistent\n  // state or simply not expect any other events to happen.\n  // signalLater looks whether there are any handlers, and schedules\n  // them to be executed when the last operation ends, or, if no\n  // operation is active, when a timeout fires.\n  function signalLater(emitter, type /*, values...*/) {\n    var arr = emitter._handlers && emitter._handlers[type];\n    if (!arr) return;\n    var args = Array.prototype.slice.call(arguments, 2), list;\n    if (operationGroup) {\n      list = operationGroup.delayedCallbacks;\n    } else if (orphanDelayedCallbacks) {\n      list = orphanDelayedCallbacks;\n    } else {\n      list = orphanDelayedCallbacks = [];\n      setTimeout(fireOrphanDelayed, 0);\n    }\n    function bnd(f) {return function(){f.apply(null, args);};};\n    for (var i = 0; i < arr.length; ++i)\n      list.push(bnd(arr[i]));\n  }\n\n  function fireOrphanDelayed() {\n    var delayed = orphanDelayedCallbacks;\n    orphanDelayedCallbacks = null;\n    for (var i = 0; i < delayed.length; ++i) delayed[i]();\n  }\n\n  // The DOM events that CodeMirror handles can be overridden by\n  // registering a (non-DOM) handler on the editor for the event name,\n  // and preventDefault-ing the event in that handler.\n  function signalDOMEvent(cm, e, override) {\n    if (typeof e == \"string\")\n      e = {type: e, preventDefault: function() { this.defaultPrevented = true; }};\n    signal(cm, override || e.type, cm, e);\n    return e_defaultPrevented(e) || e.codemirrorIgnore;\n  }\n\n  function signalCursorActivity(cm) {\n    var arr = cm._handlers && cm._handlers.cursorActivity;\n    if (!arr) return;\n    var set = cm.curOp.cursorActivityHandlers || (cm.curOp.cursorActivityHandlers = []);\n    for (var i = 0; i < arr.length; ++i) if (indexOf(set, arr[i]) == -1)\n      set.push(arr[i]);\n  }\n\n  function hasHandler(emitter, type) {\n    var arr = emitter._handlers && emitter._handlers[type];\n    return arr && arr.length > 0;\n  }\n\n  // Add on and off methods to a constructor's prototype, to make\n  // registering events on such objects more convenient.\n  function eventMixin(ctor) {\n    ctor.prototype.on = function(type, f) {on(this, type, f);};\n    ctor.prototype.off = function(type, f) {off(this, type, f);};\n  }\n\n  // MISC UTILITIES\n\n  // Number of pixels added to scroller and sizer to hide scrollbar\n  var scrollerCutOff = 30;\n\n  // Returned or thrown by various protocols to signal 'I'm not\n  // handling this'.\n  var Pass = CodeMirror.Pass = {toString: function(){return \"CodeMirror.Pass\";}};\n\n  // Reused option objects for setSelection & friends\n  var sel_dontScroll = {scroll: false}, sel_mouse = {origin: \"*mouse\"}, sel_move = {origin: \"+move\"};\n\n  function Delayed() {this.id = null;}\n  Delayed.prototype.set = function(ms, f) {\n    clearTimeout(this.id);\n    this.id = setTimeout(f, ms);\n  };\n\n  // Counts the column offset in a string, taking tabs into account.\n  // Used mostly to find indentation.\n  var countColumn = CodeMirror.countColumn = function(string, end, tabSize, startIndex, startValue) {\n    if (end == null) {\n      end = string.search(/[^\\s\\u00a0]/);\n      if (end == -1) end = string.length;\n    }\n    for (var i = startIndex || 0, n = startValue || 0;;) {\n      var nextTab = string.indexOf(\"\\t\", i);\n      if (nextTab < 0 || nextTab >= end)\n        return n + (end - i);\n      n += nextTab - i;\n      n += tabSize - (n % tabSize);\n      i = nextTab + 1;\n    }\n  };\n\n  // The inverse of countColumn -- find the offset that corresponds to\n  // a particular column.\n  function findColumn(string, goal, tabSize) {\n    for (var pos = 0, col = 0;;) {\n      var nextTab = string.indexOf(\"\\t\", pos);\n      if (nextTab == -1) nextTab = string.length;\n      var skipped = nextTab - pos;\n      if (nextTab == string.length || col + skipped >= goal)\n        return pos + Math.min(skipped, goal - col);\n      col += nextTab - pos;\n      col += tabSize - (col % tabSize);\n      pos = nextTab + 1;\n      if (col >= goal) return pos;\n    }\n  }\n\n  var spaceStrs = [\"\"];\n  function spaceStr(n) {\n    while (spaceStrs.length <= n)\n      spaceStrs.push(lst(spaceStrs) + \" \");\n    return spaceStrs[n];\n  }\n\n  function lst(arr) { return arr[arr.length-1]; }\n\n  var selectInput = function(node) { node.select(); };\n  if (ios) // Mobile Safari apparently has a bug where select() is broken.\n    selectInput = function(node) { node.selectionStart = 0; node.selectionEnd = node.value.length; };\n  else if (ie) // Suppress mysterious IE10 errors\n    selectInput = function(node) { try { node.select(); } catch(_e) {} };\n\n  function indexOf(array, elt) {\n    for (var i = 0; i < array.length; ++i)\n      if (array[i] == elt) return i;\n    return -1;\n  }\n  if ([].indexOf) indexOf = function(array, elt) { return array.indexOf(elt); };\n  function map(array, f) {\n    var out = [];\n    for (var i = 0; i < array.length; i++) out[i] = f(array[i], i);\n    return out;\n  }\n  if ([].map) map = function(array, f) { return array.map(f); };\n\n  function createObj(base, props) {\n    var inst;\n    if (Object.create) {\n      inst = Object.create(base);\n    } else {\n      var ctor = function() {};\n      ctor.prototype = base;\n      inst = new ctor();\n    }\n    if (props) copyObj(props, inst);\n    return inst;\n  };\n\n  function copyObj(obj, target, overwrite) {\n    if (!target) target = {};\n    for (var prop in obj)\n      if (obj.hasOwnProperty(prop) && (overwrite !== false || !target.hasOwnProperty(prop)))\n        target[prop] = obj[prop];\n    return target;\n  }\n\n  function bind(f) {\n    var args = Array.prototype.slice.call(arguments, 1);\n    return function(){return f.apply(null, args);};\n  }\n\n  var nonASCIISingleCaseWordChar = /[\\u00df\\u0590-\\u05f4\\u0600-\\u06ff\\u3040-\\u309f\\u30a0-\\u30ff\\u3400-\\u4db5\\u4e00-\\u9fcc\\uac00-\\ud7af]/;\n  var isWordCharBasic = CodeMirror.isWordChar = function(ch) {\n    return /\\w/.test(ch) || ch > \"\\x80\" &&\n      (ch.toUpperCase() != ch.toLowerCase() || nonASCIISingleCaseWordChar.test(ch));\n  };\n  function isWordChar(ch, helper) {\n    if (!helper) return isWordCharBasic(ch);\n    if (helper.source.indexOf(\"\\\\w\") > -1 && isWordCharBasic(ch)) return true;\n    return helper.test(ch);\n  }\n\n  function isEmpty(obj) {\n    for (var n in obj) if (obj.hasOwnProperty(n) && obj[n]) return false;\n    return true;\n  }\n\n  // Extending unicode characters. A series of a non-extending char +\n  // any number of extending chars is treated as a single unit as far\n  // as editing and measuring is concerned. This is not fully correct,\n  // since some scripts/fonts/browsers also treat other configurations\n  // of code points as a group.\n  var extendingChars = /[\\u0300-\\u036f\\u0483-\\u0489\\u0591-\\u05bd\\u05bf\\u05c1\\u05c2\\u05c4\\u05c5\\u05c7\\u0610-\\u061a\\u064b-\\u065e\\u0670\\u06d6-\\u06dc\\u06de-\\u06e4\\u06e7\\u06e8\\u06ea-\\u06ed\\u0711\\u0730-\\u074a\\u07a6-\\u07b0\\u07eb-\\u07f3\\u0816-\\u0819\\u081b-\\u0823\\u0825-\\u0827\\u0829-\\u082d\\u0900-\\u0902\\u093c\\u0941-\\u0948\\u094d\\u0951-\\u0955\\u0962\\u0963\\u0981\\u09bc\\u09be\\u09c1-\\u09c4\\u09cd\\u09d7\\u09e2\\u09e3\\u0a01\\u0a02\\u0a3c\\u0a41\\u0a42\\u0a47\\u0a48\\u0a4b-\\u0a4d\\u0a51\\u0a70\\u0a71\\u0a75\\u0a81\\u0a82\\u0abc\\u0ac1-\\u0ac5\\u0ac7\\u0ac8\\u0acd\\u0ae2\\u0ae3\\u0b01\\u0b3c\\u0b3e\\u0b3f\\u0b41-\\u0b44\\u0b4d\\u0b56\\u0b57\\u0b62\\u0b63\\u0b82\\u0bbe\\u0bc0\\u0bcd\\u0bd7\\u0c3e-\\u0c40\\u0c46-\\u0c48\\u0c4a-\\u0c4d\\u0c55\\u0c56\\u0c62\\u0c63\\u0cbc\\u0cbf\\u0cc2\\u0cc6\\u0ccc\\u0ccd\\u0cd5\\u0cd6\\u0ce2\\u0ce3\\u0d3e\\u0d41-\\u0d44\\u0d4d\\u0d57\\u0d62\\u0d63\\u0dca\\u0dcf\\u0dd2-\\u0dd4\\u0dd6\\u0ddf\\u0e31\\u0e34-\\u0e3a\\u0e47-\\u0e4e\\u0eb1\\u0eb4-\\u0eb9\\u0ebb\\u0ebc\\u0ec8-\\u0ecd\\u0f18\\u0f19\\u0f35\\u0f37\\u0f39\\u0f71-\\u0f7e\\u0f80-\\u0f84\\u0f86\\u0f87\\u0f90-\\u0f97\\u0f99-\\u0fbc\\u0fc6\\u102d-\\u1030\\u1032-\\u1037\\u1039\\u103a\\u103d\\u103e\\u1058\\u1059\\u105e-\\u1060\\u1071-\\u1074\\u1082\\u1085\\u1086\\u108d\\u109d\\u135f\\u1712-\\u1714\\u1732-\\u1734\\u1752\\u1753\\u1772\\u1773\\u17b7-\\u17bd\\u17c6\\u17c9-\\u17d3\\u17dd\\u180b-\\u180d\\u18a9\\u1920-\\u1922\\u1927\\u1928\\u1932\\u1939-\\u193b\\u1a17\\u1a18\\u1a56\\u1a58-\\u1a5e\\u1a60\\u1a62\\u1a65-\\u1a6c\\u1a73-\\u1a7c\\u1a7f\\u1b00-\\u1b03\\u1b34\\u1b36-\\u1b3a\\u1b3c\\u1b42\\u1b6b-\\u1b73\\u1b80\\u1b81\\u1ba2-\\u1ba5\\u1ba8\\u1ba9\\u1c2c-\\u1c33\\u1c36\\u1c37\\u1cd0-\\u1cd2\\u1cd4-\\u1ce0\\u1ce2-\\u1ce8\\u1ced\\u1dc0-\\u1de6\\u1dfd-\\u1dff\\u200c\\u200d\\u20d0-\\u20f0\\u2cef-\\u2cf1\\u2de0-\\u2dff\\u302a-\\u302f\\u3099\\u309a\\ua66f-\\ua672\\ua67c\\ua67d\\ua6f0\\ua6f1\\ua802\\ua806\\ua80b\\ua825\\ua826\\ua8c4\\ua8e0-\\ua8f1\\ua926-\\ua92d\\ua947-\\ua951\\ua980-\\ua982\\ua9b3\\ua9b6-\\ua9b9\\ua9bc\\uaa29-\\uaa2e\\uaa31\\uaa32\\uaa35\\uaa36\\uaa43\\uaa4c\\uaab0\\uaab2-\\uaab4\\uaab7\\uaab8\\uaabe\\uaabf\\uaac1\\uabe5\\uabe8\\uabed\\udc00-\\udfff\\ufb1e\\ufe00-\\ufe0f\\ufe20-\\ufe26\\uff9e\\uff9f]/;\n  function isExtendingChar(ch) { return ch.charCodeAt(0) >= 768 && extendingChars.test(ch); }\n\n  // DOM UTILITIES\n\n  function elt(tag, content, className, style) {\n    var e = document.createElement(tag);\n    if (className) e.className = className;\n    if (style) e.style.cssText = style;\n    if (typeof content == \"string\") e.appendChild(document.createTextNode(content));\n    else if (content) for (var i = 0; i < content.length; ++i) e.appendChild(content[i]);\n    return e;\n  }\n\n  var range;\n  if (document.createRange) range = function(node, start, end) {\n    var r = document.createRange();\n    r.setEnd(node, end);\n    r.setStart(node, start);\n    return r;\n  };\n  else range = function(node, start, end) {\n    var r = document.body.createTextRange();\n    try { r.moveToElementText(node.parentNode); }\n    catch(e) { return r; }\n    r.collapse(true);\n    r.moveEnd(\"character\", end);\n    r.moveStart(\"character\", start);\n    return r;\n  };\n\n  function removeChildren(e) {\n    for (var count = e.childNodes.length; count > 0; --count)\n      e.removeChild(e.firstChild);\n    return e;\n  }\n\n  function removeChildrenAndAdd(parent, e) {\n    return removeChildren(parent).appendChild(e);\n  }\n\n  function contains(parent, child) {\n    if (parent.contains)\n      return parent.contains(child);\n    while (child = child.parentNode)\n      if (child == parent) return true;\n  }\n\n  function activeElt() { return document.activeElement; }\n  // Older versions of IE throws unspecified error when touching\n  // document.activeElement in some cases (during loading, in iframe)\n  if (ie && ie_version < 11) activeElt = function() {\n    try { return document.activeElement; }\n    catch(e) { return document.body; }\n  };\n\n  function classTest(cls) { return new RegExp(\"(^|\\\\s)\" + cls + \"(?:$|\\\\s)\\\\s*\"); }\n  var rmClass = CodeMirror.rmClass = function(node, cls) {\n    var current = node.className;\n    var match = classTest(cls).exec(current);\n    if (match) {\n      var after = current.slice(match.index + match[0].length);\n      node.className = current.slice(0, match.index) + (after ? match[1] + after : \"\");\n    }\n  };\n  var addClass = CodeMirror.addClass = function(node, cls) {\n    var current = node.className;\n    if (!classTest(cls).test(current)) node.className += (current ? \" \" : \"\") + cls;\n  };\n  function joinClasses(a, b) {\n    var as = a.split(\" \");\n    for (var i = 0; i < as.length; i++)\n      if (as[i] && !classTest(as[i]).test(b)) b += \" \" + as[i];\n    return b;\n  }\n\n  // WINDOW-WIDE EVENTS\n\n  // These must be handled carefully, because naively registering a\n  // handler for each editor will cause the editors to never be\n  // garbage collected.\n\n  function forEachCodeMirror(f) {\n    if (!document.body.getElementsByClassName) return;\n    var byClass = document.body.getElementsByClassName(\"CodeMirror\");\n    for (var i = 0; i < byClass.length; i++) {\n      var cm = byClass[i].CodeMirror;\n      if (cm) f(cm);\n    }\n  }\n\n  var globalsRegistered = false;\n  function ensureGlobalHandlers() {\n    if (globalsRegistered) return;\n    registerGlobalHandlers();\n    globalsRegistered = true;\n  }\n  function registerGlobalHandlers() {\n    // When the window resizes, we need to refresh active editors.\n    var resizeTimer;\n    on(window, \"resize\", function() {\n      if (resizeTimer == null) resizeTimer = setTimeout(function() {\n        resizeTimer = null;\n        knownScrollbarWidth = null;\n        forEachCodeMirror(onResize);\n      }, 100);\n    });\n    // When the window loses focus, we want to show the editor as blurred\n    on(window, \"blur\", function() {\n      forEachCodeMirror(onBlur);\n    });\n  }\n\n  // FEATURE DETECTION\n\n  // Detect drag-and-drop\n  var dragAndDrop = function() {\n    // There is *some* kind of drag-and-drop support in IE6-8, but I\n    // couldn't get it to work yet.\n    if (ie && ie_version < 9) return false;\n    var div = elt('div');\n    return \"draggable\" in div || \"dragDrop\" in div;\n  }();\n\n  var knownScrollbarWidth;\n  function scrollbarWidth(measure) {\n    if (knownScrollbarWidth != null) return knownScrollbarWidth;\n    var test = elt(\"div\", null, null, \"width: 50px; height: 50px; overflow-x: scroll\");\n    removeChildrenAndAdd(measure, test);\n    if (test.offsetWidth)\n      knownScrollbarWidth = test.offsetHeight - test.clientHeight;\n    return knownScrollbarWidth || 0;\n  }\n\n  var zwspSupported;\n  function zeroWidthElement(measure) {\n    if (zwspSupported == null) {\n      var test = elt(\"span\", \"\\u200b\");\n      removeChildrenAndAdd(measure, elt(\"span\", [test, document.createTextNode(\"x\")]));\n      if (measure.firstChild.offsetHeight != 0)\n        zwspSupported = test.offsetWidth <= 1 && test.offsetHeight > 2 && !(ie && ie_version < 8);\n    }\n    if (zwspSupported) return elt(\"span\", \"\\u200b\");\n    else return elt(\"span\", \"\\u00a0\", null, \"display: inline-block; width: 1px; margin-right: -1px\");\n  }\n\n  // Feature-detect IE's crummy client rect reporting for bidi text\n  var badBidiRects;\n  function hasBadBidiRects(measure) {\n    if (badBidiRects != null) return badBidiRects;\n    var txt = removeChildrenAndAdd(measure, document.createTextNode(\"A\\u062eA\"));\n    var r0 = range(txt, 0, 1).getBoundingClientRect();\n    if (!r0 || r0.left == r0.right) return false; // Safari returns null in some cases (#2780)\n    var r1 = range(txt, 1, 2).getBoundingClientRect();\n    return badBidiRects = (r1.right - r0.right < 3);\n  }\n\n  // See if \"\".split is the broken IE version, if so, provide an\n  // alternative way to split lines.\n  var splitLines = CodeMirror.splitLines = \"\\n\\nb\".split(/\\n/).length != 3 ? function(string) {\n    var pos = 0, result = [], l = string.length;\n    while (pos <= l) {\n      var nl = string.indexOf(\"\\n\", pos);\n      if (nl == -1) nl = string.length;\n      var line = string.slice(pos, string.charAt(nl - 1) == \"\\r\" ? nl - 1 : nl);\n      var rt = line.indexOf(\"\\r\");\n      if (rt != -1) {\n        result.push(line.slice(0, rt));\n        pos += rt + 1;\n      } else {\n        result.push(line);\n        pos = nl + 1;\n      }\n    }\n    return result;\n  } : function(string){return string.split(/\\r\\n?|\\n/);};\n\n  var hasSelection = window.getSelection ? function(te) {\n    try { return te.selectionStart != te.selectionEnd; }\n    catch(e) { return false; }\n  } : function(te) {\n    try {var range = te.ownerDocument.selection.createRange();}\n    catch(e) {}\n    if (!range || range.parentElement() != te) return false;\n    return range.compareEndPoints(\"StartToEnd\", range) != 0;\n  };\n\n  var hasCopyEvent = (function() {\n    var e = elt(\"div\");\n    if (\"oncopy\" in e) return true;\n    e.setAttribute(\"oncopy\", \"return;\");\n    return typeof e.oncopy == \"function\";\n  })();\n\n  var badZoomedRects = null;\n  function hasBadZoomedRects(measure) {\n    if (badZoomedRects != null) return badZoomedRects;\n    var node = removeChildrenAndAdd(measure, elt(\"span\", \"x\"));\n    var normal = node.getBoundingClientRect();\n    var fromRange = range(node, 0, 1).getBoundingClientRect();\n    return badZoomedRects = Math.abs(normal.left - fromRange.left) > 1;\n  }\n\n  // KEY NAMES\n\n  var keyNames = {3: \"Enter\", 8: \"Backspace\", 9: \"Tab\", 13: \"Enter\", 16: \"Shift\", 17: \"Ctrl\", 18: \"Alt\",\n                  19: \"Pause\", 20: \"CapsLock\", 27: \"Esc\", 32: \"Space\", 33: \"PageUp\", 34: \"PageDown\", 35: \"End\",\n                  36: \"Home\", 37: \"Left\", 38: \"Up\", 39: \"Right\", 40: \"Down\", 44: \"PrintScrn\", 45: \"Insert\",\n                  46: \"Delete\", 59: \";\", 61: \"=\", 91: \"Mod\", 92: \"Mod\", 93: \"Mod\", 107: \"=\", 109: \"-\", 127: \"Delete\",\n                  173: \"-\", 186: \";\", 187: \"=\", 188: \",\", 189: \"-\", 190: \".\", 191: \"/\", 192: \"`\", 219: \"[\", 220: \"\\\\\",\n                  221: \"]\", 222: \"'\", 63232: \"Up\", 63233: \"Down\", 63234: \"Left\", 63235: \"Right\", 63272: \"Delete\",\n                  63273: \"Home\", 63275: \"End\", 63276: \"PageUp\", 63277: \"PageDown\", 63302: \"Insert\"};\n  CodeMirror.keyNames = keyNames;\n  (function() {\n    // Number keys\n    for (var i = 0; i < 10; i++) keyNames[i + 48] = keyNames[i + 96] = String(i);\n    // Alphabetic keys\n    for (var i = 65; i <= 90; i++) keyNames[i] = String.fromCharCode(i);\n    // Function keys\n    for (var i = 1; i <= 12; i++) keyNames[i + 111] = keyNames[i + 63235] = \"F\" + i;\n  })();\n\n  // BIDI HELPERS\n\n  function iterateBidiSections(order, from, to, f) {\n    if (!order) return f(from, to, \"ltr\");\n    var found = false;\n    for (var i = 0; i < order.length; ++i) {\n      var part = order[i];\n      if (part.from < to && part.to > from || from == to && part.to == from) {\n        f(Math.max(part.from, from), Math.min(part.to, to), part.level == 1 ? \"rtl\" : \"ltr\");\n        found = true;\n      }\n    }\n    if (!found) f(from, to, \"ltr\");\n  }\n\n  function bidiLeft(part) { return part.level % 2 ? part.to : part.from; }\n  function bidiRight(part) { return part.level % 2 ? part.from : part.to; }\n\n  function lineLeft(line) { var order = getOrder(line); return order ? bidiLeft(order[0]) : 0; }\n  function lineRight(line) {\n    var order = getOrder(line);\n    if (!order) return line.text.length;\n    return bidiRight(lst(order));\n  }\n\n  function lineStart(cm, lineN) {\n    var line = getLine(cm.doc, lineN);\n    var visual = visualLine(line);\n    if (visual != line) lineN = lineNo(visual);\n    var order = getOrder(visual);\n    var ch = !order ? 0 : order[0].level % 2 ? lineRight(visual) : lineLeft(visual);\n    return Pos(lineN, ch);\n  }\n  function lineEnd(cm, lineN) {\n    var merged, line = getLine(cm.doc, lineN);\n    while (merged = collapsedSpanAtEnd(line)) {\n      line = merged.find(1, true).line;\n      lineN = null;\n    }\n    var order = getOrder(line);\n    var ch = !order ? line.text.length : order[0].level % 2 ? lineLeft(line) : lineRight(line);\n    return Pos(lineN == null ? lineNo(line) : lineN, ch);\n  }\n  function lineStartSmart(cm, pos) {\n    var start = lineStart(cm, pos.line);\n    var line = getLine(cm.doc, start.line);\n    var order = getOrder(line);\n    if (!order || order[0].level == 0) {\n      var firstNonWS = Math.max(0, line.text.search(/\\S/));\n      var inWS = pos.line == start.line && pos.ch <= firstNonWS && pos.ch;\n      return Pos(start.line, inWS ? 0 : firstNonWS);\n    }\n    return start;\n  }\n\n  function compareBidiLevel(order, a, b) {\n    var linedir = order[0].level;\n    if (a == linedir) return true;\n    if (b == linedir) return false;\n    return a < b;\n  }\n  var bidiOther;\n  function getBidiPartAt(order, pos) {\n    bidiOther = null;\n    for (var i = 0, found; i < order.length; ++i) {\n      var cur = order[i];\n      if (cur.from < pos && cur.to > pos) return i;\n      if ((cur.from == pos || cur.to == pos)) {\n        if (found == null) {\n          found = i;\n        } else if (compareBidiLevel(order, cur.level, order[found].level)) {\n          if (cur.from != cur.to) bidiOther = found;\n          return i;\n        } else {\n          if (cur.from != cur.to) bidiOther = i;\n          return found;\n        }\n      }\n    }\n    return found;\n  }\n\n  function moveInLine(line, pos, dir, byUnit) {\n    if (!byUnit) return pos + dir;\n    do pos += dir;\n    while (pos > 0 && isExtendingChar(line.text.charAt(pos)));\n    return pos;\n  }\n\n  // This is needed in order to move 'visually' through bi-directional\n  // text -- i.e., pressing left should make the cursor go left, even\n  // when in RTL text. The tricky part is the 'jumps', where RTL and\n  // LTR text touch each other. This often requires the cursor offset\n  // to move more than one unit, in order to visually move one unit.\n  function moveVisually(line, start, dir, byUnit) {\n    var bidi = getOrder(line);\n    if (!bidi) return moveLogically(line, start, dir, byUnit);\n    var pos = getBidiPartAt(bidi, start), part = bidi[pos];\n    var target = moveInLine(line, start, part.level % 2 ? -dir : dir, byUnit);\n\n    for (;;) {\n      if (target > part.from && target < part.to) return target;\n      if (target == part.from || target == part.to) {\n        if (getBidiPartAt(bidi, target) == pos) return target;\n        part = bidi[pos += dir];\n        return (dir > 0) == part.level % 2 ? part.to : part.from;\n      } else {\n        part = bidi[pos += dir];\n        if (!part) return null;\n        if ((dir > 0) == part.level % 2)\n          target = moveInLine(line, part.to, -1, byUnit);\n        else\n          target = moveInLine(line, part.from, 1, byUnit);\n      }\n    }\n  }\n\n  function moveLogically(line, start, dir, byUnit) {\n    var target = start + dir;\n    if (byUnit) while (target > 0 && isExtendingChar(line.text.charAt(target))) target += dir;\n    return target < 0 || target > line.text.length ? null : target;\n  }\n\n  // Bidirectional ordering algorithm\n  // See http://unicode.org/reports/tr9/tr9-13.html for the algorithm\n  // that this (partially) implements.\n\n  // One-char codes used for character types:\n  // L (L):   Left-to-Right\n  // R (R):   Right-to-Left\n  // r (AL):  Right-to-Left Arabic\n  // 1 (EN):  European Number\n  // + (ES):  European Number Separator\n  // % (ET):  European Number Terminator\n  // n (AN):  Arabic Number\n  // , (CS):  Common Number Separator\n  // m (NSM): Non-Spacing Mark\n  // b (BN):  Boundary Neutral\n  // s (B):   Paragraph Separator\n  // t (S):   Segment Separator\n  // w (WS):  Whitespace\n  // N (ON):  Other Neutrals\n\n  // Returns null if characters are ordered as they appear\n  // (left-to-right), or an array of sections ({from, to, level}\n  // objects) in the order in which they occur visually.\n  var bidiOrdering = (function() {\n    // Character types for codepoints 0 to 0xff\n    var lowTypes = \"bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN\";\n    // Character types for codepoints 0x600 to 0x6ff\n    var arabicTypes = \"rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmm\";\n    function charType(code) {\n      if (code <= 0xf7) return lowTypes.charAt(code);\n      else if (0x590 <= code && code <= 0x5f4) return \"R\";\n      else if (0x600 <= code && code <= 0x6ed) return arabicTypes.charAt(code - 0x600);\n      else if (0x6ee <= code && code <= 0x8ac) return \"r\";\n      else if (0x2000 <= code && code <= 0x200b) return \"w\";\n      else if (code == 0x200c) return \"b\";\n      else return \"L\";\n    }\n\n    var bidiRE = /[\\u0590-\\u05f4\\u0600-\\u06ff\\u0700-\\u08ac]/;\n    var isNeutral = /[stwN]/, isStrong = /[LRr]/, countsAsLeft = /[Lb1n]/, countsAsNum = /[1n]/;\n    // Browsers seem to always treat the boundaries of block elements as being L.\n    var outerType = \"L\";\n\n    function BidiSpan(level, from, to) {\n      this.level = level;\n      this.from = from; this.to = to;\n    }\n\n    return function(str) {\n      if (!bidiRE.test(str)) return false;\n      var len = str.length, types = [];\n      for (var i = 0, type; i < len; ++i)\n        types.push(type = charType(str.charCodeAt(i)));\n\n      // W1. Examine each non-spacing mark (NSM) in the level run, and\n      // change the type of the NSM to the type of the previous\n      // character. If the NSM is at the start of the level run, it will\n      // get the type of sor.\n      for (var i = 0, prev = outerType; i < len; ++i) {\n        var type = types[i];\n        if (type == \"m\") types[i] = prev;\n        else prev = type;\n      }\n\n      // W2. Search backwards from each instance of a European number\n      // until the first strong type (R, L, AL, or sor) is found. If an\n      // AL is found, change the type of the European number to Arabic\n      // number.\n      // W3. Change all ALs to R.\n      for (var i = 0, cur = outerType; i < len; ++i) {\n        var type = types[i];\n        if (type == \"1\" && cur == \"r\") types[i] = \"n\";\n        else if (isStrong.test(type)) { cur = type; if (type == \"r\") types[i] = \"R\"; }\n      }\n\n      // W4. A single European separator between two European numbers\n      // changes to a European number. A single common separator between\n      // two numbers of the same type changes to that type.\n      for (var i = 1, prev = types[0]; i < len - 1; ++i) {\n        var type = types[i];\n        if (type == \"+\" && prev == \"1\" && types[i+1] == \"1\") types[i] = \"1\";\n        else if (type == \",\" && prev == types[i+1] &&\n                 (prev == \"1\" || prev == \"n\")) types[i] = prev;\n        prev = type;\n      }\n\n      // W5. A sequence of European terminators adjacent to European\n      // numbers changes to all European numbers.\n      // W6. Otherwise, separators and terminators change to Other\n      // Neutral.\n      for (var i = 0; i < len; ++i) {\n        var type = types[i];\n        if (type == \",\") types[i] = \"N\";\n        else if (type == \"%\") {\n          for (var end = i + 1; end < len && types[end] == \"%\"; ++end) {}\n          var replace = (i && types[i-1] == \"!\") || (end < len && types[end] == \"1\") ? \"1\" : \"N\";\n          for (var j = i; j < end; ++j) types[j] = replace;\n          i = end - 1;\n        }\n      }\n\n      // W7. Search backwards from each instance of a European number\n      // until the first strong type (R, L, or sor) is found. If an L is\n      // found, then change the type of the European number to L.\n      for (var i = 0, cur = outerType; i < len; ++i) {\n        var type = types[i];\n        if (cur == \"L\" && type == \"1\") types[i] = \"L\";\n        else if (isStrong.test(type)) cur = type;\n      }\n\n      // N1. A sequence of neutrals takes the direction of the\n      // surrounding strong text if the text on both sides has the same\n      // direction. European and Arabic numbers act as if they were R in\n      // terms of their influence on neutrals. Start-of-level-run (sor)\n      // and end-of-level-run (eor) are used at level run boundaries.\n      // N2. Any remaining neutrals take the embedding direction.\n      for (var i = 0; i < len; ++i) {\n        if (isNeutral.test(types[i])) {\n          for (var end = i + 1; end < len && isNeutral.test(types[end]); ++end) {}\n          var before = (i ? types[i-1] : outerType) == \"L\";\n          var after = (end < len ? types[end] : outerType) == \"L\";\n          var replace = before || after ? \"L\" : \"R\";\n          for (var j = i; j < end; ++j) types[j] = replace;\n          i = end - 1;\n        }\n      }\n\n      // Here we depart from the documented algorithm, in order to avoid\n      // building up an actual levels array. Since there are only three\n      // levels (0, 1, 2) in an implementation that doesn't take\n      // explicit embedding into account, we can build up the order on\n      // the fly, without following the level-based algorithm.\n      var order = [], m;\n      for (var i = 0; i < len;) {\n        if (countsAsLeft.test(types[i])) {\n          var start = i;\n          for (++i; i < len && countsAsLeft.test(types[i]); ++i) {}\n          order.push(new BidiSpan(0, start, i));\n        } else {\n          var pos = i, at = order.length;\n          for (++i; i < len && types[i] != \"L\"; ++i) {}\n          for (var j = pos; j < i;) {\n            if (countsAsNum.test(types[j])) {\n              if (pos < j) order.splice(at, 0, new BidiSpan(1, pos, j));\n              var nstart = j;\n              for (++j; j < i && countsAsNum.test(types[j]); ++j) {}\n              order.splice(at, 0, new BidiSpan(2, nstart, j));\n              pos = j;\n            } else ++j;\n          }\n          if (pos < i) order.splice(at, 0, new BidiSpan(1, pos, i));\n        }\n      }\n      if (order[0].level == 1 && (m = str.match(/^\\s+/))) {\n        order[0].from = m[0].length;\n        order.unshift(new BidiSpan(0, 0, m[0].length));\n      }\n      if (lst(order).level == 1 && (m = str.match(/\\s+$/))) {\n        lst(order).to -= m[0].length;\n        order.push(new BidiSpan(0, len - m[0].length, len));\n      }\n      if (order[0].level != lst(order).level)\n        order.push(new BidiSpan(order[0].level, len, len));\n\n      return order;\n    };\n  })();\n\n  // THE END\n\n  CodeMirror.version = \"4.8.0\";\n\n  return CodeMirror;\n});\n\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: http://codemirror.net/LICENSE\n\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    mod(require(\"../../lib/codemirror\"));\n  else if (typeof define == \"function\" && define.amd) // AMD\n    define([\"../../lib/codemirror\"], mod);\n  else // Plain browser env\n    mod(CodeMirror);\n})(function(CodeMirror) {\n  var ie_lt8 = /MSIE \\d/.test(navigator.userAgent) &&\n    (document.documentMode == null || document.documentMode < 8);\n\n  var Pos = CodeMirror.Pos;\n\n  var matching = {\"(\": \")>\", \")\": \"(<\", \"[\": \"]>\", \"]\": \"[<\", \"{\": \"}>\", \"}\": \"{<\"};\n\n  function findMatchingBracket(cm, where, strict, config) {\n    var line = cm.getLineHandle(where.line), pos = where.ch - 1;\n    var match = (pos >= 0 && matching[line.text.charAt(pos)]) || matching[line.text.charAt(++pos)];\n    if (!match) return null;\n    var dir = match.charAt(1) == \">\" ? 1 : -1;\n    if (strict && (dir > 0) != (pos == where.ch)) return null;\n    var style = cm.getTokenTypeAt(Pos(where.line, pos + 1));\n\n    var found = scanForBracket(cm, Pos(where.line, pos + (dir > 0 ? 1 : 0)), dir, style || null, config);\n    if (found == null) return null;\n    return {from: Pos(where.line, pos), to: found && found.pos,\n            match: found && found.ch == match.charAt(0), forward: dir > 0};\n  }\n\n  // bracketRegex is used to specify which type of bracket to scan\n  // should be a regexp, e.g. /[[\\]]/\n  //\n  // Note: If \"where\" is on an open bracket, then this bracket is ignored.\n  //\n  // Returns false when no bracket was found, null when it reached\n  // maxScanLines and gave up\n  function scanForBracket(cm, where, dir, style, config) {\n    var maxScanLen = (config && config.maxScanLineLength) || 10000;\n    var maxScanLines = (config && config.maxScanLines) || 1000;\n\n    var stack = [];\n    var re = config && config.bracketRegex ? config.bracketRegex : /[(){}[\\]]/;\n    var lineEnd = dir > 0 ? Math.min(where.line + maxScanLines, cm.lastLine() + 1)\n                          : Math.max(cm.firstLine() - 1, where.line - maxScanLines);\n    for (var lineNo = where.line; lineNo != lineEnd; lineNo += dir) {\n      var line = cm.getLine(lineNo);\n      if (!line) continue;\n      var pos = dir > 0 ? 0 : line.length - 1, end = dir > 0 ? line.length : -1;\n      if (line.length > maxScanLen) continue;\n      if (lineNo == where.line) pos = where.ch - (dir < 0 ? 1 : 0);\n      for (; pos != end; pos += dir) {\n        var ch = line.charAt(pos);\n        if (re.test(ch) && (style === undefined || cm.getTokenTypeAt(Pos(lineNo, pos + 1)) == style)) {\n          var match = matching[ch];\n          if ((match.charAt(1) == \">\") == (dir > 0)) stack.push(ch);\n          else if (!stack.length) return {pos: Pos(lineNo, pos), ch: ch};\n          else stack.pop();\n        }\n      }\n    }\n    return lineNo - dir == (dir > 0 ? cm.lastLine() : cm.firstLine()) ? false : null;\n  }\n\n  function matchBrackets(cm, autoclear, config) {\n    // Disable brace matching in long lines, since it'll cause hugely slow updates\n    var maxHighlightLen = cm.state.matchBrackets.maxHighlightLineLength || 1000;\n    var marks = [], ranges = cm.listSelections();\n    for (var i = 0; i < ranges.length; i++) {\n      var match = ranges[i].empty() && findMatchingBracket(cm, ranges[i].head, false, config);\n      if (match && cm.getLine(match.from.line).length <= maxHighlightLen) {\n        var style = match.match ? \"CodeMirror-matchingbracket\" : \"CodeMirror-nonmatchingbracket\";\n        marks.push(cm.markText(match.from, Pos(match.from.line, match.from.ch + 1), {className: style}));\n        if (match.to && cm.getLine(match.to.line).length <= maxHighlightLen)\n          marks.push(cm.markText(match.to, Pos(match.to.line, match.to.ch + 1), {className: style}));\n      }\n    }\n\n    if (marks.length) {\n      // Kludge to work around the IE bug from issue #1193, where text\n      // input stops going to the textare whever this fires.\n      if (ie_lt8 && cm.state.focused) cm.display.input.focus();\n\n      var clear = function() {\n        cm.operation(function() {\n          for (var i = 0; i < marks.length; i++) marks[i].clear();\n        });\n      };\n      if (autoclear) setTimeout(clear, 800);\n      else return clear;\n    }\n  }\n\n  var currentlyHighlighted = null;\n  function doMatchBrackets(cm) {\n    cm.operation(function() {\n      if (currentlyHighlighted) {currentlyHighlighted(); currentlyHighlighted = null;}\n      currentlyHighlighted = matchBrackets(cm, false, cm.state.matchBrackets);\n    });\n  }\n\n  CodeMirror.defineOption(\"matchBrackets\", false, function(cm, val, old) {\n    if (old && old != CodeMirror.Init)\n      cm.off(\"cursorActivity\", doMatchBrackets);\n    if (val) {\n      cm.state.matchBrackets = typeof val == \"object\" ? val : {};\n      cm.on(\"cursorActivity\", doMatchBrackets);\n    }\n  });\n\n  CodeMirror.defineExtension(\"matchBrackets\", function() {matchBrackets(this, true);});\n  CodeMirror.defineExtension(\"findMatchingBracket\", function(pos, strict, config){\n    return findMatchingBracket(this, pos, strict, config);\n  });\n  CodeMirror.defineExtension(\"scanForBracket\", function(pos, dir, style, config){\n    return scanForBracket(this, pos, dir, style, config);\n  });\n});\n\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: http://codemirror.net/LICENSE\n\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    mod(require(\"../../lib/codemirror\"));\n  else if (typeof define == \"function\" && define.amd) // AMD\n    define([\"../../lib/codemirror\"], mod);\n  else // Plain browser env\n    mod(CodeMirror);\n})(function(CodeMirror) {\n  \"use strict\";\n\n  function doFold(cm, pos, options, force) {\n    if (options && options.call) {\n      var finder = options;\n      options = null;\n    } else {\n      var finder = getOption(cm, options, \"rangeFinder\");\n    }\n    if (typeof pos == \"number\") pos = CodeMirror.Pos(pos, 0);\n    var minSize = getOption(cm, options, \"minFoldSize\");\n\n    function getRange(allowFolded) {\n      var range = finder(cm, pos);\n      if (!range || range.to.line - range.from.line < minSize) return null;\n      var marks = cm.findMarksAt(range.from);\n      for (var i = 0; i < marks.length; ++i) {\n        if (marks[i].__isFold && force !== \"fold\") {\n          if (!allowFolded) return null;\n          range.cleared = true;\n          marks[i].clear();\n        }\n      }\n      return range;\n    }\n\n    var range = getRange(true);\n    if (getOption(cm, options, \"scanUp\")) while (!range && pos.line > cm.firstLine()) {\n      pos = CodeMirror.Pos(pos.line - 1, 0);\n      range = getRange(false);\n    }\n    if (!range || range.cleared || force === \"unfold\") return;\n\n    var myWidget = makeWidget(cm, options);\n    CodeMirror.on(myWidget, \"mousedown\", function(e) {\n      myRange.clear();\n      CodeMirror.e_preventDefault(e);\n    });\n    var myRange = cm.markText(range.from, range.to, {\n      replacedWith: myWidget,\n      clearOnEnter: true,\n      __isFold: true\n    });\n    myRange.on(\"clear\", function(from, to) {\n      CodeMirror.signal(cm, \"unfold\", cm, from, to);\n    });\n    CodeMirror.signal(cm, \"fold\", cm, range.from, range.to);\n  }\n\n  function makeWidget(cm, options) {\n    var widget = getOption(cm, options, \"widget\");\n    if (typeof widget == \"string\") {\n      var text = document.createTextNode(widget);\n      widget = document.createElement(\"span\");\n      widget.appendChild(text);\n      widget.className = \"CodeMirror-foldmarker\";\n    }\n    return widget;\n  }\n\n  // Clumsy backwards-compatible interface\n  CodeMirror.newFoldFunction = function(rangeFinder, widget) {\n    return function(cm, pos) { doFold(cm, pos, {rangeFinder: rangeFinder, widget: widget}); };\n  };\n\n  // New-style interface\n  CodeMirror.defineExtension(\"foldCode\", function(pos, options, force) {\n    doFold(this, pos, options, force);\n  });\n\n  CodeMirror.defineExtension(\"isFolded\", function(pos) {\n    var marks = this.findMarksAt(pos);\n    for (var i = 0; i < marks.length; ++i)\n      if (marks[i].__isFold) return true;\n  });\n\n  CodeMirror.commands.toggleFold = function(cm) {\n    cm.foldCode(cm.getCursor());\n  };\n  CodeMirror.commands.fold = function(cm) {\n    cm.foldCode(cm.getCursor(), null, \"fold\");\n  };\n  CodeMirror.commands.unfold = function(cm) {\n    cm.foldCode(cm.getCursor(), null, \"unfold\");\n  };\n  CodeMirror.commands.foldAll = function(cm) {\n    cm.operation(function() {\n      for (var i = cm.firstLine(), e = cm.lastLine(); i <= e; i++)\n        cm.foldCode(CodeMirror.Pos(i, 0), null, \"fold\");\n    });\n  };\n  CodeMirror.commands.unfoldAll = function(cm) {\n    cm.operation(function() {\n      for (var i = cm.firstLine(), e = cm.lastLine(); i <= e; i++)\n        cm.foldCode(CodeMirror.Pos(i, 0), null, \"unfold\");\n    });\n  };\n\n  CodeMirror.registerHelper(\"fold\", \"combine\", function() {\n    var funcs = Array.prototype.slice.call(arguments, 0);\n    return function(cm, start) {\n      for (var i = 0; i < funcs.length; ++i) {\n        var found = funcs[i](cm, start);\n        if (found) return found;\n      }\n    };\n  });\n\n  CodeMirror.registerHelper(\"fold\", \"auto\", function(cm, start) {\n    var helpers = cm.getHelpers(start, \"fold\");\n    for (var i = 0; i < helpers.length; i++) {\n      var cur = helpers[i](cm, start);\n      if (cur) return cur;\n    }\n  });\n\n  var defaultOptions = {\n    rangeFinder: CodeMirror.fold.auto,\n    widget: \"\\u2194\",\n    minFoldSize: 0,\n    scanUp: false\n  };\n\n  CodeMirror.defineOption(\"foldOptions\", null);\n\n  function getOption(cm, options, name) {\n    if (options && options[name] !== undefined)\n      return options[name];\n    var editorOptions = cm.options.foldOptions;\n    if (editorOptions && editorOptions[name] !== undefined)\n      return editorOptions[name];\n    return defaultOptions[name];\n  }\n});\n\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: http://codemirror.net/LICENSE\n\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    mod(require(\"../../lib/codemirror\"), require(\"./foldcode\"));\n  else if (typeof define == \"function\" && define.amd) // AMD\n    define([\"../../lib/codemirror\", \"./foldcode\"], mod);\n  else // Plain browser env\n    mod(CodeMirror);\n})(function(CodeMirror) {\n  \"use strict\";\n\n  CodeMirror.defineOption(\"foldGutter\", false, function(cm, val, old) {\n    if (old && old != CodeMirror.Init) {\n      cm.clearGutter(cm.state.foldGutter.options.gutter);\n      cm.state.foldGutter = null;\n      cm.off(\"gutterClick\", onGutterClick);\n      cm.off(\"change\", onChange);\n      cm.off(\"viewportChange\", onViewportChange);\n      cm.off(\"fold\", onFold);\n      cm.off(\"unfold\", onFold);\n      cm.off(\"swapDoc\", updateInViewport);\n    }\n    if (val) {\n      cm.state.foldGutter = new State(parseOptions(val));\n      updateInViewport(cm);\n      cm.on(\"gutterClick\", onGutterClick);\n      cm.on(\"change\", onChange);\n      cm.on(\"viewportChange\", onViewportChange);\n      cm.on(\"fold\", onFold);\n      cm.on(\"unfold\", onFold);\n      cm.on(\"swapDoc\", updateInViewport);\n    }\n  });\n\n  var Pos = CodeMirror.Pos;\n\n  function State(options) {\n    this.options = options;\n    this.from = this.to = 0;\n  }\n\n  function parseOptions(opts) {\n    if (opts === true) opts = {};\n    if (opts.gutter == null) opts.gutter = \"CodeMirror-foldgutter\";\n    if (opts.indicatorOpen == null) opts.indicatorOpen = \"CodeMirror-foldgutter-open\";\n    if (opts.indicatorFolded == null) opts.indicatorFolded = \"CodeMirror-foldgutter-folded\";\n    return opts;\n  }\n\n  function isFolded(cm, line) {\n    var marks = cm.findMarksAt(Pos(line));\n    for (var i = 0; i < marks.length; ++i)\n      if (marks[i].__isFold && marks[i].find().from.line == line) return true;\n  }\n\n  function marker(spec) {\n    if (typeof spec == \"string\") {\n      var elt = document.createElement(\"div\");\n      elt.className = spec + \" CodeMirror-guttermarker-subtle\";\n      return elt;\n    } else {\n      return spec.cloneNode(true);\n    }\n  }\n\n  function updateFoldInfo(cm, from, to) {\n    var opts = cm.state.foldGutter.options, cur = from;\n    cm.eachLine(from, to, function(line) {\n      var mark = null;\n      if (isFolded(cm, cur)) {\n        mark = marker(opts.indicatorFolded);\n      } else {\n        var pos = Pos(cur, 0), func = opts.rangeFinder || CodeMirror.fold.auto;\n        var range = func && func(cm, pos);\n        if (range && range.from.line + 1 < range.to.line)\n          mark = marker(opts.indicatorOpen);\n      }\n      cm.setGutterMarker(line, opts.gutter, mark);\n      ++cur;\n    });\n  }\n\n  function updateInViewport(cm) {\n    var vp = cm.getViewport(), state = cm.state.foldGutter;\n    if (!state) return;\n    cm.operation(function() {\n      updateFoldInfo(cm, vp.from, vp.to);\n    });\n    state.from = vp.from; state.to = vp.to;\n  }\n\n  function onGutterClick(cm, line, gutter) {\n    var opts = cm.state.foldGutter.options;\n    if (gutter != opts.gutter) return;\n    cm.foldCode(Pos(line, 0), opts.rangeFinder);\n  }\n\n  function onChange(cm) {\n    var state = cm.state.foldGutter, opts = cm.state.foldGutter.options;\n    state.from = state.to = 0;\n    clearTimeout(state.changeUpdate);\n    state.changeUpdate = setTimeout(function() { updateInViewport(cm); }, opts.foldOnChangeTimeSpan || 600);\n  }\n\n  function onViewportChange(cm) {\n    var state = cm.state.foldGutter, opts = cm.state.foldGutter.options;\n    clearTimeout(state.changeUpdate);\n    state.changeUpdate = setTimeout(function() {\n      var vp = cm.getViewport();\n      if (state.from == state.to || vp.from - state.to > 20 || state.from - vp.to > 20) {\n        updateInViewport(cm);\n      } else {\n        cm.operation(function() {\n          if (vp.from < state.from) {\n            updateFoldInfo(cm, vp.from, state.from);\n            state.from = vp.from;\n          }\n          if (vp.to > state.to) {\n            updateFoldInfo(cm, state.to, vp.to);\n            state.to = vp.to;\n          }\n        });\n      }\n    }, opts.updateViewportTimeSpan || 400);\n  }\n\n  function onFold(cm, from) {\n    var state = cm.state.foldGutter, line = from.line;\n    if (line >= state.from && line < state.to)\n      updateFoldInfo(cm, line, line + 1);\n  }\n});\n\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: http://codemirror.net/LICENSE\n\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    mod(require(\"../../lib/codemirror\"));\n  else if (typeof define == \"function\" && define.amd) // AMD\n    define([\"../../lib/codemirror\"], mod);\n  else // Plain browser env\n    mod(CodeMirror);\n})(function(CodeMirror) {\n\"use strict\";\n\nCodeMirror.registerHelper(\"fold\", \"brace\", function(cm, start) {\n  var line = start.line, lineText = cm.getLine(line);\n  var startCh, tokenType;\n\n  function findOpening(openCh) {\n    for (var at = start.ch, pass = 0;;) {\n      var found = at <= 0 ? -1 : lineText.lastIndexOf(openCh, at - 1);\n      if (found == -1) {\n        if (pass == 1) break;\n        pass = 1;\n        at = lineText.length;\n        continue;\n      }\n      if (pass == 1 && found < start.ch) break;\n      tokenType = cm.getTokenTypeAt(CodeMirror.Pos(line, found + 1));\n      if (!/^(comment|string)/.test(tokenType)) return found + 1;\n      at = found - 1;\n    }\n  }\n\n  var startToken = \"{\", endToken = \"}\", startCh = findOpening(\"{\");\n  if (startCh == null) {\n    startToken = \"[\", endToken = \"]\";\n    startCh = findOpening(\"[\");\n  }\n\n  if (startCh == null) return;\n  var count = 1, lastLine = cm.lastLine(), end, endCh;\n  outer: for (var i = line; i <= lastLine; ++i) {\n    var text = cm.getLine(i), pos = i == line ? startCh : 0;\n    for (;;) {\n      var nextOpen = text.indexOf(startToken, pos), nextClose = text.indexOf(endToken, pos);\n      if (nextOpen < 0) nextOpen = text.length;\n      if (nextClose < 0) nextClose = text.length;\n      pos = Math.min(nextOpen, nextClose);\n      if (pos == text.length) break;\n      if (cm.getTokenTypeAt(CodeMirror.Pos(i, pos + 1)) == tokenType) {\n        if (pos == nextOpen) ++count;\n        else if (!--count) { end = i; endCh = pos; break outer; }\n      }\n      ++pos;\n    }\n  }\n  if (end == null || line == end && endCh == startCh) return;\n  return {from: CodeMirror.Pos(line, startCh),\n          to: CodeMirror.Pos(end, endCh)};\n});\n\nCodeMirror.registerHelper(\"fold\", \"import\", function(cm, start) {\n  function hasImport(line) {\n    if (line < cm.firstLine() || line > cm.lastLine()) return null;\n    var start = cm.getTokenAt(CodeMirror.Pos(line, 1));\n    if (!/\\S/.test(start.string)) start = cm.getTokenAt(CodeMirror.Pos(line, start.end + 1));\n    if (start.type != \"keyword\" || start.string != \"import\") return null;\n    // Now find closing semicolon, return its position\n    for (var i = line, e = Math.min(cm.lastLine(), line + 10); i <= e; ++i) {\n      var text = cm.getLine(i), semi = text.indexOf(\";\");\n      if (semi != -1) return {startCh: start.end, end: CodeMirror.Pos(i, semi)};\n    }\n  }\n\n  var start = start.line, has = hasImport(start), prev;\n  if (!has || hasImport(start - 1) || ((prev = hasImport(start - 2)) && prev.end.line == start - 1))\n    return null;\n  for (var end = has.end;;) {\n    var next = hasImport(end.line + 1);\n    if (next == null) break;\n    end = next.end;\n  }\n  return {from: cm.clipPos(CodeMirror.Pos(start, has.startCh + 1)), to: end};\n});\n\nCodeMirror.registerHelper(\"fold\", \"include\", function(cm, start) {\n  function hasInclude(line) {\n    if (line < cm.firstLine() || line > cm.lastLine()) return null;\n    var start = cm.getTokenAt(CodeMirror.Pos(line, 1));\n    if (!/\\S/.test(start.string)) start = cm.getTokenAt(CodeMirror.Pos(line, start.end + 1));\n    if (start.type == \"meta\" && start.string.slice(0, 8) == \"#include\") return start.start + 8;\n  }\n\n  var start = start.line, has = hasInclude(start);\n  if (has == null || hasInclude(start - 1) != null) return null;\n  for (var end = start;;) {\n    var next = hasInclude(end + 1);\n    if (next == null) break;\n    ++end;\n  }\n  return {from: CodeMirror.Pos(start, has + 1),\n          to: cm.clipPos(CodeMirror.Pos(end))};\n});\n\n});\n\n// Spectrum Colorpicker v1.7.0\n// https://github.com/bgrins/spectrum\n// Author: Brian Grinstead\n// License: MIT\n\n(function (factory) {\n    \"use strict\";\n\n    if (typeof define === 'function' && define.amd) { // AMD\n        define(['jquery'], factory);\n    }\n    else if (typeof exports == \"object\" && typeof module == \"object\") { // CommonJS\n        module.exports = factory;\n    }\n    else { // Browser\n        factory(jQuery);\n    }\n})(function($, undefined) {\n    \"use strict\";\n\n    var defaultOpts = {\n\n        // Callbacks\n        beforeShow: noop,\n        move: noop,\n        change: noop,\n        show: noop,\n        hide: noop,\n\n        // Options\n        color: false,\n        flat: false,\n        showInput: false,\n        allowEmpty: false,\n        showButtons: true,\n        clickoutFiresChange: true,\n        showInitial: false,\n        showPalette: false,\n        showPaletteOnly: false,\n        hideAfterPaletteSelect: false,\n        togglePaletteOnly: false,\n        showSelectionPalette: true,\n        localStorageKey: false,\n        appendTo: \"body\",\n        maxSelectionSize: 7,\n        cancelText: \"cancel\",\n        chooseText: \"choose\",\n        togglePaletteMoreText: \"more\",\n        togglePaletteLessText: \"less\",\n        clearText: \"Clear Color Selection\",\n        noColorSelectedText: \"No Color Selected\",\n        preferredFormat: false,\n        className: \"\", // Deprecated - use containerClassName and replacerClassName instead.\n        containerClassName: \"\",\n        replacerClassName: \"\",\n        showAlpha: false,\n        theme: \"sp-light\",\n        palette: [[\"#ffffff\", \"#000000\", \"#ff0000\", \"#ff8000\", \"#ffff00\", \"#008000\", \"#0000ff\", \"#4b0082\", \"#9400d3\"]],\n        selectionPalette: [],\n        disabled: false,\n        offset: null\n    },\n    spectrums = [],\n    IE = !!/msie/i.exec( window.navigator.userAgent ),\n    rgbaSupport = (function() {\n        function contains( str, substr ) {\n            return !!~('' + str).indexOf(substr);\n        }\n\n        var elem = document.createElement('div');\n        var style = elem.style;\n        style.cssText = 'background-color:rgba(0,0,0,.5)';\n        return contains(style.backgroundColor, 'rgba') || contains(style.backgroundColor, 'hsla');\n    })(),\n    replaceInput = [\n        \"<div class='sp-replacer'>\",\n            \"<div class='sp-preview'><div class='sp-preview-inner'></div></div>\",\n            \"<div class='sp-dd'>&#9660;</div>\",\n        \"</div>\"\n    ].join(''),\n    markup = (function () {\n\n        // IE does not support gradients with multiple stops, so we need to simulate\n        //  that for the rainbow slider with 8 divs that each have a single gradient\n        var gradientFix = \"\";\n        if (IE) {\n            for (var i = 1; i <= 6; i++) {\n                gradientFix += \"<div class='sp-\" + i + \"'></div>\";\n            }\n        }\n\n        return [\n            \"<div class='sp-container sp-hidden'>\",\n                \"<div class='sp-palette-container'>\",\n                    \"<div class='sp-palette sp-thumb sp-cf'></div>\",\n                    \"<div class='sp-palette-button-container sp-cf'>\",\n                        \"<button type='button' class='sp-palette-toggle'></button>\",\n                    \"</div>\",\n                \"</div>\",\n                \"<div class='sp-picker-container'>\",\n                    \"<div class='sp-top sp-cf'>\",\n                        \"<div class='sp-fill'></div>\",\n                        \"<div class='sp-top-inner'>\",\n                            \"<div class='sp-color'>\",\n                                \"<div class='sp-sat'>\",\n                                    \"<div class='sp-val'>\",\n                                        \"<div class='sp-dragger'></div>\",\n                                    \"</div>\",\n                                \"</div>\",\n                            \"</div>\",\n                            \"<div class='sp-clear sp-clear-display'>\",\n                            \"</div>\",\n                            \"<div class='sp-hue'>\",\n                                \"<div class='sp-slider'></div>\",\n                                gradientFix,\n                            \"</div>\",\n                        \"</div>\",\n                        \"<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>\",\n                    \"</div>\",\n                    \"<div class='sp-input-container sp-cf'>\",\n                        \"<input class='sp-input' type='text' spellcheck='false'  />\",\n                    \"</div>\",\n                    \"<div class='sp-initial sp-thumb sp-cf'></div>\",\n                    \"<div class='sp-button-container sp-cf'>\",\n                        \"<a class='sp-cancel' href='#'></a>\",\n                        \"<button type='button' class='sp-choose'></button>\",\n                    \"</div>\",\n                \"</div>\",\n            \"</div>\"\n        ].join(\"\");\n    })();\n\n    function paletteTemplate (p, color, className, opts) {\n        var html = [];\n        for (var i = 0; i < p.length; i++) {\n            var current = p[i];\n            if(current) {\n                var tiny = tinycolor(current);\n                var c = tiny.toHsl().l < 0.5 ? \"sp-thumb-el sp-thumb-dark\" : \"sp-thumb-el sp-thumb-light\";\n                c += (tinycolor.equals(color, current)) ? \" sp-thumb-active\" : \"\";\n                var formattedString = tiny.toString(opts.preferredFormat || \"rgb\");\n                var swatchStyle = rgbaSupport ? (\"background-color:\" + tiny.toRgbString()) : \"filter:\" + tiny.toFilter();\n                html.push('<span title=\"' + formattedString + '\" data-color=\"' + tiny.toRgbString() + '\" class=\"' + c + '\"><span class=\"sp-thumb-inner\" style=\"' + swatchStyle + ';\" /></span>');\n            } else {\n                var cls = 'sp-clear-display';\n                html.push($('<div />')\n                    .append($('<span data-color=\"\" style=\"background-color:transparent;\" class=\"' + cls + '\"></span>')\n                        .attr('title', opts.noColorSelectedText)\n                    )\n                    .html()\n                );\n            }\n        }\n        return \"<div class='sp-cf \" + className + \"'>\" + html.join('') + \"</div>\";\n    }\n\n    function hideAll() {\n        for (var i = 0; i < spectrums.length; i++) {\n            if (spectrums[i]) {\n                spectrums[i].hide();\n            }\n        }\n    }\n\n    function instanceOptions(o, callbackContext) {\n        var opts = $.extend({}, defaultOpts, o);\n        opts.callbacks = {\n            'move': bind(opts.move, callbackContext),\n            'change': bind(opts.change, callbackContext),\n            'show': bind(opts.show, callbackContext),\n            'hide': bind(opts.hide, callbackContext),\n            'beforeShow': bind(opts.beforeShow, callbackContext)\n        };\n\n        return opts;\n    }\n\n    function spectrum(element, o) {\n\n        var opts = instanceOptions(o, element),\n            flat = opts.flat,\n            showSelectionPalette = opts.showSelectionPalette,\n            localStorageKey = opts.localStorageKey,\n            theme = opts.theme,\n            callbacks = opts.callbacks,\n            resize = throttle(reflow, 10),\n            visible = false,\n            isDragging = false,\n            dragWidth = 0,\n            dragHeight = 0,\n            dragHelperHeight = 0,\n            slideHeight = 0,\n            slideWidth = 0,\n            alphaWidth = 0,\n            alphaSlideHelperWidth = 0,\n            slideHelperHeight = 0,\n            currentHue = 0,\n            currentSaturation = 0,\n            currentValue = 0,\n            currentAlpha = 1,\n            palette = [],\n            paletteArray = [],\n            paletteLookup = {},\n            selectionPalette = opts.selectionPalette.slice(0),\n            maxSelectionSize = opts.maxSelectionSize,\n            draggingClass = \"sp-dragging\",\n            shiftMovementDirection = null;\n\n        var doc = element.ownerDocument,\n            body = doc.body,\n            boundElement = $(element),\n            disabled = false,\n            container = $(markup, doc).addClass(theme),\n            pickerContainer = container.find(\".sp-picker-container\"),\n            dragger = container.find(\".sp-color\"),\n            dragHelper = container.find(\".sp-dragger\"),\n            slider = container.find(\".sp-hue\"),\n            slideHelper = container.find(\".sp-slider\"),\n            alphaSliderInner = container.find(\".sp-alpha-inner\"),\n            alphaSlider = container.find(\".sp-alpha\"),\n            alphaSlideHelper = container.find(\".sp-alpha-handle\"),\n            textInput = container.find(\".sp-input\"),\n            paletteContainer = container.find(\".sp-palette\"),\n            initialColorContainer = container.find(\".sp-initial\"),\n            cancelButton = container.find(\".sp-cancel\"),\n            clearButton = container.find(\".sp-clear\"),\n            chooseButton = container.find(\".sp-choose\"),\n            toggleButton = container.find(\".sp-palette-toggle\"),\n            isInput = boundElement.is(\"input\"),\n            isInputTypeColor = isInput && boundElement.attr(\"type\") === \"color\" && inputTypeColorSupport(),\n            shouldReplace = isInput && !flat,\n            replacer = (shouldReplace) ? $(replaceInput).addClass(theme).addClass(opts.className).addClass(opts.replacerClassName) : $([]),\n            offsetElement = (shouldReplace) ? replacer : boundElement,\n            previewElement = replacer.find(\".sp-preview-inner\"),\n            initialColor = opts.color || (isInput && boundElement.val()),\n            colorOnShow = false,\n            preferredFormat = opts.preferredFormat,\n            currentPreferredFormat = preferredFormat,\n            clickoutFiresChange = !opts.showButtons || opts.clickoutFiresChange,\n            isEmpty = !initialColor,\n            allowEmpty = opts.allowEmpty && !isInputTypeColor;\n\n        function applyOptions() {\n\n            if (opts.showPaletteOnly) {\n                opts.showPalette = true;\n            }\n\n            toggleButton.text(opts.showPaletteOnly ? opts.togglePaletteMoreText : opts.togglePaletteLessText);\n\n            if (opts.palette) {\n                palette = opts.palette.slice(0);\n                paletteArray = $.isArray(palette[0]) ? palette : [palette];\n                paletteLookup = {};\n                for (var i = 0; i < paletteArray.length; i++) {\n                    for (var j = 0; j < paletteArray[i].length; j++) {\n                        var rgb = tinycolor(paletteArray[i][j]).toRgbString();\n                        paletteLookup[rgb] = true;\n                    }\n                }\n            }\n\n            container.toggleClass(\"sp-flat\", flat);\n            container.toggleClass(\"sp-input-disabled\", !opts.showInput);\n            container.toggleClass(\"sp-alpha-enabled\", opts.showAlpha);\n            container.toggleClass(\"sp-clear-enabled\", allowEmpty);\n            container.toggleClass(\"sp-buttons-disabled\", !opts.showButtons);\n            container.toggleClass(\"sp-palette-buttons-disabled\", !opts.togglePaletteOnly);\n            container.toggleClass(\"sp-palette-disabled\", !opts.showPalette);\n            container.toggleClass(\"sp-palette-only\", opts.showPaletteOnly);\n            container.toggleClass(\"sp-initial-disabled\", !opts.showInitial);\n            container.addClass(opts.className).addClass(opts.containerClassName);\n\n            reflow();\n        }\n\n        function initialize() {\n\n            if (IE) {\n                container.find(\"*:not(input)\").attr(\"unselectable\", \"on\");\n            }\n\n            applyOptions();\n\n            if (shouldReplace) {\n                boundElement.after(replacer).hide();\n            }\n\n            if (!allowEmpty) {\n                clearButton.hide();\n            }\n\n            if (flat) {\n                boundElement.after(container).hide();\n            }\n            else {\n\n                var appendTo = opts.appendTo === \"parent\" ? boundElement.parent() : $(opts.appendTo);\n                if (appendTo.length !== 1) {\n                    appendTo = $(\"body\");\n                }\n\n                appendTo.append(container);\n            }\n\n            updateSelectionPaletteFromStorage();\n\n            offsetElement.bind(\"click.spectrum touchstart.spectrum\", function (e) {\n                if (!disabled) {\n                    toggle();\n                }\n\n                e.stopPropagation();\n\n                if (!$(e.target).is(\"input\")) {\n                    e.preventDefault();\n                }\n            });\n\n            if(boundElement.is(\":disabled\") || (opts.disabled === true)) {\n                disable();\n            }\n\n            // Prevent clicks from bubbling up to document.  This would cause it to be hidden.\n            container.click(stopPropagation);\n\n            // Handle user typed input\n            textInput.change(setFromTextInput);\n            textInput.bind(\"paste\", function () {\n                setTimeout(setFromTextInput, 1);\n            });\n            textInput.keydown(function (e) { if (e.keyCode == 13) { setFromTextInput(); } });\n\n            cancelButton.text(opts.cancelText);\n            cancelButton.bind(\"click.spectrum\", function (e) {\n                e.stopPropagation();\n                e.preventDefault();\n                revert();\n                hide();\n            });\n\n            clearButton.attr(\"title\", opts.clearText);\n            clearButton.bind(\"click.spectrum\", function (e) {\n                e.stopPropagation();\n                e.preventDefault();\n                isEmpty = true;\n                move();\n\n                if(flat) {\n                    //for the flat style, this is a change event\n                    updateOriginalInput(true);\n                }\n            });\n\n            chooseButton.text(opts.chooseText);\n            chooseButton.bind(\"click.spectrum\", function (e) {\n                e.stopPropagation();\n                e.preventDefault();\n\n                if (IE && textInput.is(\":focus\")) {\n                    textInput.trigger('change');\n                }\n\n                if (isValid()) {\n                    updateOriginalInput(true);\n                    hide();\n                }\n            });\n\n            toggleButton.text(opts.showPaletteOnly ? opts.togglePaletteMoreText : opts.togglePaletteLessText);\n            toggleButton.bind(\"click.spectrum\", function (e) {\n                e.stopPropagation();\n                e.preventDefault();\n\n                opts.showPaletteOnly = !opts.showPaletteOnly;\n\n                // To make sure the Picker area is drawn on the right, next to the\n                // Palette area (and not below the palette), first move the Palette\n                // to the left to make space for the picker, plus 5px extra.\n                // The 'applyOptions' function puts the whole container back into place\n                // and takes care of the button-text and the sp-palette-only CSS class.\n                if (!opts.showPaletteOnly && !flat) {\n                    container.css('left', '-=' + (pickerContainer.outerWidth(true) + 5));\n                }\n                applyOptions();\n            });\n\n            draggable(alphaSlider, function (dragX, dragY, e) {\n                currentAlpha = (dragX / alphaWidth);\n                isEmpty = false;\n                if (e.shiftKey) {\n                    currentAlpha = Math.round(currentAlpha * 10) / 10;\n                }\n\n                move();\n            }, dragStart, dragStop);\n\n            draggable(slider, function (dragX, dragY) {\n                currentHue = parseFloat(dragY / slideHeight);\n                isEmpty = false;\n                if (!opts.showAlpha) {\n                    currentAlpha = 1;\n                }\n                move();\n            }, dragStart, dragStop);\n\n            draggable(dragger, function (dragX, dragY, e) {\n\n                // shift+drag should snap the movement to either the x or y axis.\n                if (!e.shiftKey) {\n                    shiftMovementDirection = null;\n                }\n                else if (!shiftMovementDirection) {\n                    var oldDragX = currentSaturation * dragWidth;\n                    var oldDragY = dragHeight - (currentValue * dragHeight);\n                    var furtherFromX = Math.abs(dragX - oldDragX) > Math.abs(dragY - oldDragY);\n\n                    shiftMovementDirection = furtherFromX ? \"x\" : \"y\";\n                }\n\n                var setSaturation = !shiftMovementDirection || shiftMovementDirection === \"x\";\n                var setValue = !shiftMovementDirection || shiftMovementDirection === \"y\";\n\n                if (setSaturation) {\n                    currentSaturation = parseFloat(dragX / dragWidth);\n                }\n                if (setValue) {\n                    currentValue = parseFloat((dragHeight - dragY) / dragHeight);\n                }\n\n                isEmpty = false;\n                if (!opts.showAlpha) {\n                    currentAlpha = 1;\n                }\n\n                move();\n\n            }, dragStart, dragStop);\n\n            if (!!initialColor) {\n                set(initialColor);\n\n                // In case color was black - update the preview UI and set the format\n                // since the set function will not run (default color is black).\n                updateUI();\n                currentPreferredFormat = preferredFormat || tinycolor(initialColor).format;\n\n                addColorToSelectionPalette(initialColor);\n            }\n            else {\n                updateUI();\n            }\n\n            if (flat) {\n                show();\n            }\n\n            function paletteElementClick(e) {\n                if (e.data && e.data.ignore) {\n                    set($(e.target).closest(\".sp-thumb-el\").data(\"color\"));\n                    move();\n                }\n                else {\n                    set($(e.target).closest(\".sp-thumb-el\").data(\"color\"));\n                    move();\n                    updateOriginalInput(true);\n                    if (opts.hideAfterPaletteSelect) {\n                      hide();\n                    }\n                }\n\n                return false;\n            }\n\n            var paletteEvent = IE ? \"mousedown.spectrum\" : \"click.spectrum touchstart.spectrum\";\n            paletteContainer.delegate(\".sp-thumb-el\", paletteEvent, paletteElementClick);\n            initialColorContainer.delegate(\".sp-thumb-el:nth-child(1)\", paletteEvent, { ignore: true }, paletteElementClick);\n        }\n\n        function updateSelectionPaletteFromStorage() {\n\n            if (localStorageKey && window.localStorage) {\n\n                // Migrate old palettes over to new format.  May want to remove this eventually.\n                try {\n                    var oldPalette = window.localStorage[localStorageKey].split(\",#\");\n                    if (oldPalette.length > 1) {\n                        delete window.localStorage[localStorageKey];\n                        $.each(oldPalette, function(i, c) {\n                             addColorToSelectionPalette(c);\n                        });\n                    }\n                }\n                catch(e) { }\n\n                try {\n                    selectionPalette = window.localStorage[localStorageKey].split(\";\");\n                }\n                catch (e) { }\n            }\n        }\n\n        function addColorToSelectionPalette(color) {\n            if (showSelectionPalette) {\n                var rgb = tinycolor(color).toRgbString();\n                if (!paletteLookup[rgb] && $.inArray(rgb, selectionPalette) === -1) {\n                    selectionPalette.push(rgb);\n                    while(selectionPalette.length > maxSelectionSize) {\n                        selectionPalette.shift();\n                    }\n                }\n\n                if (localStorageKey && window.localStorage) {\n                    try {\n                        window.localStorage[localStorageKey] = selectionPalette.join(\";\");\n                    }\n                    catch(e) { }\n                }\n            }\n        }\n\n        function getUniqueSelectionPalette() {\n            var unique = [];\n            if (opts.showPalette) {\n                for (var i = 0; i < selectionPalette.length; i++) {\n                    var rgb = tinycolor(selectionPalette[i]).toRgbString();\n\n                    if (!paletteLookup[rgb]) {\n                        unique.push(selectionPalette[i]);\n                    }\n                }\n            }\n\n            return unique.reverse().slice(0, opts.maxSelectionSize);\n        }\n\n        function drawPalette() {\n\n            var currentColor = get();\n\n            var html = $.map(paletteArray, function (palette, i) {\n                return paletteTemplate(palette, currentColor, \"sp-palette-row sp-palette-row-\" + i, opts);\n            });\n\n            updateSelectionPaletteFromStorage();\n\n            if (selectionPalette) {\n                html.push(paletteTemplate(getUniqueSelectionPalette(), currentColor, \"sp-palette-row sp-palette-row-selection\", opts));\n            }\n\n            paletteContainer.html(html.join(\"\"));\n        }\n\n        function drawInitial() {\n            if (opts.showInitial) {\n                var initial = colorOnShow;\n                var current = get();\n                initialColorContainer.html(paletteTemplate([initial, current], current, \"sp-palette-row-initial\", opts));\n            }\n        }\n\n        function dragStart() {\n            if (dragHeight <= 0 || dragWidth <= 0 || slideHeight <= 0) {\n                reflow();\n            }\n            isDragging = true;\n            container.addClass(draggingClass);\n            shiftMovementDirection = null;\n            boundElement.trigger('dragstart.spectrum', [ get() ]);\n        }\n\n        function dragStop() {\n            isDragging = false;\n            container.removeClass(draggingClass);\n            boundElement.trigger('dragstop.spectrum', [ get() ]);\n        }\n\n        function setFromTextInput() {\n\n            var value = textInput.val();\n\n            if ((value === null || value === \"\") && allowEmpty) {\n                set(null);\n                updateOriginalInput(true);\n            }\n            else {\n                var tiny = tinycolor(value);\n                if (tiny.isValid()) {\n                    set(tiny);\n                    updateOriginalInput(true);\n                }\n                else {\n                    textInput.addClass(\"sp-validation-error\");\n                }\n            }\n        }\n\n        function toggle() {\n            if (visible) {\n                hide();\n            }\n            else {\n                show();\n            }\n        }\n\n        function show() {\n            var event = $.Event('beforeShow.spectrum');\n\n            if (visible) {\n                reflow();\n                return;\n            }\n\n            boundElement.trigger(event, [ get() ]);\n\n            if (callbacks.beforeShow(get()) === false || event.isDefaultPrevented()) {\n                return;\n            }\n\n            hideAll();\n            visible = true;\n\n            $(doc).bind(\"keydown.spectrum\", onkeydown);\n            $(doc).bind(\"click.spectrum\", clickout);\n            $(window).bind(\"resize.spectrum\", resize);\n            replacer.addClass(\"sp-active\");\n            container.removeClass(\"sp-hidden\");\n\n            reflow();\n            updateUI();\n\n            colorOnShow = get();\n\n            drawInitial();\n            callbacks.show(colorOnShow);\n            boundElement.trigger('show.spectrum', [ colorOnShow ]);\n        }\n\n        function onkeydown(e) {\n            // Close on ESC\n            if (e.keyCode === 27) {\n                hide();\n            }\n        }\n\n        function clickout(e) {\n            // Return on right click.\n            if (e.button == 2) { return; }\n\n            // If a drag event was happening during the mouseup, don't hide\n            // on click.\n            if (isDragging) { return; }\n\n            if (clickoutFiresChange) {\n                updateOriginalInput(true);\n            }\n            else {\n                revert();\n            }\n            hide();\n        }\n\n        function hide() {\n            // Return if hiding is unnecessary\n            if (!visible || flat) { return; }\n            visible = false;\n\n            $(doc).unbind(\"keydown.spectrum\", onkeydown);\n            $(doc).unbind(\"click.spectrum\", clickout);\n            $(window).unbind(\"resize.spectrum\", resize);\n\n            replacer.removeClass(\"sp-active\");\n            container.addClass(\"sp-hidden\");\n\n            callbacks.hide(get());\n            boundElement.trigger('hide.spectrum', [ get() ]);\n        }\n\n        function revert() {\n            set(colorOnShow, true);\n        }\n\n        function set(color, ignoreFormatChange) {\n            if (tinycolor.equals(color, get())) {\n                // Update UI just in case a validation error needs\n                // to be cleared.\n                updateUI();\n                return;\n            }\n\n            var newColor, newHsv;\n            if (!color && allowEmpty) {\n                isEmpty = true;\n            } else {\n                isEmpty = false;\n                newColor = tinycolor(color);\n                newHsv = newColor.toHsv();\n\n                currentHue = (newHsv.h % 360) / 360;\n                currentSaturation = newHsv.s;\n                currentValue = newHsv.v;\n                currentAlpha = newHsv.a;\n            }\n            updateUI();\n\n            if (newColor && newColor.isValid() && !ignoreFormatChange) {\n                currentPreferredFormat = preferredFormat || newColor.getFormat();\n            }\n        }\n\n        function get(opts) {\n            opts = opts || { };\n\n            if (allowEmpty && isEmpty) {\n                return null;\n            }\n\n            return tinycolor.fromRatio({\n                h: currentHue,\n                s: currentSaturation,\n                v: currentValue,\n                a: Math.round(currentAlpha * 100) / 100\n            }, { format: opts.format || currentPreferredFormat });\n        }\n\n        function isValid() {\n            return !textInput.hasClass(\"sp-validation-error\");\n        }\n\n        function move() {\n            updateUI();\n\n            callbacks.move(get());\n            boundElement.trigger('move.spectrum', [ get() ]);\n        }\n\n        function updateUI() {\n\n            textInput.removeClass(\"sp-validation-error\");\n\n            updateHelperLocations();\n\n            // Update dragger background color (gradients take care of saturation and value).\n            var flatColor = tinycolor.fromRatio({ h: currentHue, s: 1, v: 1 });\n            dragger.css(\"background-color\", flatColor.toHexString());\n\n            // Get a format that alpha will be included in (hex and names ignore alpha)\n            var format = currentPreferredFormat;\n            if (currentAlpha < 1 && !(currentAlpha === 0 && format === \"name\")) {\n                if (format === \"hex\" || format === \"hex3\" || format === \"hex6\" || format === \"name\") {\n                    format = \"rgb\";\n                }\n            }\n\n            var realColor = get({ format: format }),\n                displayColor = '';\n\n             //reset background info for preview element\n            previewElement.removeClass(\"sp-clear-display\");\n            previewElement.css('background-color', 'transparent');\n\n            if (!realColor && allowEmpty) {\n                // Update the replaced elements background with icon indicating no color selection\n                previewElement.addClass(\"sp-clear-display\");\n            }\n            else {\n                var realHex = realColor.toHexString(),\n                    realRgb = realColor.toRgbString();\n\n                // Update the replaced elements background color (with actual selected color)\n                if (rgbaSupport || realColor.alpha === 1) {\n                    previewElement.css(\"background-color\", realRgb);\n                }\n                else {\n                    previewElement.css(\"background-color\", \"transparent\");\n                    previewElement.css(\"filter\", realColor.toFilter());\n                }\n\n                if (opts.showAlpha) {\n                    var rgb = realColor.toRgb();\n                    rgb.a = 0;\n                    var realAlpha = tinycolor(rgb).toRgbString();\n                    var gradient = \"linear-gradient(left, \" + realAlpha + \", \" + realHex + \")\";\n\n                    if (IE) {\n                        alphaSliderInner.css(\"filter\", tinycolor(realAlpha).toFilter({ gradientType: 1 }, realHex));\n                    }\n                    else {\n                        alphaSliderInner.css(\"background\", \"-webkit-\" + gradient);\n                        alphaSliderInner.css(\"background\", \"-moz-\" + gradient);\n                        alphaSliderInner.css(\"background\", \"-ms-\" + gradient);\n                        // Use current syntax gradient on unprefixed property.\n                        alphaSliderInner.css(\"background\",\n                            \"linear-gradient(to right, \" + realAlpha + \", \" + realHex + \")\");\n                    }\n                }\n\n                displayColor = realColor.toString(format);\n            }\n\n            // Update the text entry input as it changes happen\n            if (opts.showInput) {\n                textInput.val(displayColor);\n            }\n\n            if (opts.showPalette) {\n                drawPalette();\n            }\n\n            drawInitial();\n        }\n\n        function updateHelperLocations() {\n            var s = currentSaturation;\n            var v = currentValue;\n\n            if(allowEmpty && isEmpty) {\n                //if selected color is empty, hide the helpers\n                alphaSlideHelper.hide();\n                slideHelper.hide();\n                dragHelper.hide();\n            }\n            else {\n                //make sure helpers are visible\n                alphaSlideHelper.show();\n                slideHelper.show();\n                dragHelper.show();\n\n                // Where to show the little circle in that displays your current selected color\n                var dragX = s * dragWidth;\n                var dragY = dragHeight - (v * dragHeight);\n                dragX = Math.max(\n                    -dragHelperHeight,\n                    Math.min(dragWidth - dragHelperHeight, dragX - dragHelperHeight)\n                );\n                dragY = Math.max(\n                    -dragHelperHeight,\n                    Math.min(dragHeight - dragHelperHeight, dragY - dragHelperHeight)\n                );\n                dragHelper.css({\n                    \"top\": dragY + \"px\",\n                    \"left\": dragX + \"px\"\n                });\n\n                var alphaX = currentAlpha * alphaWidth;\n                alphaSlideHelper.css({\n                    \"left\": (alphaX - (alphaSlideHelperWidth / 2)) + \"px\"\n                });\n\n                // Where to show the bar that displays your current selected hue\n                var slideY = (currentHue) * slideHeight;\n                slideHelper.css({\n                    \"top\": (slideY - slideHelperHeight) + \"px\"\n                });\n            }\n        }\n\n        function updateOriginalInput(fireCallback) {\n            var color = get(),\n                displayColor = '',\n                hasChanged = !tinycolor.equals(color, colorOnShow);\n\n            if (color) {\n                displayColor = color.toString(currentPreferredFormat);\n                // Update the selection palette with the current color\n                addColorToSelectionPalette(color);\n            }\n\n            if (isInput) {\n                boundElement.val(displayColor);\n            }\n\n            if (fireCallback && hasChanged) {\n                callbacks.change(color);\n                boundElement.trigger('change', [ color ]);\n            }\n        }\n\n        function reflow() {\n            dragWidth = dragger.width();\n            dragHeight = dragger.height();\n            dragHelperHeight = dragHelper.height();\n            slideWidth = slider.width();\n            slideHeight = slider.height();\n            slideHelperHeight = slideHelper.height();\n            alphaWidth = alphaSlider.width();\n            alphaSlideHelperWidth = alphaSlideHelper.width();\n\n            if (!flat) {\n                container.css(\"position\", \"absolute\");\n                if (opts.offset) {\n                    container.offset(opts.offset);\n                } else {\n                    container.offset(getOffset(container, offsetElement));\n                }\n            }\n\n            updateHelperLocations();\n\n            if (opts.showPalette) {\n                drawPalette();\n            }\n\n            boundElement.trigger('reflow.spectrum');\n        }\n\n        function destroy() {\n            boundElement.show();\n            offsetElement.unbind(\"click.spectrum touchstart.spectrum\");\n            container.remove();\n            replacer.remove();\n            spectrums[spect.id] = null;\n        }\n\n        function option(optionName, optionValue) {\n            if (optionName === undefined) {\n                return $.extend({}, opts);\n            }\n            if (optionValue === undefined) {\n                return opts[optionName];\n            }\n\n            opts[optionName] = optionValue;\n            applyOptions();\n        }\n\n        function enable() {\n            disabled = false;\n            boundElement.attr(\"disabled\", false);\n            offsetElement.removeClass(\"sp-disabled\");\n        }\n\n        function disable() {\n            hide();\n            disabled = true;\n            boundElement.attr(\"disabled\", true);\n            offsetElement.addClass(\"sp-disabled\");\n        }\n\n        function setOffset(coord) {\n            opts.offset = coord;\n            reflow();\n        }\n\n        initialize();\n\n        var spect = {\n            show: show,\n            hide: hide,\n            toggle: toggle,\n            reflow: reflow,\n            option: option,\n            enable: enable,\n            disable: disable,\n            offset: setOffset,\n            set: function (c) {\n                set(c);\n                updateOriginalInput();\n            },\n            get: get,\n            destroy: destroy,\n            container: container\n        };\n\n        spect.id = spectrums.push(spect) - 1;\n\n        return spect;\n    }\n\n    /**\n    * checkOffset - get the offset below/above and left/right element depending on screen position\n    * Thanks https://github.com/jquery/jquery-ui/blob/master/ui/jquery.ui.datepicker.js\n    */\n    function getOffset(picker, input) {\n        var extraY = 0;\n        var dpWidth = picker.outerWidth();\n        var dpHeight = picker.outerHeight();\n        var inputHeight = input.outerHeight();\n        var doc = picker[0].ownerDocument;\n        var docElem = doc.documentElement;\n        var viewWidth = docElem.clientWidth + $(doc).scrollLeft();\n        var viewHeight = docElem.clientHeight + $(doc).scrollTop();\n        var offset = input.offset();\n        offset.top += inputHeight;\n\n        offset.left -=\n            Math.min(offset.left, (offset.left + dpWidth > viewWidth && viewWidth > dpWidth) ?\n            Math.abs(offset.left + dpWidth - viewWidth) : 0);\n\n        offset.top -=\n            Math.min(offset.top, ((offset.top + dpHeight > viewHeight && viewHeight > dpHeight) ?\n            Math.abs(dpHeight + inputHeight - extraY) : extraY));\n\n        return offset;\n    }\n\n    /**\n    * noop - do nothing\n    */\n    function noop() {\n\n    }\n\n    /**\n    * stopPropagation - makes the code only doing this a little easier to read in line\n    */\n    function stopPropagation(e) {\n        e.stopPropagation();\n    }\n\n    /**\n    * Create a function bound to a given object\n    * Thanks to underscore.js\n    */\n    function bind(func, obj) {\n        var slice = Array.prototype.slice;\n        var args = slice.call(arguments, 2);\n        return function () {\n            return func.apply(obj, args.concat(slice.call(arguments)));\n        };\n    }\n\n    /**\n    * Lightweight drag helper.  Handles containment within the element, so that\n    * when dragging, the x is within [0,element.width] and y is within [0,element.height]\n    */\n    function draggable(element, onmove, onstart, onstop) {\n        onmove = onmove || function () { };\n        onstart = onstart || function () { };\n        onstop = onstop || function () { };\n        var doc = document;\n        var dragging = false;\n        var offset = {};\n        var maxHeight = 0;\n        var maxWidth = 0;\n        var hasTouch = ('ontouchstart' in window);\n\n        var duringDragEvents = {};\n        duringDragEvents[\"selectstart\"] = prevent;\n        duringDragEvents[\"dragstart\"] = prevent;\n        duringDragEvents[\"touchmove mousemove\"] = move;\n        duringDragEvents[\"touchend mouseup\"] = stop;\n\n        function prevent(e) {\n            if (e.stopPropagation) {\n                e.stopPropagation();\n            }\n            if (e.preventDefault) {\n                e.preventDefault();\n            }\n            e.returnValue = false;\n        }\n\n        function move(e) {\n            if (dragging) {\n                // Mouseup happened outside of window\n                if (IE && doc.documentMode < 9 && !e.button) {\n                    return stop();\n                }\n\n                var t0 = e.originalEvent && e.originalEvent.touches && e.originalEvent.touches[0];\n                var pageX = t0 && t0.pageX || e.pageX;\n                var pageY = t0 && t0.pageY || e.pageY;\n\n                var dragX = Math.max(0, Math.min(pageX - offset.left, maxWidth));\n                var dragY = Math.max(0, Math.min(pageY - offset.top, maxHeight));\n\n                if (hasTouch) {\n                    // Stop scrolling in iOS\n                    prevent(e);\n                }\n\n                onmove.apply(element, [dragX, dragY, e]);\n            }\n        }\n\n        function start(e) {\n            var rightclick = (e.which) ? (e.which == 3) : (e.button == 2);\n\n            if (!rightclick && !dragging) {\n                if (onstart.apply(element, arguments) !== false) {\n                    dragging = true;\n                    maxHeight = $(element).height();\n                    maxWidth = $(element).width();\n                    offset = $(element).offset();\n\n                    $(doc).bind(duringDragEvents);\n                    $(doc.body).addClass(\"sp-dragging\");\n\n                    move(e);\n\n                    prevent(e);\n                }\n            }\n        }\n\n        function stop() {\n            if (dragging) {\n                $(doc).unbind(duringDragEvents);\n                $(doc.body).removeClass(\"sp-dragging\");\n\n                // Wait a tick before notifying observers to allow the click event\n                // to fire in Chrome.\n                setTimeout(function() {\n                    onstop.apply(element, arguments);\n                }, 0);\n            }\n            dragging = false;\n        }\n\n        $(element).bind(\"touchstart mousedown\", start);\n    }\n\n    function throttle(func, wait, debounce) {\n        var timeout;\n        return function () {\n            var context = this, args = arguments;\n            var throttler = function () {\n                timeout = null;\n                func.apply(context, args);\n            };\n            if (debounce) clearTimeout(timeout);\n            if (debounce || !timeout) timeout = setTimeout(throttler, wait);\n        };\n    }\n\n    function inputTypeColorSupport() {\n        return $.fn.spectrum.inputTypeColorSupport();\n    }\n\n    /**\n    * Define a jQuery plugin\n    */\n    var dataID = \"spectrum.id\";\n    $.fn.spectrum = function (opts, extra) {\n\n        if (typeof opts == \"string\") {\n\n            var returnValue = this;\n            var args = Array.prototype.slice.call( arguments, 1 );\n\n            this.each(function () {\n                var spect = spectrums[$(this).data(dataID)];\n                if (spect) {\n                    var method = spect[opts];\n                    if (!method) {\n                        throw new Error( \"Spectrum: no such method: '\" + opts + \"'\" );\n                    }\n\n                    if (opts == \"get\") {\n                        returnValue = spect.get();\n                    }\n                    else if (opts == \"container\") {\n                        returnValue = spect.container;\n                    }\n                    else if (opts == \"option\") {\n                        returnValue = spect.option.apply(spect, args);\n                    }\n                    else if (opts == \"destroy\") {\n                        spect.destroy();\n                        $(this).removeData(dataID);\n                    }\n                    else {\n                        method.apply(spect, args);\n                    }\n                }\n            });\n\n            return returnValue;\n        }\n\n        // Initializing a new instance of spectrum\n        return this.spectrum(\"destroy\").each(function () {\n            var options = $.extend({}, opts, $(this).data());\n            var spect = spectrum(this, options);\n            $(this).data(dataID, spect.id);\n        });\n    };\n\n    $.fn.spectrum.load = true;\n    $.fn.spectrum.loadOpts = {};\n    $.fn.spectrum.draggable = draggable;\n    $.fn.spectrum.defaults = defaultOpts;\n    $.fn.spectrum.inputTypeColorSupport = function inputTypeColorSupport() {\n        if (typeof inputTypeColorSupport._cachedResult === \"undefined\") {\n            var colorInput = $(\"<input type='color' value='!' />\")[0];\n            inputTypeColorSupport._cachedResult = colorInput.type === \"color\" && colorInput.value !== \"!\";\n        }\n        return inputTypeColorSupport._cachedResult;\n    };\n\n    $.spectrum = { };\n    $.spectrum.localization = { };\n    $.spectrum.palettes = { };\n\n    $.fn.spectrum.processNativeColorInputs = function () {\n        var colorInputs = $(\"input[type=color]\");\n        if (colorInputs.length && !inputTypeColorSupport()) {\n            colorInputs.spectrum({\n                preferredFormat: \"hex6\"\n            });\n        }\n    };\n\n    // TinyColor v1.1.2\n    // https://github.com/bgrins/TinyColor\n    // Brian Grinstead, MIT License\n\n    (function() {\n\n    var trimLeft = /^[\\s,#]+/,\n        trimRight = /\\s+$/,\n        tinyCounter = 0,\n        math = Math,\n        mathRound = math.round,\n        mathMin = math.min,\n        mathMax = math.max,\n        mathRandom = math.random;\n\n    var tinycolor = function(color, opts) {\n\n        color = (color) ? color : '';\n        opts = opts || { };\n\n        // If input is already a tinycolor, return itself\n        if (color instanceof tinycolor) {\n           return color;\n        }\n        // If we are called as a function, call using new instead\n        if (!(this instanceof tinycolor)) {\n            return new tinycolor(color, opts);\n        }\n\n        var rgb = inputToRGB(color);\n        this._originalInput = color,\n        this._r = rgb.r,\n        this._g = rgb.g,\n        this._b = rgb.b,\n        this._a = rgb.a,\n        this._roundA = mathRound(100*this._a) / 100,\n        this._format = opts.format || rgb.format;\n        this._gradientType = opts.gradientType;\n\n        // Don't let the range of [0,255] come back in [0,1].\n        // Potentially lose a little bit of precision here, but will fix issues where\n        // .5 gets interpreted as half of the total, instead of half of 1\n        // If it was supposed to be 128, this was already taken care of by `inputToRgb`\n        if (this._r < 1) { this._r = mathRound(this._r); }\n        if (this._g < 1) { this._g = mathRound(this._g); }\n        if (this._b < 1) { this._b = mathRound(this._b); }\n\n        this._ok = rgb.ok;\n        this._tc_id = tinyCounter++;\n    };\n\n    tinycolor.prototype = {\n        isDark: function() {\n            return this.getBrightness() < 128;\n        },\n        isLight: function() {\n            return !this.isDark();\n        },\n        isValid: function() {\n            return this._ok;\n        },\n        getOriginalInput: function() {\n          return this._originalInput;\n        },\n        getFormat: function() {\n            return this._format;\n        },\n        getAlpha: function() {\n            return this._a;\n        },\n        getBrightness: function() {\n            var rgb = this.toRgb();\n            return (rgb.r * 299 + rgb.g * 587 + rgb.b * 114) / 1000;\n        },\n        setAlpha: function(value) {\n            this._a = boundAlpha(value);\n            this._roundA = mathRound(100*this._a) / 100;\n            return this;\n        },\n        toHsv: function() {\n            var hsv = rgbToHsv(this._r, this._g, this._b);\n            return { h: hsv.h * 360, s: hsv.s, v: hsv.v, a: this._a };\n        },\n        toHsvString: function() {\n            var hsv = rgbToHsv(this._r, this._g, this._b);\n            var h = mathRound(hsv.h * 360), s = mathRound(hsv.s * 100), v = mathRound(hsv.v * 100);\n            return (this._a == 1) ?\n              \"hsv(\"  + h + \", \" + s + \"%, \" + v + \"%)\" :\n              \"hsva(\" + h + \", \" + s + \"%, \" + v + \"%, \"+ this._roundA + \")\";\n        },\n        toHsl: function() {\n            var hsl = rgbToHsl(this._r, this._g, this._b);\n            return { h: hsl.h * 360, s: hsl.s, l: hsl.l, a: this._a };\n        },\n        toHslString: function() {\n            var hsl = rgbToHsl(this._r, this._g, this._b);\n            var h = mathRound(hsl.h * 360), s = mathRound(hsl.s * 100), l = mathRound(hsl.l * 100);\n            return (this._a == 1) ?\n              \"hsl(\"  + h + \", \" + s + \"%, \" + l + \"%)\" :\n              \"hsla(\" + h + \", \" + s + \"%, \" + l + \"%, \"+ this._roundA + \")\";\n        },\n        toHex: function(allow3Char) {\n            return rgbToHex(this._r, this._g, this._b, allow3Char);\n        },\n        toHexString: function(allow3Char) {\n            return '#' + this.toHex(allow3Char);\n        },\n        toHex8: function() {\n            return rgbaToHex(this._r, this._g, this._b, this._a);\n        },\n        toHex8String: function() {\n            return '#' + this.toHex8();\n        },\n        toRgb: function() {\n            return { r: mathRound(this._r), g: mathRound(this._g), b: mathRound(this._b), a: this._a };\n        },\n        toRgbString: function() {\n            return (this._a == 1) ?\n              \"rgb(\"  + mathRound(this._r) + \", \" + mathRound(this._g) + \", \" + mathRound(this._b) + \")\" :\n              \"rgba(\" + mathRound(this._r) + \", \" + mathRound(this._g) + \", \" + mathRound(this._b) + \", \" + this._roundA + \")\";\n        },\n        toPercentageRgb: function() {\n            return { r: mathRound(bound01(this._r, 255) * 100) + \"%\", g: mathRound(bound01(this._g, 255) * 100) + \"%\", b: mathRound(bound01(this._b, 255) * 100) + \"%\", a: this._a };\n        },\n        toPercentageRgbString: function() {\n            return (this._a == 1) ?\n              \"rgb(\"  + mathRound(bound01(this._r, 255) * 100) + \"%, \" + mathRound(bound01(this._g, 255) * 100) + \"%, \" + mathRound(bound01(this._b, 255) * 100) + \"%)\" :\n              \"rgba(\" + mathRound(bound01(this._r, 255) * 100) + \"%, \" + mathRound(bound01(this._g, 255) * 100) + \"%, \" + mathRound(bound01(this._b, 255) * 100) + \"%, \" + this._roundA + \")\";\n        },\n        toName: function() {\n            if (this._a === 0) {\n                return \"transparent\";\n            }\n\n            if (this._a < 1) {\n                return false;\n            }\n\n            return hexNames[rgbToHex(this._r, this._g, this._b, true)] || false;\n        },\n        toFilter: function(secondColor) {\n            var hex8String = '#' + rgbaToHex(this._r, this._g, this._b, this._a);\n            var secondHex8String = hex8String;\n            var gradientType = this._gradientType ? \"GradientType = 1, \" : \"\";\n\n            if (secondColor) {\n                var s = tinycolor(secondColor);\n                secondHex8String = s.toHex8String();\n            }\n\n            return \"progid:DXImageTransform.Microsoft.gradient(\"+gradientType+\"startColorstr=\"+hex8String+\",endColorstr=\"+secondHex8String+\")\";\n        },\n        toString: function(format) {\n            var formatSet = !!format;\n            format = format || this._format;\n\n            var formattedString = false;\n            var hasAlpha = this._a < 1 && this._a >= 0;\n            var needsAlphaFormat = !formatSet && hasAlpha && (format === \"hex\" || format === \"hex6\" || format === \"hex3\" || format === \"name\");\n\n            if (needsAlphaFormat) {\n                // Special case for \"transparent\", all other non-alpha formats\n                // will return rgba when there is transparency.\n                if (format === \"name\" && this._a === 0) {\n                    return this.toName();\n                }\n                return this.toRgbString();\n            }\n            if (format === \"rgb\") {\n                formattedString = this.toRgbString();\n            }\n            if (format === \"prgb\") {\n                formattedString = this.toPercentageRgbString();\n            }\n            if (format === \"hex\" || format === \"hex6\") {\n                formattedString = this.toHexString();\n            }\n            if (format === \"hex3\") {\n                formattedString = this.toHexString(true);\n            }\n            if (format === \"hex8\") {\n                formattedString = this.toHex8String();\n            }\n            if (format === \"name\") {\n                formattedString = this.toName();\n            }\n            if (format === \"hsl\") {\n                formattedString = this.toHslString();\n            }\n            if (format === \"hsv\") {\n                formattedString = this.toHsvString();\n            }\n\n            return formattedString || this.toHexString();\n        },\n\n        _applyModification: function(fn, args) {\n            var color = fn.apply(null, [this].concat([].slice.call(args)));\n            this._r = color._r;\n            this._g = color._g;\n            this._b = color._b;\n            this.setAlpha(color._a);\n            return this;\n        },\n        lighten: function() {\n            return this._applyModification(lighten, arguments);\n        },\n        brighten: function() {\n            return this._applyModification(brighten, arguments);\n        },\n        darken: function() {\n            return this._applyModification(darken, arguments);\n        },\n        desaturate: function() {\n            return this._applyModification(desaturate, arguments);\n        },\n        saturate: function() {\n            return this._applyModification(saturate, arguments);\n        },\n        greyscale: function() {\n            return this._applyModification(greyscale, arguments);\n        },\n        spin: function() {\n            return this._applyModification(spin, arguments);\n        },\n\n        _applyCombination: function(fn, args) {\n            return fn.apply(null, [this].concat([].slice.call(args)));\n        },\n        analogous: function() {\n            return this._applyCombination(analogous, arguments);\n        },\n        complement: function() {\n            return this._applyCombination(complement, arguments);\n        },\n        monochromatic: function() {\n            return this._applyCombination(monochromatic, arguments);\n        },\n        splitcomplement: function() {\n            return this._applyCombination(splitcomplement, arguments);\n        },\n        triad: function() {\n            return this._applyCombination(triad, arguments);\n        },\n        tetrad: function() {\n            return this._applyCombination(tetrad, arguments);\n        }\n    };\n\n    // If input is an object, force 1 into \"1.0\" to handle ratios properly\n    // String input requires \"1.0\" as input, so 1 will be treated as 1\n    tinycolor.fromRatio = function(color, opts) {\n        if (typeof color == \"object\") {\n            var newColor = {};\n            for (var i in color) {\n                if (color.hasOwnProperty(i)) {\n                    if (i === \"a\") {\n                        newColor[i] = color[i];\n                    }\n                    else {\n                        newColor[i] = convertToPercentage(color[i]);\n                    }\n                }\n            }\n            color = newColor;\n        }\n\n        return tinycolor(color, opts);\n    };\n\n    // Given a string or object, convert that input to RGB\n    // Possible string inputs:\n    //\n    //     \"red\"\n    //     \"#f00\" or \"f00\"\n    //     \"#ff0000\" or \"ff0000\"\n    //     \"#ff000000\" or \"ff000000\"\n    //     \"rgb 255 0 0\" or \"rgb (255, 0, 0)\"\n    //     \"rgb 1.0 0 0\" or \"rgb (1, 0, 0)\"\n    //     \"rgba (255, 0, 0, 1)\" or \"rgba 255, 0, 0, 1\"\n    //     \"rgba (1.0, 0, 0, 1)\" or \"rgba 1.0, 0, 0, 1\"\n    //     \"hsl(0, 100%, 50%)\" or \"hsl 0 100% 50%\"\n    //     \"hsla(0, 100%, 50%, 1)\" or \"hsla 0 100% 50%, 1\"\n    //     \"hsv(0, 100%, 100%)\" or \"hsv 0 100% 100%\"\n    //\n    function inputToRGB(color) {\n\n        var rgb = { r: 0, g: 0, b: 0 };\n        var a = 1;\n        var ok = false;\n        var format = false;\n\n        if (typeof color == \"string\") {\n            color = stringInputToObject(color);\n        }\n\n        if (typeof color == \"object\") {\n            if (color.hasOwnProperty(\"r\") && color.hasOwnProperty(\"g\") && color.hasOwnProperty(\"b\")) {\n                rgb = rgbToRgb(color.r, color.g, color.b);\n                ok = true;\n                format = String(color.r).substr(-1) === \"%\" ? \"prgb\" : \"rgb\";\n            }\n            else if (color.hasOwnProperty(\"h\") && color.hasOwnProperty(\"s\") && color.hasOwnProperty(\"v\")) {\n                color.s = convertToPercentage(color.s);\n                color.v = convertToPercentage(color.v);\n                rgb = hsvToRgb(color.h, color.s, color.v);\n                ok = true;\n                format = \"hsv\";\n            }\n            else if (color.hasOwnProperty(\"h\") && color.hasOwnProperty(\"s\") && color.hasOwnProperty(\"l\")) {\n                color.s = convertToPercentage(color.s);\n                color.l = convertToPercentage(color.l);\n                rgb = hslToRgb(color.h, color.s, color.l);\n                ok = true;\n                format = \"hsl\";\n            }\n\n            if (color.hasOwnProperty(\"a\")) {\n                a = color.a;\n            }\n        }\n\n        a = boundAlpha(a);\n\n        return {\n            ok: ok,\n            format: color.format || format,\n            r: mathMin(255, mathMax(rgb.r, 0)),\n            g: mathMin(255, mathMax(rgb.g, 0)),\n            b: mathMin(255, mathMax(rgb.b, 0)),\n            a: a\n        };\n    }\n\n\n    // Conversion Functions\n    // --------------------\n\n    // `rgbToHsl`, `rgbToHsv`, `hslToRgb`, `hsvToRgb` modified from:\n    // <http://mjijackson.com/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript>\n\n    // `rgbToRgb`\n    // Handle bounds / percentage checking to conform to CSS color spec\n    // <http://www.w3.org/TR/css3-color/>\n    // *Assumes:* r, g, b in [0, 255] or [0, 1]\n    // *Returns:* { r, g, b } in [0, 255]\n    function rgbToRgb(r, g, b){\n        return {\n            r: bound01(r, 255) * 255,\n            g: bound01(g, 255) * 255,\n            b: bound01(b, 255) * 255\n        };\n    }\n\n    // `rgbToHsl`\n    // Converts an RGB color value to HSL.\n    // *Assumes:* r, g, and b are contained in [0, 255] or [0, 1]\n    // *Returns:* { h, s, l } in [0,1]\n    function rgbToHsl(r, g, b) {\n\n        r = bound01(r, 255);\n        g = bound01(g, 255);\n        b = bound01(b, 255);\n\n        var max = mathMax(r, g, b), min = mathMin(r, g, b);\n        var h, s, l = (max + min) / 2;\n\n        if(max == min) {\n            h = s = 0; // achromatic\n        }\n        else {\n            var d = max - min;\n            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n            switch(max) {\n                case r: h = (g - b) / d + (g < b ? 6 : 0); break;\n                case g: h = (b - r) / d + 2; break;\n                case b: h = (r - g) / d + 4; break;\n            }\n\n            h /= 6;\n        }\n\n        return { h: h, s: s, l: l };\n    }\n\n    // `hslToRgb`\n    // Converts an HSL color value to RGB.\n    // *Assumes:* h is contained in [0, 1] or [0, 360] and s and l are contained [0, 1] or [0, 100]\n    // *Returns:* { r, g, b } in the set [0, 255]\n    function hslToRgb(h, s, l) {\n        var r, g, b;\n\n        h = bound01(h, 360);\n        s = bound01(s, 100);\n        l = bound01(l, 100);\n\n        function hue2rgb(p, q, t) {\n            if(t < 0) t += 1;\n            if(t > 1) t -= 1;\n            if(t < 1/6) return p + (q - p) * 6 * t;\n            if(t < 1/2) return q;\n            if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;\n            return p;\n        }\n\n        if(s === 0) {\n            r = g = b = l; // achromatic\n        }\n        else {\n            var q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n            var p = 2 * l - q;\n            r = hue2rgb(p, q, h + 1/3);\n            g = hue2rgb(p, q, h);\n            b = hue2rgb(p, q, h - 1/3);\n        }\n\n        return { r: r * 255, g: g * 255, b: b * 255 };\n    }\n\n    // `rgbToHsv`\n    // Converts an RGB color value to HSV\n    // *Assumes:* r, g, and b are contained in the set [0, 255] or [0, 1]\n    // *Returns:* { h, s, v } in [0,1]\n    function rgbToHsv(r, g, b) {\n\n        r = bound01(r, 255);\n        g = bound01(g, 255);\n        b = bound01(b, 255);\n\n        var max = mathMax(r, g, b), min = mathMin(r, g, b);\n        var h, s, v = max;\n\n        var d = max - min;\n        s = max === 0 ? 0 : d / max;\n\n        if(max == min) {\n            h = 0; // achromatic\n        }\n        else {\n            switch(max) {\n                case r: h = (g - b) / d + (g < b ? 6 : 0); break;\n                case g: h = (b - r) / d + 2; break;\n                case b: h = (r - g) / d + 4; break;\n            }\n            h /= 6;\n        }\n        return { h: h, s: s, v: v };\n    }\n\n    // `hsvToRgb`\n    // Converts an HSV color value to RGB.\n    // *Assumes:* h is contained in [0, 1] or [0, 360] and s and v are contained in [0, 1] or [0, 100]\n    // *Returns:* { r, g, b } in the set [0, 255]\n     function hsvToRgb(h, s, v) {\n\n        h = bound01(h, 360) * 6;\n        s = bound01(s, 100);\n        v = bound01(v, 100);\n\n        var i = math.floor(h),\n            f = h - i,\n            p = v * (1 - s),\n            q = v * (1 - f * s),\n            t = v * (1 - (1 - f) * s),\n            mod = i % 6,\n            r = [v, q, p, p, t, v][mod],\n            g = [t, v, v, q, p, p][mod],\n            b = [p, p, t, v, v, q][mod];\n\n        return { r: r * 255, g: g * 255, b: b * 255 };\n    }\n\n    // `rgbToHex`\n    // Converts an RGB color to hex\n    // Assumes r, g, and b are contained in the set [0, 255]\n    // Returns a 3 or 6 character hex\n    function rgbToHex(r, g, b, allow3Char) {\n\n        var hex = [\n            pad2(mathRound(r).toString(16)),\n            pad2(mathRound(g).toString(16)),\n            pad2(mathRound(b).toString(16))\n        ];\n\n        // Return a 3 character hex if possible\n        if (allow3Char && hex[0].charAt(0) == hex[0].charAt(1) && hex[1].charAt(0) == hex[1].charAt(1) && hex[2].charAt(0) == hex[2].charAt(1)) {\n            return hex[0].charAt(0) + hex[1].charAt(0) + hex[2].charAt(0);\n        }\n\n        return hex.join(\"\");\n    }\n        // `rgbaToHex`\n        // Converts an RGBA color plus alpha transparency to hex\n        // Assumes r, g, b and a are contained in the set [0, 255]\n        // Returns an 8 character hex\n        function rgbaToHex(r, g, b, a) {\n\n            var hex = [\n                pad2(convertDecimalToHex(a)),\n                pad2(mathRound(r).toString(16)),\n                pad2(mathRound(g).toString(16)),\n                pad2(mathRound(b).toString(16))\n            ];\n\n            return hex.join(\"\");\n        }\n\n    // `equals`\n    // Can be called with any tinycolor input\n    tinycolor.equals = function (color1, color2) {\n        if (!color1 || !color2) { return false; }\n        return tinycolor(color1).toRgbString() == tinycolor(color2).toRgbString();\n    };\n    tinycolor.random = function() {\n        return tinycolor.fromRatio({\n            r: mathRandom(),\n            g: mathRandom(),\n            b: mathRandom()\n        });\n    };\n\n\n    // Modification Functions\n    // ----------------------\n    // Thanks to less.js for some of the basics here\n    // <https://github.com/cloudhead/less.js/blob/master/lib/less/functions.js>\n\n    function desaturate(color, amount) {\n        amount = (amount === 0) ? 0 : (amount || 10);\n        var hsl = tinycolor(color).toHsl();\n        hsl.s -= amount / 100;\n        hsl.s = clamp01(hsl.s);\n        return tinycolor(hsl);\n    }\n\n    function saturate(color, amount) {\n        amount = (amount === 0) ? 0 : (amount || 10);\n        var hsl = tinycolor(color).toHsl();\n        hsl.s += amount / 100;\n        hsl.s = clamp01(hsl.s);\n        return tinycolor(hsl);\n    }\n\n    function greyscale(color) {\n        return tinycolor(color).desaturate(100);\n    }\n\n    function lighten (color, amount) {\n        amount = (amount === 0) ? 0 : (amount || 10);\n        var hsl = tinycolor(color).toHsl();\n        hsl.l += amount / 100;\n        hsl.l = clamp01(hsl.l);\n        return tinycolor(hsl);\n    }\n\n    function brighten(color, amount) {\n        amount = (amount === 0) ? 0 : (amount || 10);\n        var rgb = tinycolor(color).toRgb();\n        rgb.r = mathMax(0, mathMin(255, rgb.r - mathRound(255 * - (amount / 100))));\n        rgb.g = mathMax(0, mathMin(255, rgb.g - mathRound(255 * - (amount / 100))));\n        rgb.b = mathMax(0, mathMin(255, rgb.b - mathRound(255 * - (amount / 100))));\n        return tinycolor(rgb);\n    }\n\n    function darken (color, amount) {\n        amount = (amount === 0) ? 0 : (amount || 10);\n        var hsl = tinycolor(color).toHsl();\n        hsl.l -= amount / 100;\n        hsl.l = clamp01(hsl.l);\n        return tinycolor(hsl);\n    }\n\n    // Spin takes a positive or negative amount within [-360, 360] indicating the change of hue.\n    // Values outside of this range will be wrapped into this range.\n    function spin(color, amount) {\n        var hsl = tinycolor(color).toHsl();\n        var hue = (mathRound(hsl.h) + amount) % 360;\n        hsl.h = hue < 0 ? 360 + hue : hue;\n        return tinycolor(hsl);\n    }\n\n    // Combination Functions\n    // ---------------------\n    // Thanks to jQuery xColor for some of the ideas behind these\n    // <https://github.com/infusion/jQuery-xcolor/blob/master/jquery.xcolor.js>\n\n    function complement(color) {\n        var hsl = tinycolor(color).toHsl();\n        hsl.h = (hsl.h + 180) % 360;\n        return tinycolor(hsl);\n    }\n\n    function triad(color) {\n        var hsl = tinycolor(color).toHsl();\n        var h = hsl.h;\n        return [\n            tinycolor(color),\n            tinycolor({ h: (h + 120) % 360, s: hsl.s, l: hsl.l }),\n            tinycolor({ h: (h + 240) % 360, s: hsl.s, l: hsl.l })\n        ];\n    }\n\n    function tetrad(color) {\n        var hsl = tinycolor(color).toHsl();\n        var h = hsl.h;\n        return [\n            tinycolor(color),\n            tinycolor({ h: (h + 90) % 360, s: hsl.s, l: hsl.l }),\n            tinycolor({ h: (h + 180) % 360, s: hsl.s, l: hsl.l }),\n            tinycolor({ h: (h + 270) % 360, s: hsl.s, l: hsl.l })\n        ];\n    }\n\n    function splitcomplement(color) {\n        var hsl = tinycolor(color).toHsl();\n        var h = hsl.h;\n        return [\n            tinycolor(color),\n            tinycolor({ h: (h + 72) % 360, s: hsl.s, l: hsl.l}),\n            tinycolor({ h: (h + 216) % 360, s: hsl.s, l: hsl.l})\n        ];\n    }\n\n    function analogous(color, results, slices) {\n        results = results || 6;\n        slices = slices || 30;\n\n        var hsl = tinycolor(color).toHsl();\n        var part = 360 / slices;\n        var ret = [tinycolor(color)];\n\n        for (hsl.h = ((hsl.h - (part * results >> 1)) + 720) % 360; --results; ) {\n            hsl.h = (hsl.h + part) % 360;\n            ret.push(tinycolor(hsl));\n        }\n        return ret;\n    }\n\n    function monochromatic(color, results) {\n        results = results || 6;\n        var hsv = tinycolor(color).toHsv();\n        var h = hsv.h, s = hsv.s, v = hsv.v;\n        var ret = [];\n        var modification = 1 / results;\n\n        while (results--) {\n            ret.push(tinycolor({ h: h, s: s, v: v}));\n            v = (v + modification) % 1;\n        }\n\n        return ret;\n    }\n\n    // Utility Functions\n    // ---------------------\n\n    tinycolor.mix = function(color1, color2, amount) {\n        amount = (amount === 0) ? 0 : (amount || 50);\n\n        var rgb1 = tinycolor(color1).toRgb();\n        var rgb2 = tinycolor(color2).toRgb();\n\n        var p = amount / 100;\n        var w = p * 2 - 1;\n        var a = rgb2.a - rgb1.a;\n\n        var w1;\n\n        if (w * a == -1) {\n            w1 = w;\n        } else {\n            w1 = (w + a) / (1 + w * a);\n        }\n\n        w1 = (w1 + 1) / 2;\n\n        var w2 = 1 - w1;\n\n        var rgba = {\n            r: rgb2.r * w1 + rgb1.r * w2,\n            g: rgb2.g * w1 + rgb1.g * w2,\n            b: rgb2.b * w1 + rgb1.b * w2,\n            a: rgb2.a * p  + rgb1.a * (1 - p)\n        };\n\n        return tinycolor(rgba);\n    };\n\n\n    // Readability Functions\n    // ---------------------\n    // <http://www.w3.org/TR/AERT#color-contrast>\n\n    // `readability`\n    // Analyze the 2 colors and returns an object with the following properties:\n    //    `brightness`: difference in brightness between the two colors\n    //    `color`: difference in color/hue between the two colors\n    tinycolor.readability = function(color1, color2) {\n        var c1 = tinycolor(color1);\n        var c2 = tinycolor(color2);\n        var rgb1 = c1.toRgb();\n        var rgb2 = c2.toRgb();\n        var brightnessA = c1.getBrightness();\n        var brightnessB = c2.getBrightness();\n        var colorDiff = (\n            Math.max(rgb1.r, rgb2.r) - Math.min(rgb1.r, rgb2.r) +\n            Math.max(rgb1.g, rgb2.g) - Math.min(rgb1.g, rgb2.g) +\n            Math.max(rgb1.b, rgb2.b) - Math.min(rgb1.b, rgb2.b)\n        );\n\n        return {\n            brightness: Math.abs(brightnessA - brightnessB),\n            color: colorDiff\n        };\n    };\n\n    // `readable`\n    // http://www.w3.org/TR/AERT#color-contrast\n    // Ensure that foreground and background color combinations provide sufficient contrast.\n    // *Example*\n    //    tinycolor.isReadable(\"#000\", \"#111\") => false\n    tinycolor.isReadable = function(color1, color2) {\n        var readability = tinycolor.readability(color1, color2);\n        return readability.brightness > 125 && readability.color > 500;\n    };\n\n    // `mostReadable`\n    // Given a base color and a list of possible foreground or background\n    // colors for that base, returns the most readable color.\n    // *Example*\n    //    tinycolor.mostReadable(\"#123\", [\"#fff\", \"#000\"]) => \"#000\"\n    tinycolor.mostReadable = function(baseColor, colorList) {\n        var bestColor = null;\n        var bestScore = 0;\n        var bestIsReadable = false;\n        for (var i=0; i < colorList.length; i++) {\n\n            // We normalize both around the \"acceptable\" breaking point,\n            // but rank brightness constrast higher than hue.\n\n            var readability = tinycolor.readability(baseColor, colorList[i]);\n            var readable = readability.brightness > 125 && readability.color > 500;\n            var score = 3 * (readability.brightness / 125) + (readability.color / 500);\n\n            if ((readable && ! bestIsReadable) ||\n                (readable && bestIsReadable && score > bestScore) ||\n                ((! readable) && (! bestIsReadable) && score > bestScore)) {\n                bestIsReadable = readable;\n                bestScore = score;\n                bestColor = tinycolor(colorList[i]);\n            }\n        }\n        return bestColor;\n    };\n\n\n    // Big List of Colors\n    // ------------------\n    // <http://www.w3.org/TR/css3-color/#svg-color>\n    var names = tinycolor.names = {\n        aliceblue: \"f0f8ff\",\n        antiquewhite: \"faebd7\",\n        aqua: \"0ff\",\n        aquamarine: \"7fffd4\",\n        azure: \"f0ffff\",\n        beige: \"f5f5dc\",\n        bisque: \"ffe4c4\",\n        black: \"000\",\n        blanchedalmond: \"ffebcd\",\n        blue: \"00f\",\n        blueviolet: \"8a2be2\",\n        brown: \"a52a2a\",\n        burlywood: \"deb887\",\n        burntsienna: \"ea7e5d\",\n        cadetblue: \"5f9ea0\",\n        chartreuse: \"7fff00\",\n        chocolate: \"d2691e\",\n        coral: \"ff7f50\",\n        cornflowerblue: \"6495ed\",\n        cornsilk: \"fff8dc\",\n        crimson: \"dc143c\",\n        cyan: \"0ff\",\n        darkblue: \"00008b\",\n        darkcyan: \"008b8b\",\n        darkgoldenrod: \"b8860b\",\n        darkgray: \"a9a9a9\",\n        darkgreen: \"006400\",\n        darkgrey: \"a9a9a9\",\n        darkkhaki: \"bdb76b\",\n        darkmagenta: \"8b008b\",\n        darkolivegreen: \"556b2f\",\n        darkorange: \"ff8c00\",\n        darkorchid: \"9932cc\",\n        darkred: \"8b0000\",\n        darksalmon: \"e9967a\",\n        darkseagreen: \"8fbc8f\",\n        darkslateblue: \"483d8b\",\n        darkslategray: \"2f4f4f\",\n        darkslategrey: \"2f4f4f\",\n        darkturquoise: \"00ced1\",\n        darkviolet: \"9400d3\",\n        deeppink: \"ff1493\",\n        deepskyblue: \"00bfff\",\n        dimgray: \"696969\",\n        dimgrey: \"696969\",\n        dodgerblue: \"1e90ff\",\n        firebrick: \"b22222\",\n        floralwhite: \"fffaf0\",\n        forestgreen: \"228b22\",\n        fuchsia: \"f0f\",\n        gainsboro: \"dcdcdc\",\n        ghostwhite: \"f8f8ff\",\n        gold: \"ffd700\",\n        goldenrod: \"daa520\",\n        gray: \"808080\",\n        green: \"008000\",\n        greenyellow: \"adff2f\",\n        grey: \"808080\",\n        honeydew: \"f0fff0\",\n        hotpink: \"ff69b4\",\n        indianred: \"cd5c5c\",\n        indigo: \"4b0082\",\n        ivory: \"fffff0\",\n        khaki: \"f0e68c\",\n        lavender: \"e6e6fa\",\n        lavenderblush: \"fff0f5\",\n        lawngreen: \"7cfc00\",\n        lemonchiffon: \"fffacd\",\n        lightblue: \"add8e6\",\n        lightcoral: \"f08080\",\n        lightcyan: \"e0ffff\",\n        lightgoldenrodyellow: \"fafad2\",\n        lightgray: \"d3d3d3\",\n        lightgreen: \"90ee90\",\n        lightgrey: \"d3d3d3\",\n        lightpink: \"ffb6c1\",\n        lightsalmon: \"ffa07a\",\n        lightseagreen: \"20b2aa\",\n        lightskyblue: \"87cefa\",\n        lightslategray: \"789\",\n        lightslategrey: \"789\",\n        lightsteelblue: \"b0c4de\",\n        lightyellow: \"ffffe0\",\n        lime: \"0f0\",\n        limegreen: \"32cd32\",\n        linen: \"faf0e6\",\n        magenta: \"f0f\",\n        maroon: \"800000\",\n        mediumaquamarine: \"66cdaa\",\n        mediumblue: \"0000cd\",\n        mediumorchid: \"ba55d3\",\n        mediumpurple: \"9370db\",\n        mediumseagreen: \"3cb371\",\n        mediumslateblue: \"7b68ee\",\n        mediumspringgreen: \"00fa9a\",\n        mediumturquoise: \"48d1cc\",\n        mediumvioletred: \"c71585\",\n        midnightblue: \"191970\",\n        mintcream: \"f5fffa\",\n        mistyrose: \"ffe4e1\",\n        moccasin: \"ffe4b5\",\n        navajowhite: \"ffdead\",\n        navy: \"000080\",\n        oldlace: \"fdf5e6\",\n        olive: \"808000\",\n        olivedrab: \"6b8e23\",\n        orange: \"ffa500\",\n        orangered: \"ff4500\",\n        orchid: \"da70d6\",\n        palegoldenrod: \"eee8aa\",\n        palegreen: \"98fb98\",\n        paleturquoise: \"afeeee\",\n        palevioletred: \"db7093\",\n        papayawhip: \"ffefd5\",\n        peachpuff: \"ffdab9\",\n        peru: \"cd853f\",\n        pink: \"ffc0cb\",\n        plum: \"dda0dd\",\n        powderblue: \"b0e0e6\",\n        purple: \"800080\",\n        rebeccapurple: \"663399\",\n        red: \"f00\",\n        rosybrown: \"bc8f8f\",\n        royalblue: \"4169e1\",\n        saddlebrown: \"8b4513\",\n        salmon: \"fa8072\",\n        sandybrown: \"f4a460\",\n        seagreen: \"2e8b57\",\n        seashell: \"fff5ee\",\n        sienna: \"a0522d\",\n        silver: \"c0c0c0\",\n        skyblue: \"87ceeb\",\n        slateblue: \"6a5acd\",\n        slategray: \"708090\",\n        slategrey: \"708090\",\n        snow: \"fffafa\",\n        springgreen: \"00ff7f\",\n        steelblue: \"4682b4\",\n        tan: \"d2b48c\",\n        teal: \"008080\",\n        thistle: \"d8bfd8\",\n        tomato: \"ff6347\",\n        turquoise: \"40e0d0\",\n        violet: \"ee82ee\",\n        wheat: \"f5deb3\",\n        white: \"fff\",\n        whitesmoke: \"f5f5f5\",\n        yellow: \"ff0\",\n        yellowgreen: \"9acd32\"\n    };\n\n    // Make it easy to access colors via `hexNames[hex]`\n    var hexNames = tinycolor.hexNames = flip(names);\n\n\n    // Utilities\n    // ---------\n\n    // `{ 'name1': 'val1' }` becomes `{ 'val1': 'name1' }`\n    function flip(o) {\n        var flipped = { };\n        for (var i in o) {\n            if (o.hasOwnProperty(i)) {\n                flipped[o[i]] = i;\n            }\n        }\n        return flipped;\n    }\n\n    // Return a valid alpha value [0,1] with all invalid values being set to 1\n    function boundAlpha(a) {\n        a = parseFloat(a);\n\n        if (isNaN(a) || a < 0 || a > 1) {\n            a = 1;\n        }\n\n        return a;\n    }\n\n    // Take input from [0, n] and return it as [0, 1]\n    function bound01(n, max) {\n        if (isOnePointZero(n)) { n = \"100%\"; }\n\n        var processPercent = isPercentage(n);\n        n = mathMin(max, mathMax(0, parseFloat(n)));\n\n        // Automatically convert percentage into number\n        if (processPercent) {\n            n = parseInt(n * max, 10) / 100;\n        }\n\n        // Handle floating point rounding errors\n        if ((math.abs(n - max) < 0.000001)) {\n            return 1;\n        }\n\n        // Convert into [0, 1] range if it isn't already\n        return (n % max) / parseFloat(max);\n    }\n\n    // Force a number between 0 and 1\n    function clamp01(val) {\n        return mathMin(1, mathMax(0, val));\n    }\n\n    // Parse a base-16 hex value into a base-10 integer\n    function parseIntFromHex(val) {\n        return parseInt(val, 16);\n    }\n\n    // Need to handle 1.0 as 100%, since once it is a number, there is no difference between it and 1\n    // <http://stackoverflow.com/questions/7422072/javascript-how-to-detect-number-as-a-decimal-including-1-0>\n    function isOnePointZero(n) {\n        return typeof n == \"string\" && n.indexOf('.') != -1 && parseFloat(n) === 1;\n    }\n\n    // Check to see if string passed in is a percentage\n    function isPercentage(n) {\n        return typeof n === \"string\" && n.indexOf('%') != -1;\n    }\n\n    // Force a hex value to have 2 characters\n    function pad2(c) {\n        return c.length == 1 ? '0' + c : '' + c;\n    }\n\n    // Replace a decimal with it's percentage value\n    function convertToPercentage(n) {\n        if (n <= 1) {\n            n = (n * 100) + \"%\";\n        }\n\n        return n;\n    }\n\n    // Converts a decimal to a hex value\n    function convertDecimalToHex(d) {\n        return Math.round(parseFloat(d) * 255).toString(16);\n    }\n    // Converts a hex value to a decimal\n    function convertHexToDecimal(h) {\n        return (parseIntFromHex(h) / 255);\n    }\n\n    var matchers = (function() {\n\n        // <http://www.w3.org/TR/css3-values/#integers>\n        var CSS_INTEGER = \"[-\\\\+]?\\\\d+%?\";\n\n        // <http://www.w3.org/TR/css3-values/#number-value>\n        var CSS_NUMBER = \"[-\\\\+]?\\\\d*\\\\.\\\\d+%?\";\n\n        // Allow positive/negative integer/number.  Don't capture the either/or, just the entire outcome.\n        var CSS_UNIT = \"(?:\" + CSS_NUMBER + \")|(?:\" + CSS_INTEGER + \")\";\n\n        // Actual matching.\n        // Parentheses and commas are optional, but not required.\n        // Whitespace can take the place of commas or opening paren\n        var PERMISSIVE_MATCH3 = \"[\\\\s|\\\\(]+(\" + CSS_UNIT + \")[,|\\\\s]+(\" + CSS_UNIT + \")[,|\\\\s]+(\" + CSS_UNIT + \")\\\\s*\\\\)?\";\n        var PERMISSIVE_MATCH4 = \"[\\\\s|\\\\(]+(\" + CSS_UNIT + \")[,|\\\\s]+(\" + CSS_UNIT + \")[,|\\\\s]+(\" + CSS_UNIT + \")[,|\\\\s]+(\" + CSS_UNIT + \")\\\\s*\\\\)?\";\n\n        return {\n            rgb: new RegExp(\"rgb\" + PERMISSIVE_MATCH3),\n            rgba: new RegExp(\"rgba\" + PERMISSIVE_MATCH4),\n            hsl: new RegExp(\"hsl\" + PERMISSIVE_MATCH3),\n            hsla: new RegExp(\"hsla\" + PERMISSIVE_MATCH4),\n            hsv: new RegExp(\"hsv\" + PERMISSIVE_MATCH3),\n            hsva: new RegExp(\"hsva\" + PERMISSIVE_MATCH4),\n            hex3: /^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,\n            hex6: /^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,\n            hex8: /^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/\n        };\n    })();\n\n    // `stringInputToObject`\n    // Permissive string parsing.  Take in a number of formats, and output an object\n    // based on detected format.  Returns `{ r, g, b }` or `{ h, s, l }` or `{ h, s, v}`\n    function stringInputToObject(color) {\n\n        color = color.replace(trimLeft,'').replace(trimRight, '').toLowerCase();\n        var named = false;\n        if (names[color]) {\n            color = names[color];\n            named = true;\n        }\n        else if (color == 'transparent') {\n            return { r: 0, g: 0, b: 0, a: 0, format: \"name\" };\n        }\n\n        // Try to match string input using regular expressions.\n        // Keep most of the number bounding out of this function - don't worry about [0,1] or [0,100] or [0,360]\n        // Just return an object and let the conversion functions handle that.\n        // This way the result will be the same whether the tinycolor is initialized with string or object.\n        var match;\n        if ((match = matchers.rgb.exec(color))) {\n            return { r: match[1], g: match[2], b: match[3] };\n        }\n        if ((match = matchers.rgba.exec(color))) {\n            return { r: match[1], g: match[2], b: match[3], a: match[4] };\n        }\n        if ((match = matchers.hsl.exec(color))) {\n            return { h: match[1], s: match[2], l: match[3] };\n        }\n        if ((match = matchers.hsla.exec(color))) {\n            return { h: match[1], s: match[2], l: match[3], a: match[4] };\n        }\n        if ((match = matchers.hsv.exec(color))) {\n            return { h: match[1], s: match[2], v: match[3] };\n        }\n        if ((match = matchers.hsva.exec(color))) {\n            return { h: match[1], s: match[2], v: match[3], a: match[4] };\n        }\n        if ((match = matchers.hex8.exec(color))) {\n            return {\n                a: convertHexToDecimal(match[1]),\n                r: parseIntFromHex(match[2]),\n                g: parseIntFromHex(match[3]),\n                b: parseIntFromHex(match[4]),\n                format: named ? \"name\" : \"hex8\"\n            };\n        }\n        if ((match = matchers.hex6.exec(color))) {\n            return {\n                r: parseIntFromHex(match[1]),\n                g: parseIntFromHex(match[2]),\n                b: parseIntFromHex(match[3]),\n                format: named ? \"name\" : \"hex\"\n            };\n        }\n        if ((match = matchers.hex3.exec(color))) {\n            return {\n                r: parseIntFromHex(match[1] + '' + match[1]),\n                g: parseIntFromHex(match[2] + '' + match[2]),\n                b: parseIntFromHex(match[3] + '' + match[3]),\n                format: named ? \"name\" : \"hex\"\n            };\n        }\n\n        return false;\n    }\n\n    window.tinycolor = tinycolor;\n    })();\n\n    $(function () {\n        if ($.fn.spectrum.load) {\n            $.fn.spectrum.processNativeColorInputs();\n        }\n    });\n\n});\n\n// Spectrum Colorpicker\n// Swedish (sv) localization\n// https://github.com/bgrins/spectrum\n\n(function ( $ ) {\n\n    var localization = $.spectrum.localization[\"sv\"] = {\n        cancelText: \"Avbryt\",\n        chooseText: \"Välj\"\n    };\n\n    $.extend($.fn.spectrum.defaults, localization);\n\n})( jQuery );\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/select2/select2.html\",\"<style>\\r\\n    .select2 > .select2-choice.ui-select-match {\\r\\n        /* Because of the inclusion of Bootstrap */\\r\\n        height: 29px;\\r\\n    }\\r\\n\\r\\n    .selectize-control > .selectize-dropdown {\\r\\n        top: 36px;\\r\\n    }\\r\\n</style>\\r\\n\\r\\n<div class=\\\"form-group {{form.htmlClass}}\\\" ng-class=\\\"{\\'has-error\\': hasError()}\\\">\\r\\n    <label class=\\\"control-label\\\" ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\r\\n\\r\\n    <div class=\\\"input-group\\\">\\r\\n        <ui-select select2-search\\r\\n                   ng-show=\\\"form.key\\\"\\r\\n                   ng-model=\\\"$$value$$\\\"\\r\\n                   ng-model-options=\\\"form.ngModelOptions\\\"\\r\\n                   ng-disabled=\\\"form.readonly\\\"\\r\\n                   sf-changed=\\\"form\\\"\\r\\n                   ref=\\\"form.ref\\\"\\r\\n                   query=\\\"form.query\\\"\\r\\n                   shard=\\\"form.shard\\\"\\r\\n                   depends-on=\\\"form.dependsOn\\\">\\r\\n            <ui-select-match allow-clear=\\\"true\\\"\\r\\n                    ng-model=\\\"$$value$$\\\" placeholder=\\\"Search for {{form.title}}\\\">\\r\\n                {{printSelectedElement($select.selected)}}\\r\\n            </ui-select-match>\\r\\n            <ui-select-choices\\r\\n                    sf-changed=\\\"form\\\"\\r\\n                    ng-model=\\\"$$value$$\\\" refresh=\\\"search($select)\\\" refresh-delay=\\\"0\\\"\\r\\n                    repeat=\\\"selectIdField(item) as item in searchRes\\\">\\r\\n                <div ng-bind-html=\\\"selectDisplayField(item) | highlight: $select.search\\\"></div>\\r\\n                <small>\\r\\n                    <i>&lt;<span ng-bind-html=\\\"selectIdField(item)\\\"></span>&gt;</i>\\r\\n                </small>\\r\\n            </ui-select-choices>\\r\\n        </ui-select>\\r\\n        <span class=\\\"input-group-btn\\\">\\r\\n            <create-update-modal class=\\\"btn btn-primary\\\"\\r\\n                                 ng-model=\\\"$$value$$\\\"\\r\\n                                 sf-changed=\\\"form\\\"\\r\\n                                 ref=\\\"form.ref\\\" ng-click=\\\"open()\\\">New {{form.ref}}\\r\\n            </create-update-modal>\\r\\n            <create-update-modal class=\\\"btn btn-warning\\\"\\r\\n                                 ng-model=\\\"$$value$$\\\"\\r\\n                                 sf-changed=\\\"form\\\"\\r\\n                                 ref=\\\"form.ref\\\" type=\\\"edit\\\" ng-show=\\\"$$value$$\\\" ng-click=\\\"open()\\\">Edit\\r\\n            </create-update-modal>\\r\\n            <!--<button class=\\\"btn btn-primary\\\" ng-click=\\\"open()\\\">Create {{form.title}}</button>-->\\r\\n        </span>\\r\\n    </div>\\r\\n    <span class=\\\"help-block\\\">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span>\\r\\n</div>\\r\\n\\r\\n<script type=\\\"text/ng-template\\\" id=\\\"createUpdateModal.html\\\">\\r\\n    <div class=\\\"modal-header\\\">\\r\\n        <h3 class=\\\"modal-title\\\">Create a new {{schema.title}}</h3>\\r\\n    </div>\\r\\n    <div class=\\\"modal-body\\\">\\r\\n        <form name=\\\"ngForm\\\" sf-schema=\\\"schema\\\" sf-form=\\\"form\\\" sf-model=\\\"model\\\" ng-submit=\\\"submitForm(ngForm,model)\\\">\\r\\n            <input type=\\\"submit\\\" id=\\\"submit-form-{{schema.title}}\\\" class=\\\"hidden\\\"/></form>\\r\\n    </div>\\r\\n    <div class=\\\"modal-footer\\\">\\r\\n        <button class=\\\"btn btn-warning\\\" ng-click=\\\"cancel()\\\">Cancel</button>\\r\\n        <label class=\\\"btn btn-primary\\\" for=\\\"submit-form-{{schema.title}}\\\">Save</label><!--Ñapon del 15, pero fa el submit sense haver de fer coses rares :)-->\\r\\n    </div>\\r\\n</script>\");}]);\nangular.module('schemaForm').directive('select2Search', ['$http', '$routeParams', 'models', 'common', 'selectCache', function ($http, $routeParams, models, common, selectCache) {\r\n\r\n    return {\r\n        restrict: 'A',\r\n        scope: true,\r\n        require: ['ngModel'],\r\n        link: function (scope, element, attrs, ngModel) {\r\n            var modelName = $routeParams.schema;\r\n            var shard = $routeParams.shard;\r\n\r\n            if (!element.select)\r\n                return;\r\n\r\n            var displayField = \"\";\r\n            var idSelect = \"\";\r\n            var userq = scope.$eval(attrs.query);\r\n\r\n            var userShard = scope.$eval(attrs.shard);\r\n            if(userShard) {\r\n                userShard.replace('/this\\./', scope.$eval(attrs.key));\r\n                var actualShard = common.getField(userShard, scope.model);\r\n                if(actualShard){\r\n                    shard = actualShard;\r\n                }\r\n            }\r\n\r\n            var dependsOn = scope.$eval(attrs.dependsOn);\r\n            if (dependsOn) {\r\n                dependsOn = dependsOn.split(\"=\");\r\n            }\r\n\r\n            function getDocumentById(modelId) {\r\n                return function (query, skip) {\r\n                    return models.getModel(scope.$eval(attrs.ref), function (m) {\r\n                        var config = m.config;\r\n                        var elem = \"\";\r\n\r\n                        if (modelId instanceof Object) {\r\n                            elem = modelId[config.id];\r\n                        } else {\r\n                            elem = modelId;\r\n                        }\r\n\r\n                        selectCache.getDocument(scope.$eval(attrs.ref), elem, shard, function (doc) {\r\n                            displayField = config.displayField;\r\n                            idSelect = config.id;\r\n\r\n                            var q = {};\r\n                            q.query = {};\r\n                            var regex = query.search;\r\n                            q.query.$or = [];\r\n\r\n                            var forDisplay = {};\r\n                            forDisplay[displayField] = {$regex: regex, $options: 'i'};\r\n                            q.query.$or.push(forDisplay);\r\n\r\n\r\n                            if (config.id != \"_id\" && m.schema[config.id] && m.schema[config.id].type == \"string\") {\r\n                                var forID = {};\r\n                                forID[idSelect] = {$regex: regex, $options: 'i'};\r\n                                q.query.$or.push(forID);\r\n                            }\r\n\r\n                            if (dependsOn) {\r\n                                if (dependsOn[0] && scope.model[dependsOn[1]]) {\r\n                                    if (!isValidObjectID(scope.model[dependsOn[1]])) {\r\n                                        q.query[dependsOn[0]] = {\r\n                                            $regex: scope.model[dependsOn[1]],\r\n                                            $options: 'i'\r\n                                        };\r\n                                    } else {\r\n                                        q.query[dependsOn[0]] = scope.model[dependsOn[1]];\r\n                                    }\r\n                                }\r\n                            }\r\n\r\n                            function isValidObjectID(str) {\r\n                                // A valid Object Id must be 24 hex characters\r\n                                return (/^[0-9a-fA-F]{24}$/).test(str);\r\n                            }\r\n\r\n                            q.limit = 20;\r\n                            q.skip = skip;\r\n\r\n                            angular.extend(q, userq || {});\r\n                            selectCache.search(scope.$eval(attrs.ref), q, shard, function (response, count) {\r\n                                if (skip)\r\n                                    scope.searchRes = scope.searchRes.concat(response);\r\n                                else\r\n                                    scope.searchRes = response;\r\n\r\n                                if (doc) {\r\n                                    var present = scope.searchRes.some(function (element) {\r\n                                        return element[config.id] == doc[config.id];\r\n                                    });\r\n\r\n                                    if (!present) {\r\n                                        scope.searchRes.splice(0, 0, doc);\r\n                                    }\r\n                                }\r\n                            });\r\n                        });\r\n                    });\r\n                }\r\n            }\r\n\r\n            var elements = getDocumentById(scope.$eval(attrs.ngModel));\r\n\r\n            scope.$watch(function () {\r\n                if (dependsOn) {\r\n                    if (scope.model[dependsOn[1]])\r\n                        return scope.model[dependsOn[1]];\r\n                }\r\n            }, function (newValue) {\r\n                getDocumentById(scope.$eval(attrs.ngModel))({search: ''});\r\n            });\r\n\r\n            scope.disabled = false;\r\n            scope.searchEnabled = true;\r\n            scope.searchRes = [];\r\n            scope.search = elements;\r\n\r\n            scope.printSelectedElement = function (document) {\r\n                if (document) {\r\n                    var f = common.getField(displayField, document);\r\n                    if (f && f != \"\" && f.length > 0)\r\n                        return f + \" <\" + document[idSelect] + \">\";\r\n                    else {\r\n                        return \"No display field. ID: <\" + document[idSelect] + \">\";\r\n                    }\r\n                }\r\n            };\r\n\r\n            scope.selectDisplayField = function (document) {\r\n                if (document) {\r\n                    var f = common.getField(displayField, document);\r\n                    if (f && f != \"\" && f.length > 0)\r\n                        return f;\r\n                    else {\r\n                        return \"<empty>\";\r\n                    }\r\n                }\r\n            };\r\n\r\n            scope.selectIdField = function (document) {\r\n                if (document != undefined) {\r\n                    return document[idSelect] || \"No ID\";\r\n                }\r\n            };\r\n\r\n            scope.$on('refreshSelect2' + scope.$eval(attrs.ref), function () {\r\n                console.log(\"REFRESH SELECT2\");\r\n                elements();\r\n            });\r\n\r\n            element.find('ul').bind('scroll', function () {\r\n                var raw = arguments[0].target;\r\n                if (raw.scrollTop + raw.offsetHeight > raw.scrollHeight) {\r\n                    elements(scope.$select, (raw.children[0].children.length - 2));\r\n                }\r\n            });\r\n        }\r\n    }\r\n}\r\n])\r\n;\r\n\r\nvar modalController = function ($scope, $http, $modalInstance, $routeParams, models, configs, modelName, id, dependsOn, common) {\r\n    //Override the functinos for every opened modal (fixes problem with residual variables)\r\n    var fromSchema = $routeParams.schema;\r\n    $routeParams.schema = modelName;\r\n    $routeParams.id = id;\r\n\r\n    //TODO: Maybe we should avoid duplicate code with formController !\r\n    models.getModel(modelName, function (m) {\r\n        var s = m.schema;\r\n        var base = function (doc) {\r\n            $scope.schema = {\r\n                \"type\": \"object\",\r\n                \"title\": modelName,\r\n                \"action\": (doc) ? \"Edit\" : \"New\",\r\n                \"properties\": s\r\n            };\r\n\r\n            var innerForm = common.processForm(m.config.form, false);\r\n\r\n            $scope.form = innerForm;\r\n\r\n            $scope.model = doc || {};\r\n\r\n            if (!doc && models.getShard(fromSchema) && models.getShard(fromSchema).value) {\r\n                $scope.model[models.getShard(fromSchema).key] = models.getShard(fromSchema).value;\r\n            }\r\n\r\n            dependsOn.apply($scope, modelName, $scope.model);\r\n\r\n            $scope.submitForm = function (form, model) {\r\n                // First we broadcast an event so all fields validate themselves\r\n                $scope.$broadcast('schemaFormValidate');\r\n                // Then we check if the form is valid\r\n                if (form.$valid) {\r\n                    if ($scope.schema.action === \"New\") {\r\n                        models.postDocument(modelName, model, function (response) {\r\n                            if (response.status == '201') {\r\n                                $scope.$broadcast('postedDocument', response.data);\r\n                                $modalInstance.close('saved');\r\n                            }\r\n                        });\r\n                    } else {\r\n                        models.putDocument(modelName, id, model, function (response) {\r\n                            if (response.status == '200') {\r\n                                $scope.$broadcast('postedDocument', response.data);\r\n                                $scope.$broadcast('puttedDocument', response.data);\r\n                                $modalInstance.close('saved');\r\n                            }\r\n                        });\r\n                    }\r\n                } else {\r\n                    alert('invalid form');\r\n                }\r\n            }\r\n        };\r\n\r\n        if (id) {\r\n            models.getDocument(modelName, id, function (document) {\r\n                base(document);\r\n            });\r\n        } else {\r\n            base();\r\n        }\r\n    });\r\n\r\n    $scope.cancel = function () {\r\n        $modalInstance.dismiss('cancel');\r\n    };\r\n};\nmodalController.$inject = ['$scope', '$http', '$modalInstance', '$routeParams', 'models', 'configs', 'modelName', 'id', 'dependsOn', 'common'];\r\n\r\nangular.module('schemaForm').directive('createUpdateModal', ['$http', '$routeParams', '$rootScope', '$modal', 'models', function ($http, $routeParams, $rootScope, $modal, models) {\r\n    return {\r\n        restrict: 'E',\r\n        scope: true,\r\n        require: ['ngModel'],\r\n        link: function (scope, element, attrs, ngModel) {\r\n            scope.open = function () {\r\n                var modalInstance = $modal.open({\r\n                    templateUrl: 'createUpdateModal.html',\r\n                    controller: modalController,\r\n                    size: 'lg',\r\n                    resolve: {\r\n                        modelName: function () {\r\n                            return scope.$eval(attrs.ref);\r\n                        },\r\n                        id: function () {\r\n                            if (attrs.type == \"edit\")\r\n                                return scope.$eval(attrs.ngModel);\r\n                            else\r\n                                return \"\";\r\n                        }\r\n                    }\r\n                });\r\n\r\n                modalInstance.result.then(function () {\r\n                    $rootScope.$broadcast('refreshSelect2' + scope.$eval(attrs.ref));\r\n                }, function () {\r\n                    console.info('Modal dismissed at: ' + new Date());\r\n                });\r\n            };\r\n        }\r\n    }\r\n}]);\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n            var select2 = function (name, schema, options) {\r\n                if (schema.ref) {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'select2';\r\n                    f.query = schema.query;\r\n                    f.ref = schema.ref;\r\n                    f.shard = schema.shard;\r\n                    f.dependsOn = schema.dependsOn;\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.string.unshift(select2);\r\n            schemaFormProvider.defaults.object.unshift(select2);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'select2',\r\n                'directives/decorators/bootstrap/select2/select2.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'select2',\r\n                'directives/decorators/bootstrap/select2/select2.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/simpleselect2/simple-select2.html\",\"<div class=\\\"form-group {{form.htmlClass}} schema-form-select\\\"\\n     ng-class=\\\"{\\'has-error\\': form.disableErrorState !== true && hasError(), \\'has-success\\': form.disableSuccessState !== true && hasSuccess(), \\'has-feedback\\': form.feedback !== false}\\\">\\n  <label class=\\\"control-label {{form.labelHtmlClass}}\\\" ng-show=\\\"showTitle()\\\">\\n    {{form.title}}\\n  </label>\\n  <select simple-select\\n\t      ng-model=\\\"$$value$$\\\"\\n          ng-model-options=\\\"form.ngModelOptions\\\"\\n          ng-disabled=\\\"form.readonly\\\"\\n          sf-changed=\\\"form\\\"\\n          class=\\\"form-control {{form.fieldHtmlClass}}\\\"\\n          schema-validate=\\\"form\\\"\\n          map=\\\"form.map\\\"\\n          dynmap=\\\"form.dynMap\\\"\\n          dynenum=\\\"form.dynEnum\\\"\\n          ng-options=\\\"item.value as item.name group by item.group for item in titleMap\\\"\\n          name=\\\"{{form.key.slice(-1)[0]}}\\\">\\n  </select>\\n  <div class=\\\"help-block\\\" sf-message=\\\"form.description\\\"></div>\\n</div>\\n\");}]);\r\nangular.module('schemaForm').directive('simpleSelect', ['$http', '$routeParams', 'models', function ($http, $routeParams, models) {\r\n\r\n    return {\r\n        restrict: 'AE',\r\n        require: ['ngModel'],\r\n        link: function (scope, element, attrs, ngModel) {\r\n            scope.titleMap = [];\r\n\r\n            var map = scope.$eval(attrs.map);\r\n            var dynMap = scope.$eval(attrs.dynmap);\r\n            var dynEnum = scope.$eval(attrs.dynenum);\r\n\r\n            if(dynEnum){\r\n                $http.get(dynEnum).then(function(res){\r\n                    var resultMap = {};\r\n                    angular.forEach(res.data, function(elem){\r\n                        resultMap[elem] = elem;\r\n                    });\r\n                    setMap(resultMap);\r\n                });\r\n            } else if(dynMap){\r\n                $http.get(dynMap).then(function(res){\r\n                   setMap(res.data);\r\n                });\r\n            } else if(map){\r\n                setMap(map);\r\n            }\r\n\r\n            function setMap(map){\r\n                angular.forEach(Object.keys(map), function(key) {\r\n                    var value = map[key];\r\n                    var o = {};\r\n                    o.value = key;\r\n                    if(typeof(value)==\"string\") {\r\n                        o.name = value;\r\n                    } else {\r\n                        o.name = value.name;\r\n                        o.group = value.group;\r\n                    }\r\n                    scope.titleMap.push(o);\r\n                });\r\n            }\r\n        }\r\n    }\r\n}]);\r\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var select2 = function (name, schema, options) {\r\n                if (schema.map || schema.dynEnum || schema.dynMap) {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'simpleselect2';\r\n                    f.map = schema.map;\r\n                    f.dynMap = schema.dynMap;\r\n                    f.dynEnum = schema.dynEnum;\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.string.unshift(select2);\r\n            schemaFormProvider.defaults.number.unshift(select2);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'simpleselect2',\r\n                'directives/decorators/bootstrap/simpleselect2/simple-select2.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'simpleselect2',\r\n                'directives/decorators/bootstrap/simpleselect2/simple-select2.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/datetimepicker/datetimepicker.html\",\"<div class=\\\"form-group schema-form-{{form.type}} {{form.htmlClass}}\\\">\\r\\n    <!--<div ri-date date-picker=\\\"date\\\" view=\\\"minutes\\\" ng-model=\\\"$$value$$\\\"></div>-->\\r\\n    <label class=\\\"control-label\\\" ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\r\\n\\r\\n    <div ri-date ng-model=\\\"$$value$$\\\">\\r\\n        <!--<div class=\\\"col-md-6\\\">-->\\r\\n            <!--<div date-picker=\\\"modelDate\\\" view=\\\"date\\\" max-view=\\\"month\\\" min-view=\\\"date\\\"></div>-->\\r\\n        <!--</div>-->\\r\\n        <!--<div class=\\\"col-md-6\\\">-->\\r\\n            <!--<div date-picker=\\\"modelHours\\\" view=\\\"hours\\\" max-view=\\\"hours\\\"></div>-->\\r\\n        <!--</div>-->\\r\\n        <input date-time type=\\\"datetime\\\" ng-model=\\\"modelDate\\\" ng-change=\\\"{{updateDate(modelDate)}}\\\" view=\\\"date\\\" max-view=\\\"date\\\" class=\\\"form-control\\\" format=\\\"medium\\\">\\r\\n    </div>\\r\\n</div>\");}]);\nangular.module('schemaForm').directive('riDate', ['$http', 'models', function ($http, models) {\r\n\r\n    return {\r\n        restrict: 'A',\r\n        require: 'ngModel',\r\n        scope:false,\r\n        link: function (scope, element, attrs, ngModel) {\r\n            scope.modelDate = null;\r\n            ngModel.$render = function(){\r\n                if(ngModel.$viewValue){\r\n                    if(!scope.modelDate || (scope.modelDate && scope.modelDate.toString() != ngModel.$viewValue)) {\r\n                        scope.modelDate = new Date(ngModel.$viewValue);\r\n                    }\r\n                    //scope.modelHours = new Date(ngModel.$viewValue);\r\n                }\r\n            };\r\n\r\n            scope.updateDate = function(m){\r\n                ngModel.$setViewValue(m);\r\n\r\n                if(m == \"\" || !m){\r\n                    ngModel.$setViewValue(null);\r\n                }\r\n            };\r\n        }\r\n    }\r\n}]);\r\n\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var mixed = function (name, schema, options) {\r\n                if (schema.type === 'string' && (schema.format === 'datetimepicker' || schema.format === \"date\")) {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'datetimepicker';\r\n                    f.format = schema.dateFormat;\r\n\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.string.unshift(mixed);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'datetimepicker',\r\n                'directives/decorators/bootstrap/datetimepicker/datetimepicker.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'datetimepicker',\r\n                'directives/decorators/bootstrap/datetimepicker/datetimepicker.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/new-imageinjector/new-imageinjector.html\",\"<link rel=\\\"stylesheet\\\" href=\\\"//cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.1.3/css/jasny-bootstrap.min.css\\\">\\r\\n<div class=\\\"form-group\\\" ng-class=\\\"{\\'has-error\\': hasError()}\\\">\\r\\n    <label class=\\\"control-label\\\" ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\r\\n\\r\\n    <div class=\\\"input-group\\\">\\r\\n        <div class=\\\"fileinput fileinput-new\\\" data-provides=\\\"fileinput\\\">\\r\\n            <div class=\\\"fileinput-new thumbnail\\\" style=\\\"width: 200px; height: 150px;\\\">\\r\\n                <img bk-new-image-view ng-model=\\\"$$value$$\\\" ng-src=\\\"{{image}}\\\" filename=\\\"$$value$$.image\\\">\\r\\n            </div>\\r\\n            <p>{{$$value$$.originalName}}</p>\\r\\n\\r\\n            <div class=\\\"fileinput-preview fileinput-exists thumbnail\\\"\\r\\n                 style=\\\"max-width: 200px; max-height: 150px;\\\"></div>\\r\\n            <div>\\r\\n                <span class=\\\"btn btn-default btn-file\\\">\\r\\n                    <span class=\\\"fileinput-new\\\"><span class=\\\"glyphicon glyphicon-cloud-upload\\\"></span></span> <!-- upload image -->\\r\\n                    <span class=\\\"fileinput-exists\\\"><span class=\\\"glyphicon glyphicon-pencil\\\"></span></span> <!-- change image -->\\r\\n                    <input bk-new-image-uploader\\r\\n                           type=\\\"file\\\"\\r\\n                           name=\\\"image\\\"\\r\\n                           path=\\\"form.path\\\"\\r\\n                           index=\\\"{{arrayIndex}}\\\"\\r\\n                           ngf-select=\\\"true\\\" ng-model=\\\"myFiles\\\" ngf-change=\\\"imageExists=false; onFileSelect($files)\\\">\\r\\n                </span>\\r\\n                <a href=\\\" #\\\" class=\\\"btn btn-default fileinput-exists\\\" data-dismiss=\\\"fileinput\\\"><span\\r\\n                        class=\\\"glyphicon glyphicon-remove\\\"></span></a> <!-- discard -->\\r\\n                <a ng-if=\\\"imageExists\\\" download=\\\"{{$$value$$.image}}\\\" ng-href=\\\"{{image}}\\\" target=\\\"_self\\\"\\r\\n                   class=\\\"btn btn-default\\\"><span class=\\\"glyphicon glyphicon-cloud-download\\\"></span></a>\\r\\n                <!-- download -->\\r\\n                <a ng-if=\\\"imageExists\\\" ng-click=\\\"deleteImage(arrayIndex)\\\" class=\\\"btn btn-default\\\"><span\\r\\n                        class=\\\"glyphicon glyphicon-trash\\\"></span></a> <!-- delete from server -->\\r\\n            </div>\\r\\n        </div>\\r\\n    </div>\\r\\n    <span class=\\\"help-block\\\">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span>\\r\\n</div>\\r\\n<script src=\\\"//cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.1.3/js/jasny-bootstrap.min.js\\\"></script>\");}]);\nangular.module('schemaForm')\r\n    .directive('bkNewImageUploader', ['$http', '$routeParams', '$timeout', 'models', function ($http, $routeParams, $timeout, models) {\r\n        return {\r\n            restrict: 'A',\r\n            scope: true,\r\n            link: function (scope, element, attrs, ngModel) {\r\n                var modelName = $routeParams.schema;\r\n                scope.onFileSelect = function ($files) {\r\n                    if ($files && $files.length > 0) {\r\n                        scope.$on('postedDocument', function (event, args) {\r\n                            if (scope.myFiles && scope.myFiles.length > 0) {\r\n                                var file = scope.myFiles[0];\r\n                                models.getModelConfig(modelName, function (config) {\r\n                                    var fieldName = scope.$eval(attrs.path);\r\n                                    //console.log(modelName, args[config.id], fieldName, scope.$eval(attrs.index), file);\r\n                                    models.uploadImage(modelName, args[config.id], fieldName, scope.arrayIndex, file, function (data) {\r\n                                        //console.log(data);\r\n                                    });\r\n                                });\r\n                            }\r\n                        });\r\n                    }\r\n                };\r\n            }\r\n        }\r\n    }])\r\n    .directive('bkNewImageView', ['$routeParams', 'models', function ($routeParams, models) {\r\n        return {\r\n            restrict: 'A',\r\n            require: 'ngModel',\r\n            link: function (scope, element, attrs, ngModel) {\r\n                var defaultImage = '//dummyimage.com/200x150/cccccc/ffffff&text=Upload+Image';\r\n                var id = $routeParams.id;\r\n                var modelName = $routeParams.schema;\r\n                scope.$watch(attrs.filename, function (value) {\r\n                    if (value) {\r\n                        models.getImageUrl(modelName, id, value, function (url) {\r\n                            scope.image = url;\r\n                            scope.imageExists = true;\r\n                        });\r\n                    } else {\r\n                        scope.image = defaultImage;\r\n                        scope.imageExists = false;\r\n                    }\r\n                });\r\n\r\n                scope.downloadImage = function () {\r\n                    console.log(\"TODO: Download image from model\", modelName, \"and id\", id);\r\n                };\r\n\r\n                scope.deleteImage = function (index, model) {\r\n                    models.deleteImage(modelName, id, index, scope.$eval(attrs.filename), function () {\r\n                        console.log(\"Image deleted\");\r\n                        ngModel.$setViewValue(null);\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    }]);\r\n\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var newImageInjector = function (name, schema, options) {\r\n                if (schema.type === 'image') {\r\n                    var pathArray = options.path.filter(function(e){return e});\r\n                    //pathArray = pathArray.map(function (e) {\r\n                    //    if (e != \"\") {\r\n                    //        return e;\r\n                    //    }\r\n                    //});\r\n                    var path = pathArray.join('.');\r\n\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'image';\r\n                    f.index = 'arrayIndex';\r\n                    f.path = path;\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            if (!schemaFormProvider.defaults.image)\r\n                schemaFormProvider.defaults.image = [];\r\n            schemaFormProvider.defaults.image.unshift(newImageInjector);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'image',\r\n                'directives/decorators/bootstrap/new-imageinjector/new-imageinjector.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'image',\r\n                'directives/decorators/bootstrap/new-imageinjector/new-imageinjector.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/imageinjector/imageinjector.html\",\"<link rel=\\\"stylesheet\\\" href=\\\"//cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.1.3/css/jasny-bootstrap.min.css\\\">\\r\\n<div class=\\\"form-group\\\" ng-class=\\\"{\\'has-error\\': hasError()}\\\">\\r\\n    <label class=\\\"control-label\\\" ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\r\\n\\r\\n    <div class=\\\"input-group\\\">\\r\\n        <div class=\\\"fileinput fileinput-new\\\" data-provides=\\\"fileinput\\\">\\r\\n            <div class=\\\"fileinput-new thumbnail\\\" style=\\\"width: 200px; height: 150px;\\\">\\r\\n                <img bk-image-view ng-src=\\\"{{image}}\\\" filename=\\\"$$value$$\\\">\\r\\n            </div>\\r\\n            {{$$value$$}}\\r\\n            <div class=\\\"fileinput-preview fileinput-exists thumbnail\\\"\\r\\n                 style=\\\"max-width: 200px; max-height: 150px;\\\"></div>\\r\\n            <div>\\r\\n                <span class=\\\"btn btn-default btn-file\\\">\\r\\n                    <span class=\\\"fileinput-new\\\"><span class=\\\"glyphicon glyphicon-cloud-upload\\\"></span></span> <!-- upload image -->\\r\\n                    <span class=\\\"fileinput-exists\\\"><span class=\\\"glyphicon glyphicon-pencil\\\"></span></span> <!-- change image -->\\r\\n                    <input bk-image-uploader\\r\\n                           type=\\\"file\\\"\\r\\n                           name=\\\"image\\\"\\r\\n                           path=\\\"form.path\\\"\\r\\n                           index=\\\"{{arrayIndex}}\\\"\\r\\n                           ngf-select=\\\"true\\\" ng-model=\\\"myFiles\\\" ngf-change=\\\"imageExists=false; onFileSelect($files)\\\">\\r\\n                </span>\\r\\n                <a href=\\\" #\\\" class=\\\"btn btn-default fileinput-exists\\\" data-dismiss=\\\"fileinput\\\"><span class=\\\"glyphicon glyphicon-remove\\\"></span></a> <!-- discard -->\\r\\n                <a ng-if=\\\"imageExists\\\" download=\\\"{{$$value$$}}\\\" ng-href=\\\"{{image}}\\\" target=\\\"_self\\\" class=\\\"btn btn-default\\\"><span class=\\\"glyphicon glyphicon-cloud-download\\\"></span></a> <!-- download -->\\r\\n                <a ng-if=\\\"imageExists\\\" ng-click=\\\"deleteFile(arrayIndex)\\\" class=\\\"btn btn-default\\\"><span class=\\\"glyphicon glyphicon-trash\\\"></span></a> <!-- delete from server -->\\r\\n            </div>\\r\\n        </div>\\r\\n    </div>\\r\\n    <span class=\\\"help-block\\\">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span>\\r\\n</div>\\r\\n<script src=\\\"//cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.1.3/js/jasny-bootstrap.min.js\\\"></script>\");}]);\nangular.module('schemaForm')\r\n    .directive('bkImageUploader', ['$http', '$routeParams', '$timeout', 'models', function ($http, $routeParams, $timeout, models) {\r\n        return {\r\n            restrict: 'A',\r\n            scope: true,\r\n            link: function (scope, element, attrs, ngModel) {\r\n                var modelName = $routeParams.schema;\r\n                scope.onFileSelect = function ($files) {\r\n                    if($files && $files.length>0) {\r\n                        scope.$on('postedDocument', function (event, args) {\r\n                                if (scope.myFiles && scope.myFiles.length > 0) {\r\n                                    var file = scope.myFiles[0];\r\n                                    models.getModelConfig(modelName, function (config) {\r\n                                        var fieldName = scope.$eval(attrs.path);\r\n                                        //console.log(modelName, args[config.id], fieldName, scope.$eval(attrs.index), file);\r\n                                        models.uploadImage(modelName, args[config.id], fieldName, scope.arrayIndex, file, function (data) {\r\n                                            //console.log(data);\r\n                                        });\r\n                                    });\r\n                                }\r\n                        });\r\n                    }\r\n                };\r\n            }\r\n        }\r\n    }])\r\n    .directive('bkImageView', ['$routeParams', 'models', function ($routeParams, models) {\r\n        return {\r\n            restrict: 'A',\r\n            link: function (scope, element, attrs, ngModel) {\r\n                var defaultImage = '//dummyimage.com/200x150/cccccc/ffffff&text=Upload+Image';\r\n                var id = $routeParams.id;\r\n                var modelName = $routeParams.schema;\r\n                scope.$watch(attrs.filename, function (value) {\r\n                    if (value) {\r\n                        models.getImageUrl(modelName, id, value, function (url) {\r\n                            scope.image = url;\r\n                            scope.imageExists = true;\r\n                        });\r\n                    } else {\r\n                        scope.image = defaultImage;\r\n                        scope.imageExists = false;\r\n                    }\r\n                });\r\n\r\n                scope.downloadImage = function () {\r\n                    console.log(\"TODO: Download image from model\", modelName, \"and id\", id);\r\n                };\r\n\r\n                scope.deleteImage = function (index) {\r\n                    models.deleteImage(modelName, id, index, scope.$eval(attrs.filename), function () {\r\n                        console.log(\"Image deleted\");\r\n                        scope.image = defaultImage;\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    }]);\r\n\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var imageinjector = function (name, schema, options) {\r\n                if (schema.type === 'string' && schema.format === 'image') {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'imageinjector';\r\n                    f.index = 'arrayIndex';\r\n                    f.path = schema.path;\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.string.unshift(imageinjector);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'imageinjector',\r\n                'directives/decorators/bootstrap/imageinjector/imageinjector.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'imageinjector',\r\n                'directives/decorators/bootstrap/imageinjector/imageinjector.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/fileinjector/fileinjector.html\",\"<link rel=\\\"stylesheet\\\" href=\\\"//cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.1.3/css/jasny-bootstrap.min.css\\\">\\r\\n<div class=\\\"form-group\\\" ng-class=\\\"{\\'has-error\\': hasError()}\\\">\\r\\n    <label class=\\\"control-label\\\" ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\r\\n\\r\\n    <div class=\\\"input-group\\\">\\r\\n        <div class=\\\"fileinput fileinput-new\\\" data-provides=\\\"fileinput\\\">\\r\\n            <div class=\\\"fileinput-new thumbnail\\\" style=\\\"width: 200px; height: 150px;\\\">\\r\\n                <img bk-file-view ng-src=\\\"{{file}}\\\" filename=\\\"$$value$$\\\">\\r\\n            </div>\\r\\n            {{$$value$$}}\\r\\n            <div class=\\\"fileinput-preview fileinput-exists thumbnail\\\"\\r\\n                 style=\\\"max-width: 200px; max-height: 150px;\\\"></div>\\r\\n            <div>\\r\\n                <span class=\\\"btn btn-default btn-file\\\">\\r\\n                    <span class=\\\"fileinput-new\\\"><span class=\\\"glyphicon glyphicon-cloud-upload\\\"></span></span> <!-- upload file -->\\r\\n                    <span class=\\\"fileinput-exists\\\"><span class=\\\"glyphicon glyphicon-pencil\\\"></span></span> <!-- change file -->\\r\\n                    <input bk-file-uploader\\r\\n                           type=\\\"file\\\"\\r\\n                           name=\\\"file\\\"\\r\\n                           path=\\\"form.path\\\"\\r\\n                           index=\\\"{{arrayIndex}}\\\"\\r\\n                           ngf-select=\\\"true\\\" ng-model=\\\"myFiles\\\" ngf-change=\\\"fileExists=false; onFileSelect($files)\\\">\\r\\n                </span>\\r\\n                <a href=\\\" #\\\" class=\\\"btn btn-default fileinput-exists\\\" data-dismiss=\\\"fileinput\\\"><span class=\\\"glyphicon glyphicon-remove\\\"></span></a> <!-- discard -->\\r\\n                <a ng-if=\\\"fileExists\\\" download=\\\"{{$$value$$}}\\\" ng-href=\\\"{{file}}\\\" target=\\\"_self\\\" class=\\\"btn btn-default\\\"><span class=\\\"glyphicon glyphicon-cloud-download\\\"></span></a> <!-- download -->\\r\\n                <a ng-if=\\\"fileExists\\\" ng-click=\\\"deleteFile(arrayIndex)\\\" class=\\\"btn btn-default\\\"><span class=\\\"glyphicon glyphicon-trash\\\"></span></a> <!-- delete from server -->\\r\\n            </div>\\r\\n        </div>\\r\\n    </div>\\r\\n    <span class=\\\"help-block\\\">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span>\\r\\n</div>\\r\\n<script src=\\\"//cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.1.3/js/jasny-bootstrap.min.js\\\"></script>\");}]);\nangular.module('schemaForm')\r\n    .directive('bkFileUploader', ['$http', '$routeParams', '$timeout', 'models', function ($http, $routeParams, $timeout, models) {\r\n        return {\r\n            restrict: 'A',\r\n            scope: true,\r\n            link: function (scope, element, attrs, ngModel) {\r\n                var modelName = $routeParams.schema;\r\n                scope.onFileSelect = function ($files) {\r\n                    if ($files && $files.length > 0) {\r\n                        scope.$on('postedDocument', function (event, args) {\r\n                            if (scope.myFiles && scope.myFiles.length > 0) {\r\n                                var file = scope.myFiles[0];\r\n                                models.getModelConfig(modelName, function (config) {\r\n                                    var fieldName = scope.$eval(attrs.path);\r\n                                    //console.log(modelName, args[config.id], fieldName, scope.$eval(attrs.index), file);\r\n                                    models.uploadFile(modelName, args[config.id], fieldName, scope.arrayIndex, file, function (data) {\r\n                                        //console.log(data);\r\n                                    });\r\n                                });\r\n                            }\r\n                        });\r\n                    }\r\n                };\r\n            }\r\n        }\r\n    }])\r\n    .directive('bkFileView', ['$routeParams', 'models', function ($routeParams, models) {\r\n        return {\r\n            restrict: 'A',\r\n            link: function (scope, element, attrs, ngModel) {\r\n                var defaultImageForFile = '//dummyimage.com/200x150/cccccc/ffffff&text=Upload+File';\r\n                var id = $routeParams.id;\r\n                var modelName = $routeParams.schema;\r\n                scope.$watch(attrs.filename, function (value) {\r\n                    if (value) {\r\n                        models.getFileUrl(modelName, id, value, function (url) {\r\n                            scope.file = url;\r\n                            scope.fileExists = true;\r\n                        });\r\n                    } else {\r\n                        scope.file = defaultImageForFile;\r\n                        scope.fileExists = false;\r\n                    }\r\n                });\r\n\r\n                scope.downloadImage = function () {\r\n                    console.log(\"TODO: Download file from model\", modelName, \"and id\", id);\r\n                };\r\n\r\n                scope.deleteFile = function (index) {\r\n                    models.deleteFile(modelName, id, index, scope.$eval(attrs.filename), function () {\r\n                        console.log(\"File deleted\");\r\n                        scope.file = defaultImageForFile;\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    }]);\r\n\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var fileinjector = function (name, schema, options) {\r\n                if (schema.type === 'string' && schema.format === 'file') {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'fileinjector';\r\n                    f.index = 'arrayIndex';\r\n                    f.path = schema.path;\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.string.unshift(fileinjector);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'fileinjector',\r\n                'directives/decorators/bootstrap/fileinjector/fileinjector.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'fileinjector',\r\n                'directives/decorators/bootstrap/fileinjector/fileinjector.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/mixed/mixed.html\",\"<link rel=\\\"stylesheet\\\" href=\\\"dist/css/codemirror/theme/monokai.css\\\"/>\\r\\n<div class=\\\"form-group\\\" ng-class=\\\"{\\'has-error\\': hasError()}\\\">\\r\\n    <label class=\\\"control-label\\\" ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\r\\n    <ui-codemirror ui-codemirror-opts=\\\"editorOptions\\\" ng-model=\\\"$$value$$\\\" ui-codemirror=\\\"{ onLoad : codemirrorLoaded }\\\"></ui-codemirror>\\r\\n    <span class=\\\"help-block\\\">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span>\\r\\n</div>\\r\\n<script src=\\\"dist/extra/codemirror/javascript.js\\\"></script>\");}]);\nangular.module('schemaForm').directive('uiCodemirror', ['$http', '$routeParams', 'models', function ($http, $routeParams, models) {\r\n    return {\r\n        restrict: 'AE',\r\n        require: 'ngModel',\r\n        link: function (scope, element, attrs, ngModel) {\r\n            scope.editorOptions = {\r\n                lineNumbers: true,\r\n                //theme: 'monokai',\r\n                mode: 'application/json',\r\n                foldGutter: {\r\n                    rangeFinder: new CodeMirror.fold.combine(CodeMirror.fold.brace)\r\n                },\r\n                matchBrackets: true,\r\n                gutters: [\"CodeMirror-foldgutter\"]\r\n            };\r\n        }\r\n    }\r\n}]);\r\n\r\nangular.module('ui.codemirror', []).constant('uiCodemirrorConfig', {}).directive('uiCodemirror', ['uiCodemirrorConfig', function (uiCodemirrorConfig) {\r\n        return {\r\n            restrict: 'EA',\r\n            require: '?ngModel',\r\n            priority: 1,\r\n            compile: function compile() {\r\n                // Require CodeMirror\r\n                if (angular.isUndefined(window.CodeMirror)) {\r\n                    throw new Error('ui-codemirror need CodeMirror to work... (o rly?)');\r\n                }\r\n                return function postLink(scope, iElement, iAttrs, ngModel) {\r\n                    var options, opts, codeMirror, initialTextValue;\r\n                    initialTextValue = iElement.text();\r\n                    options = uiCodemirrorConfig.codemirror || {};\r\n                    opts = angular.extend({value: initialTextValue}, options, scope.$eval(iAttrs.uiCodemirror), scope.$eval(iAttrs.uiCodemirrorOpts));\r\n                    if (iElement[0].tagName === 'TEXTAREA') {\r\n                        // Might bug but still ...\r\n                        codeMirror = window.CodeMirror.fromTextArea(iElement[0], opts);\r\n                    } else {\r\n                        iElement.html('');\r\n                        codeMirror = new window.CodeMirror(function (cm_el) {\r\n                            iElement.append(cm_el);\r\n                        }, opts);\r\n                    }\r\n                    if (iAttrs.uiCodemirror || iAttrs.uiCodemirrorOpts) {\r\n                        var codemirrorDefaultsKeys = Object.keys(window.CodeMirror.defaults);\r\n                        scope.$watch(iAttrs.uiCodemirror || iAttrs.uiCodemirrorOpts, function updateOptions(newValues, oldValue) {\r\n                            if (!angular.isObject(newValues)) {\r\n                                return;\r\n                            }\r\n                            codemirrorDefaultsKeys.forEach(function (key) {\r\n                                if (newValues.hasOwnProperty(key)) {\r\n                                    if (oldValue && newValues[key] === oldValue[key]) {\r\n                                        return;\r\n                                    }\r\n                                    codeMirror.setOption(key, newValues[key]);\r\n                                }\r\n                            });\r\n                        }, true);\r\n                    }\r\n                    if (ngModel) {\r\n                        // CodeMirror expects a string, so make sure it gets one.\r\n                        // This does not change the model.\r\n                        ngModel.$formatters.push(function (value) {\r\n                            if (angular.isUndefined(value) || value === null) {\r\n                                return '';\r\n                            } else if (angular.isObject(value) || angular.isArray(value)) {\r\n                                return JSON.stringify(value);\r\n                            }\r\n                            return value;\r\n                        });\r\n                        // Override the ngModelController $render method, which is what gets called when the model is updated.\r\n                        // This takes care of the synchronizing the codeMirror element with the underlying model, in the case that it is changed by something else.\r\n                        ngModel.$render = function () {\r\n                            //Code mirror expects a string so make sure it gets one\r\n                            //Although the formatter have already done this, it can be possible that another formatter returns undefined (for example the required directive)\r\n                            var safeViewValue = ngModel.$viewValue || '';\r\n                            codeMirror.setValue(safeViewValue);\r\n                        };\r\n                        // Keep the ngModel in sync with changes from CodeMirror\r\n                        codeMirror.on('change', function (instance) {\r\n                            var newValue = instance.getValue();\r\n                            if (newValue !== ngModel.$viewValue) {\r\n                                // Changes to the model from a callback need to be wrapped in $apply or angular will not notice them\r\n                                scope.$apply(function () {\r\n                                    try {\r\n                                        var parsed = JSON.parse(newValue);\r\n                                        ngModel.$setViewValue(parsed);\r\n                                    } catch (e){\r\n                                        //Safe to ignore this :)\r\n                                    }\r\n                                });\r\n                            }\r\n\r\n                            //var totalLines = codeMirror.lineCount();\r\n                            //codeMirror.autoFormatRange({line:0, ch:0}, {line:totalLines});\r\n                        });\r\n                    }\r\n                    // Watch ui-refresh and refresh the directive\r\n                    if (iAttrs.uiRefresh) {\r\n                        scope.$watch(iAttrs.uiRefresh, function (newVal, oldVal) {\r\n                            // Skip the initial watch firing\r\n                            if (newVal !== oldVal) {\r\n                                codeMirror.refresh();\r\n                            }\r\n                        });\r\n                    }\r\n                    // Allow access to the CodeMirror instance through a broadcasted event\r\n                    // eg: $broadcast('CodeMirror', function(cm){...});\r\n                    scope.$on('CodeMirror', function (event, callback) {\r\n                        if (angular.isFunction(callback)) {\r\n                            callback(codeMirror);\r\n                        } else {\r\n                            throw new Error('the CodeMirror event requires a callback function');\r\n                        }\r\n                    });\r\n                    // onLoad callback\r\n                    if (angular.isFunction(opts.onLoad)) {\r\n                        opts.onLoad(codeMirror);\r\n                    }\r\n                };\r\n            }\r\n        };\r\n    }\r\n]);\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n            var mixed = function (name, schema, options) {\r\n                if (schema.type == 'object' && !schema.ref && !schema.format && schema.mixed) {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'mixed';\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.object.unshift(mixed);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'mixed',\r\n                'directives/decorators/bootstrap/mixed/mixed.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'mixed',\r\n                'directives/decorators/bootstrap/mixed/mixed.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/button/button.html\",\"<div class=\\\"form-group\\\">\\r\\n    <button bk-button type=\\\"button\\\" ng-click=\\\"click()\\\" ng-show=\\\"showTitle()\\\" class=\\\"btn\\\">{{form.title}}</button>\\r\\n</div>\");}]);\r\nangular.module('schemaForm').directive('bkButton', ['$http', 'models', function ($http, models) {\r\n\r\n    return {\r\n        restrict: 'A',\r\n        link: function (scope, element, attrs, ngModel) {\r\n            var form = scope.form;\r\n            scope.click = function () {\r\n                scope.$emit('bkButton', form);\r\n                //if (form.action == 'api') {\r\n                //    if (form.method == 'GET') {\r\n                //        $http.get(form.url + 'dfdfdf').success(function (res) {\r\n                //            console.log(res);\r\n                //        }).error(function (err) {\r\n                //            console.error(err);\r\n                //        });\r\n                //    }\r\n                //} else if (form.action == 'function') {\r\n                //    console.log(scope.form);\r\n                //    window[form.func]();\r\n                //}\r\n            };\r\n        }\r\n    }\r\n}]);\r\n\r\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var mixed = function (name, schema, options) {\r\n                if (schema.type === 'string' && (schema.format === 'button')) {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'button';\r\n                    f.action = schema.action;\r\n                    if (f.action == 'api') {\r\n                        f.method = schema.method;\r\n                        f.url = schema.url;\r\n                        f.params = schema.params;\r\n                    } else if(f.action == 'function'){\r\n                        f.func = schema.func;\r\n                    }\r\n                    f.function = schema.onClick;\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.string.unshift(mixed);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'button',\r\n                'directives/decorators/bootstrap/button/button.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'button',\r\n                'directives/decorators/bootstrap/button/button.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/textarea/textarea.html\",\"<div class=\\\"form-group has-feedback\\\" ng-class=\\\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\\\">\\n    <label ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\n    <textarea class=\\\"form-control\\\"\\n              sf-changed=\\\"form\\\"\\n              placeholder=\\\"{{form.placeholder}}\\\"\\n              ng-disabled=\\\"form.readonly\\\"\\n              ng-model=\\\"$$value$$\\\"\\n              ng-model-options=\\\"form.ngModelOptions\\\"\\n              schema-validate=\\\"form\\\"\\n              rows=\\\"{{form.rows}}\\\"></textarea>\\n    <span class=\\\"help-block\\\">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span>\\n</div>\");}]);\r\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var mixed = function (name, schema, options) {\r\n                if (schema.type === 'string' && (schema.format === 'textarea')) {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'textarea';\r\n                    f.rows = schema.rows;\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.string.unshift(mixed);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'textarea',\r\n                'directives/decorators/bootstrap/textarea/textarea.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'textarea',\r\n                'directives/decorators/bootstrap/textarea/textarea.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/password/password.html\",\"<div class=\\\"form-group has-feedback {{form.divStyle}}\\\" ng-class=\\\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\\\">\\r\\n    <label ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\r\\n    <input type=\\\"password\\\" class=\\\"form-control {{form.style}}\\\"\\r\\n              sf-changed=\\\"form\\\"\\r\\n              placeholder=\\\"{{form.placeholder}}\\\"\\r\\n              ng-disabled=\\\"form.readonly\\\"\\r\\n              ng-model=\\\"$$value$$\\\"\\r\\n              ng-model-options=\\\"form.ngModelOptions\\\"\\r\\n              schema-validate=\\\"form\\\">\\r\\n    <span class=\\\"help-block\\\">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span>\\r\\n</div>\");}]);\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var mixed = function (name, schema, options) {\r\n                if (schema.type === 'string' && (schema.format === 'password')) {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'password';\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.string.unshift(mixed);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'password',\r\n                'directives/decorators/bootstrap/password/password.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'password',\r\n                'directives/decorators/bootstrap/password/password.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/seconds/seconds.html\",\"<fieldset ng-disabled=\\\"form.readonly\\\" class=\\\"schema-form-fieldset {{form.htmlClass}}\\\">\\n    <legend ng-show=\\\"form.title\\\">{{ form.title }}</legend>\\n\\n    <!--<sf-decorator>-->\\n    <div class=\\\"form-group schema-form-number col-xs-3 has-success has-feedback\\\">\\n        <label>Minutes</label>\\n        <input type=\\\"number\\\" min=\\\"0\\\" class=\\\"form-control\\\" ng-model=\\\"timeMinutes\\\"/>\\n            <span ng-if=\\\"form.feedback !== false\\\" class=\\\"form-control-feedback ng-scope glyphicon glyphicon-ok\\\"\\n                  ng-class=\\\"evalInScope(form.feedback) || {\\'glyphicon\\': true, \\'glyphicon-ok\\': hasSuccess(), \\'glyphicon-remove\\': hasError() }\\\"\\n                  aria-hidden=\\\"true\\\"></span>\\n    </div>\\n    <!--</sf-decorator>-->\\n\\n    <!--<sf-decorator class=\\\"ng-scope\\\">-->\\n    <div class=\\\"form-group schema-form-number col-xs-3 has-success has-feedback\\\">\\n        <label>Seconds</label>\\n        <input type=\\\"number\\\" min=\\\"0\\\" max=\\\"59\\\" class=\\\"form-control\\\" ng-model=\\\"timeSeconds\\\"/>\\n            <span ng-if=\\\"form.feedback !== false\\\" class=\\\"form-control-feedback ng-scope glyphicon glyphicon-ok\\\"\\n                  ng-class=\\\"evalInScope(form.feedback) || {\\'glyphicon\\': true, \\'glyphicon-ok\\': hasSuccess(), \\'glyphicon-remove\\': hasError() }\\\"\\n                  aria-hidden=\\\"true\\\"></span>\\n    </div>\\n    <!--</sf-decorator>-->\\n    <div class=\\\"help-block\\\"\\n         ng-show=\\\"(hasError() && errorMessage(schemaError())) || form.description\\\"\\n         ng-bind-html=\\\"(hasError() && errorMessage(schemaError())) || form.description\\\"></div>\\n</fieldset>\\n\\n<input bk-seconds ng-model=\\\"$$value$$\\\" type=\\\"hidden\\\"/>\");}]);\r\nangular.module('schemaForm').directive('bkSeconds', ['$http', '$routeParams', 'models', function ($http, $routeParams, models) {\r\n    return {\r\n        restrict: 'AE',\r\n        require: 'ngModel',\r\n        link: function (scope, element, attrs, ngModel) {\r\n            ngModel.$render = function () {\r\n                if (ngModel.$viewValue != undefined) {\r\n                    scope.timeMinutes = Math.floor(ngModel.$viewValue / 60);\r\n                    scope.timeSeconds = ngModel.$viewValue % 60;\r\n                } else{\r\n                    scope.timeMinutes = 0;\r\n                    scope.timeSeconds = 0;\r\n                }\r\n            };\r\n\r\n            scope.$watch(\"timeMinutes\", function (newval) {\r\n                if (newval != undefined)\r\n                    ngModel.$setViewValue(newval * 60 + scope.timeSeconds);\r\n            });\r\n\r\n            scope.$watch(\"timeSeconds\", function (newval) {\r\n                if (newval != undefined)\r\n                    ngModel.$setViewValue(scope.timeMinutes * 60 + newval);\r\n            });\r\n        }\r\n    }\r\n}]);\r\n\r\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var seconds = function (name, schema, options) {\r\n                if (schema.type === 'number' && schema.format === 'time-seconds') {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'seconds';\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.number.unshift(seconds);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'seconds',\r\n                'directives/decorators/bootstrap/seconds/seconds.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'seconds',\r\n                'directives/decorators/bootstrap/seconds/seconds.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/multiselect/multiselect.html\",\"<div class=\\\"form-group schema-form-select {{form.htmlClass}}\\\">\\r\\n    <label class=\\\"control-label\\\" ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\r\\n    <ui-select select-multiple multiple ng-model=\\\"$$value$$\\\" separator=\\\"form.separator\\\" choices=\\\"choices\\\" enum=\\\"form.enum\\\" map=\\\"form.map\\\" lock=\\\"form.locked\\\" url=\\\"form.url\\\" ng-disabled=\\\"disabled\\\">\\r\\n        <ui-select-match placeholder=\\\"{{placeholder}}\\\">{{common.prettifyTitle($item.name)}}</ui-select-match>\\r\\n        <ui-select-choices\\r\\n                group-by=\\\"group\\\"\\r\\n                repeat=\\\"elem.value as elem in availableElems | filter: $select.search\\\"\\r\\n                refresh=\\\"refreshData($select.search)\\\">\\r\\n            {{getTitle(elem)}}\\r\\n        </ui-select-choices>\\r\\n    </ui-select>\\r\\n</div>\");}]);\nangular.module('schemaForm').directive('selectMultiple', ['$http', '$routeParams', 'models', 'common', function ($http, $routeParams, models, common) {\r\n    function convertToMap(elements){\r\n        var map = [];\r\n        angular.forEach(elements, function(val) {\r\n            if(val.name && val.value){\r\n                map.push(val);\r\n            } else if(val.split) { // is a string)\r\n                map.push({name: val, value: val});\r\n            } else{\r\n                console.error(\"Invalid value\", val, \"for multiselect element\")\r\n            }\r\n        });\r\n\r\n        return map;\r\n    }\r\n\r\n    function addStringToMap(val, map){\r\n        var exists = false;\r\n        angular.forEach(map, function(v){\r\n            if(v.value == val){\r\n                exists = true;\r\n            }\r\n        });\r\n\r\n        if(!exists) {\r\n            map.push({name: val, value: val});\r\n        }\r\n\r\n        return map;\r\n    }\r\n\r\n    return {\r\n        restrict: 'AE',\r\n        scope: false,\r\n        link: function (scope, element, attrs, ngModel) {\r\n\r\n            //WAIT TO LOAD :)\r\n            //$('body').delegate('.page-sidebar li > a', 'click',  function (e) {});\r\n\r\n\r\n            scope.common = common;\r\n            scope.grouping = false;\r\n            scope.separator = scope.$eval(attrs.separator);\r\n            scope.url = scope.$eval(attrs.url);\r\n            scope.lock = scope.$eval(attrs.lock);\r\n            scope.availableElems = [];\r\n            scope.placeholder = \"Select\";\r\n            scope.enum = scope.$eval(attrs.enum);\r\n            scope.map = scope.$eval(attrs.map);\r\n\r\n            if(scope.separator){\r\n                scope.group = function(item){\r\n                    return item.name.split(scope.separator)[0];\r\n                };\r\n                scope.grouping = true;\r\n            }\r\n\r\n            scope.getTitle = function(val){\r\n                if(scope.separator){\r\n                    var splitted = val.name.split(scope.separator);\r\n                    splitted.splice(0,1);\r\n                    var value = splitted.join(scope.separator);\r\n                    return common.prettifyTitle(value, scope.separator);\r\n                } else {\r\n                    return common.prettifyTitle(val.name);\r\n                }\r\n            };\r\n\r\n            scope.refreshData = function (item) {\r\n                if(!scope.lock) {\r\n                    if (item) {\r\n                        scope.availableElems = addStringToMap(item, scope.availableElems);\r\n                    }\r\n                }\r\n            };\r\n\r\n            if(scope.url){\r\n                if(common.hasAngularVariable(scope.url)){\r\n                    if ($routeParams.id) {\r\n                        models.getDocument($routeParams.schema, $routeParams.id, function (doc) {\r\n                            var a = common.deAngularizeUrl(doc, scope.url);\r\n                            $http.get(a).then(function (elems) {\r\n                                var d = elems.data;\r\n                                if (d instanceof Array) {\r\n                                    scope.availableElems = convertToMap(d);\r\n                                } else {\r\n                                    console.error(\"Invalid values for multiselect\", \"values:\", d);\r\n                                }\r\n                            });\r\n                        });\r\n                    } else {\r\n                        scope.placeholder = \"Cannot resolve variable \" + common.getAngularVariables(scope.url) + \". Please save the document first\";\r\n                        scope.availableElems = convertToMap(scope.$eval(attrs.choices) || []);\r\n                    }\r\n                } else {\r\n                    $http.get(scope.url).then(function (elems) {\r\n                        var d = elems.data;\r\n                        if (d instanceof Array) {\r\n                            scope.availableElems = convertToMap(d);\r\n                        } else {\r\n                            console.error(\"Invalid values for multiselect\", \"values:\", d);\r\n                        }\r\n                    });\r\n                }\r\n\r\n            } else {\r\n                if(scope.map){\r\n                    scope.availableElems = convertToMap(scope.map);\r\n                } else if(scope.enum){\r\n                    scope.availableElems = convertToMap(scope.enum);\r\n                } else {\r\n                    console.error(\"Bad configuration for multiselect\");\r\n                }\r\n            }\r\n        }\r\n    }\r\n}]);\r\n\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var multiselect = function (name, schema, options) {\r\n                if (schema.type === 'array' && schema.items.type === 'string' && (schema.items.enum || schema.items.enumUrl || schema.items.map)) {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'multiselect';\r\n                    f.map = schema.items.map;\r\n                    f.enum = schema.items.enum;\r\n                    f.path = schema.path;\r\n                    f.separator = schema.items.separator;\r\n                    f.locked = schema.items.limitToOptions || false;\r\n                    f.url = schema.items.enumUrl;\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.array.unshift(multiselect);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'multiselect',\r\n                'directives/decorators/bootstrap/multiselect/multiselect.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'multiselect',\r\n                'directives/decorators/bootstrap/multiselect/multiselect.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/rating/rating.html\",\"<div class=\\\"form-group\\\" ng-class=\\\"{\\'has-error\\': hasError()}\\\">\\n    <label class=\\\"control-label\\\" ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\n    <rating bk-rating ng-model=\\\"$$value$$\\\" max=\\\"form.maxValue\\\" min=\\\"form.minValue\\\" state-on=\\\"form.iconOn\\\" state-off=\\\"form.iconOff\\\"></rating>\\n</div>\");}]);\r\nangular.module('schemaForm').directive('bkRating', ['$http', '$routeParams', function ($http, $routeParams) {\r\n    return {\r\n        restrict: 'AE',\r\n        link: function (scope, element, attrs, ngModel) {\r\n        }\r\n    }\r\n}]);\r\n\r\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var mixed = function (name, schema, options) {\r\n                if (schema.type === 'number' && (schema.format === 'rating')) {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'rating';\r\n\r\n                    if (schema.minValue)\r\n                        f.minValue = schema.minValue;\r\n                    if (schema.maxValue)\r\n                        f.maxValue = schema.maxValue;\r\n                    if (schema.iconOn)\r\n                        f.iconOn = schema.iconOn;\r\n                    if (schema.iconOff)\r\n                        f.iconOff = schema.iconOff;\r\n\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.number.unshift(mixed);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'rating',\r\n                'directives/decorators/bootstrap/rating/rating.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'rating',\r\n                'directives/decorators/bootstrap/rating/rating.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/tinymce/tinymce.html\",\"<div class=\\\"form-group {{form.htmlClass}}\\\" ng-class=\\\"{\\'has-error\\': hasError()}\\\">\\r\\n    <label class=\\\"control-label\\\" ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\r\\n    <textarea\\r\\n            ri-tinymce=\\\"form.tinymceOptions\\\"\\r\\n            ui-tinymce\\r\\n            ng-model=\\\"$$value$$\\\"\\r\\n            schema-validate=\\\"form\\\">\\r\\n    </textarea>\\r\\n    <span class=\\\"help-block\\\">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span>\\r\\n</div>\");\n$templateCache.put(\"directives/decorators/bootstrap/tinymce/tinyvision.html\",\"<!--<!DOCTYPE html>-->\\r\\n<!--<html lang=\\\"en\\\">-->\\r\\n<!--<head>-->\\r\\n<!--<meta charset=\\\"utf-8\\\">-->\\r\\n<!--<meta http-equiv=\\\"X-UA-Compatible\\\" content=\\\"IE=edge, chrome=1\\\">-->\\r\\n<!--<meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1.0\\\">-->\\r\\n<!--<title>TinyVision</title>-->\\r\\n<style>\\r\\n    /*body {*/\\r\\n    /*margin: 0 !important;*/\\r\\n    /*padding: 51px 0 0 !important;*/\\r\\n    /*}*/\\r\\n\\r\\n    @-webkit-keyframes spin {\\r\\n        100% {\\r\\n            -webkit-transform: rotate(360deg);\\r\\n        }\\r\\n    }\\r\\n\\r\\n    @-moz-keyframes spin {\\r\\n        100% {\\r\\n            -moz-transform: rotate(360deg);\\r\\n        }\\r\\n    }\\r\\n\\r\\n    @-ms-keyframes spin {\\r\\n        100% {\\r\\n            -ms-transform: rotate(360deg);\\r\\n        }\\r\\n    }\\r\\n\\r\\n    @-o-keyframes spin {\\r\\n        100% {\\r\\n            -o-transform: rotate(360deg);\\r\\n        }\\r\\n    }\\r\\n\\r\\n    @keyframes spin {\\r\\n        100% {\\r\\n            transform: rotate(360deg);\\r\\n        }\\r\\n    }\\r\\n\\r\\n    @font-face {\\r\\n        font-family: \\'TinyVision\\';\\r\\n        font-style: normal;\\r\\n        font-weight: normal;\\r\\n        src: url(data:application/font-woff;charset=utf-8;base64,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) format(\\\"truetype\\\");\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-icon {\\r\\n        display: inline-block;\\r\\n        font-family: \\'TinyVision\\';\\r\\n        font-style: normal;\\r\\n        font-size: 16px;\\r\\n        text-transform: none;\\r\\n        font-variant: normal;\\r\\n        font-weight: normal;\\r\\n        line-height: 1;\\r\\n        speak: none;\\r\\n        vertical-align: text-bottom;\\r\\n        -webkit-font-smoothing: antialiased;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-icon-refresh:before {\\r\\n        content: \\\"\\\\e000\\\";\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-icon-upload:before {\\r\\n        content: \\\"\\\\e001\\\";\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-icon-remove:before {\\r\\n        content: \\\"\\\\e9ac\\\";\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-icon-folder:before {\\r\\n        content: \\\"\\\\e931\\\";\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-toolbar {\\r\\n        border-bottom: 1px solid #9e9e9e;\\r\\n        left: 0;\\r\\n        padding: 10px;\\r\\n        position: fixed;\\r\\n        right: 0;\\r\\n        top: 0;\\r\\n        z-index: 1000;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-toolbar-left {\\r\\n        float: left;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-toolbar-left > * {\\r\\n        float: left;\\r\\n        margin-right: 3px;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-toolbar-right {\\r\\n        float: right;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-toolbar-right > * {\\r\\n        float: left;\\r\\n        margin-left: 3px;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-upload .tv-icon-upload {\\r\\n        margin-right: 3px;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-search .tv-icon-search {\\r\\n        cursor: text;\\r\\n        left: 11px;\\r\\n        position: absolute;\\r\\n        top: 6px;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-search input {\\r\\n        padding-left: 35px;\\r\\n        width: 200px;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-notice {\\r\\n        border: 1px solid #eee;\\r\\n        color: #9e9e9e;\\r\\n        display: none;\\r\\n        font-size: 20px;\\r\\n        margin: 15% auto 0;\\r\\n        padding: 20px;\\r\\n        text-align: center;\\r\\n        white-space: normal;\\r\\n        width: 50%;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-items {\\r\\n        list-style: none;\\r\\n        margin: 10px auto;\\r\\n        width: 660px;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-item {\\r\\n        float: left;\\r\\n        margin: 10px;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-item.selected .tv-item-image {\\r\\n        border: 2px solid #0088cc !important;\\r\\n        padding: 4px;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-item.selected .tv-item-name {\\r\\n        color: #0088cc !important;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-item-link {\\r\\n        cursor: pointer;\\r\\n        display: block;\\r\\n        text-decoration: none;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-item-link:hover .tv-item-image {\\r\\n        border-color: #9e9e9e;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-item-link:hover .tv-item-name {\\r\\n        color: #000;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-item-dir {\\r\\n        border: 1px solid #eee;\\r\\n        height: 100px;\\r\\n        line-height: 100px;\\r\\n        padding: 5px;\\r\\n        text-align: center;\\r\\n        width: 100px;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-item-dir span {\\r\\n        max-height: 100px;\\r\\n        max-width: 100px;\\r\\n        min-height: 1px;\\r\\n        min-width: 1px;\\r\\n        vertical-align: middle;\\r\\n        font-size: 70px;\\r\\n        font-family: \\'Glyphicons Halflings\\';\\r\\n        color: #696969;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-item-image {\\r\\n        border: 1px solid #eee;\\r\\n        height: 100px;\\r\\n        line-height: 100px;\\r\\n        padding: 5px;\\r\\n        text-align: center;\\r\\n        width: 100px;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-item-image img {\\r\\n        max-height: 100px;\\r\\n        max-width: 100px;\\r\\n        min-height: 1px;\\r\\n        min-width: 1px;\\r\\n        vertical-align: middle;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-item-name {\\r\\n        color: #9e9e9e;\\r\\n        padding: 5px;\\r\\n        overflow: hidden;\\r\\n        text-overflow: ellipsis;\\r\\n        white-space: nowrap;\\r\\n        width: 100px;\\r\\n    }\\r\\n\\r\\n    .cf:before,\\r\\n    .cf:after {\\r\\n        content: \\' \\';\\r\\n        display: table;\\r\\n    }\\r\\n\\r\\n    .cf:after {\\r\\n        clear: both;\\r\\n    }\\r\\n</style>\\r\\n<!--<link rel=\\\"stylesheet\\\" href=\\\"tinyvision.css\\\">-->\\r\\n<!--</head>-->\\r\\n<!--<body>-->\\r\\n<div class=\\\"mce-container\\\" id=\\\"tinyvision\\\">\\r\\n    <div class=\\\"tv-toolbar mce-panel cf\\\">\\r\\n        <div class=\\\"tv-toolbar-left\\\">\\r\\n            <div class=\\\"tv-upload mce-widget mce-btn\\\">\\r\\n                <button type=\\\"button\\\" ng-click=\\\"remove()\\\" id=\\\"remove\\\"><span\\r\\n                        class=\\\"tv-icon tv-icon-remove\\\"></span> Remove\\r\\n                </button>\\r\\n            </div>\\r\\n            <div class=\\\"tv-upload mce-widget mce-btn\\\">\\r\\n                <button type=\\\"button\\\" ng-click=\\\"refresh()\\\" id=\\\"refresh\\\"><span\\r\\n                        class=\\\"tv-icon tv-icon-refresh\\\"></span> Refresh\\r\\n                </button>\\r\\n            </div>\\r\\n            <div class=\\\"tv-upload mce-widget mce-btn\\\">\\r\\n                <button type=\\\"button\\\" ng-click=\\\"openUploadModal()\\\" id=\\\"upload\\\"><span\\r\\n                        class=\\\"tv-icon tv-icon-upload\\\"></span> Upload\\r\\n                </button>\\r\\n            </div>\\r\\n        </div>\\r\\n        <div class=\\\"tv-toolbar-right\\\">\\r\\n            <div class=\\\"tv-search mce-widget\\\">\\r\\n                <span class=\\\"tv-icon tv-icon-search\\\"></span>\\r\\n                <input class=\\\"mce-textbox\\\" ng-model=\\\"dirName\\\" placeholder=\\\"Directory name\\\">\\r\\n            </div>\\r\\n            <div class=\\\"tv-refresh mce-widget mce-btn\\\">\\r\\n                <button type=\\\"button\\\" id=\\\"create\\\"><span class=\\\"tv-icon tv-icon-folder\\\"></span></button>\\r\\n            </div>\\r\\n        </div>\\r\\n    </div>\\r\\n    <div class=\\\"tv-notice\\\" id=\\\"notice\\\"></div>\\r\\n    <ol class=\\\"tv-items cf\\\" id=\\\"items\\\">\\r\\n        <li ng-if=\\\"pathStack\\\" class=\\\"tv-item\\\">\\r\\n            <a ng-click=\\\"findByPath(\\'..\\')\\\" class=\\\"tv-item-link\\\" title=\\\"{{name}}\\\">\\r\\n                <div class=\\\"tv-item-dir\\\">\\r\\n                    <span class=\\\"glyphicon glyphicon-folder-open\\\" aria-hidden=\\\"true\\\"></span>\\r\\n                </div>\\r\\n                <div class=\\\"tv-item-name\\\">..</div>\\r\\n            </a>\\r\\n        </li>\\r\\n        <li ng-repeat=\\\"e in data.directories track by $index\\\" class=\\\"tv-item\\\">\\r\\n            <a ng-click=\\\"findByPath(e)\\\" class=\\\"tv-item-link\\\" title=\\\"{{name}}\\\">\\r\\n                <div class=\\\"tv-item-dir\\\">\\r\\n                    <span class=\\\"glyphicon glyphicon-folder-close\\\" aria-hidden=\\\"true\\\"></span>\\r\\n                </div>\\r\\n                <div class=\\\"tv-item-name\\\">{{e}}</div>\\r\\n            </a>\\r\\n        </li>\\r\\n        <li ng-repeat=\\\"e in data.image track by $index\\\" class=\\\"tv-item\\\" ng-class=\\\"{\\'selected\\':selected==e}\\\">\\r\\n            <a ng-click=\\\"setSelected(e)\\\" class=\\\"tv-item-link\\\" title=\\\"{{e}}\\\">\\r\\n                <div class=\\\"tv-item-image\\\">\\r\\n                    <img ng-src=\\\"/gallery/{{pathStack}}/{{e}}\\\">\\r\\n                </div>\\r\\n                <div class=\\\"tv-item-name\\\">{{e}}</div>\\r\\n            </a>\\r\\n        </li>\\r\\n        <li ng-repeat=\\\"e in data.video track by $index\\\" class=\\\"tv-item\\\" ng-class=\\\"{\\'selected\\':selected==e}\\\">\\r\\n            <a ng-click=\\\"setSelected(e)\\\" class=\\\"tv-item-link\\\" title=\\\"{{e}}\\\">\\r\\n                <div class=\\\"tv-item-image\\\">\\r\\n                    <img ng-src=\\\"/gallery/{{pathStack}}/{{e}}\\\">\\r\\n                </div>\\r\\n                <div class=\\\"tv-item-name\\\">{{e}}</div>\\r\\n            </a>\\r\\n        </li>\\r\\n    </ol>\\r\\n</div>\\r\\n<!--&lt;!&ndash;<script src=\\\"tinyvision.min.js\\\"></script>&ndash;&gt;-->\\r\\n<!--</body>-->\\r\\n<!--</html>-->\\r\\n<!--MODAL FOR VALIDATION-->\\r\\n<style>\\r\\n    .modal {\\r\\n        z-index: 15001 !important;\\r\\n    }\\r\\n\\r\\n    .modal-dialog {\\r\\n        z-index: 15001 !important;\\r\\n    }\\r\\n\\r\\n    #mce-modal-block {\\r\\n        z-index: 15000 !important;\\r\\n    }\\r\\n\\r\\n    .mce-floatpanel {\\r\\n        z-index: 15001 !important;\\r\\n    }\\r\\n\\r\\n    #mce-modal-block .mce-panel {\\r\\n        z-index: 15001 !important;\\r\\n    }\\r\\n\\r\\n    droplet {\\r\\n        display: inline-block;\\r\\n        z-index: 15003;\\r\\n        position: relative;\\r\\n        border-radius: 2px;\\r\\n        width: 100%;\\r\\n        height: 400px;\\r\\n        background-color: rgba(255, 255, 255, .1);\\r\\n        margin-top: -5px;\\r\\n        padding-top: 5px;\\r\\n        transition: box-shadow 0.35s;\\r\\n    }\\r\\n\\r\\n    droplet.event-dragover {\\r\\n        box-shadow: inset 0 0 100px rgba(255, 255, 255, .25), inset 0 0 5px rgba(255, 255, 255, .25);\\r\\n    }\\r\\n\\r\\n    droplet ul.files {\\r\\n        height: 100%;\\r\\n        width: 100%;\\r\\n        overflow-y: auto;\\r\\n        padding: 5px;\\r\\n        list-style-type: none;\\r\\n        transition: all .5s;\\r\\n    }\\r\\n\\r\\n    droplet ul.files li {\\r\\n        width: 100px;\\r\\n        height: 100px;\\r\\n        padding: 1px;\\r\\n        float: left;\\r\\n        position: relative;\\r\\n        margin: 5px;\\r\\n    }\\r\\n\\r\\n    droplet ul.files li img.droplet-preview {\\r\\n        max-width: 96px;\\r\\n        background-size: cover;\\r\\n        background-repeat: no-repeat;\\r\\n        height: 96px;\\r\\n        width: 96px;\\r\\n        background-color: white;\\r\\n        box-shadow: 0 0 10px rgba(0, 0, 0, .25);\\r\\n        border: 1px solid white;\\r\\n        display: block;\\r\\n    }\\r\\n\\r\\n    droplet ul.files li div.delete {\\r\\n        background-color: rgba(0, 0, 0, .25);\\r\\n        width: 50px;\\r\\n        height: 50px;\\r\\n        font-family: Lato, Arial, Tahoma, Helvetica, sans-serif;\\r\\n        color: white;\\r\\n        font-size: 25px;\\r\\n        text-shadow: 1px 1px 0 rgba(0, 0, 0, .25);\\r\\n        text-align: center;\\r\\n        cursor: pointer;\\r\\n        line-height: 50px;\\r\\n        position: absolute;\\r\\n        border-radius: 50%;\\r\\n        z-index: 1010;\\r\\n        top: 25px;\\r\\n        left: 25px;\\r\\n        opacity: 0;\\r\\n        transition: all .30s;\\r\\n        transform: scale(0.5);\\r\\n    }\\r\\n\\r\\n    droplet ul.files li:hover div.delete {\\r\\n        opacity: 1;\\r\\n        transform: scale(1);\\r\\n    }\\r\\n\\r\\n    droplet ul.files li div.delete:hover {\\r\\n        background-color: rgba(0, 0, 0, .45);\\r\\n    }\\r\\n\\r\\n    droplet ul.files li div.size {\\r\\n        background-color: rgba(255, 255, 255, .5);\\r\\n        position: absolute;\\r\\n        bottom: 5px;\\r\\n        right: 5px;\\r\\n        pointer-events: none;\\r\\n        font-size: 9px;\\r\\n        font-family: Lato, Arial, Tahoma, Helvetica, sans-serif;\\r\\n        padding: 1px 4px;\\r\\n    }\\r\\n</style>\\r\\n<script type=\\\"text/ng-template\\\" id=\\\"imgUploader.html\\\">\\r\\n    <div class=\\\"modal-header\\\">\\r\\n        <h3 class=\\\"modal-title\\\">Upload Files</h3>\\r\\n    </div>\\r\\n    <div class=\\\"modal-body\\\">\\r\\n        <droplet ng-model=\\\"dropletint\\\">\\r\\n\\r\\n            <!--<div class=\\\"loading\\\" ng-class=\\\"{ visible: dropletint.isUploading() }\\\">\\r\\n                <svg viewBox=\\\"0 0 400 400\\\">\\r\\n                    <path class=\\\"loading-path\\\" data-progressbar ng-model=\\\"dropletint.progress.percent\\\"\\r\\n                          d=\\\"M 0,1 L 398,1 L 398,234 L 1,234 L 0,1\\\"\\r\\n                          stroke=\\\"#D3B2D1\\\" stroke-width=\\\"1\\\" fill-opacity=\\\"0\\\"\\r\\n                          style=\\\"stroke-dasharray: 392px, 392px;stroke-dashoffset: 392px;\\\"></path>\\r\\n                </svg>\\r\\n            </div>-->\\r\\n\\r\\n            <section ng-show=\\\"dropletint.isUploading()\\\">Upload done. Press Cancel button or ESC key</section>\\r\\n\\r\\n            <ul class=\\\"files\\\">\\r\\n                <li ng-hide=\\\"dropletint.isUploading()\\\"\\r\\n                    ng-repeat=\\\"filemodel in dropletint.getFiles(dropletint.FILE_TYPES.VALID)\\\">\\r\\n                    <droplet-preview ng-model=\\\"filemodel\\\"></droplet-preview>\\r\\n                    <div class=\\\"delete\\\" ng-click=\\\"filemodel.deleteFile()\\\">&times;</div>\\r\\n                    <div class=\\\"size\\\">{{filemodel.file.size / 1024 / 1024 | number: 1}}MB</div>\\r\\n                </li>\\r\\n            </ul>\\r\\n        </droplet>\\r\\n    </div>\\r\\n    <div class=\\\"modal-footer\\\">\\r\\n        <button class=\\\"btn btn-default\\\" ng-click=\\\"cancel()\\\">Cancel</button>\\r\\n        <button class=\\\"btn btn-primary\\\" ng-click=\\\"dropletint.uploadFiles()\\\" ng-hide=\\\"dropletint.isUploading()\\\">\\r\\n            Upload files\\r\\n        </button>\\r\\n    </div>\\r\\n</script>\");}]);\nangular.module('schemaForm').directive('riTinymce', ['$http', '$window', '$modal', function ($http, $window, $modal) {\r\n\r\n    var defaultConf = {\r\n        plugins: \"code image -tinyvision autoresize fullscreen media link paste preview textcolor\",\r\n        toolbar1: \"undo redo | styleselect fontsizeselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image media | preview | fullscreen | forecolor backcolor\",\r\n        image_advtab: true,\r\n        forced_root_block: 'p',\r\n        width: '100%',\r\n        height: 400,\r\n        autoresize_min_height: 400,\r\n        autoresize_max_height: 800,\r\n        fullscreen_new_window: true,\r\n        skin_url: 'extra/tinymce/skins/lightgray',\r\n        fullscreen_settings: {\r\n            theme_advanced_path_location: \"top\"\r\n        },\r\n        paste_preprocess: function (pl, o) {\r\n            o.content = o.content.replace(/(<b>)/ig, \"<strong>\");\r\n            o.content = o.content.replace(/(<\\/b>)/ig, \"</strong>\");\r\n            o.content = o.content.replace(/(<i>)/ig, \"<em>\");\r\n            o.content = o.content.replace(/(<\\/i>)/ig, \"</em>\");\r\n        },\r\n        //valid_elements: 'p,a[href],span[class],div[class],img[style|class|src|border=0|alt|title|hspace|vspace|width|height|align|onmouseover|onmouseout|name]',\r\n        tinyvision: {\r\n            source: '/gallery',\r\n            // upload: function () {\r\n            //     $modal.open({\r\n            //         templateUrl: 'imgUploader.html',\r\n            //         controller: 'ModalImgUploaderCtrl',\r\n            //         size: 'md'\r\n            //     });\r\n            // }\r\n        }\r\n    };\r\n\r\n\r\n    return {\r\n        restrict: 'A',\r\n        require: 'ngModel',\r\n        scope: false,\r\n        link: function (scope, element, attrs, ngModel) {\r\n            var tinyInstance;\r\n\r\n            function ensureInstance() {\r\n                if (!tinyInstance) {\r\n                    tinyInstance = tinymce.get(attrs.id);\r\n                }\r\n            }\r\n\r\n            function destroy() {\r\n                ensureInstance();\r\n                if (tinyInstance) {\r\n                    console.log(\"in destroy\", tinyInstance);\r\n                    tinyInstance.remove();\r\n                    tinyInstance = null;\r\n                }\r\n            };\r\n\r\n            var init = function (config) {\r\n                config = angular.extend(config || {}, defaultConf, {\r\n                    selector: '#' + attrs.id,\r\n                    setup: function (editor) {\r\n                        // tinyMCE.PluginManager.load('tinyvision', '/admin/extra/tinyvision/build/plugin.min.js');\r\n                        $window['focus' + attrs.id] = function () {\r\n                            tinymce.execCommand('mceFocus', false, attrs.id);\r\n                        };\r\n\r\n                        var update = function () {\r\n                            var content = editor.getContent();\r\n                            if (ngModel.$viewValue !== content) {\r\n                                ngModel.$setViewValue(content);\r\n\r\n                                //certain things like 'destroy' below triggers update inside a $digest cycle.\r\n                                if (!scope.$root.$$phase) {\r\n                                    scope.$apply();\r\n                                }\r\n                            }\r\n                        };\r\n\r\n                        editor.on('change', update);\r\n                        editor.on('KeyUp', update);\r\n                        editor.on('ExecCommand', update);\r\n                        editor.on('focus', function (e) {\r\n                            angular.element(e.target.contentAreaContainer).addClass('tx-tinymce-active');\r\n                        });\r\n                        editor.on('blur', function (e) {\r\n                            angular.element(e.target.contentAreaContainer).removeClass('tx-tinymce-active');\r\n                        });\r\n                    }\r\n                });\r\n\r\n                tinymce.init(config);\r\n            };\r\n\r\n            // If config is set watch it for changes, otherwise just init.\r\n            if (attrs.riTinymce) {\r\n                scope.$watch(attrs.riTinymce, function (c, old) {\r\n                    console.log(c);\r\n                    destroy();\r\n                    if (c) init(c);\r\n                    else init();\r\n                });\r\n            } else {\r\n                init();\r\n                destroy();\r\n            }\r\n        }\r\n    };\r\n}]);\nangular.module('schemaForm')\n    .run(['$templateCache', function ($templateCache) {\n        // Register the plugin with TinyMCE.\n        tinymce.PluginManager.add('tinyvision', function (editor, pluginUrl) {\n            /**\n             * Object to encapsulate everything.\n             *\n             * @type {Object}\n             */\n            var self = {};\n\n            /**\n             * TinyVision window.\n             *\n             * @type {tinymce.ui.Window}\n             * @see  {@link http://www.tinymce.com/wiki.php/api4:class.tinymce.ui.Window}\n             */\n            self.win = null;\n\n            /**\n             * Height of the TinyVision window.\n             *\n             * @constant {number}\n             * @default\n             */\n            self.WINDOW_HEIGHT = 537;\n\n            /**\n             * URL to open in the TinyVision window's iframe.\n             *\n             * @constant {string}\n             * @default\n             */\n            self.WINDOW_BODY = '<tinyvision></tinyvision>';//'directives/decorators/bootstrap/tinymce/tinyvision.html';//pluginUrl + '/tinyvision.html';\n\n            /**\n             * Width of the TinyVision window.\n             *\n             * @constant {number}\n             * @default\n             */\n            self.WINDOW_WIDTH = 702;\n\n            /**\n             * Get the URL of the TinyMCE editor skin. TinyMCE doesn't provide an\n             * accessor method, so the style sheets have to be manually parsed.\n             *\n             * @return {string} URL of the TinyMCE editor skin.\n             */\n            self.skinUrl = function () {\n                var regex = /\\/skins\\/\\w+\\/skin(\\.min)?\\.css$/,\n                    styleSheets = document.styleSheets,\n                    styleSheetsLength = styleSheets.length,\n                    styleSheetHref,\n                    url;\n\n                for (var i = 0; i < styleSheetsLength; i += 1) {\n                    styleSheetHref = styleSheets[i].href;\n\n                    if (styleSheetHref && styleSheetHref.match(regex)) {\n                        url = styleSheetHref;\n                        break;\n                    }\n                }\n\n                return url;\n            };\n\n            /**\n             * Get the iframe's window object.\n             *\n             * @return {Window} iframe's window object.\n             */\n            self.scope = function () {\n                return angular.element(self.win.getEl()).scope().$$childTail;\n            };\n\n            /**\n             * Get the currently selected item's data.\n             *\n             * @return {?Object} Item data.\n             */\n            self.selected = function () {\n                return self.scope().getCompleteSelected();\n            };\n\n            /**\n             * Populate the field that TinyVision was launched from with the selected\n             * item's `value`. Empties the field value if nothing selected.\n             *\n             * @param  {Element} field Field that TinyVision was launched from.\n             * @return {Object} self\n             */\n            self.populateField = function (field) {\n                var selected = self.selected();\n\n                field.value = selected ? selected : '';\n\n                return self;\n            };\n\n            /**\n             * Open the TinyMCE window for TinyVision. The window consists primarily of\n             * an iframe with the toolbar and items list.\n             *\n             * @param  {string} fieldId ID of field to populate with the selected value.\n             * @param  {string} fieldValue Current value of the field to populate.\n             * @param  {string} type The type of files to display.\n             * @param  {tinymce.ui.Window} parentWin Window launching TinyVision.\n             * @return {Object} self\n             */\n            self.openWindow = function (fieldId, fieldValue, type, parentWin) {\n                self.win = editor.windowManager.open({\n                    title: 'Select ' + type,\n                    html: self.WINDOW_BODY,\n                    buttons: [\n                        {\n                            text: 'Select',\n                            subtype: 'primary',\n                            onclick: function () {\n                                self.populateField(parentWin.document.getElementById(fieldId));\n                                self.win.close();\n                            }\n                        },\n                        {\n                            text: 'Cancel',\n                            onclick: 'close'\n                        }\n                    ],\n                    width: self.WINDOW_WIDTH,\n                    height: self.WINDOW_HEIGHT\n                }, {\n                    // Values passed to the iframe.\n                    fieldValue: fieldValue,\n                    options: editor.settings.tinyvision,\n                    skinUrl: self.skinUrl(),\n                    type: type\n                });\n                taka = self.win;\n                angular.element(document).injector().invoke([\"$compile\", \"$rootScope\", function ($compile, $rootScope) {\n                    var $targetDom = $(\"#\" + self.win._id + \"-body\");\n                    var $scope = $targetDom.html(\"<tinyvision></tinyvision>\").scope();\n                    $compile($targetDom)($scope);\n                    $rootScope.$digest();\n                }]);\n\n                return self;\n            };\n\n            // Add a TinyMCE command that other plugins can call to launch TinyVision.\n            editor.addCommand('tinyvision', function (options) {\n                self.openWindow(options.fieldId, options.fieldValue, options.type, options.win);\n            });\n\n            // Modify the editor's config to register TinyVision as the file browser.\n            /* jshint -W106 */\n            editor.settings.file_browser_callback = self.openWindow;\n            /* jshint +W106 */\n        });\n    }])\n    .directive(\"tinyvision\", ['$http', '$modal', 'models', function ($http, $modal, models) {\n        return {\n            restrict: 'E',\n            templateUrl: \"directives/decorators/bootstrap/tinymce/tinyvision.html\",\n            scope: true,\n            link: function (scope, element, attrs, ngModel) {\n                var pathStack = [];\n                scope.findByPath = function (path) {\n                    if (path === \"..\") {\n                        pathStack.pop();\n                    } else if (path !== \"\") {\n                        pathStack.push(path);\n                    }\n                    models.galleryGetByPath(pathStack.join(\"/\"), function (data) {\n                        scope.pathStack = pathStack.join(\"/\");\n                        scope.data = data;\n                    });\n                };\n                scope.setSelected = function (e) {\n                    scope.selected = e;\n                };\n                scope.getCompleteSelected = function () {\n                    return \"/gallery\" + pathStack.join(\"/\") + \"/\" + scope.selected;\n                };\n                scope.openUploadModal = function () {\n                    $modal.open({\n                        templateUrl: 'imgUploader.html',\n                        controller: 'ModalImgUploaderCtrl',\n                        size: 'md',\n                        resolve: {\n                            pathstack: function () {\n                                return pathStack;\n                            }\n                        }\n                    }).result.then(function () {\n                        scope.refresh();\n                    });\n                };\n                scope.refresh = function () {\n                    scope.selected = undefined;\n                    scope.findByPath(\"\");\n                };\n                scope.remove = function () {\n                    if (!scope.selected)\n                        return;\n                    models.galleryDeleteByPath(pathStack.join(\"/\") + \"/\" + scope.selected, function (data) {\n                        scope.refresh();\n                    });\n                };\n                scope.refresh();\n            }\n        }\n    }])\n    .controller('ModalImgUploaderCtrl', ['$scope', '$modalInstance', '$timeout', 'loginProvider', 'pathstack', function ($scope, $modalInstance, $timeout, loginProvider, pathstack) {\n        $scope.success = false;\n        $scope.error = false;\n        $scope.$on('$dropletReady', function whenDropletReady() {\n            loginProvider.getUser(function (user) {\n                $scope.dropletint.allowedExtensions(['png', 'jpg', 'bmp', 'gif']);\n                $scope.dropletint.setRequestHeaders({\n                    \"Authorization\": \"BEARER \" + user.token\n                });\n                $scope.dropletint.defineHTTPSuccess([200, 201]);\n                $scope.dropletint.setRequestUrl('/gallery/' + pathstack.join(\"/\"));\n            });\n        });\n\n        $scope.$on('$dropletSuccess', function onDropletSuccess(event, response, files) {\n            $modalInstance.close();\n        });\n\n        $scope.cancel = function () {\n            $modalInstance.close();\n        };\n\n        $modalInstance.result.finally(function () {\n            // $('iframe').contents().find('#refresh').trigger('click');\n        });\n\n    }]);\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var wysiwyg = function (name, schema, options) {\r\n                if (schema.type === 'string' && schema.format == 'html') {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'wysiwyg';\r\n                    f.tinymceOptions = schema.tinymceOptions;\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.string.unshift(wysiwyg);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping('bootstrapDecorator', 'wysiwyg',\r\n                'directives/decorators/bootstrap/tinymce/tinymce.html');\r\n            schemaFormDecoratorsProvider.createDirective('wysiwyg',\r\n                'directives/decorators/bootstrap/tinymce/tinymce.html');\r\n        }]);\r\n\n(function() {\n  var punchCardTemplate;\n\n  angular.module(\"punchCard\", []);\n\n  punchCardTemplate = \"<div id=\\\"punch-card\\\">\\n    <div class=\\\"punch-card-day\\\" ng-repeat='day in days'>\\n        <div class=\\\"punch-card-day-name\\\">\\n            <div class=\\\"punch-card-day-name-label\\\">{{ day }}</div>\\n        </div>\\n        <div class=\\\"punch-card-hour\\\"\\n             ng-repeat='hour in hours'\\n             ng-init=\\\"n = data[$parent.$index][$index]\\\">\\n            <div class=\\\"punch-card-hour-data size-{{ size(n) }}\\\"></div>\\n            <div class=\\\"punch-card-hour-tooltip\\\" ng-show=\\\"n\\\">\\n                <b>{{ n }}</b> {{ description(n) }}\\n                <div class=\\\"arrow\\\"></div>\\n            </div>\\n            <div class=\\\"punch-card-hour-tick\\\"></div>\\n        </div>\\n    </div>\\n    <div class=\\\"punch-card-hour-name\\\">\\n        <div class=\\\"punch-card-hour-name-label\\\" ng-repeat='hour in hours'>\\n            {{ hour }}\\n        </div>\\n    </div>\\n</div>\";\n\n  angular.module(\"punchCard\").directive(\"punchCard\", ['$compile', function($compile) {\n    return {\n      restrict: \"AE\",\n      scope: {\n        data: \"=\",\n        plural: \"@\",\n        singular: \"@\"\n      },\n      template: punchCardTemplate,\n      link: function($scope, element) {\n        $scope.days = [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"];\n        $scope.hours = [\"00\", \"01\", \"02\", \"03\", \"04\", \"05\", \"06\", \"07\", \"08\", \"09\", \"10\", \"11\", \"12\", \"13\", \"14\", \"15\", \"16\", \"17\", \"18\", \"19\", \"20\", \"21\", \"22\", \"23\"];\n        $scope.description = function(n) {\n          if (n === 1) {\n            return $scope.singular || \"event\";\n          } else {\n            return $scope.plural || \"events\";\n          }\n        };\n        return $scope.$watch(\"data\", function(data) {\n          var flatten, max;\n          flatten = [].concat.apply([], $scope.data);\n          max = flatten.sort(function(a, b) {\n            return a - b;\n          })[flatten.length - 1];\n          $scope.size = function(n) {\n            return Math.floor(100 / max * +n / 10);\n          };\n          element.empty();\n          return element.append($compile(punchCardTemplate)($scope));\n        });\n      }\n    };\n  }]);\n\n}).call(this);\n\n/*globals define, module, require, document*/\n(function (root, factory) {\n    \"use strict\";\n    if (typeof define === 'function' && define.amd) {\n        define([], factory);\n    } else if (typeof module !== 'undefined' && module.exports) {\n\t\tmodule.exports = factory();\n    } else {\n        root.JsonHuman = factory();\n    }\n}(this, function () {\n    \"use strict\";\n\n    var indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n    function makePrefixer(prefix) {\n        return function (name) {\n            return prefix + \"-\" + name;\n        };\n    }\n\n    function isArray(obj) {\n        return toString.call(obj) === '[object Array]';\n    }\n\n    function sn(tagName, className, data) {\n        var result = document.createElement(tagName);\n\n        result.className = className;\n        result.appendChild(document.createTextNode(\"\" + data));\n\n        return result;\n    }\n\n    function scn(tagName, className, child) {\n        var result = document.createElement(tagName),\n            i, len;\n\n        result.className = className;\n\n        if (isArray(child)) {\n            for (i = 0, len = child.length; i < len; i += 1) {\n                result.appendChild(child[i]);\n            }\n        } else {\n            result.appendChild(child);\n        }\n\n        return result;\n    }\n\n    function linkNode(child, href, target){\n        var a = scn(\"a\", HYPERLINK_CLASS_NAME, child);\n        a.setAttribute('href', href);\n        a.setAttribute('target', target);\n        return a;\n    }\n\n    var toString = Object.prototype.toString,\n        prefixer = makePrefixer(\"jh\"),\n        p = prefixer,\n        ARRAY = 2,\n        BOOL = 4,\n        INT = 8,\n        FLOAT = 16,\n        STRING = 32,\n        OBJECT = 64,\n        SPECIAL_OBJECT = 128,\n        FUNCTION = 256,\n        UNK = 1,\n\n        STRING_CLASS_NAME = p(\"type-string\"),\n        STRING_EMPTY_CLASS_NAME = p(\"type-string\") + \" \" + p(\"empty\"),\n\n        BOOL_TRUE_CLASS_NAME = p(\"type-bool-true\"),\n        BOOL_FALSE_CLASS_NAME = p(\"type-bool-false\"),\n        BOOL_IMAGE = p(\"type-bool-image\"),\n        INT_CLASS_NAME = p(\"type-int\") + \" \" + p(\"type-number\"),\n        FLOAT_CLASS_NAME = p(\"type-float\") + \" \" + p(\"type-number\"),\n\n        OBJECT_CLASS_NAME = p(\"type-object\"),\n        OBJ_KEY_CLASS_NAME = p(\"key\") + \" \" + p(\"object-key\"),\n        OBJ_VAL_CLASS_NAME = p(\"value\") + \" \" + p(\"object-value\"),\n        OBJ_EMPTY_CLASS_NAME = p(\"type-object\") + \" \" + p(\"empty\"),\n\n        FUNCTION_CLASS_NAME = p(\"type-function\"),\n\n        ARRAY_KEY_CLASS_NAME = p(\"key\") + \" \" + p(\"array-key\"),\n        ARRAY_VAL_CLASS_NAME = p(\"value\") + \" \" + p(\"array-value\"),\n        ARRAY_CLASS_NAME = p(\"type-array\"),\n        ARRAY_EMPTY_CLASS_NAME = p(\"type-array\") + \" \" + p(\"empty\"),\n\n        HYPERLINK_CLASS_NAME = p('a'),\n\n        UNKNOWN_CLASS_NAME = p(\"type-unk\");\n\n    function getType(obj) {\n        var type = typeof obj;\n\n        switch (type) {\n        case \"boolean\":\n            return BOOL;\n        case \"string\":\n            return STRING;\n        case \"number\":\n            return (obj % 1 === 0) ? INT : FLOAT;\n        case \"function\":\n            return FUNCTION;\n        default:\n            if (isArray(obj)) {\n                return ARRAY;\n            } else if (obj === Object(obj)) {\n                if (obj.constructor === Object) {\n                    return OBJECT;\n                }\n                return OBJECT | SPECIAL_OBJECT\n            } else {\n                return UNK;\n            }\n        }\n    }\n\n    function _format(data, options, parentKey) {\n\n        var result, container, key, keyNode, valNode, len, childs, tr, value,\n            isEmpty = true,\n            isSpecial = false,\n            accum = [],\n            type = getType(data);\n\n        // Initialized & used only in case of objects & arrays\n        var hyperlinksEnabled, aTarget, hyperlinkKeys ;\n\n        if (type === BOOL) {\n            var boolOpt = options.bool;\n            container = document.createElement('div');\n\n            if (boolOpt.showImage) {\n                var img = document.createElement('img');\n                img.setAttribute('class', BOOL_IMAGE);\n\n                img.setAttribute('src',\n                    '' + (data ? boolOpt.img.true : boolOpt.img.false));\n\n                container.appendChild(img);\n            }\n\n            if (boolOpt.showText) {\n                container.appendChild(data ?\n                    sn(\"span\", BOOL_TRUE_CLASS_NAME, boolOpt.text.true) :\n                    sn(\"span\", BOOL_FALSE_CLASS_NAME, boolOpt.text.false));\n            }\n\n            result = container;\n\n        } else if (type === STRING) {\n            if (data === \"\") {\n                result = sn(\"span\", STRING_EMPTY_CLASS_NAME, \"(Empty Text)\");\n            } else {\n                result = sn(\"span\", STRING_CLASS_NAME, data);\n            }\n        } else if (type === INT) {\n            result = sn(\"span\", INT_CLASS_NAME, data);\n        } else if (type === FLOAT) {\n            result = sn(\"span\", FLOAT_CLASS_NAME, data);\n        } else if (type & OBJECT) {\n            if (type & SPECIAL_OBJECT) {\n                isSpecial = true;\n            }\n            childs = [];\n\n            aTarget =  options.hyperlinks.target;\n            hyperlinkKeys = options.hyperlinks.keys;\n\n            // Is Hyperlink Key\n            hyperlinksEnabled =\n                options.hyperlinks.enable &&\n                hyperlinkKeys &&\n                hyperlinkKeys.length > 0;\n\n            for (key in data) {\n                isEmpty = false;\n\n                value = data[key];\n\n                valNode = _format(value, options, key);\n                keyNode = sn(\"th\", OBJ_KEY_CLASS_NAME, key);\n\n                if( hyperlinksEnabled &&\n                    typeof(value) === 'string' &&\n                    indexOf.call(hyperlinkKeys, key) >= 0){\n\n                    valNode = scn(\"td\", OBJ_VAL_CLASS_NAME, linkNode(valNode, value, aTarget));\n                } else {\n                    valNode = scn(\"td\", OBJ_VAL_CLASS_NAME, valNode);\n                }\n\n                tr = document.createElement(\"tr\");\n                tr.appendChild(keyNode);\n                tr.appendChild(valNode);\n\n                childs.push(tr);\n            }\n\n            if (isSpecial) {\n                result = sn('span', STRING_CLASS_NAME, data.toString())\n            } else if (isEmpty) {\n                result = sn(\"span\", OBJ_EMPTY_CLASS_NAME, \"(Empty Object)\");\n            } else {\n                result = scn(\"table\", OBJECT_CLASS_NAME, scn(\"tbody\", '', childs));\n            }\n        } else if (type === FUNCTION) {\n            result = sn(\"span\", FUNCTION_CLASS_NAME, data);\n        } else if (type === ARRAY) {\n            if (data.length > 0) {\n                childs = [];\n                var showArrayIndices = options.showArrayIndex;\n\n                aTarget = options.hyperlinks.target;\n                hyperlinkKeys = options.hyperlinks.keys;\n\n                // Hyperlink of arrays?\n                hyperlinksEnabled = parentKey && options.hyperlinks.enable &&\n                    hyperlinkKeys &&\n                    hyperlinkKeys.length > 0 &&\n                    indexOf.call(hyperlinkKeys, parentKey) >= 0;\n\n                for (key = 0, len = data.length; key < len; key += 1) {\n\n                    keyNode = sn(\"th\", ARRAY_KEY_CLASS_NAME, key);\n                    value = data[key];\n\n                    if (hyperlinksEnabled && typeof(value) === \"string\") {\n                        valNode = _format(value, options, key);\n                        valNode = scn(\"td\", ARRAY_VAL_CLASS_NAME,\n                            linkNode(valNode, value, aTarget));\n                    } else {\n                        valNode = scn(\"td\", ARRAY_VAL_CLASS_NAME,\n                            _format(value, options, key));\n                    }\n\n                    tr = document.createElement(\"tr\");\n\n                    if (showArrayIndices) {\n                        tr.appendChild(keyNode);\n                    }\n                    tr.appendChild(valNode);\n\n                    childs.push(tr);\n                }\n\n                result = scn(\"table\", ARRAY_CLASS_NAME, scn(\"tbody\", '', childs));\n            } else {\n                result = sn(\"span\", ARRAY_EMPTY_CLASS_NAME, \"(Empty List)\");\n            }\n        } else {\n            result = sn(\"span\", UNKNOWN_CLASS_NAME, data);\n        }\n\n        return result;\n    }\n\n    function format(data, options) {\n        options = validateOptions(options || {});\n\n        var result;\n\n        result = _format(data, options);\n        result.className = result.className + \" \" + prefixer(\"root\");\n\n        return result;\n    }\n\n    function validateOptions(options){\n        options = validateArrayIndexOption(options);\n        options = validateHyperlinkOptions(options);\n        options = validateBoolOptions(options);\n\n        // Add any more option validators here\n\n        return options;\n    }\n\n\n    function validateArrayIndexOption(options) {\n        if(options.showArrayIndex === undefined){\n            options.showArrayIndex = true;\n        } else {\n            // Force to boolean just in case\n            options.showArrayIndex = options.showArrayIndex ? true: false;\n        }\n\n        return options;\n    }\n\n    function validateHyperlinkOptions(options){\n        var hyperlinks = {\n            enable : false,\n            keys : null,\n            target : ''\n        };\n\n        if(options.hyperlinks && options.hyperlinks.enable) {\n            hyperlinks.enable = true;\n\n            hyperlinks.keys =  isArray(options.hyperlinks.keys) ? options.hyperlinks.keys : [];\n\n            if(options.hyperlinks.target) {\n                hyperlinks.target = '' + options.hyperlinks.target;\n            } else {\n                hyperlinks.target = '_blank';\n            }\n        }\n\n        options.hyperlinks = hyperlinks;\n\n        return options;\n    }\n\n    function validateBoolOptions(options){\n        if(!options.bool){\n            options.bool = {\n                text:  {\n                    true : \"true\",\n                    false : \"false\"\n                },\n                img : {\n                    true: \"\",\n                    false: \"\"\n                },\n                showImage : false,\n                showText : true\n            };\n        } else {\n            var boolOptions = options.bool;\n\n            // Show text if no option\n            if(!boolOptions.showText && !boolOptions.showImage){\n                boolOptions.showImage  =  false;\n                boolOptions.showText  =  true;\n            }\n\n            if(boolOptions.showText){\n                if(!boolOptions.text){\n                    boolOptions.text = {\n                        true : \"true\",\n                        false : \"false\"\n                    };\n                } else {\n                    var t = boolOptions.text.true, f = boolOptions.text.false;\n\n                    if(getType(t) != STRING || t === ''){\n                        boolOptions.text.true = 'true';\n                    }\n\n                    if(getType(f) != STRING || f === ''){\n                        boolOptions.text.false = 'false';\n                    }\n                }\n            }\n\n            if(boolOptions.showImage){\n                if(!boolOptions.img.true && !boolOptions.img.false){\n                    boolOptions.showImage = false;\n                }\n            }\n        }\n\n        return options;\n    }\n\n    return {\n        format: format\n    };\n}));\n\n(function () {\n    'use strict';\n    angular.module('flash', [])\n        .factory('flash', ['$rootScope', '$timeout', function ($rootScope, $timeout) {\n            var messages = [];\n\n            var reset;\n            var cleanup = function () {\n                $timeout.cancel(reset);\n                reset = $timeout(function () {\n                    messages = [];\n                });\n            };\n\n            var emit = function () {\n                $rootScope.$emit('flashMessage', messages[0], cleanup);\n            };\n\n            $rootScope.$on('$locationChangeSuccess', emit);\n\n            var factory = {};\n\n            factory.error = function () {\n                [].unshift.call(arguments, \"error\");\n                process.apply(this, arguments);\n            };\n            factory.success = function () {\n                [].unshift.call(arguments, \"success\");\n                process.apply(this, arguments);\n            };\n\n            factory.warning = function () {\n                [].unshift.call(arguments, \"warning\");\n                process.apply(this, arguments);\n            };\n\n            factory.getMessage = function () {\n                return messages[0];\n            };\n\n            function process() {\n                var length = arguments.length;\n                if (length < 3) {\n                    throw new Error(\"Minimum arguments for Flash is 2 (Title and Body)\");\n                }\n\n                var obj = {\n                    type: arguments[0],\n                    title: arguments[1]\n                };\n                if (length < 4) {\n                    obj.message = arguments[2];\n                } else {\n                    obj.messages = [];\n                    for (var i = 0; i < length - 2; i++) {\n                        obj.messages.push(arguments[2 + i]);\n                    }\n                }\n                emit(messages = [obj]);\n            }\n\n            return factory;\n        }])\n\n        .directive('flashMessage', function () {\n            return {\n                restrict: 'E',\n                template: '<div ng-if=\"type==\\'error\\'\" class=\"alert alert-danger\">' +\n                '<span><h3>{{title}}</h3></span>' +\n                '<p ng-if=\"message\" ng-bind-html=\"message\"></p>' +\n                '<li ng-if=\"messages\" ng-repeat=\"m in messages\"><p ng-bind-html=\"m\"></p></li>' +\n                '</div>' +\n\n                '<div ng-if=\"type==\\'success\\'\" class=\"alert alert-success\">' +\n                '<span><h3>{{title}}</h3></span>' +\n                '<p ng-if=\"message\" ng-bind-html=\"message\"></p>' +\n                '<li ng-if=\"messages\" ng-repeat=\"m in messages\"><p ng-bind-html=\"m\"></p></li>' +\n                '</div>' +\n\n                '<div ng-if=\"type==\\'warning\\'\" class=\"alert alert-warning\">' +\n                '<span><h3>{{title}}</h3></span>' +\n                '<p ng-if=\"message\" ng-bind-html=\"message\"></p>' +\n                '<li ng-if=\"messages\" ng-repeat=\"m in messages\"><p ng-bind-html=\"m\"></p></li>' +\n                '</div>',\n                controller: ['$scope', '$rootScope', 'flash', function ($scope, $rootScope, flash) {\n                    $rootScope.$on('flashMessage', function (event, data, done) {\n                        processData(data);\n                        done();\n                    });\n                    $scope.getMessage = function () {\n\n                        processData(flash.getMessage());\n                    };\n                    $scope.getMessage();\n\n                    function processData(data) {\n                        if (data) {\n                            $scope.type = data.type;\n                            $scope.title = data.title;\n                            $scope.messages = data.messages;\n                            $scope.message = data.message;\n                            //done();\n                        }\n                    }\n                }]\n            };\n        });\n})();\n\n/**!\n * AngularJS file upload/drop directive and service with progress and abort\n * FileAPI Flash shim for old browsers not supporting FormData\n * @author  Danial  <danial.farid@gmail.com>\n * @version 5.0.9\n */\n\n(function () {\n  /** @namespace FileAPI.noContentTimeout */\n\n  function patchXHR(fnName, newFn) {\n    window.XMLHttpRequest.prototype[fnName] = newFn(window.XMLHttpRequest.prototype[fnName]);\n  }\n\n  function redefineProp(xhr, prop, fn) {\n    try {\n      Object.defineProperty(xhr, prop, {get: fn});\n    } catch (e) {/*ignore*/\n    }\n  }\n\n  if (!window.FileAPI) {\n    window.FileAPI = {};\n  }\n\n  FileAPI.shouldLoad = (window.XMLHttpRequest && !window.FormData) || FileAPI.forceLoad;\n  if (FileAPI.shouldLoad) {\n    var initializeUploadListener = function (xhr) {\n      if (!xhr.__listeners) {\n        if (!xhr.upload) xhr.upload = {};\n        xhr.__listeners = [];\n        var origAddEventListener = xhr.upload.addEventListener;\n        xhr.upload.addEventListener = function (t, fn) {\n          xhr.__listeners[t] = fn;\n          if (origAddEventListener) origAddEventListener.apply(this, arguments);\n        };\n      }\n    };\n\n    patchXHR('open', function (orig) {\n      return function (m, url, b) {\n        initializeUploadListener(this);\n        this.__url = url;\n        try {\n          orig.apply(this, [m, url, b]);\n        } catch (e) {\n          if (e.message.indexOf('Access is denied') > -1) {\n            this.__origError = e;\n            orig.apply(this, [m, '_fix_for_ie_crossdomain__', b]);\n          }\n        }\n      };\n    });\n\n    patchXHR('getResponseHeader', function (orig) {\n      return function (h) {\n        return this.__fileApiXHR && this.__fileApiXHR.getResponseHeader ? this.__fileApiXHR.getResponseHeader(h) : (orig == null ? null : orig.apply(this, [h]));\n      };\n    });\n\n    patchXHR('getAllResponseHeaders', function (orig) {\n      return function () {\n        return this.__fileApiXHR && this.__fileApiXHR.getAllResponseHeaders ? this.__fileApiXHR.getAllResponseHeaders() : (orig == null ? null : orig.apply(this));\n      };\n    });\n\n    patchXHR('abort', function (orig) {\n      return function () {\n        return this.__fileApiXHR && this.__fileApiXHR.abort ? this.__fileApiXHR.abort() : (orig == null ? null : orig.apply(this));\n      };\n    });\n\n    patchXHR('setRequestHeader', function (orig) {\n      return function (header, value) {\n        if (header === '__setXHR_') {\n          initializeUploadListener(this);\n          var val = value(this);\n          // fix for angular < 1.2.0\n          if (val instanceof Function) {\n            val(this);\n          }\n        } else {\n          this.__requestHeaders = this.__requestHeaders || {};\n          this.__requestHeaders[header] = value;\n          orig.apply(this, arguments);\n        }\n      };\n    });\n\n    patchXHR('send', function (orig) {\n      return function () {\n        var xhr = this;\n        if (arguments[0] && arguments[0].__isFileAPIShim) {\n          var formData = arguments[0];\n          var config = {\n            url: xhr.__url,\n            jsonp: false, //removes the callback form param\n            cache: true, //removes the ?fileapiXXX in the url\n            complete: function (err, fileApiXHR) {\n              xhr.__completed = true;\n              if (!err && xhr.__listeners.load)\n                xhr.__listeners.load({\n                  type: 'load',\n                  loaded: xhr.__loaded,\n                  total: xhr.__total,\n                  target: xhr,\n                  lengthComputable: true\n                });\n              if (!err && xhr.__listeners.loadend)\n                xhr.__listeners.loadend({\n                  type: 'loadend',\n                  loaded: xhr.__loaded,\n                  total: xhr.__total,\n                  target: xhr,\n                  lengthComputable: true\n                });\n              if (err === 'abort' && xhr.__listeners.abort)\n                xhr.__listeners.abort({\n                  type: 'abort',\n                  loaded: xhr.__loaded,\n                  total: xhr.__total,\n                  target: xhr,\n                  lengthComputable: true\n                });\n              if (fileApiXHR.status !== undefined) redefineProp(xhr, 'status', function () {\n                return (fileApiXHR.status === 0 && err && err !== 'abort') ? 500 : fileApiXHR.status;\n              });\n              if (fileApiXHR.statusText !== undefined) redefineProp(xhr, 'statusText', function () {\n                return fileApiXHR.statusText;\n              });\n              redefineProp(xhr, 'readyState', function () {\n                return 4;\n              });\n              if (fileApiXHR.response !== undefined) redefineProp(xhr, 'response', function () {\n                return fileApiXHR.response;\n              });\n              var resp = fileApiXHR.responseText || (err && fileApiXHR.status === 0 && err !== 'abort' ? err : undefined);\n              redefineProp(xhr, 'responseText', function () {\n                return resp;\n              });\n              redefineProp(xhr, 'response', function () {\n                return resp;\n              });\n              if (err) redefineProp(xhr, 'err', function () {\n                return err;\n              });\n              xhr.__fileApiXHR = fileApiXHR;\n              if (xhr.onreadystatechange) xhr.onreadystatechange();\n              if (xhr.onload) xhr.onload();\n            },\n            progress: function (e) {\n              e.target = xhr;\n              if (xhr.__listeners.progress) xhr.__listeners.progress(e);\n              xhr.__total = e.total;\n              xhr.__loaded = e.loaded;\n              if (e.total === e.loaded) {\n                // fix flash issue that doesn't call complete if there is no response text from the server\n                var _this = this;\n                setTimeout(function () {\n                  if (!xhr.__completed) {\n                    xhr.getAllResponseHeaders = function () {\n                    };\n                    _this.complete(null, {status: 204, statusText: 'No Content'});\n                  }\n                }, FileAPI.noContentTimeout || 10000);\n              }\n            },\n            headers: xhr.__requestHeaders\n          };\n          config.data = {};\n          config.files = {};\n          for (var i = 0; i < formData.data.length; i++) {\n            var item = formData.data[i];\n            if (item.val != null && item.val.name != null && item.val.size != null && item.val.type != null) {\n              config.files[item.key] = item.val;\n            } else {\n              config.data[item.key] = item.val;\n            }\n          }\n\n          setTimeout(function () {\n            if (!FileAPI.hasFlash) {\n              throw 'Adode Flash Player need to be installed. To check ahead use \"FileAPI.hasFlash\"';\n            }\n            xhr.__fileApiXHR = FileAPI.upload(config);\n          }, 1);\n        } else {\n          if (this.__origError) {\n            throw this.__origError;\n          }\n          orig.apply(xhr, arguments);\n        }\n      };\n    });\n    window.XMLHttpRequest.__isFileAPIShim = true;\n    window.FormData = FormData = function () {\n      return {\n        append: function (key, val, name) {\n          if (val.__isFileAPIBlobShim) {\n            val = val.data[0];\n          }\n          this.data.push({\n            key: key,\n            val: val,\n            name: name\n          });\n        },\n        data: [],\n        __isFileAPIShim: true\n      };\n    };\n\n    window.Blob = Blob = function (b) {\n      return {\n        data: b,\n        __isFileAPIBlobShim: true\n      };\n    };\n  }\n\n})();\n\n(function () {\n  /** @namespace FileAPI.forceLoad */\n  /** @namespace window.FileAPI.jsUrl */\n  /** @namespace window.FileAPI.jsPath */\n\n  function isInputTypeFile(elem) {\n    return elem[0].tagName.toLowerCase() === 'input' && elem.attr('type') && elem.attr('type').toLowerCase() === 'file';\n  }\n\n  function hasFlash() {\n    try {\n      var fo = new ActiveXObject('ShockwaveFlash.ShockwaveFlash');\n      if (fo) return true;\n    } catch (e) {\n      if (navigator.mimeTypes['application/x-shockwave-flash'] !== undefined) return true;\n    }\n    return false;\n  }\n\n  function getOffset(obj) {\n    var left = 0, top = 0;\n\n    if (window.jQuery) {\n      return jQuery(obj).offset();\n    }\n\n    if (obj.offsetParent) {\n      do {\n        left += (obj.offsetLeft - obj.scrollLeft);\n        top += (obj.offsetTop - obj.scrollTop);\n        obj = obj.offsetParent;\n      } while (obj);\n    }\n    return {\n      left: left,\n      top: top\n    };\n  }\n\n  if (FileAPI.shouldLoad) {\n\n    //load FileAPI\n    if (FileAPI.forceLoad) {\n      FileAPI.html5 = false;\n    }\n\n    if (!FileAPI.upload) {\n      var jsUrl, basePath, script = document.createElement('script'), allScripts = document.getElementsByTagName('script'), i, index, src;\n      if (window.FileAPI.jsUrl) {\n        jsUrl = window.FileAPI.jsUrl;\n      } else if (window.FileAPI.jsPath) {\n        basePath = window.FileAPI.jsPath;\n      } else {\n        for (i = 0; i < allScripts.length; i++) {\n          src = allScripts[i].src;\n          index = src.search(/\\/ng\\-file\\-upload[\\-a-zA-z0-9\\.]*\\.js/);\n          if (index > -1) {\n            basePath = src.substring(0, index + 1);\n            break;\n          }\n        }\n      }\n\n      if (FileAPI.staticPath == null) FileAPI.staticPath = basePath;\n      script.setAttribute('src', jsUrl || basePath + 'FileAPI.min.js');\n      document.getElementsByTagName('head')[0].appendChild(script);\n\n      FileAPI.hasFlash = hasFlash();\n    }\n\n    FileAPI.ngfFixIE = function (elem, createFileElemFn, bindAttr, changeFn) {\n      if (!hasFlash()) {\n        throw 'Adode Flash Player need to be installed. To check ahead use \"FileAPI.hasFlash\"';\n      }\n      var makeFlashInput = function () {\n        if (elem.attr('disabled')) {\n          elem.$$ngfRefElem.removeClass('js-fileapi-wrapper');\n        } else {\n          var fileElem = elem.$$ngfRefElem;\n          if (!fileElem) {\n            fileElem = elem.$$ngfRefElem = createFileElemFn();\n            fileElem.addClass('js-fileapi-wrapper');\n            if (!isInputTypeFile(elem)) {\n//\t\t\t\t\t\tif (fileElem.parent().css('position') === '' || fileElem.parent().css('position') === 'static') {\n//\t\t\t\t\t\t\tfileElem.parent().css('position', 'relative');\n//\t\t\t\t\t\t}\n//\t\t\t\t\t\telem.parent()[0].insertBefore(fileElem[0], elem[0]);\n//\t\t\t\t\t\telem.css('overflow', 'hidden');\n            }\n            setTimeout(function () {\n              fileElem.bind('mouseenter', makeFlashInput);\n            }, 10);\n            fileElem.bind('change', function (evt) {\n              fileApiChangeFn.apply(this, [evt]);\n              changeFn.apply(this, [evt]);\n//\t\t\t\t\t\talert('change' +  evt);\n            });\n          } else {\n            bindAttr(elem.$$ngfRefElem);\n          }\n          if (!isInputTypeFile(elem)) {\n            fileElem.css('position', 'absolute')\n              .css('top', getOffset(elem[0]).top + 'px').css('left', getOffset(elem[0]).left + 'px')\n              .css('width', elem[0].offsetWidth + 'px').css('height', elem[0].offsetHeight + 'px')\n              .css('filter', 'alpha(opacity=0)').css('display', elem.css('display'))\n              .css('overflow', 'hidden').css('z-index', '900000')\n              .css('visibility', 'visible');\n          }\n        }\n      };\n\n      elem.bind('mouseenter', makeFlashInput);\n\n      var fileApiChangeFn = function (evt) {\n        var files = FileAPI.getFiles(evt);\n        //just a double check for #233\n        for (var i = 0; i < files.length; i++) {\n          if (files[i].size === undefined) files[i].size = 0;\n          if (files[i].name === undefined) files[i].name = 'file';\n          if (files[i].type === undefined) files[i].type = 'undefined';\n        }\n        if (!evt.target) {\n          evt.target = {};\n        }\n        evt.target.files = files;\n        // if evt.target.files is not writable use helper field\n        if (evt.target.files !== files) {\n          evt.__files_ = files;\n        }\n        (evt.__files_ || evt.target.files).item = function (i) {\n          return (evt.__files_ || evt.target.files)[i] || null;\n        };\n      };\n    };\n\n    FileAPI.disableFileInput = function (elem, disable) {\n      if (disable) {\n        elem.removeClass('js-fileapi-wrapper');\n      } else {\n        elem.addClass('js-fileapi-wrapper');\n      }\n    };\n  }\n})();\n\nif (!window.FileReader) {\n  window.FileReader = function () {\n    var _this = this, loadStarted = false;\n    this.listeners = {};\n    this.addEventListener = function (type, fn) {\n      _this.listeners[type] = _this.listeners[type] || [];\n      _this.listeners[type].push(fn);\n    };\n    this.removeEventListener = function (type, fn) {\n      if (_this.listeners[type]) _this.listeners[type].splice(_this.listeners[type].indexOf(fn), 1);\n    };\n    this.dispatchEvent = function (evt) {\n      var list = _this.listeners[evt.type];\n      if (list) {\n        for (var i = 0; i < list.length; i++) {\n          list[i].call(_this, evt);\n        }\n      }\n    };\n    this.onabort = this.onerror = this.onload = this.onloadstart = this.onloadend = this.onprogress = null;\n\n    var constructEvent = function (type, evt) {\n      var e = {type: type, target: _this, loaded: evt.loaded, total: evt.total, error: evt.error};\n      if (evt.result != null) e.target.result = evt.result;\n      return e;\n    };\n    var listener = function (evt) {\n      if (!loadStarted) {\n        loadStarted = true;\n        if (_this.onloadstart) _this.onloadstart(constructEvent('loadstart', evt));\n      }\n      var e;\n      if (evt.type === 'load') {\n        if (_this.onloadend) _this.onloadend(constructEvent('loadend', evt));\n        e = constructEvent('load', evt);\n        if (_this.onload) _this.onload(e);\n        _this.dispatchEvent(e);\n      } else if (evt.type === 'progress') {\n        e = constructEvent('progress', evt);\n        if (_this.onprogress) _this.onprogress(e);\n        _this.dispatchEvent(e);\n      } else {\n        e = constructEvent('error', evt);\n        if (_this.onerror) _this.onerror(e);\n        _this.dispatchEvent(e);\n      }\n    };\n    this.readAsArrayBuffer = function (file) {\n      FileAPI.readAsBinaryString(file, listener);\n    };\n    this.readAsBinaryString = function (file) {\n      FileAPI.readAsBinaryString(file, listener);\n    };\n    this.readAsDataURL = function (file) {\n      FileAPI.readAsDataURL(file, listener);\n    };\n    this.readAsText = function (file) {\n      FileAPI.readAsText(file, listener);\n    };\n  };\n}\n\n/**!\n * AngularJS file upload/drop directive and service with progress and abort\n * @author  Danial  <danial.farid@gmail.com>\n * @version 5.0.9\n */\n\nif (window.XMLHttpRequest && !(window.FileAPI && FileAPI.shouldLoad)) {\n  window.XMLHttpRequest.prototype.setRequestHeader = (function (orig) {\n    return function (header, value) {\n      if (header === '__setXHR_') {\n        var val = value(this);\n        // fix for angular < 1.2.0\n        if (val instanceof Function) {\n          val(this);\n        }\n      } else {\n        orig.apply(this, arguments);\n      }\n    };\n  })(window.XMLHttpRequest.prototype.setRequestHeader);\n}\n\nvar ngFileUpload = angular.module('ngFileUpload', []);\n\nngFileUpload.version = '5.0.9';\nngFileUpload.service('Upload', ['$http', '$q', '$timeout', function ($http, $q, $timeout) {\n  function sendHttp(config) {\n    config.method = config.method || 'POST';\n    config.headers = config.headers || {};\n\n    var deferred = $q.defer();\n    var promise = deferred.promise;\n\n    config.headers.__setXHR_ = function () {\n      return function (xhr) {\n        if (!xhr) return;\n        config.__XHR = xhr;\n        if (config.xhrFn) config.xhrFn(xhr);\n        xhr.upload.addEventListener('progress', function (e) {\n          e.config = config;\n          if (deferred.notify) {\n            deferred.notify(e);\n          } else if (promise.progressFunc) {\n            $timeout(function () {\n              promise.progressFunc(e);\n            });\n          }\n        }, false);\n        //fix for firefox not firing upload progress end, also IE8-9\n        xhr.upload.addEventListener('load', function (e) {\n          if (e.lengthComputable) {\n            e.config = config;\n            if (deferred.notify) {\n              deferred.notify(e);\n            } else if (promise.progressFunc) {\n              $timeout(function () {\n                promise.progressFunc(e);\n              });\n            }\n          }\n        }, false);\n      };\n    };\n\n    $http(config).then(function (r) {\n      deferred.resolve(r);\n    }, function (e) {\n      deferred.reject(e);\n    }, function (n) {\n      deferred.notify(n);\n    });\n\n    promise.success = function (fn) {\n      promise.then(function (response) {\n        fn(response.data, response.status, response.headers, config);\n      });\n      return promise;\n    };\n\n    promise.error = function (fn) {\n      promise.then(null, function (response) {\n        fn(response.data, response.status, response.headers, config);\n      });\n      return promise;\n    };\n\n    promise.progress = function (fn) {\n      promise.progressFunc = fn;\n      promise.then(null, null, function (update) {\n        fn(update);\n      });\n      return promise;\n    };\n    promise.abort = function () {\n      if (config.__XHR) {\n        $timeout(function () {\n          config.__XHR.abort();\n        });\n      }\n      return promise;\n    };\n    promise.xhr = function (fn) {\n      config.xhrFn = (function (origXhrFn) {\n        return function () {\n          if (origXhrFn) origXhrFn.apply(promise, arguments);\n          fn.apply(promise, arguments);\n        };\n      })(config.xhrFn);\n      return promise;\n    };\n\n    return promise;\n  }\n\n  this.upload = function (config) {\n    function addFieldToFormData(formData, val, key) {\n      if (val !== undefined) {\n        if (angular.isDate(val)) {\n          val = val.toISOString();\n        }\n        if (angular.isString(val)) {\n          formData.append(key, val);\n        } else if (config.sendFieldsAs === 'form') {\n          if (angular.isObject(val)) {\n            for (var k in val) {\n              if (val.hasOwnProperty(k)) {\n                addFieldToFormData(formData, val[k], key + '[' + k + ']');\n              }\n            }\n          } else {\n            formData.append(key, val);\n          }\n        } else {\n          val = angular.isString(val) ? val : JSON.stringify(val);\n          if (config.sendFieldsAs === 'json-blob') {\n            formData.append(key, new Blob([val], {type: 'application/json'}));\n          } else {\n            formData.append(key, val);\n          }\n        }\n      }\n    }\n\n    config.headers = config.headers || {};\n    config.headers['Content-Type'] = undefined;\n    config.transformRequest = config.transformRequest ?\n      (angular.isArray(config.transformRequest) ?\n        config.transformRequest : [config.transformRequest]) : [];\n    config.transformRequest.push(function (data) {\n      var formData = new FormData();\n      var allFields = {};\n      var key;\n      for (key in config.fields) {\n        if (config.fields.hasOwnProperty(key)) {\n          allFields[key] = config.fields[key];\n        }\n      }\n      if (data) allFields.data = data;\n      for (key in allFields) {\n        if (allFields.hasOwnProperty(key)) {\n          var val = allFields[key];\n          if (config.formDataAppender) {\n            config.formDataAppender(formData, key, val);\n          } else {\n            addFieldToFormData(formData, val, key);\n          }\n        }\n      }\n\n      if (config.file != null) {\n        var fileFormName = config.fileFormDataName || 'file';\n\n        if (angular.isArray(config.file)) {\n          var isFileFormNameString = angular.isString(fileFormName);\n          for (var i = 0; i < config.file.length; i++) {\n            formData.append(isFileFormNameString ? fileFormName : fileFormName[i], config.file[i],\n              (config.fileName && config.fileName[i]) || config.file[i].name);\n          }\n        } else {\n          formData.append(fileFormName, config.file, config.fileName || config.file.name);\n        }\n      }\n      return formData;\n    });\n\n    return sendHttp(config);\n  };\n\n  this.http = function (config) {\n    config.transformRequest = config.transformRequest || function (data) {\n        if ((window.ArrayBuffer && data instanceof window.ArrayBuffer) || data instanceof Blob) {\n          return data;\n        }\n        return $http.defaults.transformRequest[0](arguments);\n      };\n    return sendHttp(config);\n  };\n}\n\n]);\n\n(function () {\n    ngFileUpload.directive('ngfSelect', ['$parse', '$timeout', '$compile', function ($parse, $timeout, $compile) {\n            return {\n                restrict: 'AEC',\n                require: '?ngModel',\n                link: function (scope, elem, attr, ngModel) {\n                    linkFileSelect(scope, elem, attr, ngModel, $parse, $timeout, $compile);\n                }\n            };\n        }]);\n\n    function linkFileSelect(scope, elem, attr, ngModel, $parse, $timeout, $compile) {\n        /** @namespace attr.ngfSelect */\n        /** @namespace attr.ngfChange */\n        /** @namespace attr.ngModel */\n        /** @namespace attr.ngModelRejected */\n        /** @namespace attr.ngfMultiple */\n        /** @namespace attr.ngfCapture */\n        /** @namespace attr.ngfAccept */\n        /** @namespace attr.ngfMaxSize */\n        /** @namespace attr.ngfMinSize */\n        /** @namespace attr.ngfResetOnClick */\n        /** @namespace attr.ngfResetModelOnClick */\n        /** @namespace attr.ngfKeep */\n        /** @namespace attr.ngfKeepDistinct */\n\n        if (elem.attr('__ngf_gen__')) {\n            return;\n        }\n\n        scope.$on('$destroy', function () {\n            if (elem.$$ngfRefElem) elem.$$ngfRefElem.remove();\n        });\n\n        var disabled = false;\n        if (attr.ngfSelect.search(/\\W+$files\\W+/) === -1) {\n            scope.$watch(attr.ngfSelect, function (val) {\n                disabled = val === false;\n            });\n        }\n        function isInputTypeFile() {\n            return elem[0].tagName.toLowerCase() === 'input' && attr.type && attr.type.toLowerCase() === 'file';\n        }\n\n        var isUpdating = false;\n\n        function changeFn(evt) {\n            if (!isUpdating) {\n                isUpdating = true;\n                try {\n                    var fileList = evt.__files_ || (evt.target && evt.target.files);\n                    var files = [], rejFiles = [];\n\n                    for (var i = 0; i < fileList.length; i++) {\n                        var file = fileList.item(i);\n                        if (validate(scope, $parse, attr, file, evt)) {\n                            files.push(file);\n                        } else {\n                            rejFiles.push(file);\n                        }\n                    }\n                    updateModel($parse, $timeout, scope, ngModel, attr, attr.ngfChange || attr.ngfSelect, files, rejFiles, evt);\n                    if (files.length === 0) evt.target.value = files;\n//                if (evt.target && evt.target.getAttribute('__ngf_gen__')) {\n//                    angular.element(evt.target).remove();\n//                }\n                } finally {\n                    isUpdating = false;\n                }\n            }\n        }\n\n        function bindAttrToFileInput(fileElem) {\n            if (attr.ngfMultiple) fileElem.attr('multiple', $parse(attr.ngfMultiple)(scope));\n            if (attr.ngfCapture) fileElem.attr('capture', $parse(attr.ngfCapture)(scope));\n            if (attr.accept) fileElem.attr('accept', attr.accept);\n            for (var i = 0; i < elem[0].attributes.length; i++) {\n                var attribute = elem[0].attributes[i];\n                if ((isInputTypeFile() && attribute.name !== 'type') ||\n                    (attribute.name !== 'type' && attribute.name !== 'class' &&\n                    attribute.name !== 'id' && attribute.name !== 'style')) {\n                    fileElem.attr(attribute.name, attribute.value);\n                }\n            }\n        }\n\n        function createFileInput(evt, resetOnClick) {\n            if (!resetOnClick && (evt || isInputTypeFile())) return elem.$$ngfRefElem || elem;\n\n            var fileElem = angular.element('<input type=\"file\">');\n            bindAttrToFileInput(fileElem);\n\n            if (isInputTypeFile()) {\n                elem.replaceWith(fileElem);\n                elem = fileElem;\n                fileElem.attr('__ngf_gen__', true);\n                $compile(elem)(scope);\n            } else {\n                fileElem.css('visibility', 'hidden').css('position', 'absolute').css('overflow', 'hidden')\n                    .css('width', '0px').css('height', '0px').css('z-index', '-100000').css('border', 'none')\n                    .css('margin', '0px').css('padding', '0px').attr('tabindex', '-1');\n                if (elem.$$ngfRefElem) {\n                    elem.$$ngfRefElem.remove();\n                }\n                elem.$$ngfRefElem = fileElem;\n                document.body.appendChild(fileElem[0]);\n            }\n\n            return fileElem;\n        }\n\n        function resetModel(evt) {\n            updateModel($parse, $timeout, scope, ngModel, attr, attr.ngfChange || attr.ngfSelect, [], [], evt, true);\n        }\n\n        function clickHandler(evt) {\n            if (elem.attr('disabled') || disabled) return false;\n            if (evt != null) {\n                evt.preventDefault();\n                evt.stopPropagation();\n            }\n            var resetOnClick = $parse(attr.ngfResetOnClick)(scope) !== false;\n            var fileElem = createFileInput(evt, resetOnClick);\n\n            function clickAndAssign(evt) {\n                if (evt) {\n                    fileElem[0].click();\n                }\n                /*if (isInputTypeFile() || !evt) {\n                    elem.bind('click touchend', clickHandler);\n                }*/\n            }\n\n            if (fileElem) {\n                if (!evt || resetOnClick) fileElem.bind('change', changeFn);\n                if (evt && resetOnClick && $parse(attr.ngfResetModelOnClick)(scope) !== false) resetModel(evt);\n\n                // fix for android native browser < 4.4\n                if (shouldClickLater(navigator.userAgent)) {\n                    setTimeout(function () {\n                        clickAndAssign(evt);\n                    }, 0);\n                } else {\n                    clickAndAssign(evt);\n                }\n            }\n            return false;\n        }\n\n        if (window.FileAPI && window.FileAPI.ngfFixIE) {\n            window.FileAPI.ngfFixIE(elem, createFileInput, bindAttrToFileInput, changeFn);\n        } else {\n            clickHandler();\n            //if (!isInputTypeFile()) {\n            //  elem.bind('click touchend', clickHandler);\n            //}\n        }\n    }\n\n    function shouldClickLater(ua) {\n        // android below 4.4\n        var m = ua.match(/Android[^\\d]*(\\d+)\\.(\\d+)/);\n        if (m && m.length > 2) {\n            return parseInt(m[1]) < 4 || (parseInt(m[1]) === 4 && parseInt(m[2]) < 4);\n        }\n\n        // safari on windows\n        return /.*Windows.*Safari.*/.test(ua);\n    }\n\n    ngFileUpload.validate = function (scope, $parse, attr, file, evt) {\n        function globStringToRegex(str) {\n            if (str.length > 2 && str[0] === '/' && str[str.length - 1] === '/') {\n                return str.substring(1, str.length - 1);\n            }\n            var split = str.split(','), result = '';\n            if (split.length > 1) {\n                for (var i = 0; i < split.length; i++) {\n                    result += '(' + globStringToRegex(split[i]) + ')';\n                    if (i < split.length - 1) {\n                        result += '|';\n                    }\n                }\n            } else {\n                if (str.indexOf('.') === 0) {\n                    str = '*' + str;\n                }\n                result = '^' + str.replace(new RegExp('[.\\\\\\\\+*?\\\\[\\\\^\\\\]$(){}=!<>|:\\\\' + '-]', 'g'), '\\\\$&') + '$';\n                result = result.replace(/\\\\\\*/g, '.*').replace(/\\\\\\?/g, '.');\n            }\n            return result;\n        }\n\n        var accept = $parse(attr.ngfAccept)(scope, {$file: file, $event: evt});\n        var fileSizeMax = $parse(attr.ngfMaxSize)(scope, {$file: file, $event: evt}) || 9007199254740991;\n        var fileSizeMin = $parse(attr.ngfMinSize)(scope, {$file: file, $event: evt}) || -1;\n        if (accept != null && angular.isString(accept)) {\n            var regexp = new RegExp(globStringToRegex(accept), 'gi');\n            accept = (file.type != null && regexp.test(file.type.toLowerCase())) ||\n                (file.name != null && regexp.test(file.name.toLowerCase()));\n        }\n        return (accept == null || accept) && (file.size == null || (file.size < fileSizeMax && file.size > fileSizeMin));\n    };\n\n    ngFileUpload.updateModel = function ($parse, $timeout, scope, ngModel, attr, fileChange,\n                                         files, rejFiles, evt, noDelay) {\n        function update() {\n            if ($parse(attr.ngfKeep)(scope) === true) {\n                var prevFiles = (ngModel.$modelValue || []).slice(0);\n                if (!files || !files.length) {\n                    files = prevFiles;\n                } else if ($parse(attr.ngfKeepDistinct)(scope) === true) {\n                    var len = prevFiles.length;\n                    for (var i = 0; i < files.length; i++) {\n                        for (var j = 0; j < len; j++) {\n                            if (files[i].name === prevFiles[j].name) break;\n                        }\n                        if (j === len) {\n                            prevFiles.push(files[i]);\n                        }\n                    }\n                    files = prevFiles;\n                } else {\n                    files = prevFiles.concat(files);\n                }\n            }\n            if (ngModel) {\n                $parse(attr.ngModel).assign(scope, files);\n                $timeout(function () {\n                    if (ngModel) {\n                        ngModel.$setViewValue(files != null && files.length === 0 ? null : files);\n                    }\n                });\n            }\n            if (attr.ngModelRejected) {\n                $parse(attr.ngModelRejected).assign(scope, rejFiles);\n            }\n            if (fileChange) {\n                $parse(fileChange)(scope, {\n                    $files: files,\n                    $rejectedFiles: rejFiles,\n                    $event: evt\n                });\n            }\n        }\n\n        if (noDelay) {\n            update();\n        } else {\n            $timeout(function () {\n                update();\n            });\n        }\n    };\n\n    var validate = ngFileUpload.validate;\n    var updateModel = ngFileUpload.updateModel;\n\n})();\n\n(function () {\n  var validate = ngFileUpload.validate;\n  var updateModel = ngFileUpload.updateModel;\n\n  ngFileUpload.directive('ngfDrop', ['$parse', '$timeout', '$location', function ($parse, $timeout, $location) {\n    return {\n      restrict: 'AEC',\n      require: '?ngModel',\n      link: function (scope, elem, attr, ngModel) {\n        linkDrop(scope, elem, attr, ngModel, $parse, $timeout, $location);\n      }\n    };\n  }]);\n\n  ngFileUpload.directive('ngfNoFileDrop', function () {\n    return function (scope, elem) {\n      if (dropAvailable()) elem.css('display', 'none');\n    };\n  });\n\n  ngFileUpload.directive('ngfDropAvailable', ['$parse', '$timeout', function ($parse, $timeout) {\n    return function (scope, elem, attr) {\n      if (dropAvailable()) {\n        var fn = $parse(attr.ngfDropAvailable);\n        $timeout(function () {\n          fn(scope);\n          if (fn.assign) {\n            fn.assign(scope, true);\n          }\n        });\n      }\n    };\n  }]);\n\n  function linkDrop(scope, elem, attr, ngModel, $parse, $timeout, $location) {\n    var available = dropAvailable();\n    if (attr.dropAvailable) {\n      $timeout(function () {\n        if (scope[attr.dropAvailable]) {\n          scope[attr.dropAvailable].value = available;\n        } else {\n          scope[attr.dropAvailable] = available;\n        }\n      });\n    }\n    if (!available) {\n      if ($parse(attr.ngfHideOnDropNotAvailable)(scope) === true) {\n        elem.css('display', 'none');\n      }\n      return;\n    }\n\n    var disabled = false;\n    if (attr.ngfDrop.search(/\\W+$files\\W+/) === -1) {\n      scope.$watch(attr.ngfDrop, function(val) {\n        disabled = val === false;\n      });\n    }\n\n    var leaveTimeout = null;\n    var stopPropagation = $parse(attr.ngfStopPropagation);\n    var dragOverDelay = 1;\n    var actualDragOverClass;\n\n    elem[0].addEventListener('dragover', function (evt) {\n      if (elem.attr('disabled') || disabled) return;\n      evt.preventDefault();\n      if (stopPropagation(scope)) evt.stopPropagation();\n      // handling dragover events from the Chrome download bar\n      if (navigator.userAgent.indexOf('Chrome') > -1) {\n        var b = evt.dataTransfer.effectAllowed;\n        evt.dataTransfer.dropEffect = ('move' === b || 'linkMove' === b) ? 'move' : 'copy';\n      }\n      $timeout.cancel(leaveTimeout);\n      if (!scope.actualDragOverClass) {\n        actualDragOverClass = calculateDragOverClass(scope, attr, evt);\n      }\n      elem.addClass(actualDragOverClass);\n    }, false);\n    elem[0].addEventListener('dragenter', function (evt) {\n      if (elem.attr('disabled') || disabled) return;\n      evt.preventDefault();\n      if (stopPropagation(scope)) evt.stopPropagation();\n    }, false);\n    elem[0].addEventListener('dragleave', function () {\n      if (elem.attr('disabled') || disabled) return;\n      leaveTimeout = $timeout(function () {\n        elem.removeClass(actualDragOverClass);\n        actualDragOverClass = null;\n      }, dragOverDelay || 1);\n    }, false);\n    elem[0].addEventListener('drop', function (evt) {\n      if (elem.attr('disabled') || disabled) return;\n      evt.preventDefault();\n      if (stopPropagation(scope)) evt.stopPropagation();\n      elem.removeClass(actualDragOverClass);\n      actualDragOverClass = null;\n      extractFiles(evt, function (files, rejFiles) {\n        updateModel($parse, $timeout, scope, ngModel, attr,\n          attr.ngfChange || attr.ngfDrop, files, rejFiles, evt);\n      }, $parse(attr.ngfAllowDir)(scope) !== false, attr.multiple || $parse(attr.ngfMultiple)(scope));\n    }, false);\n\n    function calculateDragOverClass(scope, attr, evt) {\n      var accepted = true;\n      var items = evt.dataTransfer.items;\n      if (items != null) {\n        for (var i = 0; i < items.length && accepted; i++) {\n          accepted = accepted &&\n            (items[i].kind === 'file' || items[i].kind === '') &&\n            validate(scope, $parse, attr, items[i], evt);\n        }\n      }\n      var clazz = $parse(attr.ngfDragOverClass)(scope, {$event: evt});\n      if (clazz) {\n        if (clazz.delay) dragOverDelay = clazz.delay;\n        if (clazz.accept) clazz = accepted ? clazz.accept : clazz.reject;\n      }\n      return clazz || attr.ngfDragOverClass || 'dragover';\n    }\n\n    function extractFiles(evt, callback, allowDir, multiple) {\n      var files = [], rejFiles = [], items = evt.dataTransfer.items, processing = 0;\n\n      function addFile(file) {\n        if (validate(scope, $parse, attr, file, evt)) {\n          files.push(file);\n        } else {\n          rejFiles.push(file);\n        }\n      }\n\n      function traverseFileTree(files, entry, path) {\n        if (entry != null) {\n          if (entry.isDirectory) {\n            var filePath = (path || '') + entry.name;\n            addFile({name: entry.name, type: 'directory', path: filePath});\n            var dirReader = entry.createReader();\n            var entries = [];\n            processing++;\n            var readEntries = function () {\n              dirReader.readEntries(function (results) {\n                try {\n                  if (!results.length) {\n                    for (var i = 0; i < entries.length; i++) {\n                      traverseFileTree(files, entries[i], (path ? path : '') + entry.name + '/');\n                    }\n                    processing--;\n                  } else {\n                    entries = entries.concat(Array.prototype.slice.call(results || [], 0));\n                    readEntries();\n                  }\n                } catch (e) {\n                  processing--;\n                  console.error(e);\n                }\n              }, function () {\n                processing--;\n              });\n            };\n            readEntries();\n          } else {\n            processing++;\n            entry.file(function (file) {\n              try {\n                processing--;\n                file.path = (path ? path : '') + file.name;\n                addFile(file);\n              } catch (e) {\n                processing--;\n                console.error(e);\n              }\n            }, function () {\n              processing--;\n            });\n          }\n        }\n      }\n\n      if (items && items.length > 0 && $location.protocol() !== 'file') {\n        for (var i = 0; i < items.length; i++) {\n          if (items[i].webkitGetAsEntry && items[i].webkitGetAsEntry() && items[i].webkitGetAsEntry().isDirectory) {\n            var entry = items[i].webkitGetAsEntry();\n            if (entry.isDirectory && !allowDir) {\n              continue;\n            }\n            if (entry != null) {\n              traverseFileTree(files, entry);\n            }\n          } else {\n            var f = items[i].getAsFile();\n            if (f != null) addFile(f);\n          }\n          if (!multiple && files.length > 0) break;\n        }\n      } else {\n        var fileList = evt.dataTransfer.files;\n        if (fileList != null) {\n          for (var j = 0; j < fileList.length; j++) {\n            addFile(fileList.item(j));\n            if (!multiple && files.length > 0) {\n              break;\n            }\n          }\n        }\n      }\n      var delays = 0;\n      (function waitForProcess(delay) {\n        $timeout(function () {\n          if (!processing) {\n            if (!multiple && files.length > 1) {\n              i = 0;\n              while (files[i].type === 'directory') i++;\n              files = [files[i]];\n            }\n            callback(files, rejFiles);\n          } else {\n            if (delays++ * 10 < 20 * 1000) {\n              waitForProcess(10);\n            }\n          }\n        }, delay || 0);\n      })();\n    }\n  }\n\n  ngFileUpload.directive('ngfSrc', ['$parse', '$timeout', function ($parse, $timeout) {\n    return {\n      restrict: 'AE',\n      link: function (scope, elem, attr) {\n        if (window.FileReader) {\n          scope.$watch(attr.ngfSrc, function (file) {\n            if (file &&\n              validate(scope, $parse, attr, file, null) &&\n              (!window.FileAPI || navigator.userAgent.indexOf('MSIE 8') === -1 || file.size < 20000) &&\n              (!window.FileAPI || navigator.userAgent.indexOf('MSIE 9') === -1 || file.size < 4000000)) {\n              $timeout(function () {\n                //prefer URL.createObjectURL for handling refrences to files of all sizes\n                //since it doesn´t build a large string in memory\n                var URL = window.URL || window.webkitURL;\n                if (URL && URL.createObjectURL) {\n                  elem.attr('src', URL.createObjectURL(file));\n                } else {\n                  var fileReader = new FileReader();\n                  fileReader.readAsDataURL(file);\n                  fileReader.onload = function (e) {\n                    $timeout(function () {\n                      elem.attr('src', e.target.result);\n                    });\n                  };\n                }\n              });\n            } else {\n              elem.attr('src', attr.ngfDefaultSrc || '');\n            }\n          });\n        }\n      }\n    };\n  }]);\n\n  function dropAvailable() {\n    var div = document.createElement('div');\n    return ('draggable' in div) && ('ondrop' in div);\n  }\n\n})();\n"]}